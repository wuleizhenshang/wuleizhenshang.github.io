<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android提问问答 | Blog-无泪真伤</title><meta name="author" content="无泪真伤"><meta name="copyright" content="无泪真伤"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="转存自下面路径，转载用大佬的原文https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_29966203&#x2F;article&#x2F;details&#x2F;123868018?spm&#x3D;1001.2014.3001.5502 上 SD卡  路径 1234a).Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED) 	&#x2F;&#x2F;sd卡挂载状态">
<meta property="og:type" content="article">
<meta property="og:title" content="Android提问问答">
<meta property="og:url" content="https://www.wuleizhenshang.love/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/index.html">
<meta property="og:site_name" content="Blog-无泪真伤">
<meta property="og:description" content="转存自下面路径，转载用大佬的原文https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_29966203&#x2F;article&#x2F;details&#x2F;123868018?spm&#x3D;1001.2014.3001.5502 上 SD卡  路径 1234a).Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED) 	&#x2F;&#x2F;sd卡挂载状态">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://smms.app/image/tPiv5zLXgsfGWmn">
<meta property="article:published_time" content="2025-01-03T12:19:12.000Z">
<meta property="article:modified_time" content="2025-01-03T12:22:30.087Z">
<meta property="article:author" content="无泪真伤">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://smms.app/image/tPiv5zLXgsfGWmn"><link rel="shortcut icon" href="/img/86634.jpg"><link rel="canonical" href="https://www.wuleizhenshang.love/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 无泪真伤","link":"链接: ","source":"来源: Blog-无泪真伤","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android提问问答',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-03 20:22:30'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic.imgdb.cn/item/65582252c458853aeff7c6f5.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://smms.app/image/tPiv5zLXgsfGWmn')"><nav id="nav"><span id="blog-info"><a href="/" title="Blog-无泪真伤"><span class="site-name">Blog-无泪真伤</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android提问问答</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-03T12:19:12.000Z" title="发表于 2025-01-03 20:19:12">2025-01-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-03T12:22:30.087Z" title="更新于 2025-01-03 20:22:30">2025-01-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android%E9%9D%A2%E8%AF%95/">Android面试</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android%E9%9D%A2%E8%AF%95/Android%E7%9F%A5%E8%AF%86/">Android知识</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>138分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Android提问问答"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>转存自下面路径，转载用大佬的原文</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29966203/article/details/123868018?spm=1001.2014.3001.5502">https://blog.csdn.net/qq_29966203/article/details/123868018?spm=1001.2014.3001.5502</a></p>
<h3 id="上"><a href="#上" class="headerlink" title="上"></a>上</h3><ol>
<li>SD卡</li>
</ol>
<p>路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a).Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED) 	<span class="comment">//sd卡挂载状态</span></span><br><span class="line">  b).Environment.getExternalStorageDirectory().getPath()	<span class="comment">//sd卡路径 -&gt;/storage/emulated/0</span></span><br><span class="line">  c).Environment.getDownloadCacheDirectory().getPath()	<span class="comment">//data/cache路径</span></span><br><span class="line">  d).Environment.getDataDirectory().getPath()			<span class="comment">//data</span></span><br></pre></td></tr></table></figure>

<p>权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=“android.permission.WRITE_EXTERNAL_STORAGE”/&gt;</span><br><span class="line">  &lt;uses-permission android:name=“android.permission.MOUNT_UNMOUNT_FILESYSTEMS”/&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>android的数据存储方式</li>
</ol>
<ul>
<li>文件存储<br>a).InputStream getResouces().openRawResource(int id) &#x2F;&#x2F;返回InputStream,针对res&#x2F;raw<br>b).InputStream getAssets().open(String path) &#x2F;&#x2F;open(“img&#x2F;smail.jpg”)<br>c).Bitmap BitmapFactory.decodeResouce(resources,int,option)</li>
<li>xml、SharedPreference<br>&#x2F;&#x2F;1).SharedPreference位于data&#x2F;data&#x2F;包名&#x2F;shared_prefs的xxx.xml文件</li>
<li>SQLiteDatabase</li>
<li>ContentProvider</li>
<li>网络</li>
</ul>
<ol>
<li>BroadcastReceiver</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//隐式广播需要在manifest中加上</span></span><br><span class="line">&gt;&gt;<span class="keyword">class</span> <span class="title class_">Receiver</span>:BroadcastReceiver&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     。           <span class="comment">//自定义监听器</span></span><br><span class="line">    onReceive(context:Context?,intent:Intent?)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	val action=intent.getAction()</span><br><span class="line">        when(action)-&gt;&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;IntentFilter <span class="keyword">if</span>=IntentFilter() 	 	<span class="comment">//动态注册广播</span></span><br><span class="line">  <span class="keyword">if</span>.addAction(<span class="string">&quot;action1&quot;</span>)</span><br><span class="line">  registerReceiver(re:BroadcastReceiver,<span class="keyword">if</span>)</span><br><span class="line">  </span><br><span class="line">  override fun <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    unregisterReceiver(re:BroadcastReceiver)</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;隐式广播(通过action和category匹配)</span><br><span class="line">  :<span class="number">1.</span>在Manifest上添加&lt;category android:name=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span><br><span class="line">  :<span class="number">2.</span>标识为android.intent.category.LAUNCHER，则不用添加DEFAULT</span><br><span class="line">&gt;&gt;sendBroadcast(intent)			<span class="comment">//发送普通广播,静态注册必须描述action标签</span></span><br><span class="line">  :<span class="number">1.</span>val intent=Intent()</span><br><span class="line">     intent.action=<span class="string">&quot;&quot;</span></span><br><span class="line">     intent.addCategory()</span><br><span class="line">     </span><br><span class="line">&gt;&gt;sendOrderedBroadcast(intent,receivePermission)			<span class="comment">//发送有序广播</span></span><br><span class="line">  a).&lt;receiver android:name=<span class="string">&quot;.smsReceiver&quot;</span>&gt;  </span><br><span class="line">       &lt;intent-filter android:priority=<span class="string">&quot;1000&quot;</span>&gt;  </span><br><span class="line">         &lt;action android:name=<span class="string">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>/&gt;  </span><br><span class="line">       &lt;/intent-filter&gt;  </span><br><span class="line">     &lt;/receiver&gt;  </span><br><span class="line">  b).setResultExtras(bundle:Bundle)			<span class="comment">//后续广播通过getResultExtras(true)取回Bundle</span></span><br><span class="line">  c).abortBroadcast()				<span class="comment">//终止广播传递</span></span><br><span class="line">&gt;&gt;sendStickyBroadcast(intent)			<span class="comment">//发送粘性广播,粘性广播以最后一次的内容进行保留</span></span><br><span class="line">  :<span class="number">1.</span>removeStickyBroadcast(intent)		</span><br><span class="line">  :<span class="number">2.</span>在Manifest中声明android.permission.BROADCAST_STICKY</span><br></pre></td></tr></table></figure>

<ol>
<li>sp频繁操作会有什么后果?sp能存多少数据?</li>
</ol>
<p>sp的底层由xml来实现，操作sp的过程就是xml的序列化和解析。xml是存在磁盘上的，因此要考虑io速度。另外dvm的内存是有限的，同时dvm的堆内存为16M，所以不能超过此数字</p>
<ol>
<li>dvm与jvm的区别</li>
</ol>
<p>架构不同</p>
<ul>
<li>JVM基于栈则意味着需要去栈中读写数据</li>
<li>DVM是基于寄存器的</li>
</ul>
<p>字节码的执行顺序不同</p>
<ul>
<li>执行顺序为： .java文件 -&gt; .class文件 -&gt; .jar文件</li>
<li>java文件 –&gt;.class文件-&gt; .dex文件</li>
<li>每个应用都运行在一个DVM实例中，且一个DVM运行在一个独立的进程空间</li>
</ul>
<p>dvm的垃圾回收</p>
<ul>
<li>采用标记清除<br>缺点：容易产生很多彼此分隔的小内存块</li>
<li>dvm可划分为Active Heap+Zygote Heap+Card Table+Live Heap Bitmap+MARK HEAP Bitamp<br>-&gt;Zygote Heap 为初始时的进程，而应用程序是由Zygote fork出来的<br>-&gt;当创建了应用程序后，会从Zygote heap分出一部分创建Active Heap，之后分配的对象都在Active堆进行<br>-&gt;堆的垃圾回收标记 采用Heap Bitmap位图来存储,划分为Live + Mark<br>-&gt;垃圾回收遍历采用递归，垃圾回收的标准为Live&#x3D;1,Mark&#x3D;0<br>-&gt;垃圾回收的两个阶段，第一个阶段标记根对象 (静态对象、栈、全局变量、寄存器)，不允许其他线程运行<br>第二个阶段遍历被根对象所引用的对象，并标记，此时为Concurrent GC<br>-&gt;CardTable,用位图标识第二阶段需要被重新标记的对象，在第二阶段完成后继续标记，此时禁止其他线程</li>
</ul>
<ol>
<li>ART</li>
</ol>
<p>&#x2F;&#x2F;android4.4之后采用ART作为虚拟机<br>GC算法分为多种<br>:1.Mark-Sweep GC,标记-清楚<br>:2.Compacting GC,标记-压缩<br>新生代采用复制算法，老年代采用标记压缩 &#x2F;&#x2F;复制算法：内存分为相等的两块，一块用于分配</p>
<ol>
<li>Activity的生命周期</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结合ActivityThread</span></span><br><span class="line">-&gt;onCreate	创建时执行</span><br><span class="line">  a).mInstrumentation.callActivityOnCreate</span><br><span class="line">  b).performStart</span><br><span class="line">  c).mInstrumentation.callActivityOnRestoreInstanceState</span><br><span class="line">  </span><br><span class="line">-&gt;onStart	可见时执行</span><br><span class="line">-&gt;onResume	获取焦点时执行</span><br><span class="line">  a).handleResumeActivity</span><br><span class="line">     &gt;performResumeActivity</span><br><span class="line">-&gt;onPause	失去焦点时执行</span><br><span class="line">  a).handlePauseActivity</span><br><span class="line">     &gt;performPauseActivity</span><br><span class="line">      &gt;<span class="keyword">if</span>(!r.activity.mFinished&amp;&amp;r.saveState)</span><br><span class="line">	mInstrumentation.callActivityOnSaveInstanceState</span><br><span class="line">-&gt;onStop	不可见时执行</span><br><span class="line">  a).handleStopActivity</span><br><span class="line">     &gt;performStopActivityInner </span><br><span class="line">       &gt;performPauseActivityIfNeeded</span><br><span class="line">-&gt;onDestroy	销毁</span><br><span class="line">  a).handleDestroyActivity</span><br><span class="line">-&gt;案例分析:Activity A -&gt; Activity B</span><br><span class="line">  :<span class="number">1.</span>Activity A的创建，A::onCreate , A:onStart ,A:onResume</span><br><span class="line">  :<span class="number">2.</span>跳转 , A:onPause ,B::onCreate,B:onStart,B:onResume,A:onStop</span><br><span class="line">  :<span class="number">3.</span>Activity B返回,B:onPause,A:onRestart,A:onStart,A:onResume,B:onStop,B:onDestroy</span><br></pre></td></tr></table></figure>

<ol>
<li>Application能不能启动Activity</li>
</ol>
<p>startActivity(intent:Intent,FLAG_ACTIVITY_NEW_TASK)<br>standard模式启动的Activity,该实例会存放在启动该Activity的Activity所在的任务栈中，而 ApplicationContext不存放在任务栈中</p>
<ol>
<li>Activity的状态都有哪些</li>
</ol>
<p>-&gt;foreground activity<br>-&gt;visible activity<br>-&gt;background activity<br>-&gt;empty process</p>
<ol>
<li>横竖屏切换时Activity的生命周期</li>
</ol>
<ul>
<li>在没有配置activity的configChanges属性时<br>Activity的生命周期:onPause-&gt;onStop-&gt;onCreate-&gt;onStart-&gt;onResume</li>
<li>配置了activity的configChanges<br>onConfigurationChanged</li>
</ul>
<ol>
<li>如何设置activity成窗口样式</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:theme=“<span class="meta">@android</span>:style/Theme.Dialog”</span><br></pre></td></tr></table></figure>

<ol>
<li>Activity的启动方式</li>
</ol>
<ul>
<li>standard 不管有没有已存在的实例，都生成新实例</li>
<li>singleTop 如果发现有对应的Activity实例位于栈顶，则重复利用，否则创建实例</li>
<li>singleTask<br>a)栈内复用，复用时具有clearTop机制<br>b)single taskAffinity in task</li>
<li>singleInstance<br>a)启用一个新的栈结构，将Activity放置于栈结构中，并保证不会有其它Activity实例进入<br>b)方便多个应用共享全局唯一的实例</li>
</ul>
<ol>
<li>Service的生命周期</li>
</ol>
<p>通过startService调用 onCreate-&gt;onStartCommand-&gt;onDestroy<br>通过bindService调用 onCreate-&gt;onBind-&gt;onUnbind-&gt;onDestroy</p>
<p>Service Binder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="comment">//示例</span></span><br><span class="line">  a).<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalService</span> <span class="keyword">extends</span> <span class="title class_">Service</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> LBinder binder=<span class="keyword">new</span> <span class="title class_">LBinder</span>();			<span class="comment">//必须声明为static</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">	&#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">return</span> binder;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LBinder</span> <span class="keyword">extends</span> <span class="title class_">Binder</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    <span class="keyword">return</span> count;</span><br><span class="line"> 	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>IntentService</li>
</ol>
<p>&#x2F;&#x2F;开启线程处理耗时操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;onCreate 				<span class="comment">//创建单独的HandlerThread处理所有的intent请求</span></span><br><span class="line">  :<span class="number">1.</span><span class="type">HandlertThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandlerThread</span>(<span class="string">&quot;&quot;</span>) </span><br><span class="line">     thread.start()</span><br><span class="line">     mServiceLooper =thread.getLooper()</span><br><span class="line">     mServiceHandler =<span class="keyword">new</span> <span class="title class_">ServiceHandler</span>(mServiceLooper)</span><br></pre></td></tr></table></figure>

<p>onSTartCommand.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">onStartCommand</span><span class="params">(Intent intent,<span class="type">int</span> startId)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	onStart(intent,startId)</span><br><span class="line">	<span class="keyword">return</span> mRedelivery?START_REDELIVER_INTENT:START_NOT_STICKY;<span class="comment">//在于service挂掉了intent是否会回传</span></span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">2.</span><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">(Intent intent,<span class="type">int</span> startId)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Message msg=mServiceHandler.obtainMessage()</span><br><span class="line">        msg.obj=intent</span><br><span class="line">	msg.arg1=startId</span><br><span class="line">	mServiceHandler.sendMessage(msg)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>ServiceHandler.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//onHandleIntent,为自定义的类所实现的耗时操作</span></span><br><span class="line">  :<span class="number">1.</span><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ServiceHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ServiceHandler</span><span class="params">(Looper looper)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="built_in">super</span>(looper);&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span></span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  onHandleIntent((Intent)msg.obj)</span><br><span class="line">	  stopSelf(msg.arg1)<span class="comment">//当id为最后一个startService的startId时，进行关闭</span></span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>总结<br>a).通过HandlerThread创建线程,并调用getLooper获取looper变量，以新建Handler<br>b).IntentService通过onStartCommand接收新的intent，并放在message.obj发送过handler<br>c).handler调用实现的onHandleIntent(intent)<br>d).Message msg&#x3D;mServiceHandler.obtainMessage()<br>&#x2F;&#x2F;obtainMessage和Looper调用msg.relycleUnchecked是以插入链表头部和拆除的形式分配、释放Message资源</p>
<ol>
<li>Fragment和Activity的onCreateOptionsMenu</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;override fun <span class="title function_">onCreateOptionsMenu</span><span class="params">(menu:Menu)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    getMenuInflater.inflate(R.menu.menu1,menu)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onCreateOptionsMenu(menu)</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;setHasOptionsMenu(<span class="literal">true</span>)	<span class="comment">//Fragment onCreate</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Service的onStartCommand有几种返回值</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;START_STICKY	当Service因内存不足被系统kill掉后，会尝试重建Service，创建成功后回调onStartCommand，但Intent是空的</span><br><span class="line">&gt;&gt;START_NOT_STICKY 系统不会尝试重建Service</span><br><span class="line">&gt;&gt;START_REDELIVER_INTENT	重建Service并传递最后一次Intent</span><br></pre></td></tr></table></figure>

<ol>
<li>Service的onRebind什么情况下执行</li>
</ol>
<ul>
<li>当Service刚启动时，通过调用bindService都会进入Service的onBind回调</li>
<li>在Service启动过后，再进行绑定进入onRebind，并在onUnbind返回true</li>
</ul>
<ol>
<li>Handler防止内存泄露</li>
</ol>
<ul>
<li>原因<br>a).声明Handler为静态类，同时对于Activity的this引用封装成WeakReference<br>否则会导致匿名类引用了外部Activity，导致Activity不能被回收<br>b).如果这时对手机硬件进行横竖屏切换，讲导致Activity被创建，却不能被回收</li>
<li>措施</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">a).<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	mHandler.removeCallbacksAndMessages(<span class="literal">null</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&gt;&gt;<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    WeakReference&lt;Activity &gt; mActivityReference;</span><br><span class="line"></span><br><span class="line">    MyHandler(Activity activity) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        mActivityReference= <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;Activity&gt;(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">final</span> <span class="type">Activity</span> <span class="variable">activity</span> <span class="operator">=</span> mActivityReference.get();</span><br><span class="line">        <span class="keyword">if</span> (activity != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            mImageView.setImageBitmap(mBitmap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>IntentFilter的匹配法则</li>
</ol>
<ul>
<li>action &#x2F;&#x2F;匹配manifest中的其中一个</li>
<li>data &#x2F;&#x2F;如果manifest声明了data匹配，则隐式intent必须设置data</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;data android:scheme=‘content’ host=‘pwcong.me’ path=‘/hello’ port=‘<span class="number">8080</span>’&gt;</span><br><span class="line">     Uri.parse(‘content:<span class="comment">//pwcong.me:8080/hello&#x27;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>category<br>&#x2F;&#x2F;隐式Intent可以没有category<br>a).隐式intent默认添加 android.intent.category.DEFAULT<br>b).AndroidManifest<br>c).隐式intent设置的category必须全部能匹配命中</li>
</ul>
<blockquote>
<p>例子 :1.val uri&#x3D;Uri.parse(“<a target="_blank" rel="noopener" href="http://www.baidu.com/2.jsp%E2%80%9D">http://www.baidu.com:80/2.jsp”</a>)<br>val intent&#x3D;Intent()<br>intent.setDataAndType(uri,“abc&#x2F;eft”)</p>
</blockquote>
<p>19.Fragment与Activity传值</p>
<ul>
<li>接口或者方法调用<br>:1.在Fragment中可以通过getActivity()直接获得其绑定的Activity</li>
<li>通过fragmentManager查找<br>:1.在Activity中可以通过FragmentManager获取fragment的实例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FragmentManager fragmentManager=getFragmentManager()</span><br><span class="line"> Fragment fragment=fragmentManager.findFragmentByTag(tag)</span><br><span class="line"> Fragment fragment=fragmentManager.findFragmentById(id)</span><br></pre></td></tr></table></figure>

<p>:2.fragment的入栈行为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Fragment oneFragment=OneFragment.newInstance(arg1:String,arg2:String)</span><br><span class="line"> val transaction=getFragmentManager().beginTransaction()</span><br><span class="line"> transaction.replace(R.id.frament_hodler,oneFragment,tag:String?)</span><br><span class="line"> transaction.addToBackStack(<span class="literal">null</span>)</span><br><span class="line"> transaction.commit()</span><br></pre></td></tr></table></figure>

<p>20.Fragment 生命周期</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;onAttach						<span class="comment">//Fragment与Activity发生关联</span></span><br><span class="line">&gt;&gt;onCreate</span><br><span class="line">&gt;&gt;onCreateView(LayoutInflater,ViewGroup,Bundle)	<span class="comment">//创建Fragment视图</span></span><br><span class="line">&gt;&gt;onActivityCreated(Bundle)				<span class="comment">//当Activity的onCreate执行完</span></span><br><span class="line">&gt;&gt;onStart-&gt;onResume-&gt;onPause-&gt;onStop</span><br><span class="line">&gt;&gt;onDestroyView						<span class="comment">//Fragment视图被移除</span></span><br><span class="line">&gt;&gt;onDetach</span><br><span class="line">&gt;&gt;Fragment使用</span><br><span class="line">  a).<span class="comment">//静态</span></span><br><span class="line">	&lt;RelativeLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">          xmlns:tools=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>  </span><br><span class="line">          android:layout_width=<span class="string">&quot;match_parent&quot;</span>  </span><br><span class="line">          android:layout_height=<span class="string">&quot;match_parent&quot;</span> &gt;  </span><br><span class="line">  </span><br><span class="line">        &lt;fragment  </span><br><span class="line">          android:id=<span class="string">&quot;@+id/id_fragment_title&quot;</span>  </span><br><span class="line">          android:name=<span class="string">&quot;com.zhy.zhy_fragments.TitleFragment&quot;</span>  </span><br><span class="line">          android:layout_width=<span class="string">&quot;fill_parent&quot;</span>  </span><br><span class="line">          android:layout_height=<span class="string">&quot;45dp&quot;</span> /&gt;  </span><br><span class="line">  </span><br><span class="line">        &lt;fragment  </span><br><span class="line">          android:layout_below=<span class="string">&quot;@id/id_fragment_title&quot;</span>  </span><br><span class="line">          android:id=<span class="string">&quot;@+id/id_fragment_content&quot;</span>  </span><br><span class="line">          android:name=<span class="string">&quot;com.zhy.zhy_fragments.ContentFragment&quot;</span>  </span><br><span class="line">          android:layout_width=<span class="string">&quot;fill_parent&quot;</span>  </span><br><span class="line">          android:layout_height=<span class="string">&quot;fill_parent&quot;</span> /&gt;  </span><br><span class="line">        &lt;/RelativeLayout&gt;  </span><br><span class="line">  b).<span class="comment">//动态</span></span><br><span class="line">    a).<span class="type">FragmentManager</span> <span class="variable">fm</span> <span class="operator">=</span> getFragmentManager();	</span><br><span class="line">       ContentFragment contentFragment=(ContentFragment)fm.findFragmentById(R.id.id_fragment_container)</span><br><span class="line">       <span class="keyword">if</span>(contentFragment==<span class="literal">null</span>)</span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  contentFragment=<span class="keyword">new</span> <span class="title class_">ContentFragment</span>();</span><br><span class="line">          fm.beginTransaction().add(R.id.id_fragment_container,contentFragment).commit();</span><br><span class="line">       &#125;</span><br><span class="line">    b).宿主Activity必须实现OnFragmentInteractionListener</span><br><span class="line">&gt;&gt;ActivityThread关于Fragment的回调</span><br><span class="line">  a).Activity持有mFragments</span><br><span class="line">	<span class="comment">//FragmentController mFragments = FragmentController.createController(new HostCallbacks())</span></span><br><span class="line">  b).HostCallbacks的初始化	<span class="comment">//class HostCallbacks extends FragmentHostCallback&lt;Activity&gt;</span></span><br><span class="line">     &gt;<span class="keyword">public</span> <span class="title function_">HostCallbacks</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="built_in">super</span>(Activity.<span class="built_in">this</span>)	<span class="comment">//因为HostCallbacks为Activity的内部类</span></span><br><span class="line">      &#125;</span><br><span class="line">  c).FragmentHostCallback</span><br><span class="line">     &gt;FragmentHostCallback(Activity activity)</span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   &gt; FragmentHostCallback(activity,context,handler,windowAnimations) -&gt;</span><br><span class="line">	     mActivity=activity</span><br><span class="line">	     mContext=context</span><br><span class="line">	     mHandler=handler</span><br><span class="line">      &#125;</span><br><span class="line">     &gt;成员FragmentManagerImpl</span><br><span class="line">  d).FragmentController</span><br><span class="line">     &gt;<span class="keyword">private</span> <span class="title function_">FragmentController</span><span class="params">(FragmentHostCallback&lt;?&gt; callbacks)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       <span class="comment">//至此,mFragments持有HostCallbacks</span></span><br><span class="line">        mHost = callbacks;</span><br><span class="line">      &#125;</span><br><span class="line">  e).ActivityThread::performLaunchActivity</span><br><span class="line">     &gt;attach…</span><br><span class="line">     &gt;mFragments.attachHost(<span class="literal">null</span>)	<span class="comment">//主要是让mFragmentManager持有对外部HostCallbacks对象</span></span><br><span class="line">     Activity::performCreate		<span class="comment">//1.onCreate(bundle) 2.performCreateCommon()</span></span><br><span class="line">     Activity::onCreate		<span class="comment">//一般通过动态添加fragment时，都会在此调用getFragmentManager</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="built_in">super</span>.onCreate(savedInstanceState)</span><br><span class="line">		<span class="comment">//mFragments.dispatchCreate()-&gt;mFragmentManagerImpl.dispatchCreate()</span></span><br><span class="line">		<span class="comment">//FragmentmnagerImpl::mCurState=Fragment.CREATED</span></span><br><span class="line">	getFragmentManager()	<span class="comment">//mFragments.getFragmentManager()-&gt; mHost.getFragmentManagerImpl()</span></span><br><span class="line">         .beginTransaction()	<span class="comment">//生成BackStackRecord,并让其持有FragmentManagerImpl对象</span></span><br><span class="line">         .replace(R.id.container,mContentFragment)</span><br><span class="line">		<span class="comment">//fragment.mContainerId =containerViewId</span></span><br><span class="line">		<span class="comment">//Op op = new Op() -&gt; op.cmd = opcmd -&gt; op.fragment = fragment -&gt; addOp(op)</span></span><br><span class="line">         .commit();<span class="comment">//</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Fragment的add和replace的区别 &#x2F;&#x2F;replace&#x3D;&#x3D;remove|append</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;	transaction.add(R.id.fragment_container, oneFragment).commit()</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一个参为容器id，第二个为需要添加的fragment，添加不会导致容器的内容被清空，</span><br><span class="line">同一个fragment添加多次会报错,添加进去的fragment都会按层级显示，大多数情况都是与remove、hide</span><br><span class="line">搭配用</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;	replace,replace(R.id.fragment_container, oneFragment).commit();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">替换会把容器的所有内容都替换掉，只保存单独一个fragment</span><br></pre></td></tr></table></figure>

<ol>
<li>Fragment如何实现Activity栈的压栈和出栈</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;	transaction.addToBackStack(<span class="literal">null</span>)         	<span class="comment">//指定transaction对象</span></span><br><span class="line">&gt;&gt;	getSupportFragmentManager().popBackStack()</span><br></pre></td></tr></table></figure>

<ol>
<li>什么情况下造成内存泄露</li>
</ol>
<ul>
<li>资源释放问题 长期保存Context、Cursor的引用，资源得不到释放</li>
<li>对象内存过大 Bitmap文件,如decodeStream不设置inSampleSize</li>
<li>static关键字的使用<br>&#x2F;&#x2F;考虑到static声明的对象不再属于类实例，而是属于类范围，因此对象的生命周期将会延长，用WeakReference进行替换</li>
<li>线程内存溢出 1.将线程的内部类该为静态内部类，静态内部类不会对外部类对象拥有强引用<br>2.在线程内部用WeakReference去引用Context</li>
<li>采用软引用缓存图片&#x2F;&#x2F;？</li>
</ul>
<ol>
<li>图片过大导致OOM<br>等比例缩小图片<br>1.获取图片的原始宽高</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BitmapFactory.Options opts=<span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options()</span><br><span class="line">opts.inJustDecodeBounds=<span class="literal">true</span></span><br><span class="line">BitmapFactory.decodeStream(is, <span class="literal">null</span>, opts)</span><br></pre></td></tr></table></figure>

<p>2.计算图片的压缩比</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Bitmap bitmap=<span class="literal">null</span></span><br><span class="line"><span class="type">int</span> i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="keyword">if</span>(opts.width&gt;&gt;i&lt;=size&amp;&amp;opts.height&gt;&gt;I&lt;=size)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">//进行解析</span></span><br><span class="line">	BitmapFactory.Options options=<span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options()</span><br><span class="line">	options.inSampleSize=<span class="number">1</span>&lt;&lt;i</span><br><span class="line">	Bitmap bmp=<span class="literal">null</span></span><br><span class="line">        bmp=BitmapFactory.decodeStream(is,<span class="literal">null</span>,options)	</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>25.SoftReference跟WeakRefrence的区别</p>
<ul>
<li>WeakRefrence &#x3D;&gt; 与强引用对象的生命周期一致,不会增加引用计数</li>
<li>SoftReference &#x3D;&gt; 内存不足时才进行回收</li>
</ul>
<p>26.dp与px</p>
<ul>
<li>dp转px<br>a).float scale&#x3D;context.getResources().getDisplayMetrics().density<br>(int)(dpValue*scale+0.5f)</li>
<li>px转dp<br>a).float scale&#x3D;context.getResources().getDisplayMetrics().density<br>pxValue&#x2F;scale+0.5f</li>
</ul>
<p>27.设置布局为一半宽、高</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DisplayMetrics metrics=<span class="keyword">new</span> <span class="title class_">DisplayMetrics</span>()</span><br><span class="line">	getWindowManager().getDefaultDisplay().getMetrics(metrics)</span><br><span class="line">	Constant.srceenHeight = metrics.heightPixels; </span><br><span class="line">	Constant.srceenWidth = metrics.widthPixels;</span><br></pre></td></tr></table></figure>

<p>28.多分辨率支持的清单文件配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:normalScreens=“<span class="literal">true</span>”	android:smallScreens=“<span class="literal">true</span>”	</span><br><span class="line">android:xlargeScreens=“<span class="literal">true</span>”	android:anyDensity=“<span class="literal">true</span>”</span><br></pre></td></tr></table></figure>

<p>29.Android的事件分发机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件起点是DecorView</span></span><br><span class="line">ViewGroup和View的继承关系和接口</span><br><span class="line">  :<span class="number">1.</span>ViewGroup包含onInterceptTouchEvent、dispatchTouchEvent、onTouchEvent三个相关事件。</span><br><span class="line">  :<span class="number">2.</span>View包含dispatchTouchEvent、onTouchEvent两个相关事件。其中ViewGroup又继承于View。</span><br><span class="line"></span><br><span class="line">ViewGroup::dispatchTouchEvent</span><br><span class="line">  :<span class="number">1.</span>intercepted = onInterceptTouchEvent(ev)  <span class="comment">//是否截取点击touch_down事件</span></span><br><span class="line">     -&gt; 默认只有满足滑动条点击时时才返回<span class="literal">true</span>，可以重写</span><br><span class="line">     -&gt; intercepted==<span class="literal">true</span></span><br><span class="line"> 	调用<span class="built_in">super</span>.dispatchTouchEvent(et)		<span class="comment">//View父类</span></span><br><span class="line">  :<span class="number">2.</span>遍历子View</span><br><span class="line">     -&gt; ArrayList&lt;View&gt; preorderedList=buildTouchDispatchChildList()<span class="comment">//建立前序子view列表</span></span><br><span class="line">        &gt;根据子view下标进行遍历，z=elevation+translationZ</span><br><span class="line">	&gt;根据z的大小插入perorderedList</span><br><span class="line">     -&gt; 遍历子view，让其消费事件</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	View child=getAndVerifyPreorderedView(i,children)</span><br><span class="line">        <span class="keyword">if</span>(!isTransfromedTouchPointInView(x,y,child,<span class="literal">null</span>))<span class="comment">//触点不在child上</span></span><br><span class="line">		<span class="keyword">continue</span>;</span><br><span class="line">	newTouchTarget = getTouchTarget(child)	<span class="comment">//返回是否有匹配view的TouchTarget</span></span><br><span class="line">	dispatchTransformedTouchEvent(ev,..,child..)	<span class="comment">//当子View成功消费ev时，返true</span></span><br><span class="line">	&gt; offsetX=mScrollX-child.mLeft</span><br><span class="line">    	&gt; offsetY=mScrollY-child.mTop</span><br><span class="line">	&gt; <span class="type">boolean</span> handled=child.dispatchTouchEvent(event)<span class="comment">//此处递归</span></span><br><span class="line">	&gt; <span class="keyword">return</span> handled</span><br><span class="line">     -&gt; 遍历结束</span><br><span class="line">  	<span class="keyword">if</span>(dispatchTransformedTouchEvent(…))<span class="comment">//当子View在onTouch或者onTouchEvent上成功消费</span></span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     						</span><br><span class="line">	   newTouchTarget = addTouchTarget(child, idBitsToAssign)<span class="comment">//新建TouchTarget</span></span><br><span class="line">	   target.next=mFirstTouchTarget<span class="comment">//将TouchTarget插入链首</span></span><br><span class="line">	   mFristTouchTarget=target     <span class="comment">//设置为头指针</span></span><br><span class="line">	   alreadyDispatchedToNewTouchTarget=<span class="literal">true</span>.    <span class="comment">//标记成功消费MotionEvent.ACTION_DOWN</span></span><br><span class="line">	&#125;</span><br><span class="line">     -&gt; 针对MotionEvent.ACTION_UP和MontionEvent.ACTION_MOVE</span><br><span class="line">        target=mFirstTouchTarget</span><br><span class="line">	<span class="title function_">while</span><span class="params">(target!=<span class="literal">null</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  next:TouchTarget=target.next</span><br><span class="line">	  <span class="title function_">if</span><span class="params">(dispatchTransformedTouchEvent(ev,...,target.child,...)</span>)</span><br><span class="line">	     handled=<span class="literal">true</span></span><br><span class="line">	  target=next</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">  :<span class="number">3.</span>是否需要自己处理MotionEvent</span><br><span class="line">     <span class="title function_">if</span> <span class="params">(mFirstTouchTarget == <span class="literal">null</span>)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       handled = dispatchTransformedTouchEvent(ev,.., <span class="literal">null</span>,TouchTarget.ALL_POINTER_IDS)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">View的事件分发顺序:</span><br><span class="line">  :<span class="number">1.</span>dispatchEvent流程 : onTouch &gt; onTouchEvent &gt;onTouchEvent(<span class="meta">@Overide</span>)</span><br><span class="line">     onTouchEvent检查ACTION_UP,查看是否有mOnClickListener,有则回调onClick</span><br><span class="line">  :<span class="number">2.</span>onTouchEvent	<span class="comment">//如果没有经过重写，则调用View.onTouchEvent</span></span><br><span class="line">     &gt;<span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">        <span class="keyword">if</span> (mPerformClick == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">           mPerformClick = <span class="keyword">new</span> <span class="title class_">PerformClick</span>();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (!post(mPerformClick)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">           performClick();  <span class="comment">//mOnClickListener.onClick(this)</span></span><br><span class="line">        &#125;   </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">touch事件的层级传递</span><br><span class="line">a).在setOnTouchListener中只有当ACTION_DOWN返回<span class="literal">true</span>后,才会继续传来ACTION_UP、ACTION_MOVE</span><br><span class="line">&gt;&gt;ViewGroup</span><br><span class="line"></span><br><span class="line">&gt;&gt;ViewGroup和View组成了一个树状结构，根节点为Activity内部包含的一个ViwGroup。</span><br><span class="line"></span><br><span class="line">&gt;&gt;触摸事件由Action_Down、Action_Move、Aciton_UP组成，其中一次完整的触摸事件中，Down和Up都只有一个，Move有若干个，可以为<span class="number">0</span>个。</span><br><span class="line"></span><br><span class="line">&gt;&gt;当Acitivty接收到Touch事件时，将遍历子View进行Down事件的分发。ViewGroup的遍历可以看成是递归的。分发的目的是为了找到真正要处理本次完整触摸事件的View，这个View会在onTouchuEvent结果返回<span class="literal">true</span>。</span><br><span class="line"></span><br><span class="line">&gt;&gt;当某个子View返回<span class="literal">true</span>时，会中止Down事件的分发，同时在ViewGroup中记录该子View。接下去的Move和Up事件将由该子View直接进行处理。由于子View是保存在ViewGroup中的，多层ViewGroup的节点结构时，上级ViewGroup保存的会是真实处理事件的View所在的ViewGroup对象:如ViewGroup0-ViewGroup1-TextView的结构中，TextView返回了<span class="literal">true</span>，它将被保存在ViewGroup1中，而ViewGroup1也会返回<span class="literal">true</span>，被保存在ViewGroup0中。当Move和UP事件来时，会先从ViewGroup0传递至ViewGroup1，再由ViewGroup1传递至TextView。</span><br><span class="line"></span><br><span class="line">&gt;&gt;当ViewGroup中所有子View都不捕获Down事件时，将触发ViewGroup自身的onTouch事件。触发的方式是调用<span class="built_in">super</span>.dispatchTouchEvent函数，即父类View的dispatchTouchEvent方法。在所有子View都不处理的情况下，触发Acitivity的onTouchEvent方法。</span><br><span class="line"></span><br><span class="line">&gt;&gt;onInterceptTouchEvent有两个作用：<span class="number">1.</span>拦截Down事件的分发。<span class="number">2.</span>中止Up和Move事件向目标View传递，使得目标View所在的ViewGroup捕获Up和Move事件。</span><br></pre></td></tr></table></figure>

<p>32.ArrayList和LinkedList的区别</p>
<ul>
<li>ArrayList</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基于数组进行实现</span></span><br><span class="line">  :<span class="number">1.</span><span class="keyword">transient</span> Object[] elementData;     <span class="comment">//elementData存在一些没使用的空间，所以声明为transient</span></span><br><span class="line">  :<span class="number">2.</span><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	ensureCapacityInternal(minCapacity:size + <span class="number">1</span>)	   <span class="comment">//size代表当前非空元素的长度</span></span><br><span class="line">   	  &gt;<span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">            grow(minCapacity) 				   <span class="comment">//给数组开辟新的空间，</span></span><br><span class="line">            &gt; <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">              <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);<span class="comment">//扩容因子为3/2</span></span><br><span class="line">              <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">                newCapacity = minCapacity;</span><br><span class="line">              <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">                newCapacity = hugeCapacity(minCapacity)</span><br><span class="line">	       elementData = Arrays.copyOf(elementData, newCapacity)<span class="comment">//分配内存，并数组项的复制</span></span><br><span class="line">        System.arraycopy(elementData,index,elementData,index+<span class="number">1</span>,size-index)<span class="comment">//移动</span></span><br><span class="line">	elementData[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">3.</span><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Object[] a=c.toArray()</span><br><span class="line">        <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">        ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount,并且如果有需要进行扩容</span></span><br><span class="line">        System.arraycopy(src:a, pos:<span class="number">0</span>, dat:elementData, pos:size, len:numNew);</span><br><span class="line">        size += numNew;</span><br><span class="line">        <span class="keyword">return</span> numNew != <span class="number">0</span>;	</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">4.</span><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> -&gt; <span class="keyword">return</span> indexOf(o)   <span class="comment">//时间复杂度为O(n)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 &gt; <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">             <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">               <span class="keyword">if</span> (elementData[i]==<span class="literal">null</span>)</span><br><span class="line">                  <span class="keyword">return</span> i;</span><br><span class="line">               &#125; </span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                    <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                      <span class="keyword">return</span> i;</span><br><span class="line"> 	   &#125;</span><br><span class="line">	   <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">5.</span><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	modCount++</span><br><span class="line"> 	<span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> size</span><br><span class="line">	<span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> (E) elementData[index]</span><br><span class="line">	<span class="type">int</span> numMoved=size-index-<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span>(numMoved&gt;<span class="number">0</span>)</span><br><span class="line">	 System.arraycopy(src:elementData, srcPos:index + <span class="number">1</span>, dest:elementData, destPos:index, len:numMoved)</span><br><span class="line">	</span><br><span class="line">	elementData[—-size]=<span class="literal">null</span></span><br><span class="line">	<span class="keyword">return</span> oldValue</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>LinkedList</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//支持随机访问的双向链表</span></span><br><span class="line">  :<span class="number">1.</span>成员</span><br><span class="line">    -&gt;<span class="keyword">transient</span> <span class="type">int</span> size=<span class="number">0</span> </span><br><span class="line">    -&gt;<span class="keyword">transient</span> Node&lt;E&gt; first,last	</span><br><span class="line">  :<span class="number">2.</span>在头部插入</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">linkFirst</span><span class="params">(E e)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; f=first</span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; newNode=<span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(prev:<span class="literal">null</span>,e,next:f)</span><br><span class="line">	first=newNode<span class="comment">//设置为头结点</span></span><br><span class="line">	<span class="keyword">if</span>(f==<span class="literal">null</span>)</span><br><span class="line">	  last=newNode</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	  f.prev=newNode</span><br><span class="line">	size++;modCount++;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">3.</span>在尾部插入</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">linkLast</span><span class="params">(E e)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; l=last</span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; newNode=<span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(l,e,<span class="literal">null</span>)</span><br><span class="line">	last=newNode</span><br><span class="line">	<span class="title function_">if</span><span class="params">(l==<span class="literal">null</span>)</span></span><br><span class="line">	  first=newNode</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	  l.next=newNode	</span><br><span class="line">	size++;modCount++;</span><br><span class="line">     &#125;</span><br><span class="line">  e).<span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span><span class="comment">//默认尾部插入</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	linkLast(e)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">     &#125;</span><br><span class="line">  f).<span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">for</span>(Node&lt;E&gt; x=first;x!=<span class="literal">null</span>;x=x.next)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">if</span>(o.equals(x.item))</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    unlink(x);<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">     &#125;</span><br><span class="line">  g).E <span class="title function_">unlink</span><span class="params">(Node&lt;E&gt; x)</span> 			<span class="comment">//从链表中移除该结点</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">final</span> E element=x.item</span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; next=x.next</span><br><span class="line">	<span class="keyword">final</span> Node&lt;E&gt; prev=x.prev</span><br><span class="line">	<span class="comment">//处理前置</span></span><br><span class="line">	<span class="keyword">if</span>(prev==<span class="literal">null</span>)<span class="comment">//如果待删除结点的前置为空</span></span><br><span class="line">	  first=next</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  prev.next=next</span><br><span class="line">	  x.prev=<span class="literal">null</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理后置</span></span><br><span class="line">	<span class="keyword">if</span>(next==<span class="literal">null</span>)</span><br><span class="line">	  last=prev</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  next.prev=prev</span><br><span class="line">	  x.next=<span class="literal">null</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	x.item=<span class="literal">null</span>;size—;modCount++;</span><br><span class="line">	<span class="keyword">return</span> element</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>ArrayList和LinkedList在末尾增加一项的时间是固定的，但是ArrayList可能会造成数组空间的重新分配<br>在ArrayList中插入、删除元素会造成移动，而LinkedList不会<br>LinkedList不支持高效的随机元素访问<br>LinkedList的空间花费集中在内部类Node的开销，而ArrayList则体现在扩容</p>
</blockquote>
</blockquote>
<p>33.LruCache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//缓存淘汰框架</span></span><br><span class="line">&gt;&gt;实现</span><br><span class="line">  :<span class="number">1.</span>采用LinkedHashMap作为数据结构</span><br><span class="line">  :<span class="number">2.</span>放入缓存</span><br><span class="line">    &gt;<span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">put</span><span class="params">(K key,V value)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	V previous;</span><br><span class="line">	<span class="keyword">synchronized</span>(<span class="built_in">this</span>)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  putCount++</span><br><span class="line">	  size+=safeSizeOf(key, value)</span><br><span class="line">	  previous=map.put(key, value)</span><br><span class="line">	  <span class="keyword">if</span>(previous!=<span class="literal">null</span>)</span><br><span class="line">	    size-=safeSizeOf(key, value)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	trimToSize(maxSize)</span><br><span class="line">     &#125;</span><br><span class="line">    &gt;<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trimToSize</span><span class="params">(<span class="type">int</span> maxSize)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     		<span class="comment">//对队列进行调整</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  K key;</span><br><span class="line">	  V value;</span><br><span class="line">	  <span class="keyword">synchronized</span>(<span class="built_in">this</span>)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    <span class="keyword">if</span>(size&lt;=maxSize||map.isEmpty())</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	    Map.Entry&lt;K,V&gt; evict=map.entrySet().iterator().next()</span><br><span class="line">	    key=evict.getKey()</span><br><span class="line">	    value=evict.getValue()</span><br><span class="line">	    map.remove(key)</span><br><span class="line">	    size-=safeSizeOf(key, value)</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;示例</span><br><span class="line">  :<span class="number">1.</span>初始化</span><br><span class="line">   <span class="type">int</span> maxSize=(<span class="type">int</span>)Runtime.getRuntime().maxMemory()/<span class="number">8</span>;  <span class="comment">//为总内存的1/8</span></span><br><span class="line">   LruCache&lt;String,Bitmap&gt; cache=<span class="keyword">new</span> <span class="title class_">LruCache</span>&lt;String,Bitmap&gt;(maxSize)</span><br><span class="line">   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">sizeOf</span><span class="params">(String key, Bitmap value)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          <span class="keyword">return</span> value.getByteCount();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  :<span class="number">2.</span>放入缓存</span><br><span class="line">    cache.put(key:String, value:Bitmap)</span><br></pre></td></tr></table></figure>

<p>36.什么是ANR，如何规避</p>
<ul>
<li>ANR application not responding<br>a).keyDispatch timeout 5s<br>b).broadcast timeout 10s<br>c).service timeout 20s</li>
<li>UI线程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a).Activity&amp;AsyncTask:onPreExecute、onPostExecute、onProgressUpdate</span><br><span class="line">    &gt;&gt;<span class="keyword">public</span> Result <span class="title function_">doInBackground</span><span class="params">(String …arg)</span></span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 …</span><br><span class="line">	 publishProgress(<span class="type">int</span>)</span><br><span class="line">        …</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>避免keydisptach timeout</p>
<p>a).ui线程不做耗时操作<br>b).使用handler来处理与其它thread的交互<br>&#x2F;&#x2F;new Thread(new Runnable(){ public void run(){…handler.sendMessage(msg)}})<br>&#x2F;&#x2F;匿名内部类持有对外部类实例的引用,导致不能被回收，因将其改为内部静态类,并且把Activity声明为WeakReference</p>
</li>
</ul>
<ol>
<li>描述Service的启动方式</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主要针对Service和Activity的优先级比较</span></span><br><span class="line">- Activity.startService	</span><br><span class="line">- bindService(intent, conn, flag)		</span><br><span class="line">  :<span class="number">1.</span>flag的种类</span><br><span class="line">    &gt;BIND_AUTO_CREATE				<span class="comment">//当service不存在时自动创立</span></span><br><span class="line">    &gt;BIND_ADJUST_WITH_ACTIVITY			<span class="comment">//service的优先级随着其绑定的Activity发生变换,back&lt;-&gt;fore</span></span><br><span class="line">    &gt;BIND_ABOVE_CLIENT				<span class="comment">//service优先级超过Activity</span></span><br><span class="line">    &gt;BIND_IMPORTANT				<span class="comment">//service优先级相当于前台Activity</span></span><br><span class="line">    &gt;BIND_NOT_FOREGROUND			<span class="comment">//service优先级不高于前台Activity，但至少会提高到客户端优先级之上</span></span><br><span class="line">- onStartCommand的返回标志</span><br><span class="line">  :<span class="number">1.</span>START_NOT_STICKY		<span class="comment">//在经过onStartCommand之后，service挂了也不会重启</span></span><br><span class="line">  :<span class="number">2.</span>START_STICKY		<span class="comment">//重启</span></span><br><span class="line">  :<span class="number">3.</span>START_REDELIVER_INTENT	<span class="comment">//重启，并传入最后的intent</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Android有哪几种布局</li>
</ol>
<ul>
<li>LinearyLayout 按照水平或垂直的顺序排列子元素，android:layout_weight生效</li>
<li>FrameLayout 后来的子元素覆盖在之前子元素的上层，以左上角为基准点</li>
<li>AbsoluteLayout android:layout_x和android:layout_y会生效</li>
<li>RelativeLayout android:layout_below和android:layout_above</li>
</ul>
<blockquote>
<blockquote>
<p>TableLayout &#x2F;&#x2F;表格布局由TableRow构成,layout_column指定开始列，layout_span制定范围<br>a).全局属性<br>android:shrinkColumns&#x3D;“0,1” &#x2F;&#x2F;可收缩的列<br>android:stretchColumns&#x3D;“0,1” &#x2F;&#x2F;可拉伸的列<br>b).单元格属性<br>android:layout_span&#x3D;“2” &#x2F;&#x2F;该TableRow中的子View所横跨的列<br>android:layout_column&#x3D;“1” &#x2F;&#x2F;制定子view在哪列开始排列</p>
</blockquote>
</blockquote>
<ol>
<li>HashMap、HashTable的区别 &#x2F;&#x2F;从线程安全性、速度</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;线程方面</span><br><span class="line">  :<span class="number">1.</span>HashTable是线程安全的</span><br><span class="line">&gt;&gt;HashTable的key、value不允许设置<span class="literal">null</span>,而hashmap可以</span><br><span class="line">&gt;&gt;是否可在遍历时进行操作</span><br><span class="line">  :<span class="number">1.</span>HashMap:fail-fast	</span><br><span class="line">     a).既在遍历HashMap时，如果通过实例对象进行修改则报ConcurrentModificationException, </span><br><span class="line">      expectedModCount==modCount</span><br><span class="line">&gt;&gt;解决冲突</span><br><span class="line">  :<span class="number">1.</span>HashMap的装载因子是<span class="number">3</span>/<span class="number">4</span>,链接法解决冲突，当链表过长时转化为红黑树</span><br><span class="line">&gt;&gt;实现</span><br><span class="line">  :<span class="number">1.</span>HashMap 通过数组+链表的结构</span><br><span class="line">    &gt;<span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line">    &gt;<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt;&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">final</span> <span class="type">int</span> hash;</span><br><span class="line">	<span class="keyword">final</span> K key;</span><br><span class="line">	<span class="keyword">final</span> V value;</span><br><span class="line">	Node&lt;K,V&gt; next;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">return</span> Objects.hashCode(key)^Objects.hashCode(v)</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">2.</span>hashCode 通过Objects.hashCode(key)^Objects.hashCode(value)计算</span><br><span class="line">  :<span class="number">3.</span>扩容  哈希桶的容量形若<span class="number">100.</span>.<span class="number">.0</span>,扩容容量为<span class="number">2</span>倍，阀值也为<span class="number">2</span>倍，需要rehash</span><br><span class="line">    &gt;<span class="keyword">final</span> Node&lt;K,V&gt;[] resize()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">//oldTab 为当前表的哈希桶</span></span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">	<span class="type">int</span> oldCap=oldTab.length</span><br><span class="line">	<span class="comment">//当前的阈值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">	<span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	     newThr=oldThr&lt;&lt;<span class="number">1</span>;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">//更新阈值 </span></span><br><span class="line">        threshold = newThr</span><br><span class="line">	table= newTab</span><br><span class="line">        <span class="title function_">if</span><span class="params">(oldTab!=<span class="literal">null</span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	     Node&lt;K,V&gt; e;</span><br><span class="line">	     <span class="keyword">if</span>((e=oldTab[j])!=<span class="literal">null</span>)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		oldTab[j] = <span class="literal">null</span><span class="comment">//将原哈希桶置空以便GC</span></span><br><span class="line">		<span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">		  newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e; <span class="comment">//直接将这个元素放置在新的哈希桶里</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		   <span class="comment">//因为扩容是容量翻倍，所以原链表上的每个节点，现在可能存放在原来的下标，即low位， 或者扩容后的下标，</span></span><br><span class="line">		   <span class="comment">//即high位。 high位=  low位+原哈希桶容量</span></span><br><span class="line">                   <span class="comment">//低位链表的头结点、尾节点</span></span><br><span class="line">                   Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">		   <span class="comment">//高位链表的头节点、尾节点</span></span><br><span class="line">                   Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                   Node&lt;K,V&gt; next;<span class="comment">//临时节点 存放e的下一个节点</span></span><br><span class="line">		   <span class="keyword">do</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                      next = e.next;</span><br><span class="line">                      <span class="comment">//这里又是一个利用位运算 代替常规运算的高效点： 利用哈希值 与 旧的容量 可以得到哈希值去模后，</span></span><br><span class="line">		      <span class="comment">//是大于等于oldCap还是小于oldCap，等于0代表小于oldCap，应该存放在低位，否则存放在高位</span></span><br><span class="line">                      <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                         <span class="comment">//给头尾节点指针赋值</span></span><br><span class="line">                         <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                            loHead = e;</span><br><span class="line">                         <span class="keyword">else</span></span><br><span class="line">                            loTail.next = e;</span><br><span class="line">                         loTail = e;</span><br><span class="line">                       &#125;<span class="comment">//高位也是相同的逻辑</span></span><br><span class="line">                          <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                               hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                               hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                          &#125;<span class="comment">//循环直到链表结束</span></span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>)</span><br><span class="line">			<span class="comment">//将低位链表存放在原index处，</span></span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                            loTail.next = <span class="literal">null</span>;</span><br><span class="line">                            newTab[j] = loHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//将高位链表存放在新index处</span></span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                            hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                            newTab[j + oldCap] = hiHead;</span><br><span class="line">                        &#125;</span><br><span class="line">		&#125;</span><br><span class="line"> 	     &#125;</span><br><span class="line"></span><br><span class="line"> 	&#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="number">4.</span>插入节点</span><br><span class="line">     &gt;<span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key,V value)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> putVal(hash(key),key,value)&#125;</span><br><span class="line">     &gt;<span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash,K key,V value,...)</span></span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Node&lt;K,V&gt;[] tab=table </span><br><span class="line"> 	<span class="type">int</span> n=tab.length</span><br><span class="line">	Node&lt;K,V&gt; p;</span><br><span class="line">	<span class="comment">//如果当前哈希表是空的，代表是初始化</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//那么直接去扩容哈希表，并且将扩容后的哈希桶长度赋值给n</span></span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">	<span class="comment">//如果当前index的节点是空的，表示没有发生哈希碰撞。 直接构建一个新节点Node，挂载在index处即可。</span></span><br><span class="line">        <span class="comment">//这里再啰嗦一下，index 是利用 哈希值 &amp; 哈希桶的长度-1，替代模运算</span></span><br><span class="line">        <span class="keyword">if</span>(p=tab[I=?(n-<span class="number">1</span>)&amp;hash)==<span class="literal">null</span>)		</span><br><span class="line">	  tab[I]=newNode(hash,key,value,<span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">else</span><span class="comment">//发生了冲突</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  Node&lt;K,V&gt; e;K k;</span><br><span class="line">  	  <span class="keyword">if</span>(p.hash==hash &amp;&amp; ((k=p.key)==key || key.equals(k))<span class="comment">//键值相同，寻找成功</span></span><br><span class="line">	     e=p;</span><br><span class="line">	  <span class="keyword">else</span> <span class="keyword">if</span>(p instance TreeNode)			<span class="comment">//红黑树</span></span><br><span class="line">	     e=TreeNode&lt;K,V)p.putTreeVal(<span class="built_in">this</span>, tab,hash,key,value)</span><br><span class="line">	  <span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> 	     <span class="comment">//遍历链表</span></span><br><span class="line">	     <span class="keyword">for</span>(<span class="type">int</span> binCount=<span class="number">0</span>;;++binCount)</span><br><span class="line">	     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="keyword">if</span>((e=p.next)==<span class="literal">null</span>)			<span class="comment">//遍历到尾部，追加新节点到尾部</span></span><br><span class="line">		&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">		   p.next=newNode(hash, key, value)  	<span class="comment">//生成结点并插入</span></span><br><span class="line">		   <span class="keyword">if</span>(binCount&gt;=TREEIFY_THRESHOLD-<span class="number">1</span>)    <span class="comment">//将链表转化为树结构</span></span><br><span class="line">		      treeifyBin(tab,hash)</span><br><span class="line">		   <span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//如果找到了要覆盖的节点</span></span><br><span class="line">		<span class="keyword">if</span>(e.hash==hash&amp;&amp;((k=e.key)==key)</span><br><span class="line">		   <span class="keyword">break</span></span><br><span class="line">		p=e					<span class="comment">//迭代</span></span><br><span class="line">	     &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	  <span class="keyword">if</span>(e!=<span class="literal">null</span>)</span><br><span class="line">	     e.value=value				<span class="comment">//设置新值</span></span><br><span class="line">	&#125;</span><br><span class="line">      &#125;</span><br><span class="line">  :<span class="number">5.</span>删除结点</span><br><span class="line">    &gt;<span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">removeNode</span><span class="params">(<span class="type">int</span> hash, Object key, Object value,</span></span><br><span class="line"><span class="params">                               <span class="type">boolean</span> matchValue, <span class="type">boolean</span> movable)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">// p 是待删除节点的前置节点</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, index;</span><br><span class="line">	<span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  Node&lt;K,V&gt; node = <span class="literal">null</span>, e; K k; V v</span><br><span class="line">	  <span class="comment">//如果链表头的就是需要删除的节点</span></span><br><span class="line">          <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                node = p;<span class="comment">//将待删除节点引用赋给node</span></span><br><span class="line">	  <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//否则循环遍历 找到待删除节点，赋值给node</span></span><br><span class="line">	     <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">              <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key ||</span><br><span class="line">                          (key != <span class="literal">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        node = e;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">              &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	  <span class="comment">//如果有待删除节点node，  且 matchValue为false，或者值也相等</span></span><br><span class="line">          <span class="keyword">if</span> (node != <span class="literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                                 (value != <span class="literal">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">             <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="built_in">this</span>, tab, movable);</span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span> (node == p)<span class="comment">//如果node ==  p，说明是链表头是待删除节点</span></span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">             <span class="keyword">else</span><span class="comment">//否则待删除节点在表中间</span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">             ++modCount;<span class="comment">//修改modCount</span></span><br><span class="line">             --size;<span class="comment">//修改size</span></span><br><span class="line">             <span class="keyword">return</span> node;</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">6.</span>查找</span><br><span class="line">   &gt;<span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">getNode</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="type">int</span> n; K k;</span><br><span class="line">        <span class="comment">//查找过程和删除基本差不多， 找到返回节点，否则返回null</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">                ((k = first.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                <span class="keyword">return</span> first;</span><br><span class="line">            <span class="keyword">if</span> ((e = first.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">return</span> e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   :<span class="number">7.</span>iterator遍历</span><br><span class="line">    &gt; <span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">nextNode</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         Node&lt;K,V&gt;[] t;</span><br><span class="line">         Node&lt;K,V&gt; e = next;</span><br><span class="line">         <span class="comment">//fail-fast策略</span></span><br><span class="line">         <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">         <span class="keyword">if</span> (e == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">         <span class="comment">//依次取链表下一个节点，</span></span><br><span class="line">         <span class="keyword">if</span> ((next = (current = e).next) == <span class="literal">null</span> &amp;&amp; (t = table) != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="comment">//如果当前链表节点遍历完了，则取哈希桶下一个不为null的链表头</span></span><br><span class="line">           <span class="keyword">do</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="literal">null</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="number">40.</span>LinkedHashMap </span><br><span class="line">&gt;&gt;成员 </span><br><span class="line">  :<span class="number">1.</span>LinkedHashMapEntry			<span class="comment">//增加了before和after域，成为双向链表</span></span><br><span class="line">     <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LinkedHashMapEntry</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">HashMap</span>.Node&lt;K,V&gt; &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        LinkedHashMapEntry&lt;K,V&gt; before, after;<span class="comment">//双向链表</span></span><br><span class="line">        LinkedHashMapEntry(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="built_in">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">2.</span>head tail</span><br><span class="line">   &gt;<span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head	<span class="comment">//双向链表的头结点</span></span><br><span class="line">   &gt;<span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail	<span class="comment">//双向链表的尾节点</span></span><br><span class="line">  :<span class="number">3.</span>accessOrder 	<span class="comment">//默认为false，是按照插入结点的顺序，若为true，则可构造LruCache</span></span><br><span class="line">&gt;&gt;重写newNode,在HashMap调用putVal()方法被调用</span><br><span class="line">    &gt;<span class="comment">//在构建新节点时，构建的是`LinkedHashMap.Entry` 不再是`Node`.</span></span><br><span class="line">     Node&lt;K,V&gt; <span class="title function_">newNode</span><span class="params">(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; e)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>.Entry&lt;K,V&gt;(hash, key, value, e);</span><br><span class="line">       linkNodeLast(p);  <span class="comment">//!!!</span></span><br><span class="line">       <span class="keyword">return</span> p;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//将新增的节点，连接在链表的尾部</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">linkNodeLast</span><span class="params">(LinkedHashMap.Entry&lt;K,V&gt; p)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">        tail = p;</span><br><span class="line">        <span class="comment">//集合之前是空的</span></span><br><span class="line">        <span class="keyword">if</span> (last == <span class="literal">null</span>)</span><br><span class="line">            head = p;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//将新节点连接在链表的尾部</span></span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&gt;&gt;删除结点</span><br><span class="line">    &gt;<span class="comment">//在删除节点e时，同步将e从双向链表上删除</span></span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; e)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      <span class="comment">// unlink</span></span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">        <span class="comment">//待删除节点 p 的前置后置节点都置空</span></span><br><span class="line">        p.before = p.after = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//如果前置节点是null，则现在的头结点应该是后置节点a</span></span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">            head = a;</span><br><span class="line">        <span class="keyword">else</span><span class="comment">//否则将前置节点b的后置节点指向a</span></span><br><span class="line">            b.after = a;</span><br><span class="line">        <span class="comment">//同理如果后置节点时null ，则尾节点应是b</span></span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span>)</span><br><span class="line">            tail = b;</span><br><span class="line">        <span class="keyword">else</span><span class="comment">//否则更新后置节点a的前置节点为b</span></span><br><span class="line">            a.before = b;</span><br><span class="line">     &#125;</span><br><span class="line">&gt;&gt;get  <span class="comment">//获取结点</span></span><br><span class="line">   &gt;<span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">if</span> ((e = getNode(hash(key), key)) == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (accessOrder)</span><br><span class="line">            afterNodeAccess(e);<span class="comment">//因为访问了该结点，所以动态调整其位置</span></span><br><span class="line">        <span class="keyword">return</span> e.value;</span><br><span class="line">    &#125;  </span><br><span class="line">   &gt;若accessOrder==<span class="literal">true</span>			<span class="comment">//按访问顺序</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      <span class="comment">// move node to last</span></span><br><span class="line">       LinkedHashMapEntry&lt;K,V&gt; last;<span class="comment">//原尾节点</span></span><br><span class="line">       <span class="comment">//如果accessOrder 是true ，且原尾节点不等于e</span></span><br><span class="line">       <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="comment">//节点e强转成双向链表节点p</span></span><br><span class="line">            LinkedHashMapEntry &lt;K,V&gt; p =</span><br><span class="line">                (LinkedHashMapEntry &lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">            <span class="comment">//p现在是尾节点， 后置节点一定是null</span></span><br><span class="line">            p.after = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//如果p的前置节点是null，则p以前是头结点，所以更新现在的头结点是p的后置节点a</span></span><br><span class="line">            <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">                head = a;</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//否则更新p的前直接点b的后置节点为 a</span></span><br><span class="line">                b.after = a;</span><br><span class="line">            <span class="comment">//如果p的后置节点不是null，则更新后置节点a的前置节点为b</span></span><br><span class="line">            <span class="keyword">if</span> (a != <span class="literal">null</span>)</span><br><span class="line">                a.before = b;</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//如果原本p的后置节点是null，则p就是尾节点。 此时 更新last的引用为 p的前置节点b</span></span><br><span class="line">                last = b;</span><br><span class="line">            <span class="keyword">if</span> (last == <span class="literal">null</span>) <span class="comment">//原本尾节点是null  则，链表中就一个节点</span></span><br><span class="line">                head = p;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//否则 更新 当前节点p的前置节点为 原尾节点last， last的后置节点是p</span></span><br><span class="line">                p.before = last;</span><br><span class="line">                last.after = p;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//尾节点的引用赋值成p</span></span><br><span class="line">            tail = p;</span><br><span class="line">            <span class="comment">//修改modCount。</span></span><br><span class="line">            ++modCount;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>红黑树</li>
</ol>
<p>性质<br>a).每个结点是红色的或者黑色的<br>b).根结点是黑色的<br>c).每个叶结点(空结点)都是黑色的<br>d).如果一个结点是红色的，则它的子结点都是黑色的<br>e).对于每个结点而言，从该结点到其所有叶结点的简单路径上，包含相等数目的黑结点<br>引理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">a).n&gt;=<span class="number">2</span>^bh(x)-<span class="number">1</span></span><br><span class="line">&gt;&gt;左旋</span><br><span class="line">  LEFT-ROTATE(T,x)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    y=x.right</span><br><span class="line">    x.right=y.left</span><br><span class="line">    <span class="keyword">if</span> y.left!=T.nil</span><br><span class="line">	y.left.p=x</span><br><span class="line">    y.p=x.p</span><br><span class="line">    <span class="keyword">if</span> x.p==T.nil</span><br><span class="line">	T.root=y</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> x==x.p.left	<span class="comment">//判断x是否位于其父结点的左子树，设置父结点的子树指针</span></span><br><span class="line">    	x.p.left=y</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	x.p.right=y</span><br><span class="line">    y.left=x			<span class="comment">//左旋之后，x位于y的左分支</span></span><br><span class="line">    x.p=y			<span class="comment">//设置x父结点为y</span></span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;右旋</span><br><span class="line">  RIGHT-ROTATE(T,x)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    y=x.p</span><br><span class="line">    <span class="keyword">if</span> y.p==T.nil</span><br><span class="line">    	T.root=x</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> y.p.left==y</span><br><span class="line">      	y.p.left=x</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line"> 	y.p.right=x</span><br><span class="line">    x.p=y.p</span><br><span class="line">    y.p=x</span><br><span class="line">    y.left=x.right</span><br><span class="line">    x.right=y</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;插入</span><br><span class="line">  RB-INSERT(T,z)		<span class="comment">//插入任意结点都必须先标为红色</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    y=T.nil</span><br><span class="line">    x=T.root</span><br><span class="line">    <span class="keyword">while</span> x!=T.nil</span><br><span class="line">      	y=x</span><br><span class="line">	<span class="keyword">if</span> z.key&lt;x.key</span><br><span class="line">	  x=x.left</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	  x=x.right</span><br><span class="line">    z.p=y 			<span class="comment">//设置父结点  	</span></span><br><span class="line">    <span class="keyword">if</span> y==T.nil</span><br><span class="line">	T.root=z</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> z.key&lt;y.key</span><br><span class="line">  	y.left=z</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">	y.right=z</span><br><span class="line">    z.left=T.nil</span><br><span class="line">    z.right=T.nil</span><br><span class="line">    RB-INSERT-FIXUP(T,z)	<span class="comment">//调整颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//分三种情况: </span></span><br><span class="line">  RB-INSERT-FIXUP(T,z)		 </span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//1.结点z的叔结点、父结点皆为红色</span></span><br><span class="line">    <span class="comment">//2.结点z和其父结点为红色,叔结点为黑色,结点z为左分支 </span></span><br><span class="line">    <span class="comment">//3.结点z和其父结点为红色,叔结点为黑色,结点z为右分支</span></span><br><span class="line">   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Handler Looper 工作原理<br>成员</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span><span class="keyword">class</span> <span class="title class_">Looper</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal =<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>()<span class="comment">//why declare staic?</span></span><br><span class="line">      <span class="keyword">static</span> Looper sMainLooper</span><br><span class="line">      <span class="keyword">final</span> MessageQueue mQueue</span><br><span class="line">      <span class="keyword">final</span> Thread mThread</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>Looper.prepare()		</span><br><span class="line">     <span class="keyword">if</span>(sThreadLocal.get()!=<span class="literal">null</span></span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span></span><br><span class="line">     sThreadLocal.set(<span class="keyword">new</span> <span class="title class_">Looper</span>(<span class="literal">true</span>))</span><br><span class="line">  :<span class="number">2.</span><span class="keyword">public</span> <span class="title function_">Looper</span><span class="params">(<span class="type">boolean</span> quitAllowed)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	</span><br><span class="line">	mQueue=<span class="keyword">new</span> <span class="title class_">MessageQueue</span>(quitAllowed)</span><br><span class="line">	mThread=Thread.currentThread()</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">3.</span>开启事件循环</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Looper.loop()</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="keyword">final</span> Looper me=myLooper()<span class="comment">//  通过ThreadLocal获取Looper实例,通过Looper获取消息队列实例</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">MessageQueue</span> <span class="variable">queue</span> <span class="operator">=</span> me.mQueue</span><br><span class="line">      <span class="title function_">for</span> <span class="params">(;;)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> queue.next()<span class="comment">//通过消息队列阻塞性地获取消息</span></span><br><span class="line">	<span class="keyword">if</span> (msg == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> ;&#125;<span class="comment">// 跳出循环</span></span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  msg.target.dispatchMessage(msg)<span class="comment">//检查顺序:msg.callback-&gt;mCallback-&gt;handleMessage</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	&#125;</span><br><span class="line">	msg.recycleUnChecked()	   <span class="comment">//初始化msg属性，并放置在Message的sPool头部</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>最后Handler通过sendMessage将消息塞入mQueue队列<br>由Looper接收到了msg，然后调用Handler的dispatchMessage<br>Handler 检查mCallback-&gt;message.callback-&gt;mCallback的handleMessage</p>
<ol>
<li>Listview的几种adapter介绍</li>
</ol>
<ul>
<li>SimpleAdapter</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在一个行中能放入不同view组件</span></span><br><span class="line">  a).SimpleAdapter(Context context,List&lt;? <span class="keyword">extends</span> <span class="title class_">Map</span>&lt;String, ?&gt;&gt; data,<span class="type">int</span> resource,String[] from,<span class="type">int</span>[] to)</span><br><span class="line">  b).<span class="comment">//示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Map&lt;String, Object&gt; item = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        item.put(<span class="string">&quot;touxiang&quot;</span>, R.drawable.ic_launcher);<span class="comment">//drawable</span></span><br><span class="line">        item.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;某某&quot;</span> + i);</span><br><span class="line">        item.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;今晚我请客吃饭&quot;</span>);</span><br><span class="line">        data.add(item);</span><br><span class="line">&#125;</span><br><span class="line">listView = (ListView) findViewById(R.id.listview1);</span><br><span class="line">simAdapt = <span class="keyword">new</span> <span class="title class_">SimpleAdapter</span>(</span><br><span class="line">            <span class="built_in">this</span>, </span><br><span class="line">            data, </span><br><span class="line">            R.layout.listview_item,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      <span class="string">&quot;touxiang&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;message&quot;</span> &#125;,<span class="comment">// 与下面数组元素要一一对应</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      R.id.touxiang, R.id.tv_name, R.id.tv_message &#125;);</span><br><span class="line">listView.setAdapter(simAdapt);</span><br></pre></td></tr></table></figure>

<ul>
<li>ArrayAdapter</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在一个行中只能放入TextView</span></span><br><span class="line">  a).List&lt;String&gt; items=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">     items.add(<span class="string">&quot;item1&quot;</span>);</span><br><span class="line">     items.add(<span class="string">&quot;item2&quot;</span>);</span><br><span class="line">     listView.setAdapter(<span class="keyword">new</span> <span class="title class_">ArrayAdapter</span>&lt;String&gt;(<span class="built_in">this</span>,android.R.layout.simple_list_item_1,items));</span><br><span class="line">&gt;&gt;BaseAdapter		<span class="comment">//动态构建行的布局和子组件</span></span><br><span class="line">  a).<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LAdapter</span> <span class="keyword">extends</span> <span class="title class_">BaseAdapter</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="keyword">private</span> LayoutInflater mInflater;</span><br><span class="line">        <span class="keyword">private</span> Context mContext;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LAdapter</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            mContext=context;</span><br><span class="line">            mInflater=LayoutInflater.from(context);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getItemId</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(<span class="type">int</span> position)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> View <span class="title function_">getView</span><span class="params">(<span class="type">int</span> position, View convertView, ViewGroup parent)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">        </span><br><span class="line">          View v= LayoutInflater.from(mContext).inflate(R.layout.xxx,parent,<span class="literal">false</span>)</span><br><span class="line">		<span class="comment">//inflate传参:1).viewGroup为null,此时R.layout.xxx的根节点的layout_width、layout_height失效</span></span><br><span class="line">    			      <span class="number">2</span>).viewGroup不为<span class="literal">null</span>,attachToRoot=<span class="literal">false</span>,layout_width、layout_height有效</span><br><span class="line">			      <span class="number">3</span>).viewGroup不为<span class="literal">null</span>,attachToRoot=<span class="literal">true</span>,直接添加到父容器</span><br><span class="line">	   <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  b).使用convertView进行优化</span><br><span class="line">     &gt;&gt;<span class="keyword">if</span>(convertView==<span class="literal">null</span>)	convertView=mInflater.inflate(R.layout.xx,<span class="literal">null</span>);</span><br><span class="line">  c).使用ViewHolder进行优化</span><br><span class="line">     &gt;&gt;<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ViewHolder</span></span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    	  <span class="keyword">public</span> ImageView img;</span><br><span class="line">    	  <span class="keyword">public</span> TextView title;</span><br><span class="line">    	  <span class="keyword">public</span> TextView info;</span><br><span class="line">	&#125;</span><br><span class="line">     &gt;&gt;<span class="keyword">if</span>(convertView == <span class="literal">null</span>)</span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          holder = <span class="keyword">new</span> <span class="title class_">ViewHolder</span>();</span><br><span class="line">          convertView = mInflater.inflate(R.layout.list_item, <span class="literal">null</span>);</span><br><span class="line">          holder.img = (ImageView)item.findViewById(R.id.img)</span><br><span class="line">          holder.title = (TextView)item.findViewById(R.id.title);</span><br><span class="line">          holder.info = (TextView)item.findViewById(R.id.info);</span><br><span class="line">          convertView.setTag(holder);				<span class="comment">//mTag=holder</span></span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          holder = (ViewHolder)convertView.getTag();		<span class="comment">//return mTag</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        holder.img.setImageResource((Integer) data.get(position).get(<span class="string">&quot;img&quot;</span>));</span><br><span class="line">        holder.title.setText((String)data.get(position).get(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">        holder.info.setText((String)data.get(position).get(<span class="string">&quot;info&quot;</span>));</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">return</span> convertView;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何在ListView间添加分割线</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//推荐用divider设置drawable的分割线</span></span><br><span class="line">&gt;&gt;.设置全局属性			</span><br><span class="line">   a).android:divider=<span class="string">&quot;#FFF&quot;</span>   	        <span class="comment">//设置为null可无视间距     </span></span><br><span class="line">   b).android:dividerHeight=<span class="string">&quot;1px&quot;</span>    </span><br><span class="line">   c).默认的list view不支持设置footerDevider,采取在每个item布局中添加</span><br><span class="line">      &gt; &lt;View</span><br><span class="line">          android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;1dp&quot;</span></span><br><span class="line">          android:background=<span class="string">&quot;#999&quot;</span></span><br><span class="line">          /&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>LinkedHashMap 源码解读</li>
<li>Drawable转Bitmap</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;Bitmap bitmap= BitmapFactory.decodeResource(getResources(),R.drawable.icon_hint);</span><br></pre></td></tr></table></figure>

<ol>
<li>Layout_weight</li>
</ol>
<p>根据比重划分布局<br>a).根据LinearLayout的orientation，设置layout_width&#x3D;0或者layout_height&#x3D;0<br>b).layout_weight&#x3D;xx,直接进行布局划分<br>根据剩余布局叠加进行划分<br>a).首先计算layout_width的布局之和layout_sum,layout_remain&#x3D;width-layout_sum<br>b).得出子view的宽度:layout_width+layout_remain*layout_weight&#x2F;sum</p>
<ol>
<li>android:layout_gravity和android:gravity的区别</li>
</ol>
<p>android:layout_gravity 用于设置当前View在父容器的位置<br>android:gravity 用于设置当前View中文本、图像的位置</p>
<ol>
<li>如何重用布局<br>采用</li>
<li>使用merge减少include布局所造成的布局层次</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;merge xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何优化布局</li>
</ol>
<p>设置为invisible或者gone的View -&gt; ViewStub<br>:1.ViewStub是一个不可见且大小为0的视图<br>:2.当ViewStub被设置为visible或者调用.inflate()时就会被指定的layout所代替<br>:3.inflatedId指定加载过来的layout id<br>:4.例子  </p>
<ol>
<li>android:layout_gravity的使用规则</li>
</ol>
<p>LinearyLayout 当orientation为horizontal时，存在 center\top\bottom<br>FrameLayout<br>a).android:layout_centerVertical</p>
<ol>
<li>TextView显示图像</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;android:drawableLeft 			<span class="comment">//设置图像id</span></span><br><span class="line">&gt;&gt;CharSequence charSequence=Html.fromHtml(html,<span class="keyword">new</span> <span class="title class_">ImageGetter</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Drawable <span class="title function_">getDrawable</span><span class="params">(String source)</span></span><br><span class="line"> 	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		Drawable drawable=getResources().getDrawable(getResourceId(source))</span><br><span class="line">		drawable.setBounds(<span class="number">0</span>,<span class="number">0</span>,drawable.getIntrinsicWidth(),drawable.getIntrinsicHeight())</span><br><span class="line">		<span class="keyword">return</span> drawable</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;,<span class="literal">null</span>)</span><br><span class="line">&gt;&gt;textView.setText(charSequence)</span><br></pre></td></tr></table></figure>

<p>53.SpannableString的使用</p>
<ul>
<li>支持局部字符样式化<br>a).<br>b).setSpan(Object what,int start,int end,int flags)<br>flags:Spanned.SPAN_INCLUSIVE_EXCLUSIVE &#x2F;&#x2F;不包括终止下标<br>:Spanned.SPAN_INCLUSIVE_INCLUSIVE &#x2F;&#x2F;包括起始下标、终止下标</li>
<li>采用ImageSpan设置文本图标<br>a).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Drawable</span> <span class="variable">drawable</span> <span class="operator">=</span> getResources().getDrawable(R.mipmap.a9c);</span><br><span class="line">     drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, <span class="number">42</span>, <span class="number">42</span>);</span><br><span class="line">     <span class="type">ImageSpan</span> <span class="variable">imageSpan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageSpan</span>(drawable);</span><br><span class="line">     spannableString.setSpan(imageSpan, <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_INCLUSIVE_EXCLUSIVE)</span><br><span class="line"></span><br><span class="line">&gt;&gt;ClickableSpan	设置响应点击	</span><br><span class="line">  a).setSpan(<span class="keyword">new</span> <span class="title class_">ClickableSpan</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="comment">//todo:利用intent执行跳转</span></span><br><span class="line">	&#125;</span><br><span class="line">     &#125;,<span class="number">0</span>,text.length(),Spanned.SPAN_EXCLUSIVE_EXCLUSIVE)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>BackgroundColorSpan设置背景色<br>a).</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BackgroundColorSpan bcSpan=<span class="keyword">new</span> <span class="title class_">BackgroundColorSpan</span>(Color.YELLOW)</span><br><span class="line">     spannableString.setSpan(bcSpan,start,end,Scannable.SPAN_EXCLUSIVE_EXCLUSIVE)</span><br></pre></td></tr></table></figure>

<p>54.AutoCompleteTextView的使用</p>
<p>android:completionThreshold &#x2F;&#x2F;至少用户输入多少个字符才显示<br>android:dropDownHeight &#x2F;&#x2F;下拉列表的高度<br>android:dropDownWidth<br>android:completionHint &#x2F;&#x2F;提示<br>setAdapter<br>a).String [] arr&#x3D;{“aa”,“aab”,“aac”};<br>ArrayAdapter arrayAdapter &#x3D; new ArrayAdapter(this, android.R.layout.simple_list_item_1,arr);<br>autotext.setAdapter(arrayAdapter);</p>
<ol>
<li>在按钮上显示图像的方式有哪些<br>Button android:drawableXXX(left|rigth|…)<br>Button继承自TextView，可以通过采用SpannableString进行setText<br>ImageButton<br>a).layout_width&amp;layout_height &#x2F;&#x2F;设置了具体的宽高后，图像并不会拉伸，而是背景增大<br>b).src &#x2F;&#x2F;设置图片<br>c).不设置宽高，表现与ImageView一致</li>
<li>如何动态改变Button的大小和位置<br>View.layout(left,top,right,bottom)</li>
<li>如何让一个显示图像的按钮在不同状态下显示不同图像</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">drawable	<span class="comment">//通过selector标签构建xml</span></span><br><span class="line">  &lt;selector&gt;</span><br><span class="line">	&lt;item android:state_pressed=“<span class="literal">true</span>”	android:drawable=“<span class="meta">@drawable</span>/pressed”/&gt;</span><br><span class="line">	&lt;item android:state_focused=“<span class="literal">true</span>”	android:drawable=“<span class="meta">@drawable</span>/focused”/&gt;</span><br><span class="line">	&lt;item android:drawable=“<span class="meta">@drawable</span>/normal”/&gt;</span><br><span class="line">  &lt;/selector&gt;	</span><br><span class="line">&gt;&gt;程序里设置监听</span><br><span class="line"></span><br><span class="line">  a).button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                Drawable drawable=getResources().getDrawable(R.mipmap.ic_launcher);</span><br><span class="line">                v.setBackground(drawable);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">  b).button.setOnFocusChangeListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnFocusChangeListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFocusChange</span><span class="params">(View v, <span class="type">boolean</span> hasFocus)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<ol>
<li>如何实现图像的半透明度<br>自定义View 在onDraw中绘制到canvas上</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">InputStream is=getResources().openRawResource(R.drawable.image)</span><br><span class="line">    Bitmap bitmap=BitmapFactory.decodeStream(is)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDraw</span><span class="params">(Canvas canvas)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      Paint paint=<span class="keyword">new</span> <span class="title class_">Paint</span>();</span><br><span class="line">      paint.setAlpha(<span class="number">180</span>);</span><br><span class="line">      canvas.drawBitmap(bitmap,….,paint)</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt;在图像上方覆盖一个半透明的图像	<span class="comment">//设置android:background,父组件采用FrameLayout</span></span><br></pre></td></tr></table></figure>

<ol>
<li>HttpURLConnection<br>URL</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">   HttpURLConnection connection= (HttpURLConnection) url.openConnection();</span><br><span class="line">   connection.setDoInput(<span class="literal">true</span>);</span><br><span class="line">   InputStream inputStream= connection.getInputStream();</span><br><span class="line">   <span class="type">byte</span>[] buffer=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">   <span class="type">int</span> hasRead=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>BufferedReader</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//inputStream进行包装，可进行整行读取</span></span><br><span class="line">  a).BufferedReader br=<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(is);</span><br><span class="line">     <span class="keyword">while</span>((line=br.readLine())!=<span class="literal">null</span>)</span><br><span class="line">	result+=line+”\n”;</span><br><span class="line">  c).网页也是字符组织，故该方法可行</span><br></pre></td></tr></table></figure>

<p>BitmapFactory.decodeStream(is)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取图片,返回的Bitmap用完要记得销毁,只有BufferedInputStream实现了reset</span></span><br></pre></td></tr></table></figure>

<ol>
<li>ProgressBar</li>
</ol>
<ul>
<li>属性设置<br>a).style&#x3D;“@android:style&#x2F;Widget.ProgressBar.Horizontal”<br>b).android:max&#x3D;“100”<br>c).android:progress&#x3D;“50”</li>
<li>属性更新<br>a).setProgress(int v)<br>b).incrementProgressBy(int step)</li>
</ul>
<ol>
<li>AbsListView<br>layoutChildren<br>a).ListView::layoutChildren</li>
<li>ListView,如何进行数据的增删改查</li>
</ol>
<p>数据更新<br>a).Adapter::notifyDataSetChanged() &#x2F;&#x2F;只使用于数据集的某项改变，更改引用将不会有效<br>b).Adapter::update &#x2F;&#x2F;自定义方法，直接更新对应holder<br>BaseAdapter.notifyDataSetInvalidated()<br>a).针对adapter数据源改变引用的情况</p>
<ol>
<li>ListView中如何显示数据库中的数据</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">setAdapter(CursorAdapter adapter)			<span class="comment">//重写子类继承CursorAdapter</span></span><br><span class="line">  a).<span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> View <span class="title function_">newView</span><span class="params">(Context context, Cursor cursor, ViewGroup parent)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           </span><br><span class="line">        ViewHolder viewHolder= <span class="keyword">new</span> <span class="title class_">ViewHolder</span>();</span><br><span class="line">        LayoutInflater  inflater=(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">        View view=inflater.inflate(R.layout.item_contacts ,parent,<span class="literal">false</span>);</span><br><span class="line">        viewHolder.tv_name=(TextView) view.findViewById(R.id.tv_showusername );</span><br><span class="line">	 view.setTag(vieHolder);</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bindView</span><span class="params">(View view, Context context, Cursor cursor)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Log. i(<span class="string">&quot;cursor&quot;</span> ,<span class="string">&quot;bindView=&quot;</span> +view);</span><br><span class="line">        ViewHolder viewHolder=(ViewHolder) view.getTag();</span><br><span class="line">        <span class="comment">//从数据库中查询姓名字段</span></span><br><span class="line">        String name=cursor.getString(cursor.getColumnIndex(PersonInfo.NAME));</span><br><span class="line">        <span class="comment">//从数据库中查询电话字段</span></span><br><span class="line">        String phoneNumber=cursor.getString(cursor.getColumnIndex(PersonInfo.PHONENUMBER));        </span><br><span class="line">        viewHolder. tv_name.setText(name);</span><br><span class="line">        viewHolder. tv_phonenumber.setText(phoneNumber);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>CursorAdapter源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">a).<span class="keyword">class</span> <span class="title class_">CursorAdapter</span> <span class="keyword">extends</span> <span class="title class_">BaseAdapter</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	</span><br><span class="line">       <span class="keyword">public</span> Object <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">if</span> (mDataValid &amp;&amp; mCursor != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            mCursor.moveToPosition(position);</span><br><span class="line">            <span class="keyword">return</span> mCursor;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">if</span> (mDataValid &amp;&amp; mCursor != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> mCursor.getCount();</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getItemId</span><span class="params">( <span class="type">int</span> position)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">if</span> (mDataValid &amp;&amp; mCursor != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">if</span> ( mCursor.moveToPosition(position)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="keyword">return</span> mCursor.getLong( mRowIDColumn)	<span class="comment">//mRowIDColumn==cursor.getColumnIndex(“_id”)</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">public</span> View <span class="title function_">getView</span><span class="params">( <span class="type">int</span> position, View convertView, ViewGroup parent)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">if</span> (!mDataValid) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>( <span class="string">&quot;this should only be called when the cursor is valid&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (!mCursor.moveToPosition(position)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>( <span class="string">&quot;couldn&#x27;t move cursor to position &quot;</span> + position);</span><br><span class="line">         &#125;</span><br><span class="line">         View v;</span><br><span class="line">         <span class="keyword">if</span> (convertView == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            v = newView( mContext, mCursor, parent);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            v = convertView;</span><br><span class="line">         &#125;</span><br><span class="line">         bindView(v, mContext, mCursor);</span><br><span class="line">         <span class="keyword">return</span> v;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>66.android TypedArray</p>
<p>在res&#x2F;value下新建attr.xml文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a).&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;  </span><br><span class="line">     &lt;resources&gt;  </span><br><span class="line">       &lt;declare-styleable name=<span class="string">&quot;MyView&quot;</span>&gt;  </span><br><span class="line">         &lt;attr name=<span class="string">&quot;myTextSize&quot;</span> format=<span class="string">&quot;dimension&quot;</span>/&gt;  </span><br><span class="line">         &lt;attr name=<span class="string">&quot;myColor&quot;</span> format=<span class="string">&quot;color&quot;</span>/&gt;  </span><br><span class="line"> 	  &lt;attr name=“title” format=“string”/&gt;</span><br><span class="line">    	&lt;/declare-styleable&gt;  </span><br><span class="line">     &lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<p>在布局中声明自己的类空间，并进行组件引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">    xmlns:myapp=<span class="string">&quot;http://schemas.android.com/apk/res/com.eyu.attrtextdemo&quot;</span>  </span><br><span class="line">    xmlns:tools=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>  </span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span>  </span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>  </span><br><span class="line">    android:orientation=<span class="string">&quot;vertical&quot;</span>  </span><br><span class="line">    tools:context=<span class="string">&quot;.MainActivity&quot;</span> &gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;TextView  </span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span>  </span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span>  </span><br><span class="line">        android:text=<span class="string">&quot;@string/hello_world&quot;</span> /&gt;  </span><br><span class="line">    &lt;com.eyu.attrtextdemo.MyView  </span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span>  </span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span>  </span><br><span class="line">        myapp:myTextSize=<span class="string">&quot;20sp&quot;</span>  </span><br><span class="line">        myapp:myColor=<span class="string">&quot;#324243&quot;</span>/&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>在自定义view的构造函数中获取属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//declare-styleable name=“MyView”</span></span><br><span class="line">  a).<span class="type">TypedArray</span> <span class="variable">a</span> <span class="operator">=</span> context.obtainStyledAttributes(attrs,R.styleable.MyView);      </span><br><span class="line">     <span class="type">int</span> <span class="variable">textColor</span> <span class="operator">=</span> a.getColor(R.styleable.MyView_myColor, <span class="number">003344</span>);  </span><br><span class="line">     <span class="type">float</span> <span class="variable">textSize</span> <span class="operator">=</span> a.getDimension(R.styleable.MyView_myTextSize, <span class="number">33</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li>如何动态加载apk文件(未安装)的类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;DexFile dexFile=dalvik.system.DexFile.loadDex(‘/sdcard/my.apk’,’/sdcard/my_temp.apk’,<span class="number">0</span>);</span><br><span class="line">&gt;&gt;Object obj=dexFile.loadClass(‘mobile.android.file.explorer.widget.Test’,<span class="literal">null</span>).newInstance()</span><br><span class="line">&gt;&gt;Method method=obj.getClass().getDeclaredMethod(‘getName’,<span class="literal">null</span>)</span><br><span class="line">&gt;&gt;String result=String.valueOf(method.invoke(obj,<span class="literal">null</span>))</span><br></pre></td></tr></table></figure>

<p>69.Android ContentProvider</p>
<ul>
<li>定义权限</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>&lt;permission</span><br><span class="line">      android:name=<span class="string">&quot;top.shixinzhang.permission.READ_CONTENT&quot;</span>    <span class="comment">//指定权限的名称</span></span><br><span class="line">      android:label=<span class="string">&quot;Permission for read content provider&quot;</span></span><br><span class="line">      android:protectionLevel=<span class="string">&quot;normal&quot;</span>    </span><br><span class="line">      /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>设置访问provider所需要的权限</p>
</li>
<li><p>在应用中注册权限</p>
</li>
<li><p>继承ContentProvider</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>成员</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UriMatcher matcher;	<span class="comment">//用于匹配Uri</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTHORITY=<span class="string">&quot;com.danding.lProvider&quot;</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Uri CONTENT_URI=Uri.parse(<span class="string">&quot;content://lprovider/person&quot;</span>)</span><br><span class="line">  :<span class="number">2.</span>初始化</span><br><span class="line">	&gt;<span class="keyword">static</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  mUriMatcher.addURI(AUTHORITY,<span class="string">&quot;person&quot;</span>,<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	&gt;onCreate()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  mDatabase = <span class="keyword">new</span> <span class="title class_">DbOpenHelper</span>(mContext).getWritableDatabase();</span><br><span class="line">	&#125;</span><br><span class="line">  :<span class="number">3.</span>查询</span><br><span class="line">  <span class="keyword">public</span> Cursor <span class="title function_">query</span><span class="params">(Uri uri,String[] projection,String selection,String[] selectionArgs)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Cursor c=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">switch</span>(matcher.match(uri))&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	    c=mSqliteDatabase.query(tableName,projection,selection,selectionArgs,</span><br><span class="line">		groupBy:<span class="literal">null</span>,having:<span class="literal">null</span>,orderBy:<span class="literal">null</span>) 	    </span><br><span class="line">	    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br><span class="line">  b).<span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri,ContentValues cv)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	low rowId=mSqliteDatabase.insert(tableName,nullColumnHack:”_id”,cv)</span><br><span class="line">	<span class="keyword">if</span>(rowId&gt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  Uri insertedUri=Uri.withAppendedPath(Uri.parse(authorities),”/user/“+rowId)</span><br><span class="line">	  getContext().getContentResolver().notifyChange(insertedUri,<span class="literal">null</span>)</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br><span class="line">  c).<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Uri uri,String selection,String[] selectionArgs)</span></span><br><span class="line">  d).<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Uri uri,ContentValues cv,String selection,String[] selectionArgs)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">//sqlite:  mSqliteDatabase.execSQL(“update student set name=‘dd’ where ….”) </span></span><br><span class="line">	<span class="type">int</span> affected=mSqliteDatabase.update(tableName,cv,selection,selectionArgs);</span><br><span class="line">	<span class="keyword">return</span> affected;</span><br><span class="line">     &#125;</span><br><span class="line">  e).<span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">(Uri uri)</span></span><br><span class="line">&gt;&gt;ContentObserver		<span class="comment">//监听ContentProvider数据改变</span></span><br><span class="line">  :<span class="number">1.</span>getContentResolver().registerContentObserver(Uri uri, <span class="type">boolean</span> notifyForDescendents,ContentObserver co)</span><br><span class="line">    <span class="comment">//设置监听，ContentObserver需要自己实现</span></span><br><span class="line">  :<span class="number">2.</span>getContext().getContentResolver().notifyChange(uri,<span class="literal">null</span>)	<span class="comment">//在provider中的更新和删除通知该uri已发生变化</span></span><br></pre></td></tr></table></figure>

<p>客户端调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="built_in">super</span>.onCreate(savedInstanceState)</span><br><span class="line">     …</span><br><span class="line">     Uri uri=Uri.parse(“content:<span class="comment">//com.ryg.chapter_2.book.provider”);</span></span><br><span class="line">     getContentResolver().query(uri,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>);	</span><br><span class="line">     getContentResolver().registerContentObserver(uri,<span class="literal">true</span>,Observer)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LObserver</span> <span class="keyword">extends</span> <span class="title class_">ContentObserver</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LObserver</span><span class="params">(Handler handler)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="built_in">super</span>(handler);	<span class="comment">//handler作用是用于更新ui</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChange</span><span class="params">(<span class="type">boolean</span> selfChange)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Cursor cursor=getContentResolver().query(…)</span><br><span class="line">	<span class="comment">//do ui op</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何设置Activity为程序启动的默认Activity</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&lt;intent-filter&gt;</span><br><span class="line">    &lt;action android:name=“android.intent.action.MAIN”/&gt;</span><br><span class="line">    &lt;category android:name=“android.intent.category.LAUNCHER”/&gt;</span><br><span class="line">  &lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>启动Activity的几种方式</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;startActivity	 intent</span><br><span class="line">&gt;&gt;startActivityForResult</span><br></pre></td></tr></table></figure>

<ol>
<li>Activity传递数据的方式</li>
</ol>
<ul>
<li>Intent<br>&#x2F;&#x2F;setData是用于设置uri<br>a).intent.putExtra(key,value) getIntent().getExtras().getString(key)</li>
<li>类的静态变量</li>
<li>剪切板<br>a).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ClipboardManager cm=(ClipboardManager)getSystemService(Context.CLIPBOARD_SERVICE)</span><br><span class="line">     &gt;&gt;设置</span><br><span class="line">       ClipboardManager cm=(ClipboardManager)getSystemService(Context.CLIPBOARD_SERVICE);</span><br><span class="line">       cm.setPrimaryClip(ClipData.newPlainText(“name”,”dancing”));</span><br><span class="line">     &gt;&gt;获取</span><br><span class="line">       cm.getPrimaryClip().getItemAt(<span class="number">0</span>).getText().toString()</span><br></pre></td></tr></table></figure>

<ul>
<li>全局对象 继承Application,同时修改manifest的的android:name</li>
</ul>
<ol>
<li>如何将Activity设置成半透明的模态框</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;在style.xml定义继承自<span class="meta">@android</span>:style/Theme.Dialog的主题</span><br><span class="line">&gt;&gt;&lt;style name=‘test’ parent=‘<span class="meta">@android</span>:style/Theme.Dialog’&gt;</span><br><span class="line">    &lt;item name=‘android:windowBackground”&gt;<span class="meta">@color</span>/colorAccent&lt;/item&gt;</span><br><span class="line">  &lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>74.如何接收广播<br>继承BroadcastReceiver,在onReceive(Context context,Intent intent)中处理广播消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a).<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   String msg=intent.getExtras().get(“msg”).toString();</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>orderedBroadcast</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a).设置传播结果 -&gt; setResultExtras(bundle)</span><br><span class="line">  b).获取传播结果 -&gt; Bundle bundle= getResultExtras(makeup:<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>在AndroidManifest.xml通过intent-filter指定action,category,data</li>
</ul>
<ol>
<li>如何获取短信内容<br>指定intent-filter</li>
<li>如何拦截手机屏幕休眠和唤醒<br>通过程序里注册广播监听 ScreenOnOffReceiver<br>ScreenOnOffReceiver receiver&#x3D;new ScreenOnOffReceiver()</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IntentFilter filter=<span class="keyword">new</span> <span class="title class_">IntentFilter</span>()</span><br><span class="line">  filter.addAction(Intent.ACTION_SCREEN_ON)</span><br><span class="line">  filter.addAction(Intent.ACTION_SCREEN_OFF)</span><br><span class="line">  registerRecei	<span class="title function_">ver</span><span class="params">(receiver,filter)</span></span><br></pre></td></tr></table></figure>

<ol>
<li>如何发送广播</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Intent intent…</span><br><span class="line">  intent.addAction(‘…’)</span><br><span class="line">  intent.putExtra(key,val)</span><br><span class="line">  sendBroadcast(intent)</span><br><span class="line">  Bundle bundle=intent.getExtras()<span class="comment">//当广播拿到消息</span></span><br></pre></td></tr></table></figure>

<ol>
<li>AIDL与Service</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;AIDL的创建</span><br><span class="line">  a).<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">float</span> price;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(Parcel in)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  id=in.readInt()</span><br><span class="line">	  name=in.readString()</span><br><span class="line">	  price=in.readFloat()	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeToParcel</span><span class="params">(Parcel dest,flags)</span>		<span class="comment">//写入</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		dest.writeInt(id)</span><br><span class="line">		dest.writeString(name)</span><br><span class="line">		dest.writeFloat(price)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//声明CREATOR常量</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;Product&gt;  CREATOR=<span class="keyword">new</span> <span class="title class_">Parcelable</span>.Creator&lt;Product&gt;&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="keyword">public</span> Product <span class="title function_">createFromParcel</span><span class="params">(Parcel in)</span>	<span class="comment">//读出</span></span><br><span class="line">		&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Product</span>(in)</span><br><span class="line">		&#125;</span><br><span class="line">               </span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="keyword">public</span> Product[] newArray(<span class="type">int</span> size) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Product</span>[size];</span><br><span class="line">               &#125;</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何读取联系人信息<br>Cursor cursor&#x3D;getContentResolver().query(ContactsContract.Contacts.CONTENT_URI,null,null,null,null)</li>
<li>请描述Content Provider的uri由哪几部分组成</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content://mobile.android.mydata/product/20</span></span><br><span class="line">&gt;&gt;scheme	content:<span class="comment">//</span></span><br><span class="line">&gt;&gt;authority	域名,mobile.android.mydata</span><br><span class="line">&gt;&gt;path		路径,product</span><br><span class="line">&gt;&gt;param		<span class="number">20</span></span><br></pre></td></tr></table></figure>

<ol>
<li>介绍开发ContentProvider的步骤<br>编写一个类，继承ContentProvider<br>实现query\update\delete\insert<br>在static块中创建UriMatcher,add需要映射的uri,初始化SqliteOpenHelper和SqliteDatabase的实例<br>manifest中注册provider并填写authorities属性，readPermission</li>
<li>如何为ContentProvider添加访问权限</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;在manifest中声明 自定义权限</span><br><span class="line">  &lt;permission android:name=“xxx” android:protectionLevel=“normal”/&gt;</span><br><span class="line">&gt;&gt;添加权限限制		<span class="comment">//provider可添加android:permission、android:readPermission、android:writePermission</span></span><br><span class="line">  a)&lt;provider</span><br><span class="line">    android:name=<span class="string">&quot;.MyContentProvider&quot;</span></span><br><span class="line">    android:authorities=“….”</span><br><span class="line">    ......</span><br><span class="line">    android:readPermission=“com.danding.lPermission” /&gt;</span><br><span class="line">  b)在应用中去使用权限</span><br><span class="line">    &lt;uses-permission android:name=“com.danding.lPermission”/&gt;</span><br></pre></td></tr></table></figure>

<p>84.AlertDialog</p>
<p>构建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">a).AlertDialog dialog= <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(<span class="built_in">this</span>)		<span class="comment">//不设置title不显示icon</span></span><br><span class="line">       .setIcon(R.drawable.menu_contact)</span><br><span class="line">       .setTitle(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">       .setMessage(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">       .setPositiveButton(<span class="string">&quot;确定&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">       .setNegativeButton(<span class="string">&quot;返回&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        </span><br><span class="line">           &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .create();</span><br><span class="line">     dialog.show();</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//设置button的颜色和大小</span></span><br><span class="line">     dialog.getButton(dialog.BUTTON_NEGATIVE).setTextColor(Color.parseColor(“#009900”))</span><br></pre></td></tr></table></figure>

<p>显示列表项</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//与setMessage冲突</span></span><br><span class="line">  a).builder.setItems(Items, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         Toast.makeText(getApplicationContext(), <span class="string">&quot;You clicked &quot;</span>+Items[i],          						Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<p>显示单选列表项</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a).setSingleChoiceItems(CharSequence[] items,<span class="type">int</span> checkedItem,DialogInterface.OnClickListener)</span><br></pre></td></tr></table></figure>

<p>显示多选列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a).setMultiChoiceItems(items,<span class="keyword">new</span> <span class="title class_">boolean</span>[]&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="literal">true</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">true</span>&#125;,<span class="keyword">new</span> 							<span class="title class_">DialogInterface</span>.OnMultiChoiceClickListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure>

<p>显示自定义列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a).setAdapter(? <span class="keyword">extends</span> <span class="title class_">BaseAdapter</span>)	<span class="comment">//注意用ConvertView和ViewHolder提高性能</span></span><br></pre></td></tr></table></figure>

<p>显示自定义View</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a).setView(view)</span><br></pre></td></tr></table></figure>

<p>85.如何自己控制对话框的关闭时机</p>
<p>控制mShowing 当它为false时对话框关闭不起作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Field field=dialog.getSuperClass().getDeclaredField(‘mShowing’)</span><br><span class="line">	field.setAccessible(<span class="literal">true</span>)</span><br><span class="line">	field.set(dialog,<span class="literal">false</span>)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>86.如何改变对话框的透明度</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;	Window window=dialog.getWindow()</span><br><span class="line">	WindowManager.LayoutParams lp=window.getAttributes()</span><br><span class="line">	lp.alpha=<span class="number">0.7f</span></span><br><span class="line">	window.setAttributes(lp)</span><br></pre></td></tr></table></figure>

<p>87.如何自己控制Toast的显示和关闭</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;Toast.TN.show、Toast.TN.hide 	打开和关闭对话框，对话框不会自动关闭</span><br><span class="line">&gt;&gt;Toast toast=Toast.makeText(<span class="built_in">this</span>,’…’,Toast.LENGTH_LONG)</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Field field=toast.getClass().getDeclaredField(’mTN’)</span><br><span class="line">	field.setAccessible(<span class="literal">true</span>)</span><br><span class="line">	Object ob=field.get(toast)</span><br><span class="line">	Method method=ob.getClass().getDeclaredMethod(‘show’,<span class="literal">null</span>)</span><br><span class="line">	method.invoke(ob,<span class="literal">null</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何使用Notification<br>&#x2F;属于remoteView<br>构建notification</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>NotificationManager nm=(NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE)</span><br><span class="line">     Notification.Builder builder=<span class="keyword">new</span> <span class="title class_">Notification</span>.Builder(<span class="built_in">this</span>)</span><br><span class="line">     Notification notification=builder</span><br><span class="line">	.setAutoCancel(<span class="literal">true</span>)</span><br><span class="line">	.setContentTitle(‘title’)</span><br><span class="line">	.setContentText(‘something here’)</span><br><span class="line">	.setContentIntent(PendingIntent:pi)	</span><br><span class="line">	.setDefaults(Notification.DEFAULT_SOUND|Notification.DEFAULT_VIBRATE)</span><br><span class="line">	.setWhen(System.currentTimeMillis())</span><br><span class="line">	.setProgress(max:<span class="type">int</span>,progress:<span class="type">int</span>,indeterminate:<span class="literal">false</span>)</span><br><span class="line">	.build();</span><br><span class="line">     nm.notify(<span class="number">1</span>,notification)</span><br></pre></td></tr></table></figure>

<p>Notification的重复发送<br>a).nm.notify(id:int,Notification:xx) &#x2F;&#x2F;覆盖已有的相同id的Notification,可用于更新progress<br>b).contentIntent(PendingIntent:pi) &#x2F;&#x2F;可针对Flag动态更新PendingIntent:Intent的内容  </p>
<blockquote>
<p>PendingIntent pi&#x3D;PendingIntent.getActivity(context:this,<br>requestCode:2,intent,PendingIntent.FLAG_UPDATE_CURRENT)<br>&#x2F;&#x2F;每次都更新intent的内容,requestCode用于判断是否是相同的pi<br>取消Notification<br>a).nm.cancel(id)</p>
</blockquote>
<ol>
<li>PendingIntent使用 &#x2F;&#x2F;跨进程intent<br>跳转到Activity getActivity(Context context,int requestCode,Intent intent,int flags)<br>发送广播 getBroadcast(Context context,int requestCode,Intent intent,int flags)<br>启动Service getService(Context context,int requestCode,Intent intent,int flags)<br>Flag变量说明 &#x2F;&#x2F;requestCode和notifyId作为识别一个PendingIntent的条件<br>FLAG_CANCEL_CURRENT &#x2F;&#x2F;取消当前已存在的PendingIntent<br>FLAG_UPDATE_CURRENT &#x2F;&#x2F;更新之前相同PendingIntent的内容<br>FLAG_ONE_SHOT &#x2F;&#x2F;PendingIntent只能有效一次<br>FLAG_NO_CREATE</li>
<li>点击Notification触发Activity跳转</li>
</ol>
<blockquote>
<blockquote>
<p>contentIntent<br>PendingIntent contentIntent&#x3D;PendingIntent.getActivity(this,0,intent,PendingIntent.FLAG_UPDATE_CURRENT)<br>notification.contentIntent&#x3D;contentIntent</p>
</blockquote>
</blockquote>
<p>91.如何自定义Notification的view</p>
<p>设置RemoteViews</p>
<p>RemoteViews remoteViews&#x3D;new RemoteViews(getPakcageName(),R.layout.xxx)<br>remoteViews.setTextViewText(R.id.xxx,’xxx’)<br>remoteViews.setOnClickPendingIntent(R.id.xxx,pendingIntent) &#x2F;&#x2F;设置点击的响应<br>notification.contentView&#x3D;remoteViews</p>
<p>92.然后为一个Activity添加选项菜单<br>menu.add(charSequence) &#x2F;&#x2F;添加1级菜单子项<br>menu.addSubMenu(charSequence) &#x2F;&#x2F;添加子菜单<br>menu.add((int groupId, int itemId, int order, charsequence title) &#x2F;&#x2F;itemId用于在回调时识别这个MenuItem</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例</span></span><br><span class="line">  :<span class="number">1.</span><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      menu.add(groupId:<span class="number">0</span>,itemId:<span class="number">1</span>,order:<span class="number">0</span>,title:”red”)	</span><br><span class="line">      menu.add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,”green”).setIcon(R.drawable.xxx)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.onCreateOptionsMenu(menu);</span><br><span class="line">    &#125;</span><br><span class="line">  :<span class="number">2.</span>getMenuInflater().inflate(R.menu.main, menu);  <span class="comment">//R.menu.main直接当作子菜单加入menu</span></span><br><span class="line">  :<span class="number">3.</span><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="type">int</span> groupId=item.getGroupId()</span><br><span class="line">        <span class="type">int</span> itemId=item.getItemId()</span><br><span class="line">        Log.v(<span class="string">&quot;options_item&quot;</span>,itemId+<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item)</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">4.</span><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(menu:Menu?)</span></span><br><span class="line">   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	menuInflater.inflate(R.menu.xxx,menu)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">super</span>.onCreateOptionsMenu(menu)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何将上下文菜单绑定至可视组件View</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreateContextMenu</span><span class="params">(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 选择菜单 一样 进行打气使用</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menc_main, menu);</span><br><span class="line">        <span class="built_in">super</span>.onCreateContextMenu(menu, v, menuInfo);</span><br><span class="line">    &#125; </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onContextItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">case</span> R.id.xxx：</span><br><span class="line">          <span class="comment">// 内容</span></span><br><span class="line">          <span class="keyword">break</span>；</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onContextItemSelected(item);</span><br><span class="line">  &#125;</span><br><span class="line">registerForContextMenu(button)</span><br></pre></td></tr></table></figure>

<ol>
<li>在单击菜单时，如何能跳转进别的Activity</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MenuItem item=menu.add(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,name)</span><br><span class="line">  item.setIntent(<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>,ActivityB.class)</span><br></pre></td></tr></table></figure>

<ol>
<li>菜单的回调函数有哪些</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;onOptionsItemSelected</span><br><span class="line">&gt;&gt;onContextItemSelected</span><br></pre></td></tr></table></figure>

<ol>
<li>如何使用SharedPreferences存取数据<br>读取</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存放文件位于/data/data/&#123;package&#125;/shared_prefs/PREFERENCE_NAME</span></span><br><span class="line">  SharedPreferences sharedPreferences=Context.getSharedPreferences(PREFERENCE_NAME,Context.MODE_PRIVATE)</span><br><span class="line">  sharedPreferences.getXXX(key,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>写入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SharedPreferences.Editor editor=sharedPreference.edit()</span><br><span class="line">  editor.putXXX(key,value)</span><br><span class="line">  editor.commit()</span><br></pre></td></tr></table></figure>

<ol>
<li>SharedPreferences &#x2F;&#x2F;构造函数(string name,int mode)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;mode</span><br><span class="line">  a).MODE_PRIVATE	<span class="comment">//默认针对应用包进行访问控制,新的写入会</span></span><br><span class="line">  b).MODE_APPEND			</span><br><span class="line">&gt;&gt;<span class="type">ObjectOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span>   </span><br><span class="line">  <span class="title class_">FileOutputStream</span>(<span class="string">&quot;employee.dat&quot;</span>));   </span><br><span class="line">  out.writeObject(staff); <span class="comment">//将对象写入&quot;employee.dat&quot;中   </span></span><br><span class="line">  out.close(); <span class="comment">//关闭流，请牢记   </span></span><br><span class="line">&gt;&gt;写入SharedPreferences</span><br><span class="line">  Product product=<span class="keyword">new</span> <span class="title class_">Product</span>()</span><br><span class="line">  ByteArrayOutputStream bos=<span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>()</span><br><span class="line">  ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos)</span><br><span class="line">  oos.writeObject(product)</span><br><span class="line">  SharedPreferences sp=Context.getSharedPreferences(<span class="built_in">this</span>,Context.MODE_PRIVATE)</span><br><span class="line">  String product64=<span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(bos.toByteArray()))</span><br><span class="line">  SharedPreferences.Editor editor=sharedPreferences.edit()</span><br><span class="line">  editor.putString(‘product’,product64)</span><br><span class="line">  editor.commit()</span><br><span class="line">&gt;&gt;从SharedPreferences中装载		</span><br><span class="line">  String product64=sharedPreferences.getString(‘product’,’’)</span><br><span class="line">  <span class="type">byte</span>[] bytes=Base64.decode(product64.getBytes(),Base64.DEFAULT);</span><br><span class="line">  ByteArrayInputStream bis=<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes)</span><br><span class="line">  ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis)</span><br><span class="line">  product product=(Product)  </span><br><span class="line">  ois.readObject()		<span class="comment">//Product implements Serializable</span></span><br></pre></td></tr></table></figure>

<p>99.Android如何解析xml文件<br>xml文件放置在res&#x2F;xml&#x2F;xxx.xml<br>采用XmlResourceParser进行解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">XmlResourceParser xrp=getResources().getXml(R.xml.books);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span>(xrp.getEventType()!=XmlResourceParser.END_DOCUMENT)	  <span class="comment">//文档解析结束</span></span><br><span class="line">            &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="comment">//遇到开标签</span></span><br><span class="line">                <span class="keyword">if</span>(xrp.getEventType()==XmlResourceParser.START_TAG)</span><br><span class="line">                &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                    String tagName=xrp.getName();	<span class="comment">//获取标签属性</span></span><br><span class="line">                    <span class="keyword">if</span>(tagName.equals(<span class="string">&quot;book&quot;</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        String bookPrice=xrp.getAttributeValue(namespace:<span class="literal">null</span>,name:”price<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                        sb.append(&quot;</span>price:<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                        sb.append(bookPrice);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        String bookYear=xrp.getAttributeValue(null,&quot;</span>date<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                        sb.append(&quot;</span>date:<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                        sb.append(bookYear);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        sb.append(&quot;</span>name:<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                        sb.append(xrp.nextText());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                    sb.append(&quot;</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                &#125;else if(xrp.getEventType()==XmlResourceParser.TEXT)</span></span><br><span class="line"><span class="string">  		 &#123;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">		     sb.append(xrp.getText());</span></span><br><span class="line"><span class="string"> 		 &#125;</span></span><br><span class="line"><span class="string">                xrp.next();</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#125;catch (Exception e)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">            e.printStackTrace();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>gson<br>解析json</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>val gson=Gson()</span><br><span class="line">     val goAbroad:AuditGoAbroad=gson.fromJson(str,AuditGoAbroad::class.java)</span><br></pre></td></tr></table></figure>

<p>转为string</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>val gson=Gson()</span><br><span class="line">     val str=gson.toJson(tmp)</span><br></pre></td></tr></table></figure>

<h3 id="下"><a href="#下" class="headerlink" title="下"></a>下</h3><ol>
<li>如何将table1表的数据和结构复制到table2上</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table table2 as select * from table1</span><br></pre></td></tr></table></figure>

<p>102.SQLite</p>
<ol>
<li>多次插入开启事务 &#x2F;&#x2F;节省回滚时间</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	mSqliteDatabase.beginTransaction()</span><br><span class="line">	…</span><br><span class="line">	mSqliteDatabase.execSQL(….)</span><br><span class="line">	…</span><br><span class="line">	mSqliteDatabase.setTransactionSuccessful()</span><br><span class="line">     &#125;<span class="keyword">catch</span>(Exception e)</span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	e.printStackTrace()</span><br><span class="line">     &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	mSqliteDatabase.endTransaction()</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>alter操作<br>a).alter table student add sex integer default 0 &#x2F;&#x2F;增加sex column<br>b).目前不支持drop column &#x2F;&#x2F;采用新建临时表，复制数据，删除旧表</li>
<li></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mSqliteDatabase.execSQL(“create table temp as select … from student”)</span><br><span class="line">mSqliteDatabase.execSQL(“drop table <span class="keyword">if</span> exists student”)</span><br><span class="line">mSqliteDatabase.execSQL(“alter table temp rename to student”)</span><br></pre></td></tr></table></figure>

<ol>
<li>SQLiteOpenHelper.getReadableDatabase和SQLiteOpenHelper.getWritableDatabase将数据库文件放哪了<br>保存在&#x2F;data&#x2F;data&#x2F;&#x2F;databases&#x2F;DATABASE_NAME</li>
</ol>
<p>104.然后将带数据的SQLite同apk一起发布</p>
<ul>
<li>SQLite放置在res&#x2F;raw<br>a).InputStream is&#x3D; getResources().openRawResource(R.id.filename)<br>b).InputStream is&#x3D; getAssets().oepn(path) &#x2F;&#x2F;path基于assets文件夹</li>
<li>Android不能打开放置在apk的数据库文件,因此在初始化时将文件拷贝到sdcard中</li>
<li>String databaseFilename&#x3D;‘&#x2F;sdcard&#x2F;test.db’<br>if(!new File(databaseFilename).exists())</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    InputStream is=getResources().openRawResource(R.raw.test)</span><br><span class="line">    FileOutputStream fos=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(databaseFiename)</span><br><span class="line">    <span class="type">byte</span>[] buffer= <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>]</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>((count=is.read(buffer))!=-<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      fos.write(buffer,<span class="number">0</span>,count)</span><br><span class="line">    &#125;</span><br><span class="line">    fos.close()</span><br><span class="line">    is.close()</span><br><span class="line">  &#125;</span><br><span class="line">  SQLiteDatabase database=SQLiteDatabase.createOrOpenDatabase(databaseFilename,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>105.Socket连接成功后，怎么获取服务器的ip和域名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socket.getInetAddress().getHostName()</span><br><span class="line">socket.getInetAddress().getHostAddress()</span><br></pre></td></tr></table></figure>

<ol>
<li>BufferedInputStream mark &#x2F;&#x2F;只有BufferedInputStream实现了mark方法</li>
</ol>
<ul>
<li>mark(int readmit) &#x2F;&#x2F;设置在标记位置失效前能够读取的字节数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">a)bis.mark(is.available());</span><br><span class="line">    <span class="type">byte</span>[] buffer=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    String result=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">while</span> ((len=bis.read(buffer))&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   	result+=<span class="keyword">new</span> <span class="title class_">String</span>(buffer,<span class="number">0</span>,len);</span><br><span class="line">    &#125;</span><br><span class="line">    bis.reset();</span><br><span class="line">    <span class="keyword">while</span> ((len=bis.read(buffer))&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> 	result+=<span class="keyword">new</span> <span class="title class_">String</span>(buffer,<span class="number">0</span>,len);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(result);</span><br><span class="line">    is.close();</span><br><span class="line">    bis.close();</span><br></pre></td></tr></table></figure>

<ol>
<li>如何打开手机中的蓝牙功能</li>
</ol>
<ul>
<li>使用Intent</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent enableIntent=<span class="keyword">new</span> <span class="title class_">Intent</span>(BluetoothAdapter.ACTION_REQUEST_ENABLE)</span><br><span class="line">  startActivityForResult(enableIntent,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>BluetoothAdapter</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BluetoothAdapter bluetoothAdapter=BluetoothAdapter.getDefaultAdapter()</span><br><span class="line">  bluetoothAdapter.enable()</span><br></pre></td></tr></table></figure>

<p>111.如何获取已绑定的蓝牙设备</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;BluetoothDevice&gt; devices=bluetoothAdapter.getBoundedDeviecs()</span><br></pre></td></tr></table></figure>

<p>112.搜索蓝牙的过程中经过哪些状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">IntentFilter filter=<span class="keyword">new</span> <span class="title class_">IntentFilter</span>(BluetoothDevice.ACTION_FOUND)</span><br><span class="line">  <span class="built_in">this</span>.registerReceiver(receiver,filter)</span><br><span class="line">  filter=<span class="keyword">new</span> <span class="title class_">IntentFilter</span>(BluetoothDevice.ACTION_DISCOVERY_FINISHED)</span><br><span class="line">  <span class="built_in">this</span>.registerReceiver(receiver,filter)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> BroadcastReceiver receiver=<span class="keyword">new</span> <span class="title class_">BroadcastReceiver</span>()</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context,Intent intent)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	String action=intent.getAction()</span><br><span class="line"> 	<span class="keyword">if</span>(BluetoothDevice.ACTION_FOUND.equals(action)</span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  BluetoothDevice device=intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE)</span><br><span class="line">  	  <span class="keyword">if</span>(device.getBondState()!=BluetoothDevice.BOND_BONDED)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="comment">//<span class="doctag">TODO:</span>处理这些未绑定的设备</span></span><br><span class="line"> 	  &#125;</span><br><span class="line">  	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(BluetoothDevice.ACTION_DISCOVERY_FINISHED.equals(action)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">  </span><br><span class="line">  adapter.startDiscovery()</span><br></pre></td></tr></table></figure>

<p>113.隐式Intent<br>系统默认 Intent<br>a).Intent.ACTION_DIAL 拨打电话,需要添加权限android.permission.CALL_PHONE<br>b).Intent.ACTION_NEW_OUTGOING_CALL 用户主动发起拨打电话<br>c).Intent.ACTION_SCREEN_ON|Intent.ACTION_SCREEN_OFF</p>
<p>114.如何采用广播监听去电和来电</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(<span class="keyword">final</span> Context context,Intent intent)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">if</span>(intent.getAction().equals(Intent.ACTION_NEW_OUTGOING_CALL)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="comment">//todo:去电</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="comment">//todo:来电</span></span><br><span class="line">	&#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>xml描述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.PROCESS_OUTGOING_CALLS&quot;</span>/&gt;</span><br><span class="line">  &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span><br><span class="line">  &lt;receiver android:name=<span class="string">&quot;.PhoneBroadcastReceiver&quot;</span>&gt;</span><br><span class="line">	&lt;intent-filter android:priority=<span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">	  &lt;action android:name=<span class="string">&quot;android.intent.action.NEW_OUTGOING_CALL&quot;</span>/&gt;</span><br><span class="line">	  &lt;action android:name=<span class="string">&quot;android.intent.action.PHONE_STATE&quot;</span>/&gt; </span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">  &lt;/receiver&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>Android支持的电话状态</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TelephonyManager</span> <span class="variable">tm</span> <span class="operator">=</span>(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE)</span><br><span class="line">  <span class="keyword">switch</span>(tm.getCallState())</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">case</span> TelephonyManager.CALL_STATE_RINGING:</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> TelephonyManager.CALL_STATE_IDLE:</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Android如何控制接听和挂断电话</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TelephonyManager telephonyManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">       Class&lt;TelephonyManager&gt; telephonyManagerClass=TelephonyManager.class;</span><br><span class="line">       Method telephonyMethod=telephonyManagerClass.getDeclaredMethod(<span class="string">&quot;getITelephony&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">       telephonyMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">       Object obj=telephonyMethod.invoke(telephonyManager,<span class="literal">null</span>);</span><br><span class="line">       Method endCallMethod=obj.getClass().getDeclaredMethod(<span class="string">&quot;endCall&quot;</span>);</span><br><span class="line">       endCallMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">       <span class="comment">//执行电话挂断</span></span><br><span class="line">       endCallMethod.invoke(obj,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">       Method answerRinginCallMethod=obj.getClass().getDeclaredMethod(<span class="string">&quot;answerRinginCallMethod&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">       answerRinginCallMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">       answerRinginCallMethod.invoke(obj,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>117.请给出访问通话记录的Content Provider URI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&lt;uses-permission android:name=“READ_CALL_LOG”/&gt;</span><br><span class="line">&gt;&gt;Uri.parse(“content:<span class="comment">//call_log/calls”)</span></span><br><span class="line">&gt;&gt;M版本以上进行动态权限申请</span><br><span class="line">  a).<span class="keyword">if</span>(PackageManager.PERMISSION_GRANTED==checkSelfPermission(Manifest.permission.READ_CALL_LOG)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       <span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> getContentResolver().query(Uri.parse(<span class="string">&quot;content://call_log/calls&quot;</span>), <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">       cursor.moveToFirst();</span><br><span class="line">       <span class="keyword">while</span> (!cursor.isAfterLast()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="type">int</span> <span class="variable">phone</span> <span class="operator">=</span> cursor.getInt(cursor.getColumnIndex(CallLog.Calls.NUMBER));</span><br><span class="line"> 	 String name=cursor.getString(cursor.getColumnIndex(CallLog.Calls.CACHED_NAME));</span><br><span class="line">        Log.v(“call_log”,phone+””);</span><br><span class="line">         cursor.moveToNext();</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        requestPermissions(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     Manifest.permission.READ_CALL_LOG&#125;,<span class="number">1</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRequestPermissionsResult</span><span class="params">(<span class="type">int</span> requestCode, <span class="meta">@NonNull</span> String[] permissions, <span class="meta">@NonNull</span> <span class="type">int</span>[] grantResults)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="built_in">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">        <span class="keyword">switch</span> (requestCode)</span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	     <span class="keyword">if</span>(grantResuls[<span class="number">0</span>]==PackageManager.PERMISSION_GRANTED)</span><br><span class="line">		…</span><br><span class="line">	     <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>119.发送短信 &#x2F;&#x2F;需要动态请求权限:android.permission.SEND_SMS</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SmsManager smsManager=SmsManager.getDefault()</span><br><span class="line">  String message=“i gonna fuck u”</span><br><span class="line">  List&lt;String&gt; msges=smsManager.divideMessage(message);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;msges.size();i++)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      smsManager.sendTextMessage(“<span class="number">12345678</span>”,<span class="literal">null</span>,”你好吗”,PendingIntent pi,PendingIntent di)	</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ContactsContract</li>
</ol>
<p>Contacts&amp;CommonDataKinds.Phone &#x2F;&#x2F;存储通讯录中每个人的概要信息<br>a).查询姓名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cursor c=getContentResolver().query(ContactsContract.Contacts.CONTENT_URI,<span class="literal">null</span>,<span class="literal">null</span>,…)</span><br><span class="line">    String name=c.getString(c.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME_PRIMARY))</span><br></pre></td></tr></table></figure>

<p>b).查询电话</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Cursor c=getContentResolver().query(ContactsContract.Contacts.CONTENT_URI,<span class="literal">null</span>,…)</span><br><span class="line"><span class="type">int</span> id=c.getInt(c.getColumnIndex(ContactsContract.Contacts._ID))</span><br><span class="line">c.close()</span><br><span class="line">c=getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI,<span class="literal">null</span>,</span><br><span class="line">ContactsContract.CommonDataKinds.Phone.CONTACT_ID+”=?”,id,<span class="literal">null</span>)</span><br><span class="line">c.moveToFirst()</span><br><span class="line"><span class="keyword">while</span>(!c.isAfterLast())</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  String 														phone=c.getString(c.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NORMALIZED_NUMBER))</span><br><span class="line">  …</span><br><span class="line">&#125;</span><br><span class="line">c.close()</span><br></pre></td></tr></table></figure>

<ol>
<li>VideoView 播放视频</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span>Uri.parse(path)</span><br><span class="line">  videoView.setVideoURI(uri)</span><br><span class="line">  videoView.start()</span><br><span class="line">  </span><br><span class="line">  videoView.setOnPreparedListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnPreparedListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPrepared</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">                mp.start();<span class="comment">// 播放</span></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;开始播放！&quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">  videoView.setOnCompletionListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnCompletionListener() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;播放完毕&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<ol>
<li>在工程路径下的res&#x2F;drawable存放tree.png,如果将图片显示在View上</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InputStream is=getResources().openRawResource(R.raw.xxx)  <span class="comment">//只适合读取raw下的资源</span></span><br><span class="line">  BitmapFactory.Options options=<span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options()</span><br><span class="line">  options.inSampleSize=<span class="number">2</span></span><br><span class="line">  Bitmap bitmap=BitmapFactory.decodeStream(is,<span class="literal">null</span>,opts)</span><br><span class="line">  canvas.drawBitmap(bitmap,<span class="number">10</span>,<span class="number">10</span>,<span class="literal">null</span>)</span><br><span class="line">Bitmap bitmap=BitmapFactory.decodeResource(getResources(),R.drawable.tree)</span><br></pre></td></tr></table></figure>

<p>123.调用Drawable进行绘图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Drawable.draw(canvas)	<span class="comment">//调用setBounds设置范围,在调用draw</span></span><br><span class="line">  Drawable drawable=getResources().getDrawable(R.drawable.tree)</span><br><span class="line">  drawable.setBounds(x,x,x,x)</span><br><span class="line">  drawable.draw(canvas)</span><br></pre></td></tr></table></figure>

<p>124.如何设置图像透明度</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Paint paint=<span class="keyword">new</span> <span class="title class_">Paint</span>()</span><br><span class="line">  paint.setAlpha(<span class="number">0.5</span>)</span><br><span class="line">  canvas.drawBitmap(bitmap,sourceRect,destRect,paint)</span><br></pre></td></tr></table></figure>

<p>125.如何旋转View</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Matrix</span><br><span class="line">  Matrix matrix=<span class="keyword">new</span> <span class="title class_">Matrix</span>()</span><br><span class="line">  matrix.setRotate(<span class="number">120</span>,<span class="number">80</span>,<span class="number">80</span>)</span><br><span class="line">  canvas.setMatrix(matrix)</span><br></pre></td></tr></table></figure>

<p>126.Activity 切换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">overridePendingTransition(<span class="type">int</span> enterAnim,<span class="type">int</span> exitAnim)</span><br><span class="line">  a).Intent intent=<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>,xxx.class)		  <span class="comment">//跳转</span></span><br><span class="line">     startActivity(intent);</span><br><span class="line">     overridePendingTransition(R.anim.enter,R.anim.exit)</span><br><span class="line">  b).<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finish</span><span class="params">()</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	overridePendingTransition(R.anim.enter,R.anim.exit)	<span class="comment">//退场</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>127.Android</p>
<ul>
<li>xml &#x2F;&#x2F;定义animation-list,位于res&#x2F;drawable,属于帧动画</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lottey_animlist.xml</span></span><br><span class="line">  &lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">  &lt;animation-list xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">      android:oneshot=<span class="string">&quot;false&quot;</span>&gt;&lt;!— oneshot 代表只会播放一次,默认为循环播放-&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_1&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_2&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_3&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_4&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_5&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">      &lt;item</span><br><span class="line">        android:drawable=<span class="string">&quot;@mipmap/lottery_6&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;200&quot;</span> /&gt;</span><br><span class="line">  &lt;/animation-list&gt;</span><br><span class="line">  <span class="comment">//使用ImageView作为载体显示</span></span><br><span class="line">  imageView.setImageResource(R.drawable.lottery_animlist)</span><br><span class="line">  AnimationDrawable animationDrawable=(AnimationDrawable)button.getBackground()</span><br><span class="line">  animationDrawable.start()</span><br></pre></td></tr></table></figure>

<ul>
<li>AnimationDrawable &#x2F;&#x2F;api<br>.start()<br>.stop()<br>.isRunning()<br>.getNumberOfFrames()<br>.setOneShot()</li>
</ul>
<p>onAnimationEnd 接口 采用hashCode()进行区分</p>
<p>128.动画</p>
<p>AlphaAnimation 透明度渐变，针对<br>a)动画声明 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;alpha xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">android:interpolator=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>  </span><br><span class="line">android:fromAlpha=<span class="string">&quot;1.0&quot;</span>  </span><br><span class="line">android:toAlpha=<span class="string">&quot;0.1&quot;</span>  </span><br><span class="line">android:duration=<span class="string">&quot;2000&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>b)动画调用 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Animation animation= AnimationUtils.loadAnimation(<span class="built_in">this</span>,R.anim.alpha_demo)</span><br><span class="line">imageView.startAnimation(animation)</span><br></pre></td></tr></table></figure>

<p>RotateAnimation 旋转渐,针对<br>a)动画声明 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;rotate xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">android:interpolator=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>  </span><br><span class="line">android:fromDegrees=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">android:toDegrees=<span class="string">&quot;360&quot;</span>  </span><br><span class="line">android:duration=<span class="string">&quot;1000&quot;</span>  </span><br><span class="line">android:repeatCount=<span class="string">&quot;1&quot;</span>  </span><br><span class="line">android:repeatMode=<span class="string">&quot;reverse&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>ScaleAnimation 放缩渐变,需要指定参考点,针对<br>a)动画声明 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;scale xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">    android:interpolator=<span class="string">&quot;@android:anim/accelerate_interpolator&quot;</span>  </span><br><span class="line">    android:fromXScale=<span class="string">&quot;0.2&quot;</span>  </span><br><span class="line">    android:toXScale=<span class="string">&quot;1.5&quot;</span>  </span><br><span class="line">    android:fromYScale=<span class="string">&quot;0.2&quot;</span>  </span><br><span class="line">    android:toYScale=<span class="string">&quot;1.5&quot;</span>  </span><br><span class="line">    android:pivotX=<span class="string">&quot;50%&quot;</span>  </span><br><span class="line">    android:pivotY=<span class="string">&quot;50%&quot;</span>  </span><br><span class="line">    android:duration=<span class="string">&quot;2000&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>TranslateAnimation 位移渐变,需要指定开始和结束坐标,针对<br>a)动画声明 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;translate xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">android:interpolator=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span>  </span><br><span class="line">android:fromXDelta=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">android:toXDelta=<span class="string">&quot;320&quot;</span>  </span><br><span class="line">android:fromYDelta=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">android:toYDelta=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">android:duration=<span class="string">&quot;2000&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>LayoutAnimation &#x2F;&#x2F;在ViewGroup中指定，并作用于它的各个子元素</p>
<p>a)动画声明 &#x3D;&gt; &#x2F;&#x2F;res&#x2F;anim&#x2F;anim_layout.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;layoutAnimation</span><br><span class="line">   xmlns:android=“http:<span class="comment">//schemas.android.com/apk/res/android”</span></span><br><span class="line">   android:delay=“<span class="number">0.5</span>”</span><br><span class="line">   android:animationOrder=“normal”</span><br><span class="line">   android:animation=“<span class="meta">@anim</span>/anim_item”/&gt;</span><br></pre></td></tr></table></figure>

<p>b)为子元素指定具体动画</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;set xmlns:android=“http:<span class="comment">//schemas.android.com/apk/res/android”</span></span><br><span class="line">     android:duration=“<span class="number">3000</span>”  &gt;</span><br><span class="line">&lt;alpha android:fromAlpha=“<span class="number">0.0</span> android:toAlpha=“<span class="number">1.0</span>”/&gt;</span><br><span class="line">&lt;translate android:fromXDelta=<span class="number">500</span>” android:toXDelta=“<span class="number">0</span>”/&gt;</span><br><span class="line">&lt;/set&gt;</span><br></pre></td></tr></table></figure>

<p>c)设置父容器属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListView android:layoutAnimation=“<span class="meta">@anim</span>/anim_layout”/&gt;</span><br></pre></td></tr></table></figure>

<p>AnimationSet 动画集合,针对<br>a)动画声明 &#x3D;&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;set xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">  android:interpolator=<span class="string">&quot;@android:anim/decelerate_interpolator&quot;</span>  </span><br><span class="line">  android:shareInterpolator=<span class="string">&quot;true&quot;</span> &gt;  </span><br><span class="line">  </span><br><span class="line">  &lt;scale  </span><br><span class="line">    android:duration=<span class="string">&quot;2000&quot;</span>  </span><br><span class="line">    android:fromXScale=<span class="string">&quot;0.2&quot;</span>  </span><br><span class="line">    android:fromYScale=<span class="string">&quot;0.2&quot;</span>  </span><br><span class="line">    android:pivotX=<span class="string">&quot;50%&quot;</span>  </span><br><span class="line">    android:pivotY=<span class="string">&quot;50%&quot;</span>  </span><br><span class="line">    android:toXScale=<span class="string">&quot;1.5&quot;</span>  </span><br><span class="line">    android:toYScale=<span class="string">&quot;1.5&quot;</span> /&gt;  </span><br><span class="line">  </span><br><span class="line">  &lt;rotate  </span><br><span class="line">    android:duration=<span class="string">&quot;1000&quot;</span>  </span><br><span class="line">    android:fromDegrees=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">    android:repeatCount=<span class="string">&quot;1&quot;</span>  </span><br><span class="line">    android:repeatMode=<span class="string">&quot;reverse&quot;</span>  </span><br><span class="line">    android:toDegrees=<span class="string">&quot;360&quot;</span> /&gt;  </span><br><span class="line">  </span><br><span class="line">  &lt;translate  </span><br><span class="line">    android:duration=<span class="string">&quot;2000&quot;</span>  </span><br><span class="line">    android:fromXDelta=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">    android:fromYDelta=<span class="string">&quot;0&quot;</span>  </span><br><span class="line">    android:toXDelta=<span class="string">&quot;320&quot;</span>  </span><br><span class="line">    android:toYDelta=<span class="string">&quot;0&quot;</span> /&gt;  </span><br><span class="line">  </span><br><span class="line">  &lt;alpha  </span><br><span class="line">    android:duration=<span class="string">&quot;2000&quot;</span>  </span><br><span class="line">    android:fromAlpha=<span class="string">&quot;1.0&quot;</span>  </span><br><span class="line">    android:toAlpha=<span class="string">&quot;0.1&quot;</span> /&gt;  </span><br><span class="line">  </span><br><span class="line"> &lt;/set&gt;</span><br></pre></td></tr></table></figure>

<p>129.属性动画 Animator</p>
<ul>
<li>ObjectAnimator</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">a)ObjectAnimator</span><br><span class="line">    .ofFloat(view,”rotateX”,<span class="number">0f</span>,<span class="number">360f</span>)</span><br><span class="line">    .setDuration(<span class="number">500</span>)</span><br><span class="line">    .start();</span><br><span class="line">  b)ObjectAnimator</span><br><span class="line">    .ofFloat(view,”y”,sunYStart,sunYEnd)</span><br><span class="line">    .setDuration(<span class="number">3000</span>)</span><br><span class="line">    .setRepeatCount(Animation.INFINITE)</span><br><span class="line">    .setRepeatMode(Animation.REVERSE)</span><br><span class="line">    .setInterpolator(<span class="keyword">new</span> <span class="title class_">AccelerateInterpolator</span>());	<span class="comment">//设置插值模式为加速</span></span><br><span class="line">    oa.start();</span><br><span class="line">  c)TypeEvaluator	<span class="comment">//辅助ObjectAnimator精确第计算由初始值到结束值的插值模式</span></span><br><span class="line">    ObjectAnimator</span><br><span class="line">    .ofInt(mSkyView,”backgroundColor”,mBlueSkyColor,mRedSkyColor)</span><br><span class="line">    .setDuration(<span class="number">3000</span>)</span><br><span class="line">    .setEvaluator(<span class="keyword">new</span> <span class="title class_">ArgbEvaluator</span>())		<span class="comment">//针对色彩的evaluator</span></span><br><span class="line">    .start();</span><br><span class="line">  d)添加插值监听</span><br><span class="line">    oa.start();</span><br><span class="line">    oa.addUpdateListener(<span class="keyword">new</span> <span class="title class_">AnimatorUpdateListener</span>()</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAnimationUpdate</span><span class="params">(ValueAnimator animator)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="type">float</span> <span class="variable">cVal</span> <span class="operator">=</span> (Float) animator.getAnimatedValue();  </span><br><span class="line">          view.setAlpha(cVal);  </span><br><span class="line">          view.setScaleX(cVal);  </span><br><span class="line">          view.setScaleY(cVal);  </span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ValueAnimator</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">a)添加插值监听</span><br><span class="line">   	ValueAnimator animator=ValueAnimator.ofFloat(<span class="number">0</span>,mScreenHeight-mBlueBall.getHeight()); </span><br><span class="line">	animator.setDuraton(<span class="number">3000</span>).start();</span><br><span class="line">	animator.addUpdateListener(<span class="keyword">new</span> <span class="title class_">AnimatorUpdateListener</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="meta">@Override</span></span><br><span class="line">	  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span></span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    mBlueBall.setTranslationY((Float)animation.getAnimatedValue())</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	va.setDuration(<span class="number">3000</span>)</span><br><span class="line">  b)返回自定义类型的估值</span><br><span class="line"> 	ValueAnimator animator=<span class="keyword">new</span> <span class="title class_">ValueAnimator</span>();</span><br><span class="line">	animator.setDuration(<span class="number">3000</span>);</span><br><span class="line">	animator.setObjectValues(<span class="keyword">new</span> <span class="title class_">PointF</span>(<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">	animator.setEvaluator(<span class="keyword">new</span> <span class="title class_">TypeEvaluator</span>&lt;PointF&gt;()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    </span><br><span class="line">	    <span class="comment">// fraction = t / duration  </span></span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> PointF <span class="title function_">evaluate</span><span class="params">(<span class="type">float</span> fraction, PointF startValue,  </span></span><br><span class="line"><span class="params">                    PointF endValue)</span>  </span><br><span class="line">            &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">                Log.e(TAG, fraction * <span class="number">3</span> + <span class="string">&quot;&quot;</span>);  </span><br><span class="line">                <span class="comment">// x方向200px/s ，则y方向0.5 * 10 * t  </span></span><br><span class="line">                <span class="type">PointF</span> <span class="variable">point</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PointF</span>();  </span><br><span class="line">                point.x = <span class="number">200</span> * fraction * <span class="number">3</span>;  </span><br><span class="line">                point.y = <span class="number">0.5f</span> * <span class="number">200</span> * (fraction * <span class="number">3</span>) * (fraction * <span class="number">3</span>);  </span><br><span class="line">                <span class="keyword">return</span> point;  </span><br><span class="line">            &#125;  </span><br><span class="line"></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>AnimatorSet 动画集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectAnimator</span> <span class="variable">anim1</span> <span class="operator">=</span> ObjectAnimator.ofFloat(mBlueBall, <span class="string">&quot;scaleX&quot;</span>,<span class="number">1.0f</span>, <span class="number">2f</span>);  </span><br><span class="line">	<span class="type">ObjectAnimator</span> <span class="variable">anim2</span> <span class="operator">=</span> ObjectAnimator.ofFloat(mBlueBall, <span class="string">&quot;scaleY&quot;</span>, <span class="number">1.0f</span>, <span class="number">2f</span>);  	 </span><br><span class="line">	AnimatorSet animSet=<span class="keyword">new</span> <span class="title class_">AnimatorSet</span>();</span><br><span class="line">	animSet.setDuration(<span class="number">2000</span>)</span><br><span class="line">	animSet.setInterpolator(<span class="keyword">new</span> <span class="title class_">LinearInterpolator</span>());</span><br><span class="line">	animist.playTogether(anim1,anim2);</span><br><span class="line">	animist.start();</span><br><span class="line">  a)AnimatorSet 设置动画执行秩序  </span><br><span class="line"> 	animSet.play(anim1).with(anim2)</span><br><span class="line">	animSet.play(anim2).before(anim3)</span><br><span class="line">  b)AnimatorSet xml设置</span><br><span class="line">    Animator animator=AnimatorInflater.loadAnimator(<span class="built_in">this</span>,R.animator.property_t);</span><br><span class="line">    animator.setTarget()</span><br><span class="line">    animator.start()</span><br></pre></td></tr></table></figure>

<ol>
<li>定义字符串数组资源</li>
</ol>
<ul>
<li>在res&#x2F;values 定义xxx.xml</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;string-array name=‘planet_array’&gt;</span><br><span class="line">	&lt;item&gt;venus&lt;/item&gt;</span><br><span class="line">	&lt;item&gt;mars&lt;/item&gt;</span><br><span class="line">	&lt;item&gt;earth&lt;/item&gt;</span><br><span class="line">    &lt;/string-array&gt;</span><br><span class="line">  &lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>程序加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] names=getResources().getStringArray(R.array.names)</span><br></pre></td></tr></table></figure>

<ol>
<li>图层layer资源<br>在res&#x2F;drawable layer.xml</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=“<span class="number">1.0</span>” encoding=“utf-<span class="number">8</span>”?&gt;</span><br><span class="line">  &lt;layer-list xmlns:android=“http:<span class="comment">//schemas.android.com/apk/res/android”&gt;</span></span><br><span class="line">    &lt;item&gt;</span><br><span class="line">      &lt;bitmap android:src=“” android:gravity=“center”/&gt;</span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">    &lt;item android:top=“20dp” android:left=“20dp”&gt;</span><br><span class="line">      &lt;bitmap android:src=“” android:gravity=“center”/&gt;</span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">  &lt;/layer-list&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>Clip图像资源</li>
</ol>
<ul>
<li>放置在res&#x2F;drawable clip.xml</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;clip xmlns=“http:<span class="comment">//schemeas.android.com/apk/res/android”</span></span><br><span class="line">	android:drawable=“”</span><br><span class="line">	android:orientation=“horizontal”</span><br><span class="line">	android:gravity=“left”</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>ImageView imageView</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ClipDrawable drawable=(ClipDrawable)imageView.getBackground()</span><br><span class="line">  drawable.setLevel(<span class="number">3000</span>)<span class="comment">//内部预设最大值为10000</span></span><br></pre></td></tr></table></figure>

<ol>
<li>ShapeDrawable<br>放置在res&#x2F;drawable shape.xml</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;shape xmlns=“http:<span class="comment">//schemas.android.com/apk/res/android” android:shape=“rectangle”&gt;</span></span><br><span class="line">    &lt;!— 定义渐变色 —&gt;</span><br><span class="line">    &lt;gradient android:startColor=“#<span class="number">00f</span>” android:endColor=“#f00” android:angle=“<span class="number">45</span>”/&gt;</span><br><span class="line">    &lt;padding  android:left=“7dp” android:right=“7dp”/&gt;</span><br><span class="line">    &lt;corners android:radius=“8dp”/&gt;</span><br><span class="line">    &lt;size android:height=<span class="string">&quot;20dp&quot;</span> android:width=<span class="string">&quot;20dp&quot;</span>/&gt;</span><br><span class="line">    &lt;solid android:color=“”/&gt;</span><br><span class="line">    &lt;stroke android:color=“” android:width=“”/&gt;</span><br><span class="line">  &lt;/shape&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>如何统一设置多个View的android:textSize和android:textColor<br>放置于res&#x2F;values style.xml</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;style name=“customText” parent=“<span class="meta">@style</span>/Text”&gt;</span><br><span class="line">	&lt;item name=“android:textSize”&gt;20sp&lt;/item&gt;</span><br><span class="line">	&lt;item name=“android:textColor”&gt;#008&lt;/item&gt;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>布局文件中的”@“、”+”、”?”含义<br>引用资源<br>+号代表所引用的资源id在R类不存在<br>?代表引用当前主题的属性</li>
<li>android获取屏幕高度和宽度的办法<br>:1.通过获取DisplayMetrics</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DisplayMetrics dm=getResources().getDisplayMetrics()</span><br><span class="line"> <span class="type">int</span> width=dm.widthPixels</span><br><span class="line"> <span class="type">int</span> height=dm.heightPixels</span><br></pre></td></tr></table></figure>

<p>:2.通过windowManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;DisplayMetrics dm=<span class="keyword">new</span> <span class="title class_">DisplayMetrics</span>()</span><br><span class="line">   getWindowManager().getDefaultDisplay(dm)</span><br><span class="line">   dm.widthPixels , dm.heightPixels</span><br></pre></td></tr></table></figure>

<p>138.AsyncTask<br>在ui主线程 执行.execute(T… params, T …progress,T result) 对应的参数会再doInBackground接收到回调 &#x3D;&gt; onPreExecute、onPostExecute、doInBackground、onProgressUpdate<br>AsyncTask的模板参数 &lt;Params,Progress,Result&gt;</p>
<blockquote>
<p>示例:<br>:1.ProgressBarAsyncTask asyncTask &#x3D; new ProgressBarAsyncTask(textView, progressBar);<br>asyncTask.execute(1000);<br>&#x2F;&#x2F;AsyncTask子类<br>public class ProgressBarAsyncTask extends AsyncTask&lt;Integer,Integer,String&gt;{</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView textView;  </span><br><span class="line">    <span class="keyword">private</span> ProgressBar progressBar; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProgressBarAsyncTask</span><span class="params">(TextView textView, ProgressBar progressBar)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        <span class="built_in">super</span>();  </span><br><span class="line">        <span class="built_in">this</span>.textView = textView;  </span><br><span class="line">        <span class="built_in">this</span>.progressBar = progressBar;  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">doInBackground</span><span class="params">(Integer... params)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        <span class="type">NetOperator</span> <span class="variable">netOperator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NetOperator</span>();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">10</span>; i &lt;= <span class="number">100</span>; i+=<span class="number">10</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">            netOperator.operator();  </span><br><span class="line">            publishProgress(i);  			<span class="comment">//进入onProgressUpdate回调</span></span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> i + params[<span class="number">0</span>].intValue() + <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//该回调处于ui主线程</span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onProgressUpdate</span><span class="params">(Integer... values)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        <span class="type">int</span> <span class="variable">vlaue</span> <span class="operator">=</span> values[<span class="number">0</span>];  </span><br><span class="line">        progressBar.setProgress(vlaue);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该方法运行在UI线程当中</span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPreExecute</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        textView.setText(<span class="string">&quot;开始执行异步线程&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//该回调处于ui主线程,onPostExecute的形参类型由result决定</span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPostExecute</span><span class="params">(String result)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        textView.setText(<span class="string">&quot;异步操作执行结束&quot;</span> + result);  </span><br><span class="line">    &#125;    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>139.Intent可传递的数据类型</p>
<blockquote>
<p>8种基本数据类型:double、int、float、char、long、byte、short、String<br>实现了Parcelable接口的类<br>实现了Serializable接口的类</p>
</blockquote>
<p>141.AlarmManager &#x2F;&#x2F;闹钟</p>
<ul>
<li>初始化<br>:1.AlarmManager am&#x3D;(AlarmManager)getSystemService(Context.ALARM_SERVICE)</li>
<li>类型<br>:1.AlarmManager.RTC_WAKEUP | AlarmManager.RTC &#x2F;&#x2F;按系统时钟计算,WAKEUP表示睡眠可用<br>:2.AlarmManager.ELAPSED_REALTIME | AlarmManager.ELAPSED_REALTIME_WAKEUP&#x2F;&#x2F;按真实流逝时间计算<br>:3.AlarmManager.POWER_OFF_WAKEUP &#x2F;&#x2F;关机也可使用</li>
<li>设定闹钟<br>a). am.set(int type,long startTime,PendingIntent pi)<br>b). am.setRepeating(int type,long startTime,long interval,PendingIntent pi) &#x2F;&#x2F;设置重复闹钟<br>c).pi &#x2F;&#x2F;当闹钟触发后，执行pi。可以通过Service或者Activity去进行提示</li>
</ul>
<ol>
<li>HandlerThread<br>&#x2F;&#x2F;例子</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">HandlerThread mThread=<span class="keyword">new</span> <span class="title class_">HandlerThread</span>(“xx”);</span><br><span class="line">  mThread.start();</span><br><span class="line">  handler = <span class="keyword">new</span> <span class="title class_">Handler</span>( myHandlerThread.getLooper() )&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="built_in">super</span>.handleMessage(msg);</span><br><span class="line">                <span class="comment">//这个方法是运行在 handler-thread 线程中的 ，可以执行耗时操作</span></span><br><span class="line">                Log.d( <span class="string">&quot;handler &quot;</span> , <span class="string">&quot;消息： &quot;</span> + msg.what + <span class="string">&quot;  线程： “+</span></span><br><span class="line"><span class="string">   				Thread.currentThread().getName()  ) ;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">   &#125;;</span></span><br><span class="line"><span class="string">  handler.send(xxx)</span></span><br></pre></td></tr></table></figure>

<p>Thread</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a)没有Looper 所以需要在Thread的run中去执行Looper.prepare()和Looper.loop()</span><br><span class="line">  b)Hanlder的初始化需要当前线程具有looper，所以也得放置在Looper的循环中</span><br></pre></td></tr></table></figure>

<p>HandlerThread<br>a)HandlerThread自行进行Looper的prepare、loop等api<br>b)允许调用getLooper()获取Looper实例<br>c)可以在handleMessage执行耗时<br>d)HandlerThread自己创建Looper，分担了主Looper的压力<br>e)异步请求是排队调用的，不适合网络IO</p>
<ol>
<li>自定义ViewGroup</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ViewGroup.LayoutParams <span class="title function_">generateLayoutParams</span><span class="params">(AttributeSet attrs)</span>		<span class="comment">//返回支持设置的属性</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MarginLayoutParams</span>(getContext(),attrs);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">onMeasure =&gt; a)子View的宽高测量调用  b)setMeasuredDimension设置宽高</span><br><span class="line"><span class="comment">//例子</span></span><br><span class="line">  <span class="meta">@Override</span> </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec,<span class="type">int</span> heightMeasureSpec)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> widthMode=MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">    <span class="type">int</span> heightMode=MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    <span class="type">int</span> sizeWidth=MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">    <span class="type">int</span> sizeHeight=MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">    <span class="comment">//进行childView的宽高计算，会进入view的onMeasure回调</span></span><br><span class="line">    measureChildren(widthMeasureSpec, heightMeasureSpec)	</span><br><span class="line">		<span class="comment">//for+measureChild(child,widthMeasureSpec,heightMeasureSpec)</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">cCount</span> <span class="operator">=</span> getChildCount();  </span><br><span class="line">    <span class="type">int</span> <span class="variable">cWidth</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">cHeight</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="type">MarginLayoutParams</span> <span class="variable">cParams</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cCount; i++)  </span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="type">View</span> <span class="variable">childView</span> <span class="operator">=</span> getChildAt(i);  </span><br><span class="line">      cWidth = childView.getMeasuredWidth();  </span><br><span class="line">      cHeight = childView.getMeasuredHeight();</span><br><span class="line">      cParams = (MarginLayoutParams) childView.getLayoutParams();</span><br><span class="line">      <span class="comment">// 上面两个childView  </span></span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">0</span> || i == <span class="number">1</span>)  </span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        tWidth += cWidth + cParams.leftMargin + cParams.rightMargin;  </span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">2</span> || i == <span class="number">3</span>)  </span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">         bWidth += cWidth + cParams.leftMargin + cParams.rightMargin;  </span><br><span class="line">      &#125;  </span><br><span class="line">      width=Math.max(tWidth,bWidth) </span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    setMeasuredDimension((widthMode == MeasureSpec.EXACTLY) ? sizeWidth  </span><br><span class="line">                : width, (heightMode == MeasureSpec.EXACTLY) ? sizeHeight  </span><br><span class="line">                : height);  </span><br><span class="line">  &#125;</span><br><span class="line">onLayout =&gt; 作为虚函数需要由子类实现  a)放置各个子View</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onLayout</span><span class="params">(<span class="type">boolean</span> changed,<span class="type">int</span> l,<span class="type">int</span> t,<span class="type">int</span> r,<span class="type">int</span> b)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> <span class="variable">cCount</span> <span class="operator">=</span> getChildCount(); </span><br><span class="line">    <span class="type">MarginLayoutParams</span> <span class="variable">cParams</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cCount;i++)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="type">View</span> <span class="variable">childView</span> <span class="operator">=</span> getChildAt(i);</span><br><span class="line">      <span class="type">int</span> cWidth=childView.getMeasuredWidth()</span><br><span class="line">      <span class="type">int</span> cHeight=childView.getMeasuredHeight()</span><br><span class="line">      <span class="comment">//……</span></span><br><span class="line">      childView.layout(cl, ct, cr, cb);  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>147.JVM的GC算法</p>
<ul>
<li>标记-清除 &#x2F;&#x2F;只清除可回收内存，使得在清除后出现很多不连续的小空间碎片<br>a)标记对象分为:可用内存、可回收内存、存活对象<br>b)释放可回收内存<br>c)缺点:清除标记后产生大量的不连续空间</li>
<li>标记-整理 &#x2F;&#x2F;需要进行整理，同时将存活对象移动到边界的一端<br>a)标记对象: 略<br>b)增加存活对象的整理过程</li>
<li>复制算法 &#x2F;&#x2F;新生代采用复制算法 - &gt; 8:1:1<br>a)它将内存分为大小相等的2块，每次只是使用其中一块。当一块内存用完之后，就将存活的对象复制到另外一块内存区域并将本块内存清理<br>b)新生代的复制算法:<br>’8’比例和一块’1’比例的内存作为活动空间，剩余的’1’比例作为空闲空间<br>每次新建对象放置于’8’比例的内存中,GC时清除活动空间的可回收对象，并把存活对象移动到空闲空间</li>
<li>活动空间和空闲空间的轮换,始终在’1’比例的内存块中进行</li>
<li>分代收集 &#x2F;&#x2F;新生代的对象有’年龄’计算，当超过阀值，转入老年代内存<br>a)新生代&#x3D;&gt;Eden+s0+1 老生代&#x3D;&gt;Perm</li>
</ul>
<ol>
<li>OkHttp<br>使用<br>:1.get方式 &#x2F;&#x2F;new OkHttpClient -&gt; 构造Request对象 -&gt; newCall -&gt;enqueue or execute</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://wwww.baidu.com&quot;</span>		<span class="comment">//同步</span></span><br><span class="line">  <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>()</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">    .url(url)</span><br><span class="line">    .get()</span><br><span class="line">    .build();</span><br><span class="line">  Response response= okHttpClient.newCall(request).execute()</span><br><span class="line">  String result= response.body().toString</span><br><span class="line">&gt; <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://wwww.baidu.com&quot;</span>		<span class="comment">//异步</span></span><br><span class="line">  <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>()</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">    .url(url)</span><br><span class="line">    .get()</span><br><span class="line">    .build()</span><br><span class="line">  okHttpClient.newCall(request).enqueue(ne <span class="title function_">Callback</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">	  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call call, IOException e)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onFailure: &quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"> 	<span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onResponse: &quot;</span> + response.body().string());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>:2.post方式 &#x2F;&#x2F;new OkHttpClient -&gt; 构造RequestBody、指定mimeType -&gt; 构造request</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; OkHttpClient okHttpClient= <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>()</span><br><span class="line">     RequestBody requestBody=<span class="keyword">new</span> <span class="title class_">FormBody</span>.Builder()</span><br><span class="line">				.add(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;danding&quot;</span>)</span><br><span class="line">				.build()</span><br><span class="line">     Request request= <span class="keyword">new</span> <span class="title class_">RequestBody</span>.Builder()</span><br><span class="line">			.url(url)</span><br><span class="line">			.post(requestBody)</span><br><span class="line">			.build()</span><br><span class="line">     okHttpClient.newCall(request).enqueue(<span class="keyword">new</span> <span class="title class_">CallBack</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    	  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call call, IOException e)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            Log.d(TAG, <span class="string">&quot;onFailure: &quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">     	<span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            Log.d(TAG, <span class="string">&quot;onResponse: &quot;</span> + response.body().string());</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure>

<p>:3.自定义Interceptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Response <span class="title function_">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> Request request=chain.request()</span><br><span class="line"> <span class="comment">//todo.... </span></span><br><span class="line"> Response response=chain.proceed(request)</span><br><span class="line"> <span class="keyword">return</span> response</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>源码<br>:1.创建OkHttpClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">public</span> <span class="title function_">OkHttpClient</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     		<span class="comment">//直接创建的 OkHttpClient对象并且默认构造builder对象进行初始化</span></span><br><span class="line">   <span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">Builder</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  OkHttpClient(Builder builder) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="built_in">this</span>.interceptors = Util.immutableList(builder.interceptors)</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:2.创建Request &#x2F;&#x2F;代码new Request.Builder().url(url).build()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  	  <span class="built_in">this</span>.method = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">   	  <span class="built_in">this</span>.headers = <span class="keyword">new</span> <span class="title class_">Headers</span>.Builder();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> Builder <span class="title function_">url</span><span class="params">(String url)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="type">HttpUrl</span> <span class="variable">parsed</span> <span class="operator">=</span> HttpUrl.parse(url);	<span class="comment">//获取scheme、host、port等信息</span></span><br><span class="line">  <span class="keyword">return</span> url(parsed)		<span class="comment">//设置this.url成员</span></span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:3.okHttpClient.newCall(request)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OkHttpClient</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>, Call.Factory, WebSocket.Factory &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> Call <span class="title function_">newCall</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RealCall</span>(<span class="built_in">this</span>, request, <span class="literal">false</span> <span class="comment">/* for web socket */</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&gt; <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">RealCall</span> <span class="keyword">implements</span> <span class="title class_">Call</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> <span class="meta">@Override</span> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(Callback responseCallback)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Already Executed&quot;</span>);</span><br><span class="line">          executed = <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       captureCallStackTrace();</span><br><span class="line">       client.dispatcher().enqueue(<span class="keyword">new</span> <span class="title class_">AsyncCall</span>(responseCallback))</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&gt; <span class="keyword">class</span> <span class="title class_">AsyncCall</span> <span class="keyword">extends</span> <span class="title class_">NamedRunnable</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	<span class="comment">//implements Runnable </span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> getResponseWithInterceptorChain()<span class="comment">//!!!核心</span></span><br><span class="line">    ... List&lt;Interceptor&gt; interceptors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()</span><br><span class="line">	interceptors.addAll(client.interceptors())</span><br><span class="line">	interceptors.add(retryAndFollowUpInterceptor)</span><br><span class="line">	interceptors.add(<span class="keyword">new</span> <span class="title class_">BridgeInterceptor</span>(client.cookieJar()))</span><br><span class="line">	interceptors.add(<span class="keyword">new</span> <span class="title class_">ConnectInterceptor</span>(client))</span><br><span class="line">	interceptors.add(<span class="keyword">new</span> <span class="title class_">CallServerInterceptor</span>(forWebSocket))</span><br><span class="line">   </span><br><span class="line">    ... Interceptor.<span class="type">Chain</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RealInterceptorChain</span>(</span><br><span class="line">    		interceptors, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>, originalRequest);</span><br><span class="line">	<span class="keyword">return</span> chain.proceed(originalRequest)</span><br><span class="line"></span><br><span class="line">    ... <span class="keyword">public</span> Response <span class="title function_">proceed</span><span class="params">(Request request, StreamAllocation streamAllocation, HttpCodec 			httpCodec ,RealConnection connection)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">if</span> (index &gt;= interceptors.size()) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>()</span><br><span class="line">	  val interceptor=interceptos.get(index)</span><br><span class="line">	  <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> interceptor.intercept(next)</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">    responseCallback.onResponse(RealCall.<span class="built_in">this</span>, response)</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:4.Dispatcher线程池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt; 	<span class="comment">/** 最大并发请求数为64 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxRequests</span> <span class="operator">=</span> <span class="number">64</span>;</span><br><span class="line"><span class="comment">/** 每个主机最大请求数为5 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxRequestsPerHost</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 线程池 */</span></span><br><span class="line"><span class="keyword">private</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 准备执行的请求 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Deque&lt;AsyncCall&gt; readyAsyncCalls = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 正在执行的异步请求，包含已经取消但未执行完的请求 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Deque&lt;AsyncCall&gt; runningAsyncCalls = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 正在执行的同步请求，包含已经取消单未执行完的请求 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Deque&lt;RealCall&gt; runningSyncCalls = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&gt; enqueue <span class="comment">//压入请求</span></span><br><span class="line">  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(AsyncCall call)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="comment">//maxRequest==64	</span></span><br><span class="line">   <span class="keyword">if</span> (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  	 runningAsyncCalls.add(call);		<span class="comment">//压入正在执行队列</span></span><br><span class="line">     executorService().execute(call);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     readyAsyncCalls.add(call);		<span class="comment">//压入就绪队列</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:5.Interceptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;BridgeInterceptor -&gt; 添加Content-Type、Content-Length、User-Agent等协议头</span><br><span class="line">&gt;ConnectInterceptor -&gt; ....</span><br><span class="line">&gt;CallServerInterceptor -&gt; 实际发送网络请求</span><br></pre></td></tr></table></figure>

<p>149.ButterKnife &#x2F;&#x2F;源码阅读<br>初始化<br>:1.定义处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来指定你使用的 java 版本。通常你应该返回</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SourceVersion <span class="title function_">getSupportedSourceVersion</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> SourceVersion.latestSupported();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//会被处理器调用，可以在这里获取Filer，Elements，Messager等辅助类，后面会解释</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ProcessingEnvironment processingEnv)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="built_in">super</span>.init(processingEnv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这个方法返回stirng类型的set集合，集合里包含了你需要处理的注解</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getSupportedAnnotationTypes</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        Set&lt;String&gt; annotataions = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;String&gt;();</span><br><span class="line">        annotataions.add(<span class="string">&quot;com.example.MyAnnotation&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> annotataions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//核心方法，这个一般的流程就是先扫描查找注解，再生成 java 文件</span></span><br><span class="line">   <span class="comment">//这2个步骤设计的知识点细节很多。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations,</span></span><br><span class="line"><span class="params">            RoundEnvironment env)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>:2.注册处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoService(Processor.class)</span></span><br><span class="line">     Public <span class="keyword">class</span> <span class="title class_">xxx</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">&gt;&gt;流程 </span><br><span class="line">  :<span class="number">1.</span>process (annotations:Set , env:RoundEnvironment)</span><br><span class="line">   -&gt;Map&lt;TypeElement, BindingSet&gt; targetClassMap = findAndParseTargets(env)</span><br><span class="line">     ...Map&lt;TypeElement,BindingSet&gt; targetClassMap</span><br><span class="line">	<span class="comment">//查找用BindView注解的元素</span></span><br><span class="line">     ...<span class="keyword">for</span>(Element element:env.getElementsAnnotatedWith(BindView.class)</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   	  parseBindView(element, Map&lt;TypeElement,BindingSet.Builder&gt;builderMap,...) </span><br><span class="line">	       ....enclosingElement=(TypeElement)element.getEnclosingElement()</span><br><span class="line">   		    <span class="type">TypeMirror</span> <span class="variable">elementType</span> <span class="operator">=</span> element.asType()<span class="comment">//转换成TypeMirror才能获取类型等信息</span></span><br><span class="line">		    <span class="keyword">if</span> (elementType.getKind() == TypeKind.TYPEVAR) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//变量类型</span></span><br><span class="line">			<span class="type">TypeVariable</span> <span class="variable">typeVariable</span> <span class="operator">=</span> (TypeVariable) <span class="type">elementType</span></span><br><span class="line">		        <span class="variable">elementType</span> <span class="operator">=</span> typeVariable.getUpperBound()<span class="comment">//获取上限类型</span></span><br><span class="line">		    &#125;</span><br><span class="line">		    <span class="comment">//检查1!!!</span></span><br><span class="line">		    <span class="keyword">if</span> (!isSubtypeOfType(elementType, VIEW_TYPE) &amp;&amp; !isInterface(elementType)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			<span class="keyword">throw</span> Error</span><br><span class="line">		    &#125;</span><br><span class="line">		    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> element.getAnnotation(BindView.class).value()<span class="comment">//获取资源id</span></span><br><span class="line">		    BindingSet.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> builderMap.get(enclosingElement)</span><br><span class="line">		    <span class="keyword">if</span>(builder!=<span class="literal">null</span>)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">		    <span class="keyword">else</span></span><br><span class="line">		      builder = getOrCreateBindingBuilder(builderMap, enclosingElement)</span><br><span class="line">			... builder=BindingSet.newBuilder(enclosingElement)</span><br><span class="line">			     -&gt;packageName= getPackage(enclosingElement).getQualifiedName()</span><br><span class="line">				 className=enclosingElement.getQualifiedName().toString()</span><br><span class="line">				 bindingClassName = ClassName.get(packageName, className + <span class="string">&quot;_ViewBinding&quot;</span>)</span><br><span class="line">			... builderMap.put(enclosingElement,builder)</span><br><span class="line">		      </span><br><span class="line">		    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> simpleName.toString();<span class="comment">//绑定注解的变量名</span></span><br><span class="line">		    <span class="type">TypeName</span> <span class="variable">type</span> <span class="operator">=</span> TypeName.get(elementType)<span class="comment">//变量类型</span></span><br><span class="line">		    <span class="comment">//往刚刚生成的BuildingSet.Builder加入field信息</span></span><br><span class="line">		    builder.addField(resourceId, <span class="keyword">new</span> <span class="title class_">FieldViewBinding</span>(name, type, required))</span><br><span class="line">		       ... <span class="keyword">new</span> <span class="title class_">FieldViewBinding</span>(name, type, required)<span class="comment">//分配变量名、变量类型</span></span><br><span class="line"></span><br><span class="line">		       ... viewId=<span class="keyword">new</span> <span class="title class_">ViewBinding</span>.Builder(id)</span><br><span class="line">			   viewIdMap.put(id,viewId)<span class="comment">//viewIdMap为BindingSet的私有变量</span></span><br><span class="line">		     	   viewId.setFieldBinding(biding)</span><br><span class="line">			  </span><br><span class="line"></span><br><span class="line">	  &#125;</span><br><span class="line">	   </span><br><span class="line">  :<span class="number">2.</span><span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingSet&gt; entry : bindingMap.entrySet()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       <span class="type">TypeElement</span> <span class="variable">typeElement</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">       <span class="type">BindingSet</span> <span class="variable">binding</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">       binding.brewJava </span><br><span class="line">	 ... BuildingSet.createType	<span class="comment">//创建TypeSpec</span></span><br><span class="line">             TypeSpec.<span class="type">Builder</span> <span class="variable">result</span> <span class="operator">=</span> TypeSpec.classBuilder(bindingClassName.simpleName())</span><br><span class="line">        	.addModifiers(PUBLIC);     <span class="comment">//创建类</span></span><br><span class="line">	      <span class="comment">//设置类要实现的接口</span></span><br><span class="line">	      <span class="keyword">if</span> (parentBinding != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      		 result.superclass(parentBinding.bindingClassName);</span><br><span class="line">    	      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      		 result.addSuperinterface(UNBINDER);<span class="comment">//设置实现Unbinder</span></span><br><span class="line">    	      &#125;</span><br><span class="line">	      <span class="keyword">if</span> (hasTargetField()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	   <span class="comment">//检查FieldViewBinding</span></span><br><span class="line">     		 result.addField(targetTypeName, <span class="string">&quot;target&quot;</span>, PRIVATE);</span><br><span class="line">              &#125;</span><br><span class="line">	      <span class="comment">//创建构造函数</span></span><br><span class="line">	      <span class="keyword">if</span> (isActivity) </span><br><span class="line">      		result.addMethod(createBindingConstructorForActivity(useAndroidX));</span><br><span class="line">   		  .... MethodSpec.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> MethodSpec.constructorBuilder()</span><br><span class="line">        		.addAnnotation(useAndroidX ? UI_THREAD_ANDROIDX : UI_THREAD)</span><br><span class="line"> 		        .addModifiers(PUBLIC)</span><br><span class="line">		        .addParameter(targetTypeName, <span class="string">&quot;target&quot;</span>);<span class="comment">//targetTypeName指向Activity</span></span><br><span class="line">	      <span class="comment">//构建bind</span></span><br><span class="line">	      result.addMethod(createBindingConstructor(sdk, debuggable, useAndroidX))</span><br><span class="line">		... <span class="keyword">if</span> (hasViewBindings()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			<span class="keyword">for</span> (ViewBinding binding : viewBindings) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        	           addViewBinding(constructor, binding, debuggable)</span><br><span class="line">			    -&gt; <span class="type">FieldViewBinding</span> <span class="variable">fieldBinding</span> <span class="operator">=</span> binding.getFieldBinding()</span><br><span class="line">				</span><br><span class="line">      			&#125;</span><br><span class="line">		    &#125;</span><br><span class="line">	      <span class="comment">//针对hasViewBinding,构建unbind函数</span></span><br><span class="line">	      <span class="keyword">if</span> (hasViewBindings() || parentBinding == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	        result.addMethod(createBindingUnbindMethod(result, useAndroidX));</span><br><span class="line">              &#125;</span><br><span class="line">	</span><br><span class="line">	      </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>概念</p>
<ul>
<li>Element &#x2F;&#x2F;包含程序中的包、类、方法等<br>TypeElement &#x2F;&#x2F;类<br>VariableElement &#x2F;&#x2F;变量<br>ExecutableElement &#x2F;&#x2F;函数</li>
<li>TypeElement<br>不含有类的信息,转换为Element后，调用element.asType()获取TypeMirror<br>:3.Typemirror &#x2F;&#x2F;tm&#x3D;element.asType()<br>包含元素信息 &#x2F;&#x2F;比如TYPEVAR等<br>getKind() &#x2F;&#x2F;DECLARED|EXECUTE<br>toString() &#x2F;&#x2F;返回类型完全限定名<br>:4.FieldViewBinding 类<br>constructor<br>FieldViewBinding(String name, TypeName type, boolean required) {<br>this.name &#x3D; name;<br>this.type &#x3D; type;<br>this.required &#x3D; required;<br>}<br>b).getModifiers &#x2F;&#x2F;返回Modifier修饰<br>c).getSimpleName &#x2F;&#x2F;返回注释元素的变量名<br>d).getEnclosingElement &#x2F;&#x2F;返回上一级Element,Enclosing(Activity)&#x3D; Annotation,Enclosing(Button)&#x3D;Activity<br>e). processingEnv.getElementUtils().getPackageOf(Element ) &#x2F;&#x2F;获取包名<br>解析BindView的流程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>parseBindView(Element element,....)</span><br><span class="line">     <span class="type">TypeMirror</span> <span class="variable">elementType</span> <span class="operator">=</span> element.asType()</span><br><span class="line">     <span class="keyword">if</span> (elementType.getKind() == TypeKind.TYPEVAR) <span class="comment">//注解在变量</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       <span class="type">TypeVariable</span> <span class="variable">typeVariable</span> <span class="operator">=</span> (TypeVariable) elementType;</span><br><span class="line">       elementType = typeVariable.getUpperBound();<span class="comment">//获取变量的上界,比如TextView extends View </span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//判断是否为View的子类型,不是的话报错</span></span><br><span class="line">     <span class="keyword">if</span> (!isSubtypeOfType(elementType, VIEW_TYPE) &amp;&amp; !isInterface(elementType)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="keyword">if</span> (elementType.getKind() == TypeKind.ERROR) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        note(element, <span class="string">&quot;@%s field with unresolved type (%s) &quot;</span></span><br><span class="line">                + <span class="string">&quot;must elsewhere be generated as a View or interface. (%s.%s)&quot;</span>,</span><br><span class="line">            BindView.class.getSimpleName(), elementType, enclosingElement.getQualifiedName(),</span><br><span class="line">            element.getSimpleName());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        error(element, <span class="string">&quot;@%s fields must extend from View or be an interface. (%s.%s)&quot;</span>,</span><br><span class="line">            BindView.class.getSimpleName(), enclosingElement.getQualifiedName(),</span><br><span class="line">            element.getSimpleName());</span><br><span class="line">        hasError = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取@BindView的id值</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> element.getAnnotation(BindView.class).value();</span><br><span class="line">    <span class="comment">//检查是否有缓存,有则生成ViewBindings</span></span><br><span class="line">    <span class="type">BindingClass</span> <span class="variable">bindingClass</span> <span class="operator">=</span> targetClassMap.get(enclosingElement);</span><br><span class="line">    <span class="keyword">if</span> (bindingClass != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="type">ViewBindings</span> <span class="variable">viewBindings</span> <span class="operator">=</span> bindingClass.getViewBinding(getId(id));</span><br><span class="line">      <span class="keyword">if</span> (viewBindings != <span class="literal">null</span> &amp;&amp; viewBindings.getFieldBinding() != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="type">FieldViewBinding</span> <span class="variable">existingBinding</span> <span class="operator">=</span> viewBindings.getFieldBinding();</span><br><span class="line">        error(element, <span class="string">&quot;Attempt to use @%s for an already bound ID %d on &#x27;%s&#x27;. (%s.%s)&quot;</span>,</span><br><span class="line">            BindView.class.getSimpleName(), id, existingBinding.getName(),</span><br><span class="line">            enclosingElement.getQualifiedName(), element.getSimpleName());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="comment">//声称_ViewBinding类</span></span><br><span class="line">      bindingClass = getOrCreateTargetClass(targetClassMap, enclosingElement);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//name就是word</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> element.getSimpleName().toString();</span><br><span class="line">    <span class="comment">//类型的名字</span></span><br><span class="line">    <span class="type">TypeName</span> <span class="variable">type</span> <span class="operator">=</span> TypeName.get(elementType);</span><br><span class="line">    <span class="comment">//生成FieldViewBinding实体</span></span><br><span class="line">    <span class="type">FieldViewBinding</span> <span class="variable">binding</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldViewBinding</span>(name, type, required)</span><br><span class="line">    <span class="comment">//5.加入到 bindingClass 成员变量的集合中</span></span><br><span class="line">    bindingClass.addField(getId(id), binding);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">2.</span>getOrCreateTargetClass			<span class="comment">//获取或者创建BindingClass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="type">BindingClass</span> <span class="variable">bindingClass</span> <span class="operator">=</span> targetClassMap.get(enclosingElement);</span><br><span class="line">  <span class="comment">//再次判断</span></span><br><span class="line">  <span class="keyword">if</span> (bindingClass == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="type">TypeName</span> <span class="variable">targetType</span> <span class="operator">=</span> TypeName.get(enclosingElement.asType())</span><br><span class="line"> <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> getPackageName(enclosingElement);<span class="comment">//获取该类的包名</span></span><br><span class="line"> <span class="comment">//类名字</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> getClassName(enclosingElement, packageName)</span><br><span class="line">     <span class="type">ClassName</span> <span class="variable">bindingClassName</span> <span class="operator">=</span> ClassName.get(packageName, className + <span class="string">&quot;_ViewBinding&quot;</span>)</span><br><span class="line">     <span class="type">boolean</span> <span class="variable">isFinal</span> <span class="operator">=</span> enclosingElement.getModifiers().contains(Modifier.FINAL)</span><br><span class="line">     bindingClass = <span class="keyword">new</span> <span class="title class_">BindingClass</span>(targetType, bindingClassName, isFinal)</span><br><span class="line"> <span class="comment">//加入集合，缓存</span></span><br><span class="line">     targetClassMap.put(enclosingElement, bindingClass);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:3.process &#x2F;&#x2F;生成java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">//遍历生存生成java 文件</span></span><br><span class="line">  <span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingClass&gt; entry : targetClassMap.entrySet()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="type">TypeElement</span> <span class="variable">typeElement</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">    <span class="type">BindingClass</span> <span class="variable">bindingClass</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line"></span><br><span class="line">    <span class="type">JavaFile</span> <span class="variable">javaFile</span> <span class="operator">=</span> bindingClass.brewJava();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      javaFile.writeTo(filer);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:4.brewJava &#x2F;&#x2F;生成</p>
<ul>
<li>BindingClass的数据结构<br>:1.</li>
<li>注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;</span></span><br><span class="line"><span class="meta">   </span></span><br><span class="line"><span class="meta">     </span></span><br><span class="line"><span class="meta">     ElementType.FIELD&#125;)</span></span><br><span class="line">  <span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="meta">@interface</span> BindView&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@IdRes</span> <span class="type">int</span> <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JavaPoet用法<br>a).目标模板</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  System.out.println(“hello,JavaPoet!”);</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>b).? extends AbstractProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">private</span> Filer filer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ProcessingEnvironment processingEnv)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">     <span class="built_in">super</span>.init(processingEnv);  </span><br><span class="line">     <span class="comment">// Filer是个接口，支持通过注解处理器创建新文件  </span></span><br><span class="line">     filer = processingEnv.getFiler();  </span><br><span class="line">   &#125;  	</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      </span><br><span class="line">   <span class="keyword">for</span> (TypeElement element : annotations) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">         <span class="keyword">if</span> (element.getQualifiedName().toString().equals(JPHelloWorld.class.getCanonicalName())) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">            <span class="comment">// 创建main方法  </span></span><br><span class="line">            <span class="type">MethodSpec</span> <span class="variable">main</span> <span class="operator">=</span> MethodSpec.methodBuilder(<span class="string">&quot;main&quot;</span>)  </span><br><span class="line">                    .addModifiers(Modifier.PUBLIC, Modifier.STATIC)  </span><br><span class="line">                    .returns(<span class="keyword">void</span>.class)  </span><br><span class="line">                    .addParameter(String[].class, <span class="string">&quot;args&quot;</span>)  </span><br><span class="line">                    .addStatement(<span class="string">&quot;$T.out.println($S)&quot;</span>, System.class, <span class="string">&quot;Hello, JavaPoet!&quot;</span>)  </span><br><span class="line">                    .build();  </span><br><span class="line">            <span class="comment">// 创建HelloWorld类  </span></span><br><span class="line">            <span class="type">TypeSpec</span> <span class="variable">helloWorld</span> <span class="operator">=</span> TypeSpec.classBuilder(<span class="string">&quot;HelloWorld&quot;</span>)  </span><br><span class="line">                    .addModifiers(Modifier.PUBLIC, Modifier.FINAL)  </span><br><span class="line">                    .addMethod(main)  </span><br><span class="line">                    .build();  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">                <span class="comment">// 生成 com.example.HelloWorld.java  </span></span><br><span class="line">                <span class="type">JavaFile</span> <span class="variable">javaFile</span> <span class="operator">=</span> JavaFile.builder(<span class="string">&quot;com.example&quot;</span>, helloWorld)  </span><br><span class="line">                        .addFileComment(<span class="string">&quot; This codes are generated automatically. Do not modify!&quot;</span>)  </span><br><span class="line">                        .build();  </span><br><span class="line">                <span class="comment">//　生成文件  </span></span><br><span class="line">                javaFile.writeTo(filer);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">                e.printStackTrace();  </span><br><span class="line">            &#125;  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">&#125;	</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>addViewBinding &#x2F;&#x2F;赋值BindView对应的View id</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>CodeBlock.Builder builder=CodeBlock.builder()</span><br><span class="line">	.add(<span class="string">&quot;target.$L&quot;</span>,fieldBinding.getName())</span><br><span class="line">  :<span class="number">2.</span>赋值</span><br><span class="line">     <span class="keyword">if</span> (requiresCast) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	<span class="comment">//需要转型</span></span><br><span class="line">        builder.add(<span class="string">&quot;($T) &quot;</span>, fieldBinding.getType());</span><br><span class="line">      &#125;</span><br><span class="line">     builder.add(<span class="string">&quot;source.findViewById($L)&quot;</span>, binding.getId().code);  <span class="comment">//getId对应设置时的数字</span></span><br><span class="line">- bind 				<span class="comment">//运行时</span></span><br><span class="line">  :<span class="number">1.</span><span class="keyword">public</span> <span class="keyword">static</span> Unbinder <span class="title function_">bind</span><span class="params">(Activity target)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     		<span class="comment">//针对Activity和DecorView</span></span><br><span class="line">	View sourceView=target.getWindow().getDecorView()</span><br><span class="line">	<span class="keyword">return</span> createBinding(target,sourceView)</span><br><span class="line">     &#125;</span><br><span class="line">  :<span class="number">2.</span><span class="keyword">public</span> <span class="keyword">static</span> Unbinder <span class="title function_">crateBinding</span><span class="params">(Object target,View source)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Class&lt;?&gt; targetClass =target.getClass()</span><br><span class="line">       <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">&quot;Looking up binding for &quot;</span> + targetClass.getName());</span><br><span class="line">       Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">Unbinder</span>&gt; constructor = findBindingConstructorForClass(targetClass)</span><br><span class="line">	<span class="comment">//返回构造器，以便初始化对象</span></span><br><span class="line">       <span class="keyword">if</span> (constructor == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">return</span> Unbinder.EMPTY;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="keyword">return</span> constructor.newInstance(target, source);		<span class="comment">//初始化对象</span></span><br><span class="line">       &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         ….</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  :<span class="number">3.</span>Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">Unbinder</span>&gt; findBindingConstructorForClass(Class&lt;?&gt; cls)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">Unbinder</span>&gt; bindingCtor = BINDINGS.get(cls)<span class="comment">//查看缓存</span></span><br><span class="line">  	<span class="keyword">if</span> (bindingCtor != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="keyword">if</span> (debug) Log.d(TAG, <span class="string">&quot;HIT: Cached in binding map.&quot;</span>);</span><br><span class="line">           <span class="keyword">return</span> bindingCtor;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="type">String</span> <span class="variable">clsName</span> <span class="operator">=</span> cls.getName()		<span class="comment">//cls属于Class，调用getName获取类名</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          Class&lt;?&gt; bindingClass = cls.getClassLoader().loadClass(clsName +<span class="string">&quot;_ViewBinding”)</span></span><br><span class="line"><span class="string">          bindingCtor = (Constructor&lt;? extends Unbinder&gt;) bindingClass.getConstructor(cls, View.class);</span></span><br><span class="line"><span class="string">         &#125; catch (ClassNotFoundException e) &#123;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">            bindingCtor = findBindingConstructorForClass(cls.getSuperclass());</span></span><br><span class="line"><span class="string">         &#125; catch (NoSuchMethodException e) &#123;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">         BINDINGS.put(cls, bindingCtor)	</span></span><br><span class="line"><span class="string">     &#125;</span></span><br></pre></td></tr></table></figure>

<p>150.Dalvik内存模型</p>
<ul>
<li><p>Heap&#x3D;Active Heap + Zygote Heap</p>
</li>
<li><p>Bitmap来标记引用情况<br>:1.采用一个unsigned long数组来维护Heap Bitmap, Bitmap的某个位为1则标记该对象正在使用<br>:2.采用Live Bitmap+ Mark Bitmap来描述堆对象</p>
<blockquote>
<p>Live Bitmap用于标记上一次GC时被引用的对象,也就是未回收对象<br>Mark Bitmap标记当前GC有被引用的对象<br>回收Live Bitmap&#x3D;1, Mark Bitmap&#x3D;0的对象</p>
</blockquote>
</li>
<li><p>垃圾收集<br>:1.mark阶段</p>
<blockquote>
<p>标记根对象(非并行) -&gt; 标记栈变量、静态成员、方法区常量、本地方法被引用的对象<br>标记被根集所引用的对象(允许并行) -&gt; 增加Card Table,以免其他线程更改了该对象的引用情况</p>
</blockquote>
</li>
<li><p>Card Table<br>:1.Card Table 由Card组成，每个Card可以为CLEAN或者DIRTY，每个Card占用一个字节<br>:2.在堆中，连续GC_CARD_SIZE地址的对象共用一个Card，Dalvik设置为128，在32位机器上就是4个对象</p>
</li>
<li><p>Mark Stack &#x2F;&#x2F;递归方式的标记对象<br>:1.避免函数递归层次过深占用内存<br>:2.在第一次标记的过程中，先找到根集对象，然后将其压入Mark Stack</p>
<blockquote>
<p>在之后的过程中，弹出Mark Stack的对象，并标记在Bitamap之中，并将该对象的引用也压入Mark Stack</p>
</blockquote>
</li>
</ul>
<p>151.ART垃圾回收</p>
<ul>
<li>Image Space、Zygote Space、Allocation Space、Large Object Space、Card Table</li>
<li>Bitmap&#x3D;Live Bitmap +Mark Bitmap</li>
<li>mod_union_table<br>:1.image_mod_union_table -&gt; 记录在并行GC阶段，image space上所分配的对于在Zygote、Allocation对象的引用<br>:2.zygote_mod_union_table -&gt; 记录在并行Gc阶段，zygote space上分配的对于Allocation堆的对象的引用<br>:3.跟Card Table配合，使得Card Table可以在标记阶段重复使用</li>
<li>第一步是调用ModUnionTable类的成员函数ClearCards清理Card Table里面的Dirty Card，并且将这些Dirty Card记录在Mod<br>Union Table中。第二步是调用ModUnionTable类的成员函数Update将遍历记录在Mod Union Table里面的Drity Card，并且找<br>到对应的被修改对象，然后将被修改对象引用的其它对象记录起来。第三步是调用ModUnionTable类的成员函数MarkReferences标记前<br>面第二步那些被被修改对象引用的其它对象。通过这种方式，就可以使用Card Table可以在标记阶段重复使用，即在执行第二步之前，重<br>复执行第一步，最后通过Mod Union Table将所有被被修改对象引用的其它对象收集起来统一进行标记，避免对相同对象进行重复标记</li>
<li>stack<br>:1.Mark Stack,用于在GC过程中递归标记对象</li>
</ul>
<p>151.2.JVM 可达性分析中哪些对象可以作为根节点</p>
<ul>
<li>栈的引用对象</li>
<li>本地方法栈中的引用对象 &#x2F;&#x2F;指jni</li>
<li>类的静态成员</li>
<li>方法区重的常量引用对象</li>
</ul>
<ol>
<li>HashSet</li>
</ol>
<ul>
<li>采用HashMap进行实现,值为new出的Object</li>
<li>采用HashMap的put进行不重复性的保证</li>
</ul>
<ol>
<li>SSL中的对称加密和非对称加密</li>
</ol>
<ul>
<li>对称加密<br>a).当通过浏览器向服务器请求安全网页时(https:&#x2F;&#x2F;…)<br>b).服务器同时把证书和公钥发送过来<br>c).浏览器检查证书是不是由信赖机构颁发的<br>d).浏览器随机生成对称密钥，并采用服务器发送的公钥加密自身的公钥，同时采用公钥加密请求，一并发送至服务器<br>e).服务器用自己的私钥解密了发过来的密钥，并用该密钥解析加密后的请求<br>f).服务器用收到的密钥加密返回的数据<br>G).浏览器用自身的私钥解密服务器返回的加密消息<br>&#x2F;&#x2F;那么中间人有没有可能解密出信息呢，关注点主要在客户端发来的信息<br>&#x2F;&#x2F;从d步骤开始检测,中间人截取到了被加密的浏览器密钥，但是无法猜测对应服务器的公钥，故无法解密<br>&#x2F;&#x2F; a)假设中间人清除目标服务器，首先获取了服务器的公钥，但是只有私钥才能解密被该公钥加密后的信息，故也无法解密</li>
</ul>
<ol>
<li>Handler的内存泄露问题</li>
</ol>
<ul>
<li>当使用内部类（包括匿名类）来创建Handler的时候，Handler对象会隐式地持有一个外部类对象（通常是一个Activity）的引用（不然你怎么可 能通过Handler来操作Activity中的View？）。而Handler通常会伴随着一个耗时的后台线程（例如从网络拉取图片）一起出现，这个后台线程在任务执行完毕（例如图片下载完毕）之后，通过消息机制通知Handler，然后Handler把图片更新到界面。然而，如果用户在网络请求过程中关闭了Activity，正常情况下，Activity不再被使用，它就有可能在GC检查时被回收掉，但由于这时线程尚未执行完，而该线程持有Handler的引用（不然它怎么发消息给Handler？），这个Handler又持有Activity的引用，就导致该Activity无法被回收（即内存泄露），直到网络请求结束（例如图片下载完毕）。另外，如果你执行了Handler的postDelayed()方法，该方法会将你的Handler装入一个Message，并把这条Message推到MessageQueue中，那么在你设定的delay到达之前，会有一条MessageQueue -&gt; Message -&gt; Handler -&gt; Activity的链，导致你的Activity被持有引用而无法被回收</li>
<li>改善<br>:1.Activity的引用包装为WeakReference&lt;&gt;弱引用<br>:2.声明Handler为静态类</li>
</ul>
<ol>
<li>Android volatile关键字</li>
</ol>
<ul>
<li>JVM对于volatile所提供的内存屏障 &#x2F;&#x2F;内存屏障的作用 -&gt; 阻止屏障2侧的指令重排<br>a).Load Barrier &#x2F;&#x2F;在指令前插入Load Barrier，可以让高速缓存的数据失效，强制从主存加载<br>b).Store Barrier &#x2F;&#x2F;在指令后插入Store Barrier，强制写回主存<br>c).在每个volatile写操作前插入StoreStore屏障，在写操作后插入StoreLoad屏障<br>在每个volatile读操作前插入LoadLoad屏障，在读操作后插入LoadStore屏障</li>
<li>多线程工作时，线程对于特定变量采取对主存读取后拷贝到自身内存区的办法进行操作</li>
<li>volatile保证该变量是通过共享内存进行同步的</li>
<li>volatile不能替代synchronized，因为不能保证原子性操作</li>
</ul>
<ol>
<li>EventBus 源码阅读 &#x2F;&#x2F;反射Class通常采用通配符 &#x3D;&gt;Class&lt;?&gt;或者Class&lt;? extends T&gt;</li>
</ol>
<ul>
<li>成员<br>:1.subscriptionsByEventType:HashMap &#x2F;&#x2F;subscription &#x3D; subscriber+subscriberMethod<br>:2.typesBySubscriber<br>:3.subscriberMethodFinder<br>:4.METHOD_CACHE:HashMap&lt;Subscriber,List&gt; &#x2F;&#x2F;缓存<br>:5.PostingThreadState &#x2F;&#x2F;带有事件队列，当前线程的posting状态</li>
<li>流程<br>:1.register</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val subscriberClass=subscriber.getClass()</span><br><span class="line">  </span><br><span class="line">List&lt;SubscriberMethod&gt; subscriberMethods=subscriberMethodFinder.findSubscriberMethods(cls)</span><br><span class="line">   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	...findUsingReflection</span><br><span class="line">           ...moveToSuperclass 		<span class="comment">//从子类到父类都去查找注解信息</span></span><br><span class="line">              ...findUsingReflectionInSingleClass </span><br><span class="line">		-&gt; 检查参数是否只有一个 -&gt; getAnnotation -&gt; 获取Subscribe注解信息 -&gt; 生成subscriberMethod</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>:2.subscribe</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">for</span>(subscriberMethod in subscriberMethods)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  	subscribe(subscriber,subscriberMethod)</span><br><span class="line">	  ...Class&lt;?&gt; eventType = subscriberMethod.eventType;<span class="comment">//获取订阅的事件类型</span></span><br><span class="line">	     <span class="type">subscription</span> <span class="variable">newSubscription</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Subscription</span>(subscriber, subscriberMethod)</span><br><span class="line">	     val subscriptions=subscriptionsByEventType.get(eventType)</span><br><span class="line">	     <span class="keyword">if</span>(subscriptions.contains(newSubscription))<span class="comment">//检查1！！！</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span></span><br><span class="line">	     subscriptionsByEventType.put(eventType,subscriptions)</span><br><span class="line">	  </span><br><span class="line">	  ...List&lt;Class&lt;?&gt;&gt; events=typesBySubscriber.get(subscriber)<span class="comment">//获取订阅者监听的所有消息</span></span><br><span class="line">	     events.add(eventType)    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>:3.post &#x2F;&#x2F;发送事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">post</span><span class="params">(Object event)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	..PostingThreadState postingState=currentPostingThreadState.get()<span class="comment">//ThreadLocal变量保存</span></span><br><span class="line">	  List&lt;Object&gt; eventQueue=postingState.eventQueue</span><br><span class="line">	  eventQueue.add(event)</span><br><span class="line"></span><br><span class="line">	..<span class="keyword">if</span>(!postingState.isPosting)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    postingState.isMainThread=Looper.getMainLooper()==Looper.myLooper()</span><br><span class="line">	    <span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="keyword">while</span>(!eventQueue.isEmpty())</span><br><span class="line">		  postingSingleEvent(eventQueue.remove(<span class="number">0</span>),postingState)<span class="comment">//发送单个事件!!!</span></span><br><span class="line">		     ...<span class="comment">//查找eventClass类所有的父类以及接口</span></span><br><span class="line">            		List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass)</span><br><span class="line">			<span class="keyword">for</span>(clazz in eventTypes)</span><br><span class="line">			&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			  postSingleEventForEventType(event , postingState , clazz )</span><br><span class="line">			  -&gt; CopyOnWriteArrayList&lt;Subscription&gt; subscriptions</span><br><span class="line">			     subscriptions=subscriptionsByEventType.get(clazz)</span><br><span class="line">			     <span class="keyword">for</span>(subscription in subscriptions)</span><br><span class="line">				postToSubscription(subscription, event, postingState.isMainThread)</span><br><span class="line">				..区别一下主进程的派送方式 -&gt; 根据getMainLooper创建handler再sendMessage</span><br><span class="line">			&#125;</span><br><span class="line">	    &#125;<span class="keyword">catch</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>EventBus使用<br>a).EventBus.getDefault().register(subscriber: this) &#x2F;&#x2F;注册<br>b).单例模式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">static</span> EventBus <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span> (defaultInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">synchronized</span> (EventBus.class) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">if</span> (defaultInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                defaultInstance = <span class="keyword">new</span> <span class="title class_">EventBus</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>c).@Subscribe(threadMode&#x3D;ThreadMode.POSTING)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleSomethingElse</span><span class="params">(Msg msg)</span>		<span class="comment">//Msg为普通po,handleSomethingElse名字不固定</span></span><br><span class="line"> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">….</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>d).线程指定  </p>
<blockquote>
<p>ThreadMode.POSTING &#x2F;&#x2F;在信息发送的线程进行响应<br>ThreadMode.MAIN &#x2F;&#x2F;ui主线程进行响应<br>e).StickyEvent<br>EventBus.getDefault().postSticky(new Msg(“Hello everyone!”))<br>Msg msg&#x3D; EventBus.getDefault().getStickyEvent(Msg.class)<br>EventBus.getDefault().removeStickyEvent(msg)</p>
</blockquote>
<ul>
<li>register &#x2F;&#x2F;注册<br>:1.获取SubscriberMethods</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;SubscriberMethod&gt; <span class="title function_">findSubscriberMethods</span><span class="params">(Class&lt;?&gt; subscriberClass)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">List&lt;SubscriberMethod&gt; subscriberMethods=METHOD_CACHEA.get(subscriberClass)</span><br><span class="line">    <span class="keyword">if</span>(subscriberMethods!=<span class="literal">null</span>)	<span class="keyword">return</span> subscriberMethods</span><br><span class="line">    subscriberMethods=findUsingReflection(subscriberClass)</span><br><span class="line">    METHOD_CACHE.put(subscriberClass, subscriberMethods);</span><br><span class="line">    Return subscriberMethods</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>:3.根据反射遍历</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title function_">findUsingReflection</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//FindState 用来做订阅方法的校验和保存</span></span><br><span class="line">    <span class="type">FindState</span> <span class="variable">findState</span> <span class="operator">=</span> prepareFindState();</span><br><span class="line">    findState.initForSubscriber(subscriberClass);</span><br><span class="line">    <span class="keyword">while</span> (findState.clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="comment">//通过反射来获得订阅方法信息</span></span><br><span class="line">        findUsingReflectionInSingleClass(findState);</span><br><span class="line">        <span class="comment">//查找父类的订阅方法</span></span><br><span class="line">        findState.moveToSuperclass();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取findState中的SubscriberMethod(也就是订阅方法List)并返回</span></span><br><span class="line">    <span class="keyword">return</span> getMethodsAndRelease(findState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>:4.获取注解以及注解的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">findUsingReflectionInSingleClass</span><span class="params">(FindState findState)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">Method[] methods</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  methods=findState.clazz.getDeclaredMethods()<span class="comment">//通过反射获取方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(Throwable th)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment">//遍历Method</span></span><br><span class="line">    <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> method.getModifiers();</span><br><span class="line">   <span class="keyword">if</span> ((modifiers &amp; Modifier.PUBLIC) != <span class="number">0</span> &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == <span class="number">0</span>) </span><br><span class="line">   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">      <span class="comment">//保证必须只有一个事件参数</span></span><br><span class="line">          <span class="keyword">if</span> (parameterTypes.length == <span class="number">1</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">//获取注解</span></span><br><span class="line">	<span class="type">Subscribe</span> <span class="variable">subscribeAnnotation</span> <span class="operator">=</span> method.getAnnotation(Subscribe.class)</span><br><span class="line">	<span class="keyword">if</span> (subscribeAnnotation != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">               Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];</span><br><span class="line">                 </span><br><span class="line">               <span class="type">ThreadMode</span> <span class="variable">threadMode</span> <span class="operator">=</span> subscribeAnnotation.threadMode();</span><br><span class="line">               <span class="comment">//实例化SubscriberMethod对象并添加</span></span><br><span class="line">               findState.subscriberMethods.add(<span class="keyword">new</span> <span class="title class_">SubscriberMethod</span>(method, eventType,</span><br><span class="line">		threadMode,</span><br><span class="line">                    subscribeAnnotation.priority(), </span><br><span class="line">		subscribeAnnotation.sticky()));</span><br><span class="line">                  </span><br><span class="line">             &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Subscription &#x2F;&#x2F;封装注册信息<br>a).Object subscriber<br>b).SubscriberMethod subscriberMethod</li>
<li>SubscriberMethod<br>a).Method method<br>b).int priority<br>c).boolean sticky<br>d).ThreadMode threadMode<br>e).Class&lt;?&gt; eventType</li>
<li>注释类 &#x2F;&#x2F;@Retention定义了该Annotation被保留的时间长短,@Target({ElementType.METHOD})注释对象为方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Subscribe&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       ThreadMode <span class="title function_">threadMode</span><span class="params">()</span> <span class="keyword">default</span> ThreadMode.POSTING;</span><br><span class="line">       <span class="type">boolean</span> <span class="title function_">sticky</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="type">int</span> <span class="title function_">priority</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt;subscribe <span class="comment">//注册方法</span></span><br><span class="line">  :<span class="number">1.</span><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Object subscriber, SubscriberMethod subscriberMethod)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="comment">//获取订阅的事件类型</span></span><br><span class="line">        Class&lt;?&gt; eventType = subscriberMethod.eventType;</span><br><span class="line">	<span class="comment">//创建Subscription对象</span></span><br><span class="line">        <span class="type">Subscription</span> <span class="variable">newSubscription</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Subscription</span>(subscriber, subscriberMethod)</span><br><span class="line">	CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);</span><br><span class="line">	<span class="keyword">if</span> (subscriptions == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            subscriptions = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">            subscriptionsByEventType.put(eventType, subscriptions);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    <span class="comment">//一个类只能监听一个事件一次</span></span><br><span class="line">            <span class="keyword">if</span> (subscriptions.contains(newSubscription)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EventBusException</span>(<span class="string">&quot;Subscriber &quot;</span> + subscriber.getClass() + <span class="string">&quot; already registered to event &quot;</span></span><br><span class="line">                        + eventType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="comment">//根据优先级priority来添加Subscription对象</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> subscriptions.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= size; i++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">if</span> (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                subscriptions.add(i, newSubscription);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="comment">//将订阅者对象以及订阅的事件保存到typesBySubscriber里,以便后续取消订阅</span></span><br><span class="line">        List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber)</span><br><span class="line">	<span class="keyword">if</span> (subscribedEvents == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            subscribedEvents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            typesBySubscriber.put(subscriber, subscribedEvents);</span><br><span class="line">        &#125;</span><br><span class="line">        subscribedEvents.add(eventType);</span><br><span class="line">	<span class="comment">//区别sticky事件，如果为sticky事件则立即分发</span></span><br><span class="line">	<span class="keyword">if</span>(subscriberMethod.sticky)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">if</span>(eventInheritance)<span class="comment">//是否考虑监听事件的父类也作为事件去监听</span></span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">	  <span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	      <span class="type">Object</span> <span class="variable">stickyEvent</span> <span class="operator">=</span> stickyEvents.get(eventType)<span class="comment">//stickEvents为全局对象</span></span><br><span class="line">              checkPostStickyEventToSubscription(newSubscription, stickyEvent)</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>post &#x2F;&#x2F;发送事件<br>:1.PostingThreadState &#x2F;&#x2F;本线程用于保存事件队列信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PostingThreadState</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">final</span> List&lt;Object&gt; eventQueue = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">    <span class="type">boolean</span> isPosting;</span><br><span class="line">    <span class="type">boolean</span> isMainThread;</span><br><span class="line">    Subscription subscription;</span><br><span class="line">    Object event;</span><br><span class="line">    <span class="type">boolean</span> canceled;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:2.public void post(Object event) &#x2F;&#x2F;主循环</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="type">PostingThreadState</span> <span class="variable">postingState</span> <span class="operator">=</span> currentPostingThreadState.get()<span class="comment">//ThreadLocal变量</span></span><br><span class="line">List&lt;Object&gt; eventQueue = postingState.eventQueue </span><br><span class="line">eventQueue.add(event)</span><br><span class="line"><span class="keyword">if</span> (!postingState.isPosting) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      postingState.isMainThread = Looper.getMainLooper() == Looper.myLooper();</span><br><span class="line">      postingState.isPosting = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">if</span> (postingState.canceled) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EventBusException</span>(<span class="string">&quot;Internal error. Abort state was not reset&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">while</span> (!eventQueue.isEmpty()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            postSingleEvent(eventQueue.remove(<span class="number">0</span>), postingState)<span class="comment">//发送事件</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        postingState.isPosting = <span class="literal">false</span>;</span><br><span class="line">        postingState.isMainThread = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; </span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>:3.分发单个事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postSingleEvent</span><span class="params">(Object event, PostingThreadState postingState)</span></span><br><span class="line"> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> Class&lt;?&gt; eventClass = event.getClass()</span><br><span class="line"> <span class="type">boolean</span> <span class="variable">subscriptionFound</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"> <span class="title function_">if</span><span class="params">(eventInheritance)</span></span><br><span class="line"> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass)<span class="comment">//将事件类和其父类都加入链表</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">countTypes</span> <span class="operator">=</span> eventTypes.size()</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">0</span>; h &lt; countTypes; h++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            Class&lt;?&gt; clazz = eventTypes.get(h);</span><br><span class="line">            subscriptionFound |= postSingleEventForEventType(event, postingState, clazz);</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>D).反射调用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">postSingleEventForEventType</span><span class="params">(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass)</span></span><br><span class="line"> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">CopyOnWriteArrayList&lt;Subscription&gt; subscriptions</span><br><span class="line"><span class="title function_">synchronized</span><span class="params">(<span class="built_in">this</span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  subscriptions=subscriptionsByEventType.get(eventClass)</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">if</span> (subscriptions != <span class="literal">null</span> &amp;&amp; !subscriptions.isEmpty()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="keyword">for</span>(Subscription subscription:subscriptions)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">     postingState.event=evnet</span><br><span class="line">     postingState.subscription=subscription</span><br><span class="line">     <span class="title function_">postToSubscription</span><span class="params">(subscription,event,postingState.isMainThread)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ture</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>e).postToSubscription(subscription,event,isMainThread) &#x2F;&#x2F;isMainThread代表是否post的线程为主线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">switch</span>(subscription.subscriberMethod.threadMode)</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="keyword">case</span> ThreadMode.POSTING:</span><br><span class="line">    invokeSubscriber(subscription,event) -&gt;</span><br><span class="line">    &gt;<span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       subscription.subscriberMethod.method.invoke(subscription.subscriber,event)</span><br><span class="line">     &#125;<span class="keyword">catch</span>(e)</span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> ThreadMode.MAIN:</span><br><span class="line">    <span class="keyword">if</span> (isMainThread) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          invokeSubscriber(subscription, event);		    <span class="comment">//如果post线程就是主线程</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">          mainThreadPoster.enqueue(subscription, event);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> BACKGROUND:</span><br><span class="line">        <span class="keyword">if</span> (isMainThread) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            backgroundPoster.enqueue(subscription, event);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            invokeSubscriber(subscription, event);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>f).mainThreadPoster &#x2F;&#x2F;HandlerPoster实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HandlerPoster</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> PendingPostQueue queue</span><br><span class="line"><span class="keyword">private</span> EventBus eventBus</span><br><span class="line">…</span><br><span class="line">HandlerPoster(EventBus eventBus,Looper looper,..)</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="built_in">super</span>(looper)</span><br><span class="line">  <span class="built_in">this</span>.eventBus=eventBus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(Subscription subscription,Object event)</span></span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  PendingPost pendingPost=PendingPost.obtainPendingPost(subscription,event)</span><br><span class="line">  <span class="keyword">synchronized</span>(<span class="built_in">this</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    queue.enqueue(pendingPost)</span><br><span class="line">    <span class="keyword">if</span>(!handlerActive)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      handlerActive=<span class="literal">true</span></span><br><span class="line">      <span class="title function_">sendMessage</span><span class="params">(obtainMessage()</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span></span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  <span class="type">PendingPost</span> <span class="variable">pendingPost</span> <span class="operator">=</span> queue.poll()</span><br><span class="line">  <span class="keyword">if</span> (pendingPost == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	<span class="comment">//此时没有消息</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="comment">// Check again, this time in synchronized</span></span><br><span class="line">           pendingPost = queue.poll();</span><br><span class="line">           <span class="keyword">if</span> (pendingPost == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                 handlerActive = <span class="literal">false</span>;</span><br><span class="line">                 <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   eventBus.invokeSubscriber(pendingPost)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>g).BackgroundPoster &#x2F;&#x2F;如果派发线程不是主线程则直接invokeSubscriber,否则调用线程池execute</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">BackgroundPoster</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">&gt;&gt;sticky事件</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postSticky</span><span class="params">(Object event)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">synchronized</span> (stickyEvents) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        stickyEvents.put(event.getClass(), event);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Should be posted after it is putted, in case the subscriber wants to remove immediately</span></span><br><span class="line">    post(event)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;executorService = Executors.newCachedThreadPool()</span><br><span class="line"></span><br><span class="line">&gt;&gt;eventTypesCache		<span class="comment">//Map&lt;Class&lt;?&gt;, List&lt;Class&lt;?&gt;&gt;&gt; </span></span><br><span class="line">  a).</span><br></pre></td></tr></table></figure>

<ol>
<li>String a&#x3D;“ abc”;String b&#x3D;“ abc”; 创建了几个对象 &#x2F;&#x2F;栈存放引用变量 堆存在new出来的对象，并且堆划分出一部分作为常量池</li>
</ol>
<p>当使用任何方式来创建一个字符串对象s时，Java运行时（运行中JVM）会拿着这个X在String池中找是否存在内容相同的字符串对象，如果不存在，则在池中创建一个字符串s，否则，不在池中添加<br>b)Java中，只要使用new关键字来创建对象，则一定会（在堆区或栈区）创建一个新的对象<br>c)使用直接指定或者使用纯字符串串联来创建String对象，则仅仅会检查维护String池中的字符串，池中没有就在池中创建一个，有则罢了！但绝不会在堆栈区再去创建该String对象<br>d)使用包含变量的表达式来创建String对象,会在堆栈创建新的</p>
<ol>
<li>java的单例创建<br>a)懒汉式 &#x2F;&#x2F;线程不安全,指令重排</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span> <span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> instance</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>b)饿汉式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> <span class="comment">//效率浪费,单例对象只有在创建阶段才需要同步</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>c)双重检测锁 &#x2F;&#x2F;效率提高，双重指的是2次检查instance是否为null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeDoubleCheckedLocking</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Instance instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Instance <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">           <span class="keyword">synchronized</span> (SafeDoubleCheckedLocking.class) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">             <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">               instance = <span class="keyword">new</span> <span class="title class_">Instance</span>();<span class="comment">//此句会出现问题，因为构造函数存在多次赋值，而第1层检测是允许重入的,</span></span><br><span class="line">						 <span class="comment">//所以其它线程可能会去引用一个未初始化完成的对象，造成系统崩溃</span></span><br><span class="line">						<span class="comment">//加入volatile后保证在多线程环境下对变量的写操作优先于读操作</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>163.Android进程优先级<br>a)Foreground processes 前台进程<br>进程中包含处于前台的正与用户交互的activity;<br>进程中包含与前台activity绑定的service;<br>进程中包含调用了startForeground()方法的service;<br>进程中包含正在执行onCreate(), onStartCommand(), 或onDestroy()方法的service;<br>进程中包含正在执行onReceive()方法的BroadcastReceiver.<br>b)Visiable processes 可视进程</p>
<p>进程中包含未处于前台但仍然可见的activity(调用了activity的onPause()方法, 但没有调用onStop()方法)。 典型的情况是：运行&gt;&gt;activity时弹出对话框（类似对话框，将activity遮挡）, 此时的activity虽然不是前台activity, 但其仍然可见。<br>进程中包含与可见activity绑定的service.可视进程不会被系统杀死, 除非为了保证前台进程的运行而不得已为之.<br>c)Service processes 服务进程<br>正在运行的Service（不在onCreate(),onStartCommand(),onDestroy()状态中）<br>d)background processes 后台进程<br>如：不可见状态的activity</p>
<p>164.ThreadLocal 源码<br>ThreadLocalMap<br>:1.由Thread维护  </p>
<blockquote>
<p>ThreadLocal.ThreadLocalMap threadLocals,装载因子为2&#x2F;3，超过即扩容<br>:2.ThreadLocalMap &#x2F;&#x2F;结构</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">a).<span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	</span><br><span class="line">	  Object value;</span><br><span class="line">	  Entry(ThreadLocal&lt;?&gt;k,Object v)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    <span class="built_in">super</span>(k)</span><br><span class="line">	    value=v</span><br><span class="line">	  &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    b).<span class="keyword">private</span> Entry[] table	<span class="comment">//Entry表</span></span><br><span class="line">    c).<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> INITIAL_CAPCITY=<span class="number">16</span>		<span class="comment">//必须为2的幂</span></span><br><span class="line">    d).ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey,Object firstValue)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  table=<span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY]</span><br><span class="line">	  <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>)</span><br><span class="line">		<span class="comment">//当新建ThreadLocal实例时会生成threadLocalHashCode，主要针对ThreadLocal的开地址解决冲突策略</span></span><br><span class="line">          <span class="comment">// 初始化该节点</span></span><br><span class="line">          table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">	&#125;</span><br><span class="line">       </span><br><span class="line">    e).线性探查</span><br><span class="line">      &gt;寻找下个索引</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">nextIndex</span><span class="params">(<span class="type">int</span> i ,<span class="type">int</span> len)</span></span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="keyword">return</span> i+<span class="number">1</span>&lt;len?i+<span class="number">1</span>:<span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">      &gt;寻找上个索引</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">prevIndex</span><span class="params">(<span class="type">int</span> i ,<span class="type">int</span> len)</span></span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="keyword">return</span> i-<span class="number">1</span>&gt;=<span class="number">0</span>?i-<span class="number">1</span>:len-<span class="number">1</span></span><br><span class="line">       &#125; </span><br><span class="line">   g).获取元素</span><br><span class="line">     &gt; getEntry(ThreadLocal&lt;?&gt; key)</span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="type">int</span> i=key.threadLocalHashCode &amp; table.length-<span class="number">1</span></span><br><span class="line">         Entry e=table[i]</span><br><span class="line">         <span class="keyword">if</span>(e!=<span class="literal">null</span>&amp;&amp;e.get()==key)</span><br><span class="line">	   <span class="keyword">return</span> e</span><br><span class="line">         <span class="title function_">while</span><span class="params">(e!=<span class="literal">null</span>)</span></span><br><span class="line">         &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   ThreadLocal&lt;?&gt;k = e.get()</span><br><span class="line">	   <span class="keyword">if</span>(k==key)</span><br><span class="line">	     <span class="keyword">return</span> e</span><br><span class="line">	   <span class="title function_">if</span><span class="params">(k==<span class="literal">null</span>)</span>	<span class="comment">//弱引用被垃圾回收</span></span><br><span class="line">	     expungeStaleEntry(i)		<span class="comment">//清理staleEntry</span></span><br><span class="line">	   <span class="keyword">else</span></span><br><span class="line">	     i=nextIndex(i,len)</span><br><span class="line">	   e=tab[i]</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &gt; expungeStaleEntry(<span class="type">int</span> slot)		<span class="comment">//清理槽</span></span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Entry[] tab=table</span><br><span class="line">	<span class="type">int</span> len=tab.length</span><br><span class="line">	tab[slot].value=<span class="literal">null</span></span><br><span class="line">	tab[slot]=<span class="literal">null</span></span><br><span class="line">	<span class="comment">//遇到空的entry即停止</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=nextIndex(slot,len);(e=tab[i])!=<span class="literal">null</span>;i=nextIndex(i,len))</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  ThreadLocal&lt;?&gt; k=e.get()</span><br><span class="line">	  <span class="keyword">if</span>(k==<span class="literal">null</span>)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	     e.value=<span class="literal">null</span></span><br><span class="line">	     tab[i]=<span class="literal">null</span></span><br><span class="line">	  &#125;</span><br><span class="line">	  <span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    <span class="comment">//get the hash of this new slot</span></span><br><span class="line">	    <span class="type">int</span> h= k.threadLocalHashCode()&amp;(len-<span class="number">1</span>)</span><br><span class="line">	    <span class="keyword">if</span>(h!=i)<span class="comment">//rehash,鉴于该hash有可能是基于线性探查才决定的位置</span></span><br><span class="line">            &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	      tab[i]=<span class="literal">null</span></span><br><span class="line">	      <span class="title function_">while</span><span class="params">(tab[h]!=<span class="literal">null</span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		h=nextIndex(h,len)</span><br><span class="line">	      &#125;</span><br><span class="line">	      tab[h]=e</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    h).设置元素</span><br><span class="line">     &gt; <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key,Object value)</span></span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 Entry[] tab=table</span><br><span class="line">	 <span class="type">int</span> len=tab.length</span><br><span class="line"> 	 <span class="type">int</span> i= key.threadLocalHashCode &amp; (len-<span class="number">1</span>)</span><br><span class="line">	 <span class="keyword">for</span>(Entry e=tab[i]; e!=<span class="literal">null</span> ;e=tab[i=nextIndex(i,len)])</span><br><span class="line">	 &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   ThreadLocal&lt;?&gt; k=e.get()</span><br><span class="line">	   <span class="keyword">if</span>(k==key)</span><br><span class="line">	     e.value=value</span><br><span class="line">	     <span class="keyword">return</span></span><br><span class="line">	   <span class="keyword">if</span>(k==<span class="literal">null</span>)<span class="comment">//该entry的引用已被GC回收</span></span><br><span class="line">	     replaceStaleEntry(key, value ,i)</span><br><span class="line">	     <span class="keyword">return</span></span><br><span class="line">	 &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &gt; 取代旧有的entry</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">replaceStaleEntry</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value,</span></span><br><span class="line"><span class="params">                               <span class="type">int</span> staleSlot)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 Entry[] tab=table</span><br><span class="line">	 <span class="type">int</span> len=tab.length</span><br><span class="line">	 </span><br><span class="line">	 <span class="title function_">for</span><span class="params">(<span class="type">int</span> i=nextIndex(staleSlot,len)</span>;(e=tab[i])!=<span class="literal">null</span>;i=nextIndex(i,len))</span><br><span class="line">	 &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   ThreadLocal&lt;?&gt; k= e.get()</span><br><span class="line">	   <span class="keyword">if</span>(k==key)</span><br><span class="line">	   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	     e.value=value</span><br><span class="line">	     <span class="comment">//交换空槽和匹配的槽</span></span><br><span class="line">	     tab[i]=tab[staleSlot]</span><br><span class="line">	     tab[staleSlot]=e</span><br><span class="line">           &#125;</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&gt;&gt;ThreadLocal</span><br><span class="line">  a).ThreadLocal::ThreadLocal()</span><br><span class="line">  b).<span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	Thread t=Thread.currentThread()</span><br><span class="line">	ThreadLocalMap map=t.getMap(t)</span><br><span class="line">	<span class="keyword">if</span>(map!=<span class="literal">null</span>)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  ThreadLocalMap.Entry e=map.getEntry(<span class="built_in">this</span>)</span><br><span class="line">	  <span class="keyword">if</span>(e!=<span class="literal">null</span>)</span><br><span class="line">	  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    T result=(T)e.value</span><br><span class="line">	    <span class="keyword">return</span> result</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> setInitialValue()</span><br><span class="line">     &#125;</span><br><span class="line">  c).<span class="keyword">private</span> Entry <span class="title function_">getEntry</span><span class="params">(ThreadLocal&lt;?&gt; key)</span></span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (table.length - <span class="number">1</span>)</span><br><span class="line">	Entry e=table[i]</span><br><span class="line">	<span class="keyword">if</span> (e != <span class="literal">null</span> &amp;&amp; e.get() == key)</span><br><span class="line">           <span class="keyword">return</span> e</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	    <span class="keyword">return</span> getEntryAfterMiss(key, i, e)</span><br><span class="line">     &#125;</span><br><span class="line">  d).<span class="keyword">private</span> Entry <span class="title function_">getEntryAfterMiss</span><span class="params">(ThreadLocal&lt;?&gt; key,<span class="type">int</span> i,Entry e</span></span><br><span class="line"><span class="params">  c)</span>.ThreadLocal::set(T)</span><br><span class="line">  d).ThreadLocal::remove()</span><br><span class="line">&gt;&gt;set					<span class="comment">//</span></span><br><span class="line">b).ThreadLocal.set()  =&gt; Thread t= Thread.currentThread();  ThreadLocalMap map=getMap(t);</span><br><span class="line">c).当ThreadLocal初始化时,会自动调用nextHashCode生成，以便随后根据hashCode进行数组元素的索引</span><br><span class="line">d).如果当前thread的threadLocalMap不为空 =&gt; map.set(<span class="built_in">this</span>,value)</span><br><span class="line">   如果为空 =&gt; createMap</span><br><span class="line">   &gt;&gt;t.threadLocals= <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>,firstValue);</span><br><span class="line">&gt;&gt;<span class="comment">//实例</span></span><br><span class="line">  ThreadLocal&lt;String&gt; name=<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();  </span><br><span class="line">  name.set(“dancing”)</span><br></pre></td></tr></table></figure>

<p>165.自定义View对象</p>
<ul>
<li>自定义View的属性<br>:1.res&#x2F;values&#x2F;styles.xml</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;  &lt;resources&gt;</span><br><span class="line">       &lt;!--name为声明的<span class="string">&quot;属性集合&quot;</span>名，可以随便取，但是最好是设置为跟我们的View一样的名称--&gt;</span><br><span class="line">    	&lt;declare-styleable name=<span class="string">&quot;MyView&quot;</span>&gt;</span><br><span class="line">          &lt;!--声明我们的属性，名称为default_size,取值类型为尺寸类型（dp,px等）--&gt;</span><br><span class="line">          &lt;attr name=<span class="string">&quot;default_size&quot;</span> format=<span class="string">&quot;dimension&quot;</span> /&gt;</span><br><span class="line">       &lt;/declare-styleable&gt;</span><br><span class="line">     &lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<p>在View的构造函数中获取自定义属性<br>:1.public CustomTitleView(Context context, AttributeSet attrs, int defStyle)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyle);  </span><br><span class="line">        <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 获得我们所定义的自定义样式属性 </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        <span class="type">TypedArray</span> <span class="variable">a</span> <span class="operator">=</span> context.getTheme().obtainStyledAttributes(attrs, R.styleable.CustomTitleView, defStyle, <span class="number">0</span>);  </span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> a.getIndexCount();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)  </span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">            <span class="type">int</span> <span class="variable">attr</span> <span class="operator">=</span> a.getIndex(i);  </span><br><span class="line">            <span class="keyword">switch</span> (attr)  </span><br><span class="line">            &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">            <span class="keyword">case</span> R.styleable.CustomTitleView_titleText:  </span><br><span class="line">                mTitleText = a.getString(attr);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> R.styleable.CustomTitleView_titleTextColor:  </span><br><span class="line">                <span class="comment">// 默认颜色设置为黑色  </span></span><br><span class="line">                mTitleTextColor = a.getColor(attr, Color.BLACK);  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> R.styleable.CustomTitleView_titleTextSize:  </span><br><span class="line">                <span class="comment">// 默认设置为16sp，TypeValue也可以把sp转化为px  </span></span><br><span class="line">                mTitleTextSize = a.getDimensionPixelSize(attr, (<span class="type">int</span>) TypedValue.applyDimension(  </span><br><span class="line">                        TypedValue.COMPLEX_UNIT_SP, <span class="number">16</span>, getResources().getDisplayMetrics()));  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        a.recycle();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 获得绘制文本的宽和高 </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        mPaint = <span class="keyword">new</span> <span class="title class_">Paint</span>();  </span><br><span class="line">        mPaint.setTextSize(mTitleTextSize);  </span><br><span class="line">        <span class="comment">// mPaint.setColor(mTitleTextColor);  </span></span><br><span class="line">        mBound = <span class="keyword">new</span> <span class="title class_">Rect</span>();  </span><br><span class="line">        mPaint.getTextBounds(mTitleText, <span class="number">0</span>, mTitleText.length(), mBound);  </span><br><span class="line">  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>c).重写onMeasure &#x2F;&#x2F;非必需</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec,<span class="type">int</span> heightMeasureSpec)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="built_in">super</span>.onMeasure(widthMeasureSpec,heightMeasureSpec);  </span><br><span class="line">    <span class="comment">//当自定义view采用wrap_content匹配时需要重写     a).setMeasuredDimension(width,height)</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>d).重写onDraw</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDraw</span><span class="params">(Canvas canvas)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    mPaint.setColor(Color.YELLOW);  </span><br><span class="line">    canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, getMeasuredWidth(), getMeasuredHeight(), mPaint); </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Android @Override &#x2F;&#x2F;重写<br>a).重写方法的参数列表必须完全与被重写的方法的相同,否则不能称其为重写而是重载<br>b).重写方法的访问修饰符一定要大于被重写方法的访问修饰符 public&gt;protected&gt;default&gt;private<br>c).重写的方法的返回值必须和被重写的方法的返回一致<br>d).重写的方法所抛出的异常必须和被重写方法的所抛出的异常一致，或者是其子类<br>e).被重写的方法不能为private，否则在其子类中只是新定义了一个方法，并没有对其进行重写</li>
<li>Android Semaphore机制</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">final</span> Semaphore semaphore=<span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">1</span>)<span class="comment">//资源数量为1</span></span><br><span class="line">  semaphore.acquire()	<span class="comment">//相当于P操作</span></span><br><span class="line">  semaphore.release()	<span class="comment">//相当于V操作</span></span><br><span class="line">&gt;&gt;例子</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Semaphore</span> <span class="variable">sema</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">1</span>; index &lt; <span class="number">10</span>; index++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span> <span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  sema.acquire()</span><br><span class="line">	  <span class="comment">//todo...</span></span><br><span class="line">	  sema.release()</span><br><span class="line">  	&#125;</span><br><span class="line"></span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>169.Android Lock同步<br>ReentrantLock<br>:1.比synchronized更加适用于描述多个线程互相获取资源的场景,对象级别声明为static有效与否未知<br>unlock &#x2F;&#x2F;相当于V<br>lock &#x2F;&#x2F;相当于P<br>b).ReadWriteLock &#x2F;&#x2F;读写锁<br>private ReentrantReadWriteLock rw1&#x3D;new ReentrantReadWriteLock()<br>rw1.readLock().lock() &#x2F;&#x2F;unlock释放<br>rw1.writeLock().lock() &#x2F;&#x2F;unlock释放<br>实例<br>:1.ReentrantLock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">class</span> <span class="title class_">Outputter</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(); <span class="comment">// 定义锁对象</span></span><br><span class="line"> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">output</span><span class="params">(String text)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		lock.lock(); <span class="comment">// 得到锁</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	          <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; text.length(); i++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		    System.out.println(text.charAt(i));</span><br><span class="line">		    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">		  &#125;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		  lock.unlock(); <span class="comment">// 释放锁</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">      &#125;</span><br><span class="line">  :<span class="number">2.</span>ReadWriteLock<span class="comment">//读写锁</span></span><br><span class="line">    &gt;<span class="keyword">class</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> data;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">ReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		readWriteLock.writeLock().lock(); <span class="comment">// 获取写锁</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		  Thread.sleep(<span class="number">50</span>); <span class="comment">// 模拟耗时操作</span></span><br><span class="line">		  <span class="built_in">this</span>.data = data;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	          readWriteLock.writeLock().unlock(); <span class="comment">// 释放写锁</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  readWriteLock.readLock().lock(); <span class="comment">// 获取读锁</span></span><br><span class="line">	  <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    Thread.sleep(<span class="number">50</span>); <span class="comment">// 模拟耗时操作</span></span><br><span class="line">	  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	    readWriteLock.readLock().unlock(); <span class="comment">// 释放读锁</span></span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>170.ThreadPoolExecutor 线程池<br>a)newFixedThreadPool &#x2F;&#x2F;返回一个固定线程数量的线程池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="type">ExecutorService</span> <span class="variable">fixedThreadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i;</span><br><span class="line">        fixedThreadPool.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                 <span class="type">String</span> <span class="variable">threadName</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">                 Log.v(<span class="string">&quot;zxy&quot;</span>, <span class="string">&quot;线程：&quot;</span>+threadName+<span class="string">&quot;,正在执行第&quot;</span> + index + <span class="string">&quot;个任务&quot;</span>);</span><br><span class="line">                 <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                 &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>b)newSingleThreadExecutor &#x2F;&#x2F;该池只跑一个线程，对所有耗时任务进行FIFO排队<br>c)newScheduledThreadPool &#x2F;&#x2F;创建一个可以定时或者周期性执行任务的线程池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="comment">//延迟1秒后，每隔2秒执行一次该任务</span></span><br><span class="line">   scheduledThreadPool.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;, <span class="number">2</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p>d)自定义ThreadPoolExecutor &#x2F;&#x2F;可以根据优先级进行排队</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PriorityRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>, Comparable&lt;PriorityRunnable&gt; &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> priority;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PriorityRunnable</span><span class="params">(<span class="type">int</span> priority)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">if</span> (priority &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        <span class="built_in">this</span>.priority = priority;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(PriorityRunnable another)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="type">int</span> <span class="variable">my</span> <span class="operator">=</span> <span class="built_in">this</span>.getPriority();</span><br><span class="line">        <span class="type">int</span> <span class="variable">other</span> <span class="operator">=</span> another.getPriority();</span><br><span class="line">        <span class="keyword">return</span> my &lt; other ? <span class="number">1</span> : my &gt; other ? -<span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        doSth();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doSth</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPriority</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> priority;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt; <span class="type">ExecutorService</span> <span class="variable">priorityThreadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">3</span>, <span class="number">0L</span>, TimeUnit.SECONDS, <span class="keyword">new</span>   <span class="title class_">PriorityBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">priority</span> <span class="operator">=</span> i;</span><br><span class="line">            priorityThreadPool.execute(<span class="keyword">new</span> <span class="title class_">PriorityRunnable</span>(priority) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSth</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                    <span class="type">String</span> <span class="variable">threadName</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">                    Log.v(<span class="string">&quot;zxy&quot;</span>, <span class="string">&quot;线程：&quot;</span> + threadName + <span class="string">&quot;,正在执行优先级为：&quot;</span> + priority + <span class="string">&quot;的任务&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>171.Android下载图片通过bitmap设置ImageView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityMain</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">  <span class="type">String</span> <span class="variable">imageUrl</span> <span class="operator">=</span> <span class="string">&quot;http://i.pbase.com/o6/92/229792/1/80199697.uAs58yHk.50pxCross_of_the_Knights_Templar_svg.png&quot;</span>;  </span><br><span class="line">  Bitmap bmImg;  </span><br><span class="line">  ImageView imView;  </span><br><span class="line">    </span><br><span class="line">  Button button1;  </span><br><span class="line">    </span><br><span class="line">  <span class="meta">@Override</span>  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">     <span class="built_in">super</span>.onCreate(savedInstanceState);  </span><br><span class="line">     setContentView(R.layout.main);  </span><br><span class="line">     imView = (ImageView) findViewById(R.id.imview);  </span><br><span class="line">     imView.setImageBitmap(returnBitMap(imageUrl));  </span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Bitmap <span class="title function_">returnBitMap</span><span class="params">(String url)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">    <span class="type">URL</span> <span class="variable">myFileUrl</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">    <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">      myFileUrl = <span class="keyword">new</span> <span class="title class_">URL</span>(url);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">    e.printStackTrace();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">      <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) myFileUrl  </span><br><span class="line">       .openConnection();  </span><br><span class="line">      conn.setDoInput(<span class="literal">true</span>);  </span><br><span class="line">      conn.connect();  </span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> conn.getInputStream();  </span><br><span class="line">      bitmap = BitmapFactory.decodeStream(is);  	<span class="comment">//容易OOM</span></span><br><span class="line">      is.close();  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">       </span><br><span class="line">      e.printStackTrace();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> bitmap;  </span><br><span class="line">  &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ImageView<br>ScaleType<br>:1.FIT_CENTER 默认，图片等比例缩放到宽或者高能够填充控件大小<br>:2.FIT_START,FIT_END 等比例缩放，并放置在控件的左边或者上方<br>:3.FIT_XY 完全填充控件大小，但不是等比例<br>:4.CENTER -&gt; 图片大小为原始大小，如果大于ImageView组件，则截取中间部分，若小于则将图片居中显示<br>:5.CENTER_CROP -&gt;图片等比例缩放，使图像的短边填满，截取中间部分</li>
<li>onSaveInstanceState &#x2F;&#x2F;保存app数据,当系统因内存不足时而销毁app，会得到调用</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSaveInstanceState</span><span class="params">(Bundle outState)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    outState.put(“index”,<span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle saveInstanceState)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="type">int</span> curIndex=saveInstanceState.get(“index”,<span class="number">0</span>);<span class="comment">//默认值是0</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>177.ViewPager&amp;PagerAdapter&amp;TabFragmentPagerAdapter<br>实例<br>:1.fragments&#x3D;mutableListOf(Fragment1(),Fragment2())<br>val adapter&#x3D; TagFragmentPagerAdapter(getSupportFragmentManager(),fragments)<br>view_pager.adapter&#x3D;adapter<br>:2.view_pager.addOnPageChangeListener<br>:3.view_pager.setCurrentItem &#x2F;&#x2F;设置默认选中的item</p>
<ol>
<li>Fragment在横竖屏切换时的数据保存<br>onCreate-&gt; setRetainInstance(true)<br>当设置retain后，Fragment的生命周期不再经过onCreate、onDestroy</li>
<li>DialogFragment &#x2F;&#x2F;采用子类继承的方式进行使用,相比AlertDialog由FragmentManager负责自动重建</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatePickerFragment</span> <span class="keyword">extends</span> <span class="title class_">DialogFragment</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    a).<span class="keyword">public</span> Dialog <span class="title function_">onCreateDialog</span><span class="params">(Bundle saveInstanceState)</span>  </span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> (Date) getArguments().getSerializable(ARG_DATE);</span><br><span class="line">         <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">         calendar.setTime(date);</span><br><span class="line">         <span class="type">int</span> <span class="variable">year</span> <span class="operator">=</span> calendar.get(Calendar.YEAR);</span><br><span class="line">         <span class="type">int</span> <span class="variable">month</span> <span class="operator">=</span> calendar.get(Calendar.MONTH);</span><br><span class="line">         <span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_MONTH);</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DatePickerDialog</span>(context, <span class="built_in">this</span>,year,month,day)</span><br><span class="line">       &#125;   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>180.SQLiteDatabase<br>helper &#x2F;&#x2F;通过helper来获取database实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">a).<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbOpenHelper</span> <span class="keyword">extends</span> <span class="title class_">SQLiteOpenHelper</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> VERSION=<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_NAME=<span class="string">&quot;crimeBase.db&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">DbOpenHelper</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="built_in">super</span>(context, DATABASE_NAME, <span class="literal">null</span>  , VERSION);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(SQLiteDatabase db)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        db.execSQL(<span class="string">&quot;create table crimes (&quot;</span> +</span><br><span class="line">                <span class="string">&quot;_id integer primary key autoincrement ,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;title varchar(10) ,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;date datetime,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;solved boolean&quot;</span> +</span><br><span class="line">                <span class="string">&quot;)&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="type">int</span> oldVersion, <span class="type">int</span> newVersion)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>getWritableDatabase、getReadableDatabase<br>a).getWritableDatabase &#x2F;&#x2F;以读写方式打开数据库，一旦数据库的磁盘空间满了就只能读，因此会报错<br>b).getReadableDatabase &#x2F;&#x2F;首先以读写方式打开，失败后转换为只读方式打开<br>c).锁 &#x2F;&#x2F;SqliteOpenHelper,针对数据库进行了加锁，故遵循读写-锁原则，可多个读只有一个写<br>CursorWrapper &#x2F;&#x2F;1).自动针对Cursor实现了getItem、getCount 2).通过convertView去调用createView|bindView<br>a).bindView(view,context,cursor)<br>b).newView(context,cursor,parent)<br>DateTime的数据存储 &#x2F;&#x2F;cursor不支持直接Date类型的数据存取<br>String dateStr &#x3D;DateFormat.getDateTimeInstance().format(date) &#x2F;&#x2F;getDateTimeInstance获取针对DateTime的转换器<br>cv.put(“date”,dateStr) &#x2F;&#x2F;SQLite中设置date为datetime</p>
<ol>
<li>IntentFilter的匹配规则</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&lt;intent-filter&gt;			<span class="comment">//进行匹配</span></span><br><span class="line">  :<span class="number">1.</span>&lt;action android:name=“…”/&gt;		<span class="comment">//目标intent-filter可以有多个action，intent只要符合其中一个</span></span><br><span class="line">  :<span class="number">2.</span>&lt;category android:name=“…”/&gt;	<span class="comment">//addCategory,intent可以没有category，但是intent的category都必须在目标中存在</span></span><br><span class="line">  :<span class="number">3.</span>&lt;data android:scheme=“string”</span><br><span class="line">    android:host=“string”</span><br><span class="line">    android:port=“string”</span><br><span class="line">    android:path=“string”</span><br><span class="line">    android:mimeType=“string”/&gt;       <span class="comment">//intent.setDataAndType(Uri.parse(…),”image/png”)</span></span><br><span class="line">&gt;&gt;预查询能匹配的Activity         	      <span class="comment">//返回ResolveInfo</span></span><br><span class="line">  a)getPackageManager().queryIntentActivities(intent,<span class="number">0</span>)<span class="comment">//0代表MATCH_DEFAULT_ONLY</span></span><br><span class="line">  b)getPackageManager().resolveActivity(intent,<span class="number">0</span>)      <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>183.Android多进程</p>
<ul>
<li>Messenger<br>:1.服务器端所持有的Messenger</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">private</span> <span class="type">Messenger</span> <span class="variable">serviceMessenger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Messenger</span>(<span class="keyword">new</span> <span class="title class_">ServiceHandler</span>());<span class="comment">//初始化</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ServiceHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       <span class="keyword">switch</span>(msg.what)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    Log.i(<span class="string">&quot;DemoLog&quot;</span>, <span class="string">&quot;MyServivce -&gt; onBind&quot;</span>);</span><br><span class="line">    <span class="comment">//获取Service自身Messenger所对应的IBinder，并将其发送共享给所有客户端</span></span><br><span class="line">    <span class="keyword">return</span> serviceMessenger.getBinder();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:2.设置在service在别的进程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=<span class="string">&quot;.MessengerService&quot;</span> android:process=<span class="string">&quot;:remote&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>:3.客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">private</span> Messenger mService;</span><br><span class="line">  <span class="keyword">private</span> ServiceConnection mConnection=<span class="keyword">new</span> <span class="title class_">ServiceConnection</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceConnected</span><span class="params">(ComponentName xx,IBinder service)</span></span><br><span class="line"> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   mService=<span class="keyword">new</span> <span class="title class_">Messenger</span>(service);</span><br><span class="line">   Message msg=Message.obtain(<span class="literal">null</span>,what);</span><br><span class="line">   Bundle data=<span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">   data.put(“”,”xx”);</span><br><span class="line">   msg.setData(data);</span><br><span class="line">	   <span class="keyword">try</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	mService.send(data);</span><br><span class="line">   &#125;<span class="keyword">catch</span>(RemoteException e)</span><br><span class="line">   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	e.printStackTrace();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> bindService(intent,mConnection,Context.BIND_AUTO_SERVICE);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>:4.服务器回应客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;客户端设置replyTo</span><br><span class="line"> Message msg=Message.obtain()</span><br><span class="line"> msg.replyTo=<span class="keyword">new</span> <span class="title class_">Messenger</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     &#125;&#125;)</span><br><span class="line"> serverMessenger.send(msg)</span><br></pre></td></tr></table></figure>

<ul>
<li>AIDL<br>a)服务器 -&gt; 创建Service来监听客户端的连接请求，创建AIDL文件，将暴露给客户端的接口在该文件中声明，最后Service实现<br>b)客户端 -&gt; 绑定Service，将返回的Binder转换为AIDL类型，调用AIDL方法<br>c)AIDL接口的创建 &#x2F;&#x2F;引入一个接口和声明2个方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">import</span> com.ryg.chapter_2.aidl.Book;</span><br><span class="line">      <span class="keyword">interface</span> <span class="title class_">IBookManager</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> 	 List&lt;Book&gt; <span class="title function_">getBookList</span><span class="params">()</span>;</span><br><span class="line">  	 <span class="keyword">void</span> <span class="title function_">addBook</span><span class="params">(in Book book)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &gt;&gt;AIDL支持的数据类型 -&gt; 基本数据类型、String和CharSequence、ArrayList、HashMap、Parcelable、AIDL</span><br><span class="line">    &gt;&gt;AIDL不支持声明静态常量 </span><br><span class="line">  d)针对AIDL服务端Service的创建</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookManagerService</span> <span class="keyword">extends</span> <span class="title class_">Service</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">private</span> CopyOnWriteArrayList&lt;Book&gt; mBookList=<span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;Book&gt;();</span><br><span class="line"> 	<span class="keyword">private</span> Binder mBinder=<span class="keyword">new</span> <span class="title class_">IBookManager</span>.Stub()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getBookList</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			<span class="keyword">return</span> mBookList;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBook</span><span class="params">(Book book)</span><span class="keyword">throws</span> RemoteException&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">			mBookList.add(book);</span><br><span class="line">		&#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span></span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">		<span class="keyword">return</span> mBinder;</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  e)针对AIDL客户端</span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mConnection=<span class="keyword">new</span> <span class="title class_">ServiceConnection</span>()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceConnected</span><span class="params">(ComponentName className,IBinder service)</span></span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	   IBookManager manager=IBookManager.Stub.asInterface(service);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	bindService(intent,mConnection,Context.BIND_AUTO_CREATE);	<span class="comment">//在onDestroy中调用unbindService</span></span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt;RemoteCallbackList <span class="comment">//专门用于维护跨进程的监听队列</span></span><br><span class="line">  a)<span class="keyword">final</span> <span class="type">int</span> N=mListenerList.beginBroadcast()</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	IOnNewBookArrivedListener l=mListenerList.getBroadcastItem(i)</span><br><span class="line">        l.onNewBookArrived(Book);</span><br><span class="line">    &#125;</span><br><span class="line">    mListenerList.finishBroadcast()</span><br><span class="line">&gt;&gt;权限验证</span><br><span class="line">  a)自定义权限	-&gt; &lt;permission android:name=“com.ryg.chapter_2.permission.ACCESS_BOOK_SERVICE” </span><br><span class="line"> 			android:protectionLevel=“normal”/&gt;</span><br><span class="line">  b)检查申请应用是否有对应权限</span><br><span class="line">    -&gt;<span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span></span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	 <span class="type">int</span> check=checkCallingOrSelfPermission(“com.ryg.chapter_2.permission.ACCESS_BOOK_SERVICE”)</span><br><span class="line">	 <span class="keyword">if</span>(check==PackageManager.PERMISSION_DENIED)</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line"> 	 <span class="keyword">else</span></span><br><span class="line">	    <span class="keyword">return</span> mBinder;</span><br><span class="line">      &#125;</span><br><span class="line">&gt;&gt;ContentProvider	<span class="comment">//专门用于不同应用间进行数据共享</span></span><br></pre></td></tr></table></figure>

<p>186.Android Scroller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;Scroller mScroller=<span class="keyword">new</span> <span class="title class_">Scroller</span>(context)	<span class="comment">//创建实例</span></span><br><span class="line">&gt;&gt;mScroller.startScroll();			<span class="comment">//开始滑动，并需要调用invalidate刷新界面</span></span><br><span class="line">  invalidate();</span><br><span class="line">&gt;&gt;<span class="meta">@Override</span>					<span class="comment">//滑动开始后的回调</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">computeScroll</span><span class="params">()</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(mScroller.computeScrollOffset)</span><br><span class="line">      scrollTo(mScroller.getCurX(),mScroller.getCurY())</span><br><span class="line">    invalidate();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>188.Sqlite 连接操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;cross join 	<span class="comment">//交叉连接，如果不进行条件筛选，则结果为笛卡尔积</span></span><br><span class="line">  a)select e.no,e.name from emp e cross join dept d </span><br><span class="line">&gt;&gt;inner join   <span class="comment">//内连接,table1 (inner) join table2 on …</span></span><br><span class="line">&gt;&gt;natural join <span class="comment">//自然连接，自动检测相同属性是否值相等</span></span><br><span class="line">&gt;&gt;outer join	<span class="comment">//外连接,table1 left outer join table2 on ….</span></span><br></pre></td></tr></table></figure>

<p>190.Spinner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;setOnItemSelectedListener		<span class="comment">//设置监听</span></span><br><span class="line">&gt;&gt;setAdapter				<span class="comment">//设置数据源</span></span><br></pre></td></tr></table></figure>

<p>191.RelativeLayout 源代码</p>
<ul>
<li>sortChildren()<br>a).DependGraph,形成依赖图和依赖子图<br>b).findRoots返回当前没有依赖的view结点集合roots<br>c).通过roots集合采用bfs遍历所有view结点，具体是访问某个view时去除该view的相邻边,sorted[index++]&#x3D;view</li>
<li>getLayoutDirection() &#x2F;&#x2F;RTL,主要针对阿拉伯地区，默认LayoutDirection.LTR<br>a).LayoutDirection.LTR，容器内容左对齐<br>b).LayoutDirection.RTL, 容器内容右对齐</li>
<li>水平方向和垂直方向的尺寸测量</li>
</ul>
<p>192.Message &#x2F;&#x2F;static Message sPool,指向队列前头的可用Message对象</p>
<ul>
<li>obtain</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">()</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      <span class="keyword">if</span> (sPool != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">         <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> <span class="type">sPool</span></span><br><span class="line">         <span class="variable">sPool</span> <span class="operator">=</span> m.next;</span><br><span class="line">         m.next = <span class="literal">null</span>;</span><br><span class="line">         m.flags = <span class="number">0</span>; <span class="comment">// clear in-use flag</span></span><br><span class="line">         sPoolSize--;</span><br><span class="line">         <span class="keyword">return</span> m;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Message</span>()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>recycleUnchecked</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span> (sPoolSize &lt; MAX_POOL_SIZE) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       next = <span class="type">sPool</span>	</span><br><span class="line">       <span class="variable">sPool</span> <span class="operator">=</span> <span class="built_in">this</span></span><br><span class="line">       sPoolSize++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>193.ArrayDeque 源代码阅读</p>
<ul>
<li>成员 &#x2F;&#x2F;transient标识的在通过ObjectOutputStream进行持久化时不进行该成员处理<br>a).private transient E[] elements<br>b).private transient int head<br>c).private transient int tail<br>d).private static final int MIN_INITIAL_CAPACITY &#x3D; 8</li>
<li>初始化时的分配<br>a).allocateElements(int numElements) &#x2F;&#x2F;后续操作保证capacity为2的n次方<br>b).elements &#x3D; new Object[initialCapacity]</li>
<li>doubleCapacity &#x2F;&#x2F;扩容,当tail+1&#x3D;&#x3D;head时，进行扩容<br>a).int p &#x3D; head;<br>int n &#x3D; elements.length;<br>int r &#x3D; n - p;<br>int n &#x3D; elements.length<br>int newCapacity &#x3D; n &lt;&lt; 1<br>System.arraycopy(elements, p, a, 0, r);<br>System.arraycopy(elements, 0, a, r, p);</li>
<li>插入<br>a).addFirst &#x2F;&#x2F;头部插入数据<br>elements[head &#x3D; (head - 1) &amp; (elements.length - 1)] &#x3D; e;&#x2F;&#x2F;elements.length-1 equals 1111…111<br>if (head &#x3D;&#x3D; tail)<br>doubleCapacity();<br>b).addLast &#x2F;&#x2F;尾部插入数据<br>elements[tail] &#x3D; e;<br>if ( (tail &#x3D; (tail + 1) &amp; (elements.length - 1)) &#x3D;&#x3D; head)<br>doubleCapacity();</li>
<li>遍历<br>a).成员 &#x2F;&#x2F;cursor,fence,lastRet<br>b).public E next()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">if</span>(cursor==fence) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span></span><br><span class="line">    &gt;lastRet=cursor</span><br><span class="line">    &gt;cursor = (cursor + <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)</span><br><span class="line">    &gt;<span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>c).public void remove()<br>delete(lastRet) &#x2F;&#x2F;调用私有方法delete删除lastRet对应下标  </p>
<blockquote>
<p>final int front &#x3D; (i - h) &amp; mask;<br>final int back &#x3D; (t - i) &amp; mask;<br>if(front&lt;back) &#x2F;&#x2F;删除某一下标的元素后，需要对前半和后半进行移动，这时选择较短部分进行操作省时</p>
</blockquote>
<p>194.RecyclerView</p>
<ul>
<li>ViewHolder复用<br>:1.Recycler</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;mAttachedScrap 		<span class="comment">//仍然依赖于RecyclerView，但已经被标记移除的vh(例如已经滑出可视范，但还没被移除)</span></span><br><span class="line"> &gt;mChangedScrap  		<span class="comment">//存储notifyXXX时需要改变的vh</span></span><br><span class="line"> &gt;mCachedViews		<span class="comment">//mAttachedScrap不再依赖RecyclerView的vh</span></span><br></pre></td></tr></table></figure>

<p>:2.getViewForPosition &#x2F;&#x2F;1).从mChangedScrap 2).mAttachedScrap 3).mCachedViews<br>:3.recycleView  </p>
<blockquote>
<p>recycleViewHolderInternal(holder)-&gt; mCachedViews.add -&gt; mRecyclerPool</p>
</blockquote>
<ul>
<li>RecyclerView::onMeasure &#x2F;&#x2F;测量<br>a).dispatchLayoutStep2 -&gt; mLayout.onLayoutChildren<br>…<br>b).dispatchLayoutStep3 &#x2F;&#x2F;执行动画</li>
<li>LayoutManager<br>a).onLayoutChildren(RecyclerView.Recycler recycler, RecyclerView.State state)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="comment">//1)确认锚点信息</span></span><br><span class="line"><span class="keyword">if</span>(mAnchorInfo.mLayoutFromEnd)</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">  firstLayoutDirection=LayoutState.ITEM_DIRECTION_TAIL<span class="comment">//向底部填充</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2)填充</span></span><br><span class="line">    fill(recycler, mLayoutState,RecyclerVie.State::state, <span class="literal">false</span>)-&gt;</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="keyword">while</span> ((layoutState.mInfinite || remainingSpace &gt; <span class="number">0</span>) &amp;&amp; layoutState.hasMore(state)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     layoutChunk(recycler, state, layoutState, layoutChunkResult)—&gt;</span><br><span class="line">      &gt; addView</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>RecycledViewPool &#x2F;&#x2F;存放ViewHolder<br>a).public ViewHolder getRecycledView(int viewType)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"> <span class="keyword">final</span> ArrayList&lt;ViewHolder&gt; scrapHeap = mScrap.get(viewType);</span><br><span class="line">    <span class="keyword">if</span> (scrapHeap != <span class="literal">null</span> &amp;&amp; !scrapHeap.isEmpty()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> scrapHeap.size() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ViewHolder</span> <span class="variable">scrap</span> <span class="operator">=</span> scrapHeap.get(index);</span><br><span class="line">        scrapHeap.remove(index);</span><br><span class="line">        <span class="keyword">return</span> scrap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>b).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putRecycledView</span><span class="params">(ViewHolder scrap)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">viewType</span> <span class="operator">=</span> scrap.getItemViewType();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ArrayList</span> <span class="variable">scrapHeap</span> <span class="operator">=</span> getScrapHeapForType(viewType);</span><br><span class="line">        <span class="keyword">if</span> (mMaxScrap.get(viewType) &lt;= scrapHeap.size()) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG &amp;&amp; scrapHeap.contains(scrap)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;this scrap item already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        scrap.resetInternal();</span><br><span class="line">        scrapHeap.add(scrap);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>195.LinearLayoutManager &#x2F;&#x2F;RecyclerView的布局管理器</p>
<ul>
<li>onLayoutChildren<br>:1.更新layoutState的状态，并等待getItemCount()的刷新</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mAnchorInfo.mLayoutFromStart=<span class="literal">true</span>	</span><br><span class="line">  updateLayoutStateToFillEnd -&gt; </span><br><span class="line">mLayoutSTate.mAvailable = mOrientationHelper.getEndAfterPadding()-offset<span class="comment">//一开始就是很大的</span></span><br></pre></td></tr></table></figure>

<p>:2.填充子view</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fill(recycler , mLayoutState,state,<span class="literal">false</span>)</span><br><span class="line">  ... <span class="type">int</span> start=layoutState.mAvailable</span><br><span class="line">      <span class="type">int</span> remainSpace=layoutState.mAvailable<span class="comment">//主要用于保存滑动的偏移距离</span></span><br><span class="line">      <span class="keyword">while</span>(remainSpace&gt;<span class="number">0</span>&amp;&amp;layoutState.hasMore(state))<span class="comment">//判断是否有剩余空间&amp;&amp;mItemCount&gt;position</span></span><br><span class="line">	 layoutChunk(recycler, state, layoutState, layoutChunkResult)</span><br><span class="line">	    ... View view=layoutState.next(recycler)</span><br><span class="line">		<span class="keyword">if</span>(mScrapList!=<span class="literal">null</span>)</span><br><span class="line">		  <span class="keyword">return</span> nextViewFromScrapList()</span><br><span class="line">		View view=recycler.getViewForPosition(mCurrentPosition)</span><br><span class="line">		 ... holder=getScrapOrHiddenOrCachedHolderForPosition(position)</span><br><span class="line">		    <span class="keyword">if</span>(holder==<span class="literal">null</span>)</span><br><span class="line">			holder=getRecycledViewPool().getRecycledView(type)</span><br><span class="line">		    <span class="keyword">if</span>(holder==<span class="literal">null</span>&amp;&amp;mAdapter!=<span class="literal">null</span>)</span><br><span class="line">			holder=mAdapter.createViewHolder()  <span class="comment">//!!,调用Recycler.Adapter</span></span><br><span class="line">		    ...</span><br><span class="line">		    mAdapter.onBindViewHolder()          <span class="comment">//!!,调用</span></span><br><span class="line">                    addView(view)		<span class="comment">//加入子view</span></span><br><span class="line">		measureChildWithMargins(view)	<span class="comment">//view.measure(..,..)</span></span><br><span class="line">		result.mConsumed=view.height</span><br><span class="line">		<span class="title function_">if</span><span class="params">(mOrientation==VERTICAL)</span></span><br></pre></td></tr></table></figure>

<p>196.1 GridLayoutManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;mGridLayoutManager.setSpanSizeLookup(<span class="keyword">new</span> <span class="title class_">GridLayoutManager</span>.SpanSizeLookup()&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    override <span class="keyword">public</span> <span class="title function_">getSpanSize</span><span class="params">(position:<span class="type">int</span>)</span>:<span class="type">int</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">      val type=mAdapter.getItemViewType(position)</span><br><span class="line">      <span class="keyword">switch</span>(type)</span><br><span class="line">      &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>196.2.RecyclerView 使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;封装adapter</span><br><span class="line">  :<span class="number">1.</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRecyclerViewAdapter</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.Adapter&lt;MyAdapter.ViewHolder&gt; &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyAdapter</span><span class="params">(List&lt;String&gt; list)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyAdapter.ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="type">int</span> viewType)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span>  LayoutInflater.from(parent.getContext()).inflate(R.layout.item_base_use, parent, <span class="literal">false</span>);</span><br><span class="line">        MyAdapter.<span class="type">ViewHolder</span> <span class="variable">viewHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyAdapter</span>.ViewHolder(view);</span><br><span class="line">        <span class="keyword">return</span> viewHolder;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(MyAdapter.ViewHolder holder, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        holder.mText.setText(list.get(position));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> list.size();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ViewHolder</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.ViewHolder &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">        TextView mText;</span><br><span class="line">        ViewHolder(View itemView) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">            <span class="built_in">super</span>(itemView);</span><br><span class="line">            mText = itemView.findViewById(R.id.item_tx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>196.1 Binder</p>
<ul>
<li>BpBinder<br>:1.val in:Parcel ,val out:Parcel</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;MediaPlayerService	<span class="comment">//class MediaPlayerService : public BnMediaPlayerService，媒体服务  </span></span><br><span class="line">  :<span class="number">1.</span>调用了BpServiceManager::addService(String16&amp; name,const sp&lt;IBinder&gt; &amp;service)</span><br><span class="line">    ...	Parcel data, reply;</span><br><span class="line">	data.writeInterfaceToken(IServiceManager::getInterfaceDescriptor());</span><br><span class="line">	data.writeString16(name)</span><br><span class="line">	data.writeStrongBinder(service)</span><br><span class="line">	remote()-&gt;transact(ADD_SERVICE_TRANSACTION, data, &amp;reply)<span class="comment">//remote是BpBinder</span></span><br><span class="line">  :<span class="number">2.</span>BpBinder::transact(uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags)</span><br><span class="line">   ...  <span class="type">status_t</span> <span class="variable">status</span> <span class="operator">=</span> IPCThreadState::self()-&gt;transact(mHandle, code, data, reply, flags)</span><br></pre></td></tr></table></figure>

<ul>
<li>Service Manager</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>打开Binder设备文件，分配内存 -&gt; 告诉Binder驱动自己成为Binder的上下文管理者 -&gt; binder_loop(bs,svcmgr_handler)</span><br><span class="line">   ...  struct binder_state *bs</span><br><span class="line">	<span class="keyword">void</span> *svcmgr = BINDER_SERVICE_MANAGER	<span class="comment">//句柄为0</span></span><br><span class="line">	bs = binder_open(<span class="number">128</span>*<span class="number">1024</span>)</span><br><span class="line">	<span class="keyword">if</span> (binder_become_context_manager(bs)) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	&#125;</span><br><span class="line">        svcmgr_handle = svcmgr</span><br><span class="line">	<span class="title function_">binder_loop</span><span class="params">(bs, svcmgr_handler)</span></span><br><span class="line">  :<span class="number">2.</span> fd是文件描述符，mapped是把设备文件/dev/binder映射到进程空间的起始地址；mapsize是上述内存映射空间的大小</span><br><span class="line">   .... struct binder_state</span><br><span class="line">        &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    	  <span class="type">int</span> fd;</span><br><span class="line">     	  <span class="keyword">void</span> *mapped;</span><br><span class="line">    	  unsigned mapsize;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>197.ActivityThread &#x2F;&#x2F;Android应用的主线程</p>
<ul>
<li>成员<br>:1.mActivities<br>:2.mServices<br>:3.mApplication<br>:4.mProviderMap</li>
<li>流程<br>:1.main</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;Looper.prepareMainLooper()</span><br><span class="line"> <span class="type">ActivityThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityThread</span>()</span><br><span class="line"> <span class="keyword">if</span> (sMainThreadHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   sMainThreadHandler =thread.getHandler();<span class="comment">//mH</span></span><br><span class="line"> &#125;</span><br><span class="line"> ...</span><br><span class="line"> Looper.loop()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ActivityInfo &#x2F;&#x2F;封装了所有在AndroidManifest.xml解析出的关于Activity、receiver的信息</p>
</li>
<li><p>ActivityClientRecord<br>a).intent</p>
<blockquote>
<p>mAction&#x3D;“android.intent.action.MAIN”<br>mComponent&#x3D;{mClass&#x3D;“com.pill.interview.annotation.Home”}<br>b).activityInfo<br>taskAffinity&#x3D;“com.pill.interview”<br>processName&#x3D;“com.pill.interview”</p>
</blockquote>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">  &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    Looper.prepareMainLooper()		<span class="comment">//1.新建looper,并放置于ThreadLocal中 2.赋值在Looper的sMainLooper</span></span><br><span class="line">    ActivityThread thread=<span class="keyword">new</span> <span class="title class_">ActivityThread</span>()<span class="comment">//1.初始化成员变量mH,mH=new H()2.初始化ApplicationThread</span></span><br><span class="line">    …</span><br><span class="line">    sMainThreadHandler = thread.getHandler();	<span class="comment">//将mH赋值给sMainThreadHandler</span></span><br><span class="line">    Looper.loop()</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;<span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">H</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span><span class="comment">//包含: 对Activity、Service、Application的操作</span></span><br><span class="line">    &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	<span class="keyword">switch</span>(msg.what)</span><br><span class="line">	&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  a).<span class="keyword">case</span> LAUNCH_ACTIVITY:</span><br><span class="line">	     handleLaunchActivity(r,Intent <span class="title function_">customIntent</span><span class="params">(<span class="literal">null</span>)</span>, <span class="string">&quot;LAUNCH_ACTIVITY&quot;</span>) -&gt;</span><br><span class="line">	     &gt;performLaunchActivity(r,customIntent)<span class="comment">//通过Instrumentation反射得到Activity对象,新建Application</span></span><br><span class="line">		&gt;检查r.packageInfo	<span class="comment">//无效的话通过r.applicationInfo去创建</span></span><br><span class="line"> 		&gt;检查r.intent.mComponent<span class="comment">//无效的话通过r.intent.resolveActivity去创建</span></span><br><span class="line">		&gt; activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);</span><br><span class="line">			<span class="comment">//(Activity)cl.loadClass(className).newInstance() -&gt; 反射创建Activity</span></span><br><span class="line">		&gt;<span class="type">Application</span> <span class="variable">app</span> <span class="operator">=</span> r.packageInfo.makeApplication(<span class="literal">false</span>, mInstrumentation)</span><br><span class="line">  		&gt;Context appContext= createBaseContextForActivity(r, activity)<span class="comment">//创建Context</span></span><br><span class="line">		&gt;<span class="type">CharSequence</span> <span class="variable">title</span> <span class="operator">=</span> r.activityInfo.loadLabel(appContext.getPackageManager())<span class="comment">//设置标题</span></span><br><span class="line">		&gt;activity.attach(appContext…)</span><br><span class="line">		&gt;mInstrumentation.callActivityOnCreate(activity, r.state);</span><br><span class="line">			<span class="comment">//进入Activity的onCreate回调，设置ActionBar和恢复Fragments的状态</span></span><br><span class="line">		&gt;activity.performStart()	<span class="comment">//调用Activity的onStart()回调</span></span><br><span class="line">		&gt;mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state)</span><br><span class="line">			<span class="comment">//进入Activity的onRestoreInstanceState回调</span></span><br><span class="line">		&gt;r.paused = <span class="literal">true</span> 		<span class="comment">//代表当前Activity的状态是pause</span></span><br><span class="line">	  b).<span class="keyword">case</span> RESUME_ACTIVITY:	<span class="comment">//当进入Resume后</span></span><br><span class="line">	     handleResumeActivity(IBinder token,<span class="type">boolean</span> clearHide,<span class="type">boolean</span> isForward)-&gt;</span><br><span class="line">	     &gt;<span class="type">ActivityClientRecord</span> <span class="variable">r</span> <span class="operator">=</span> mActivities.get(token)</span><br><span class="line">			<span class="comment">//mActivities -&gt; ArrayMap&lt;IBinder,ActivityClientRecord&gt;</span></span><br><span class="line">	     &gt;r = performResumeActivity(token, clearHide, reason)	</span><br><span class="line">		&gt;<span class="keyword">if</span>(r.pendingIntents != <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                  deliverNewIntents(r, r.pendingIntents)</span><br><span class="line">			<span class="comment">//mInstrumentation.callActivityOnNewIntent(r.activity, intent),进入onNewIntent回调</span></span><br><span class="line">                  r.pendingIntents = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">		&gt;r.activity.performResume()<span class="comment">//进入onResume()</span></span><br><span class="line">	  c).<span class="keyword">case</span> PAUSE_ACTIVITY:</span><br><span class="line">	     handlePauseActivity(IBinder token,<span class="type">boolean</span> finished …) -&gt;</span><br><span class="line">	     &gt;performPauseActivity(ActivityClientRecord r,<span class="type">boolean</span> finished,..)</span><br><span class="line">		&gt; 检查r.paused	<span class="comment">//1)r.paused==true,检查r.activity.mFinished是否为true,否则报异常</span></span><br><span class="line">		&gt; <span class="keyword">if</span> (r.paused &amp;&amp;r.activity.mFinished) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> <span class="literal">null</span>&#125;</span><br><span class="line">		&gt; <span class="keyword">if</span>(r.paused)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     RuntimeExceptio e&#125;</span><br><span class="line">		&gt; 检查finished	<span class="comment">//if(finished) -&gt; r.activity.mFinished=true</span></span><br><span class="line">		&gt; <span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; saveState) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	<span class="comment">//如果需要saveState</span></span><br><span class="line">	           mInstrumentation.callActivityOnSaveInstanceState(r.activity,r.state)</span><br><span class="line">			<span class="comment">//进入Activity的onSaveInstanceState回调</span></span><br><span class="line">        	  &#125;</span><br><span class="line">		&gt; performPauseActivityIfNeeded(r,reason)	</span><br><span class="line">		  <span class="keyword">if</span>(r.paused)&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> ;&#125;</span><br><span class="line">		  mInstrumentation.callActivityOnPause(r.activity);	<span class="comment">//进入onPause回调</span></span><br><span class="line">	  d).<span class="keyword">case</span> STOP_ACTIVITY_SHOW:</span><br><span class="line">	     handleStopActivity(IBinder token,<span class="type">boolean</span> show) -&gt;</span><br><span class="line">	     &gt;performStopActivityInner(ActivityClientRecord r,StopInfo info,show…)</span><br><span class="line">		&gt;performPauseActivityIfNeeded(r,reason)</span><br><span class="line">		&gt;<span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; saveState) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                  <span class="keyword">if</span> (r.state == <span class="literal">null</span>) &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">                    callCallActivityOnSaveInstanceState(r);	<span class="comment">//进入Activity的onSaveInstanceState回调</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">	  e).<span class="keyword">case</span> DESTROY_ACTIVITY:</span><br><span class="line">	     handleDestroyActivity(IBinder token,<span class="type">boolean</span> finishing…) -&gt;</span><br><span class="line">	     &gt;performDestroyActivity(token, finishing,configChanges, getNonConfigInstance)</span><br><span class="line">		&gt;performPauseActivityIfNeeded	<span class="comment">//如果必要，使Activity进入mPaused==true的状态</span></span><br><span class="line"></span><br><span class="line">	&#125;    </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&gt;<span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ApplicationThread</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    a).<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> scheduleLaunchActivity</span><br><span class="line">       &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	  <span class="type">ActivityClientRecord</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityClientRecord</span>()</span><br><span class="line">         …</span><br><span class="line">         sendMessage(H.LAUNCH_ACTIVITY, r)</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>198.CountDownLatch 线程同步<br>199.retrofit</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;建立retrofit对象</span><br><span class="line">  :<span class="number">1.</span><span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(<span class="string">&quot;http://fy.iciba.com/&quot;</span>) <span class="comment">//http://fy.iciba.com/</span></span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build();</span><br><span class="line">  :<span class="number">2.</span>动态代理</span><br><span class="line">   Public&lt;T&gt; T <span class="title function_">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span>&#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">      service &#125;,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     	</span><br><span class="line">           <span class="meta">@Override</span> <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy,Method method,Object[] args)</span>	</span><br><span class="line">	   &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">	      <span class="keyword">if</span>(method.getDeclaringClass()==Object.class)</span><br><span class="line">	      	<span class="keyword">return</span> method.invoke(<span class="built_in">this</span>, args)</span><br><span class="line">	   &#125;</span><br><span class="line"> 	&#125;)</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&gt;建立ServiceMethod</span><br><span class="line">  :<span class="number">1.</span>建立CallAdapter</span><br><span class="line">   &gt;retrofit.callAdapter(returnType,annotations)</span><br></pre></td></tr></table></figure>

<p>200.ClassLoader 类加载器</p>
<ul>
<li>JVM<br>:1.Bootstrap ClassLoader &#x2F;jre&#x2F;lib,用于加载java虚拟机所需要的系统类，java.lang.*<br>:2.Ext ClassLoader &#x2F;jre&#x2F;lib&#x2F;ext<br>:3.App ClassLoader</li>
<li>ART<br>:1.BootClassLoader -&gt;加载常用类<br>:2.PathClassLoader -&gt;extends DexClassLoader,加载系统类和应用程序的类dex文件、apk等<br>:3.DexClassLoader -&gt;以加载dex文件以及包含dex的apk文件或jar文件，也支持从SD卡进行加载</li>
</ul>
<p>201.RxJava</p>
<ul>
<li>创建Observable</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1.</span>create(ObservableOnSubscribe&lt;T&gt; source)</span><br><span class="line">     &#123;</span><br><span class="line">   </span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">       RxJavaPlugins.onAssembly(<span class="keyword">new</span> <span class="title class_">ObservableCreate</span>&lt;T&gt;(source)) <span class="comment">//this.source = source</span></span><br><span class="line">       </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Action</li>
<li>Function</li>
<li>map操作符</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.wuleizhenshang.love">无泪真伤</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.wuleizhenshang.love/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/">https://www.wuleizhenshang.love/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.wuleizhenshang.love" target="_blank">Blog-无泪真伤</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://smms.app/image/tPiv5zLXgsfGWmn" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/03/android%E7%9F%A5%E8%AF%86%E7%B2%BE%E5%8D%8E/" title="Android知识秘籍"><img class="cover" src="https://smms.app/image/gw4uYQMBloWir5K" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android知识秘籍</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/28/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/" title="程序员面试金典（Java代码）"><img class="cover" src="https://pic.imgdb.cn/item/67487ddcd0e0a243d4da7860.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">程序员面试金典（Java代码）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic.imgdb.cn/item/65582252c458853aeff7c6f5.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">无泪真伤</div><div class="author-info__description">找寻自己所爱！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wuleizhenshang"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本人并非什么大佬！写博客纯属个人兴趣，记录一下个人学习经历而已，有错误请见谅！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A"><span class="toc-number">1.</span> <span class="toc-text">上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B"><span class="toc-number">2.</span> <span class="toc-text">下</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/android%E7%9F%A5%E8%AF%86%E7%B2%BE%E5%8D%8E/" title="Android知识秘籍"><img src="https://smms.app/image/gw4uYQMBloWir5K" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android知识秘籍"/></a><div class="content"><a class="title" href="/2025/01/03/android%E7%9F%A5%E8%AF%86%E7%B2%BE%E5%8D%8E/" title="Android知识秘籍">Android知识秘籍</a><time datetime="2025-01-03T12:19:51.000Z" title="发表于 2025-01-03 20:19:51">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/" title="Android提问问答"><img src="https://smms.app/image/tPiv5zLXgsfGWmn" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android提问问答"/></a><div class="content"><a class="title" href="/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/" title="Android提问问答">Android提问问答</a><time datetime="2025-01-03T12:19:12.000Z" title="发表于 2025-01-03 20:19:12">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/28/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/" title="程序员面试金典（Java代码）"><img src="https://pic.imgdb.cn/item/67487ddcd0e0a243d4da7860.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序员面试金典（Java代码）"/></a><div class="content"><a class="title" href="/2024/11/28/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/" title="程序员面试金典（Java代码）">程序员面试金典（Java代码）</a><time datetime="2024-11-28T14:54:00.000Z" title="发表于 2024-11-28 22:54:00">2024-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/18/23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+7%E7%A7%8D%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="7大设计原则+23种设计模式（Java代码版本）"><img src="https://pic.imgdb.cn/item/673b421bd29ded1a8cbbff29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7大设计原则+23种设计模式（Java代码版本）"/></a><div class="content"><a class="title" href="/2024/11/18/23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+7%E7%A7%8D%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="7大设计原则+23种设计模式（Java代码版本）">7大设计原则+23种设计模式（Java代码版本）</a><time datetime="2024-11-18T07:54:00.000Z" title="发表于 2024-11-18 15:54:00">2024-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" title="代码随想录学习记录"><img src="https://s2.loli.net/2024/09/16/rdv2wuJ17ghb3Qj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代码随想录学习记录"/></a><div class="content"><a class="title" href="/2024/09/16/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" title="代码随想录学习记录">代码随想录学习记录</a><time datetime="2024-09-16T07:54:00.000Z" title="发表于 2024-09-16 15:54:00">2024-09-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By 无泪真伤</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to my blog! --by Wuleizhenshang</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false#  open shake (抖動特效);
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>