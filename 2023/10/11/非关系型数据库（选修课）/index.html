<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>非关系型数据库（选修课） | Blog-无泪真伤</title><meta name="author" content="无泪真伤"><meta name="copyright" content="无泪真伤"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="非关系型数据库（选修课）上课老师发的课件合计，下载地址如下 https:&#x2F;&#x2F;wwcz.lanzout.com&#x2F;b04kt28wb 密码:4a0t  Redis基础内容概述简介 Remote Dictionary Server，简称Redis，即远程字典服务器，它是一个开源的、高性能的、基于键值对的缓存与存储数据库，并且通过提供多种键值数据结构来适应不同场景下的缓存与存储需求。Redis数据库是基于">
<meta property="og:type" content="article">
<meta property="og:title" content="非关系型数据库（选修课）">
<meta property="og:url" content="https://www.wuleizhenshang.love/2023/10/11/%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%80%89%E4%BF%AE%E8%AF%BE%EF%BC%89/index.html">
<meta property="og:site_name" content="Blog-无泪真伤">
<meta property="og:description" content="非关系型数据库（选修课）上课老师发的课件合计，下载地址如下 https:&#x2F;&#x2F;wwcz.lanzout.com&#x2F;b04kt28wb 密码:4a0t  Redis基础内容概述简介 Remote Dictionary Server，简称Redis，即远程字典服务器，它是一个开源的、高性能的、基于键值对的缓存与存储数据库，并且通过提供多种键值数据结构来适应不同场景下的缓存与存储需求。Redis数据库是基于">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.imgdb.cn/item/6558704bc458853aef160963.jpg">
<meta property="article:published_time" content="2023-10-11T02:18:30.000Z">
<meta property="article:modified_time" content="2024-04-02T05:02:52.116Z">
<meta property="article:author" content="无泪真伤">
<meta property="article:tag" content="开发技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/6558704bc458853aef160963.jpg"><link rel="shortcut icon" href="/img/86634.jpg"><link rel="canonical" href="https://www.wuleizhenshang.love/2023/10/11/%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%80%89%E4%BF%AE%E8%AF%BE%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 无泪真伤","link":"链接: ","source":"来源: Blog-无泪真伤","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '非关系型数据库（选修课）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-02 13:02:52'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic.imgdb.cn/item/65582252c458853aeff7c6f5.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/6558704bc458853aef160963.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Blog-无泪真伤"><span class="site-name">Blog-无泪真伤</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">非关系型数据库（选修课）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-11T02:18:30.000Z" title="发表于 2023-10-11 10:18:30">2023-10-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-02T05:02:52.116Z" title="更新于 2024-04-02 13:02:52">2024-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>110分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="非关系型数据库（选修课）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="非关系型数据库（选修课）"><a href="#非关系型数据库（选修课）" class="headerlink" title="非关系型数据库（选修课）"></a>非关系型数据库（选修课）</h1><p>上课老师发的课件合计，下载地址如下</p>
<p><a target="_blank" rel="noopener" href="https://wwcz.lanzout.com/b04kt28wb">https://wwcz.lanzout.com/b04kt28wb</a></p>
<p>密码:4a0t</p>
<hr>
<h2 id="Redis基础内容"><a href="#Redis基础内容" class="headerlink" title="Redis基础内容"></a>Redis基础内容</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><strong>简介</strong></p>
<p>Remote Dictionary Server，简称Redis，即远程字典服务器，它是一个开源的、高性能的、基于键值对的缓存与存储数据库，并且通过提供多种键值数据结构来适应不同场景下的缓存与存储需求。Redis数据库是基于ANSI C语言编写开发的，并且提供了多种语言API，例如Java、C&#x2F;C++、C#、PHP、JavaScript、Perl、Python及Ruby等语言。</p>
<p><strong>特点</strong></p>
<ul>
<li>支持多种数据结构</li>
<li>功能丰富</li>
<li>应用广泛</li>
<li>读写速度快</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>构建队列系统</li>
<li>排行榜</li>
<li>实时的垃圾系统</li>
<li>数据自动过期处理</li>
<li>计数器应用</li>
<li>缓存</li>
</ul>
<p><strong>支持的数据结构</strong></p>
<ul>
<li>String（字符串）</li>
<li>List（列表）</li>
<li>Set（集合）</li>
<li>Hash（散列）</li>
<li>Sorted Sets（有序集合）</li>
</ul>
<h3 id="相关操作"><a href="#相关操作" class="headerlink" title="相关操作"></a>相关操作</h3><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>启动 redis-cli 客户端工具，可以做如下处理：</p>
<p>修改 cmd 控制台的编码格式为 UTF-8：</p>
<p>命令：chcp 65001</p>
<p>然后再输入：</p>
<p>命令：redis-cli –raw</p>
<p>再查询时，就能得到想要的中文数据了。</p>
<h4 id="Key（键）"><a href="#Key（键）" class="headerlink" title="Key（键）"></a>Key（键）</h4><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>SET</td>
<td>为指定键设置值</td>
</tr>
<tr>
<td>MSET</td>
<td>为多个键设置值</td>
</tr>
<tr>
<td>GET</td>
<td>获取指定键等值</td>
</tr>
<tr>
<td>MGET</td>
<td>获取多个键对应的值</td>
</tr>
<tr>
<td>EXISTS</td>
<td>判断指定键是否存在</td>
</tr>
<tr>
<td>KEYS</td>
<td>查找所有符合给定pattern（正则表达式）的键</td>
</tr>
<tr>
<td>DUMP</td>
<td>序列化置顶的键，并返回被序列化的值</td>
</tr>
<tr>
<td>TYPE</td>
<td>查看指定键的类型</td>
</tr>
<tr>
<td>RENAME</td>
<td>重命名指定键的键名</td>
</tr>
<tr>
<td>EXPIRE</td>
<td>设置指定键的生存时间，以秒为单位</td>
</tr>
<tr>
<td>TTL</td>
<td>查看指定键的剩余生存时间</td>
</tr>
<tr>
<td>PERSIST</td>
<td>移除键的生存时间</td>
</tr>
<tr>
<td>DEL</td>
<td>在键存在时，删除键</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091411821.jpg" alt="img"></p>
<h4 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/ed51cb6e01193b494c5b3b953d72fdeceb4ff3b7/img/202309132144659.png"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>SET</td>
<td>为指定键设置值</td>
</tr>
<tr>
<td>MSET</td>
<td>为多个键设置值</td>
</tr>
<tr>
<td>GET</td>
<td>获取指定字符串key中的值</td>
</tr>
<tr>
<td>MGET</td>
<td>获取多个字符串key中的值</td>
</tr>
<tr>
<td>GETSET</td>
<td>获取指定字符串的旧值并设置新值</td>
</tr>
<tr>
<td>STRLEN</td>
<td>获取字符串的字节长度</td>
</tr>
<tr>
<td>GETRANGE</td>
<td>获取字符串键指定索引范围的值的内容</td>
</tr>
<tr>
<td>SETRANGE</td>
<td>为字符串的指定索引位置设置值</td>
</tr>
<tr>
<td>APPEND</td>
<td>追加新内容到值的末尾</td>
</tr>
</tbody></table>
<p><strong>注：setrange是指定一个字符串的开始替换位置，然后从这个位置开始把要设置的值替换进去，相当于从指定位置开始把原始值和指定值做覆盖，指定值覆盖在原始值上面</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091345977.png" alt="image-20231009134539937"></p>
<h4 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/107996c962e2d2e88caa0d8a9506a941405f1e0d/img/202309132144835.png"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>LPUSH</td>
<td>将一个或多个元素推入到列表的左端</td>
</tr>
<tr>
<td>RPUSH</td>
<td>将一个或多个元素推入到列表的右端</td>
</tr>
<tr>
<td>LRANGE</td>
<td>获取列表指定索引范围内的元素</td>
</tr>
<tr>
<td>LINDEX</td>
<td>获取列表指定索引位置上的元素</td>
</tr>
<tr>
<td>LPOP</td>
<td>弹出列表最左端的元素</td>
</tr>
<tr>
<td>RPOP</td>
<td>弹出列表最右端的元素</td>
</tr>
<tr>
<td>LLEN</td>
<td>获取指定列表的长度</td>
</tr>
<tr>
<td>LREM</td>
<td>移除列表中的指定元素</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091411257.png" alt="image-20231009141108214"></p>
<h4 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/8f1a08fedf7717ad349f3243bde26cda07f83766/img/202309142231846.png"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>SADD</td>
<td>将一个或多个元素添加到集</td>
</tr>
<tr>
<td>SCARD</td>
<td>获取集合中元素数量</td>
</tr>
<tr>
<td>SMEMBERS</td>
<td>获取集合中所有存在元素</td>
</tr>
<tr>
<td>SISMEMBER</td>
<td>检查指定元素是否存在在集合中</td>
</tr>
<tr>
<td>SREM</td>
<td>移除集合中的一个或多个已存在的元素</td>
</tr>
<tr>
<td>SMOVE</td>
<td>将元素从一个集合移到另一个集合中</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091318434.png" alt="image-20231009131701212"></p>
<h4 id="Hash（散列）"><a href="#Hash（散列）" class="headerlink" title="Hash（散列）"></a>Hash（散列）</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/576cd8aee0db0bbd776d88cef4871917b7b1bcc3/img/202309142239035.png"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>HSET</td>
<td>为散列中指定键设置值</td>
</tr>
<tr>
<td>HMSET</td>
<td>为散列中多个键设置值</td>
</tr>
<tr>
<td>HGET</td>
<td>获取散列中的指定键的值</td>
</tr>
<tr>
<td>MMGET</td>
<td>获取散列中多个键的值</td>
</tr>
<tr>
<td>HGETALL</td>
<td>获取散列中的所有键值对</td>
</tr>
<tr>
<td>HKEYS</td>
<td>获取散列中所有键</td>
</tr>
<tr>
<td>HVALS</td>
<td>获取散列中所有键的值</td>
</tr>
<tr>
<td>HDEL</td>
<td>删除散列中指定键及其对应的值</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091328205.png" alt="image-20231009132839165"></p>
<h4 id="Sorted-Sets（有序集合）"><a href="#Sorted-Sets（有序集合）" class="headerlink" title="Sorted Sets（有序集合）"></a>Sorted Sets（有序集合）</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/a4bf7bf0ae370177764f8b3e27ddcedbe8890830/img/202309142301526.png"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ZADD</td>
<td>为有序集合添加一个或多个键值对（先写值后写键）</td>
</tr>
<tr>
<td>ZCARD</td>
<td>获取有序集合中元素个数</td>
</tr>
<tr>
<td>ZCOUNT</td>
<td>统计有序集合中指定分值范围内的元素个数</td>
</tr>
<tr>
<td>ZRANGE</td>
<td>获取有序集合中指定索引范围内的元素</td>
</tr>
<tr>
<td>ZSCORE</td>
<td>获取有序集合中指定元素的分值</td>
</tr>
<tr>
<td>ZREM</td>
<td>移除有序集合中的指定元素</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310091338917.png" alt="image-20231009133819875"></p>
<hr>
<h2 id="Docker基础内容"><a href="#Docker基础内容" class="headerlink" title="Docker基础内容"></a>Docker基础内容</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p><strong>概念</strong></p>
<p>Docker 是一个开源的应用容器引擎，诞生于 2013 年初，基于 Go 语言实现， dotCloud 公司出品（后改名为Docker Inc） Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux 机器上。容器是完全使用沙箱机制，相互隔离容器性能开销极低。Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版）</p>
<p><strong>架构</strong></p>
<ul>
<li><p>镜像（Image）：Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。</p>
</li>
<li><p>容器（Container）：镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和对象一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
</li>
<li><p>仓库（Repository）：仓库可看成一个代码控制中心，用来保存镜像。</p>
</li>
</ul>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><p><strong>Window端通过安装docker软件，通过软件启动、停住重启docker服务</strong></p>
<h4 id="镜像相关"><a href="#镜像相关" class="headerlink" title="镜像相关"></a>镜像相关</h4><ul>
<li><p>查看镜像</p>
<p><code>docker images</code></p>
<p><code>docker images –q </code>   查看所用镜像的id</p>
</li>
<li><p>搜索镜像</p>
<p><code>docker search 镜像名称</code></p>
</li>
<li><p>拉取镜像</p>
<p><code>docker pull 镜像名称</code></p>
</li>
<li><p>删除镜像</p>
<p><code>docker rmi 镜像id</code>   删除指定本地镜像</p>
<p><code>docker rmi docker images -q</code>    删除所有本地镜像</p>
</li>
</ul>
<h4 id="容器相关"><a href="#容器相关" class="headerlink" title="容器相关"></a>容器相关</h4><ul>
<li><p>查看容器</p>
<p><code>docker ps</code>  查看正在运行的容器</p>
<p><code>docker ps –a </code>  查看所有容器</p>
</li>
<li><p>创建容器</p>
<p><code>docker run 参数</code></p>
<p><strong>参数如下</strong></p>
<p>-i：保持容器运行。通常与 -t 同时使用。加入it这两个参数后，容器创建后自动进入容器中，退出容器后，容器自动关闭。</p>
<p>-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用。</p>
<p>-d：以守护（后台）模式运行容器。创建一个容器在后台运行，需要使用docker exec 进入容器。退出后，容器不会关闭。</p>
<p>-it 创建的容器一般称为交互式容器，-id 创建的容器一般称为守护式容器</p>
<p>–name：为创建的容器命名。</p>
<p>-p: 把写在前面的本地tcp端口映射到写在后面的容器内部端口号，如<code>-p 8000:8080</code>表示将容器内的8080端口映射到主机的8000端口。</p>
</li>
<li><p>进入容器</p>
<p><code>docker exec 参数</code>   退出容器，容器不会关闭</p>
</li>
<li><p>启动容器</p>
<p><code>docker start 容器名称</code></p>
<p><strong>进入容器、启动容器、停止容器可以通过docker软件以可视化的方式完成</strong></p>
</li>
<li><p>停止容器</p>
</li>
</ul>
<p>  <code>docker stop 容器名称</code></p>
<ul>
<li>删除容器</li>
</ul>
<p>  <code>docker rm 容器名称</code>  删除已经停止的容器，运行状态的容器会删除失败</p>
<ul>
<li>查看容器信息</li>
</ul>
<p>  <code>docker inspect 容器名称</code></p>
<h4 id="数据卷配置"><a href="#数据卷配置" class="headerlink" title="数据卷配置"></a>数据卷配置</h4><p><strong>概念</strong></p>
<ul>
<li><p>数据卷是宿主机中的一个目录或文件</p>
</li>
<li><p>当容器目录和数据卷目录绑定后，对方的修改会立即同步</p>
</li>
<li><p>一个数据卷可以被多个容器同时挂载</p>
</li>
<li><p>一个容器也可以被挂载多个数据卷</p>
</li>
</ul>
<p><strong>作用</strong></p>
<ul>
<li><p>容器数据持久化</p>
</li>
<li><p>外部机器和容器间接通信</p>
</li>
<li><p>容器之间数据交换</p>
</li>
</ul>
<p><strong>配置数据卷</strong></p>
<p><strong>创建启动容器时，使用-v参数设置数据卷</strong>、</p>
<p><code>docker run ... –v 宿主机目录(文件):容器内目录(文件) ...</code> </p>
<p><strong>注意：目录必须是绝对路径，如果目录不存在会自动创建，可以挂载多个数据卷</strong></p>
<h3 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h3><h4 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h4><p>使用 Docker 时，宿主机和容器内系统、容器和容器之间都需要进行网络连接，因此要考虑容器和宿主机、容器和容器之间的网络连接方式，了解 Docker 的网络模式对正确使用 Docker 是非常重要的。<br>Docker 启动后，它默认会创建三个网络，使用 <code>docker network ls</code> 命令可以查看这些网络。</p>
<p>docker 自动创建了 bridge、host 和 none 3 种网络模式，默认情况下，使用的是 <strong>bridge</strong> 模式。</p>
<p>另外，用户还可以创建 Container 网络模式和自定义网络模式。在实际应用中，通过这 5 种网络模式就可以实现：</p>
<ul>
<li><p>容器间的互联和通信</p>
</li>
<li><p>容器和宿主机的通信以及端口映射</p>
</li>
<li><p>容器 IP 变动时，可以通过服务名直接进行网络通信，不需要重新配置</p>
</li>
</ul>
<p>Docker 中的网络接口默认都是<strong>虚拟</strong>的接口。对于本地系统和容器内系统来说，虚拟接口跟一个正常的以太网卡相比，是一样的。</p>
<h5 id="Bridge（桥接模式）"><a href="#Bridge（桥接模式）" class="headerlink" title="Bridge（桥接模式）"></a>Bridge（桥接模式）</h5><p>Bridge 模式是 docker 默认的，也是最常使用的网络模式。</p>
<p>当 Docker 服务启动时：会在宿主机上创建一个名为 docker0 的虚拟网桥，并选择一个和宿主机不同的IP 地址(172.12.0.1)和子网(172.12.0.0&#x2F;16)分配给 docker0 网桥，此主机上启动的 Docker 容器会连接到这个虚拟网桥上；</p>
<p> 创建一个容器时，docker 也会为该容器创建独立的网络环境，保证容器内的进程使用独立的网络环境，同时还会将容器连接到 docker0 虚拟网桥；</p>
<p> 通过宿主机上的 docker0 网桥，就实现了容器之间、容器与宿主机之间乃至外界进行网络通信。</p>
<p><code>docker network inspect bridge</code>  查看docker0的相关信息</p>
<p>创建容器时，使用<code>--network=bridge</code>,参数表示使用 bridge 网络模式，该参数可以不写，默认情况下就是使用 bridge。命令：<code>docker run --network=bridge</code></p>
<p><code>docker inspect r1</code> 查看一个容器的网络信息</p>
<p>如果宿主机外的机器想访问容器，只能先访问宿主机，再使用端口映射来访问，即将容器的端口与宿主机的端口进行映射，供外面的机器访问</p>
<h5 id="Host（主机模式）"><a href="#Host（主机模式）" class="headerlink" title="Host（主机模式）"></a>Host（主机模式）</h5><p>如果启动容器的时候使用 Host 模式，那么这个容器将不会获得独立的网络命名空间，而是和宿主机共用一个 Network Namespace；容器也不会模拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。但是，容器的其他方面，如文件系统，进程列表等还是和宿主机隔离的。</p>
<p>Host模式下虽然容器和宿主机的IP一样，但是<strong>端口号不同</strong>。</p>
<p>创建容器时，使用<code>--network=host</code>参数表示使用 host 网络模式<strong>。</strong>命令：<code>docker run --network=host</code></p>
<h5 id="none（无网络模式）"><a href="#none（无网络模式）" class="headerlink" title="none（无网络模式）"></a>none（无网络模式）</h5><p>none 无网络模式下，容器有独立的 network namespace,但不对其进行任何网络设置。该模式实际上是关闭了容器的网络功能，容器不能联网。</p>
<h2 id="Docker下使用Redis"><a href="#Docker下使用Redis" class="headerlink" title="Docker下使用Redis"></a>Docker下使用Redis</h2><ol>
<li><p>搜索redis镜像</p>
<p><code>docker search redis</code></p>
</li>
<li><p>下载redis镜像</p>
<p><code>docker pull redis</code></p>
<p>不添加下载参数就是默认下载最新版本，默认补全为该命令<code>docker pull redis:latest</code></p>
</li>
<li><p>新建redis容器</p>
<p><code>docker run -id --name redis_test -p 6379:6379 redis</code></p>
</li>
</ol>
<h2 id="Docker下使用MySql"><a href="#Docker下使用MySql" class="headerlink" title="Docker下使用MySql"></a>Docker下使用MySql</h2><p><code>docker run -d --name mysql_test_6367 -e MYSQL_ROOT_PASSWORD=wang10086 -p 6367:3306 mysql</code></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42847719/article/details/128097426">MySQL安装_mysql :: download mysql installer (archived versio-CSDN博客</a></p>
<h2 id="Docker下使用MongoDB"><a href="#Docker下使用MongoDB" class="headerlink" title="Docker下使用MongoDB"></a>Docker下使用MongoDB</h2><p><code>docker pull mongo</code>拉取镜像</p>
<p><code>docker run -d --name mongodb -p 27017:27017 --privileged=true -v /d/mongodb/data:/data/db mongo</code></p>
<hr>
<h2 id="Redis数据持久化"><a href="#Redis数据持久化" class="headerlink" title="Redis数据持久化"></a>Redis数据持久化</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p><strong>简介</strong></p>
<p>持久化可以理解为数据的永久存储，就是将数据存储到一个不会丢失的地方。如果把数据放在内存中，电脑关闭或重启数据就会丢失，所以放在内存中的数据不是持久化的，而放在磁盘上就是一种持久化。Redis 的数据存储在内存中，内存是瞬时的，如果系统宕机或重启，又或者 Redis崩溃或重启，所有内存数据都会丢失，尤其是在 Redis 作为缓存使用时，数据丢失影响非常大。为解决这个问题，Redis 提供两种机制对数据进行持久化存储，以便发生故障后能迅速恢复数据。</p>
<p><strong>Redis两种持久化方式</strong></p>
<ul>
<li>RDB 默认的持久化方式，备份数据</li>
<li>AOF 备份读写操作</li>
</ul>
<h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>Redis Database（RDB），就是在指定的时间间隔内将内存中的数据集快照写入磁盘。每次进行数据写入时，为了不影响 Redis 服务的正常使用，都会通过 fork 方式创建一个新的写入子进程，将当前的数据以二进制的形式写入到 dump.rdb 文件中。当Redis 实例故障重启后，会自动从磁盘读取快照文件，恢复数据。快照文件称为 RDB 文件，保存了在某个时间点的全部数据，默认是保存在当前运行目录，默认文件名是 <strong>dump.rdb</strong>，该文件会自动创建。RDB 技术可能会造成主进程和子进程之间数据不同步，产生部分数据丢失现象，比较适合定期对数据做完整备份。</p>
<h5 id="手动方式"><a href="#手动方式" class="headerlink" title="手动方式"></a>手动方式</h5><ul>
<li><p>执行 save 命令</p>
<p>执行save命令会使用主进程来执行RDB，这个进程中其他所有命令都会被阻塞，即redis无法对外提供服务，因此一般关闭redis之前或在数据迁移时可能会用到该命令。</p>
</li>
<li><p>执行 bgsave 命令</p>
<p>bgsave命令是异步执行RDB，执行后会开启子线程来完成EDB，主线程可以继续处理用户请求，不受影响。</p>
</li>
<li><p>执行 shutdown 命令时，Redis 自动执行 save 命令</p>
</li>
</ul>
<p>  执行该命令后会redis会自动执行save命令然后关闭服务器</p>
<h5 id="自动方式"><a href="#自动方式" class="headerlink" title="自动方式"></a>自动方式</h5><ul>
<li>触发RDB方式（修改配置文件）</li>
</ul>
<p>Redis的配置文件redis.conf中设置了出发RDB的机制，启动redis时可以指定绑定conf配置文件，其中的save参数下面有几个属性设置了执行RDB生成快照文件的时间策略。</p>
<p><strong>配置格式：</strong>save <seconds> <changes> <seconds> <changes>..</p>
<p>作用：在N秒内数据集至少有M个key改动，这一条件被满足时自动保存一次数据集，如“save 900 1”就是900秒内如果至少有1个key被修改，则执行bgsave命令。</p>
<p><strong>注：可以根据系统需要，加入自己的触发机制，save “”表示禁用RDB</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202309292202354.png"></p>
<p><strong>其他配置</strong></p>
<ul>
<li><p>dbfilename:设置 RDB 文件的名称</p>
</li>
<li><p>dir：指定 RDB 文件的存储位置</p>
</li>
<li><p>Rebcompression：是否压缩 RDB 文件</p>
</li>
</ul>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>为解决 RDB 方式丢失数据的问题，从 1.1 版本开始，redis 增加了一种更加可靠的方式：AOF 持久化方式。Append-only File（AOF），Redis 每次接收到一条<strong>更新数据</strong>的命令时，它将把该命令写到一个 AOF 文件中（只登记写操作，读操作不登记）。当 Redis 重启时，它通过重新执行 AOF 文件中所有的命令来恢复数据。</p>
<p><strong>配置（也是修改conf配置文件实现）</strong></p>
<ul>
<li>Appendonly：开启 aof 功能</li>
</ul>
<p>  默认是no，给成yes是开启aof持久化</p>
<ul>
<li><p>appendfilename：指定 AOF 文件名</p>
<p>默认文件名为 appendonly.aof ，可以修改。</p>
</li>
<li><p>dir:指定 RDB 和 AOF 文件存放的目录，默认是.&#x2F;</p>
</li>
<li><p>appendfsync：配置向 aof 文件写命令数据时的策略</p>
<p>有以下三种策略（对比在下面表格）：</p>
<ul>
<li><p>no：写命令执行完先放入 AOF 缓冲区，由操作系统决定何时将缓冲区内容写回磁盘；</p>
</li>
<li><p>always：表示每执行一次写命令，立即记录到 AOF 文件；</p>
</li>
<li><p>everysec：写命令执行完先放入 AOF 缓冲区，然后表示每隔 1 秒将缓冲区数据写到 AOF 文件，是默认方案。</p>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>配置项</th>
<th>刷盘时机</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>Always</td>
<td>同步刷盘</td>
<td>可靠性高，几乎不丢数据</td>
<td>性能影响大</td>
</tr>
<tr>
<td>everysec</td>
<td>每秒刷盘</td>
<td>性能适中</td>
<td>最多丢死1秒数据</td>
</tr>
<tr>
<td>no</td>
<td>操作系统控制</td>
<td>性能最好</td>
<td>可靠性较差，可能丢失大量数据</td>
</tr>
</tbody></table>
<h3 id="Docker下的Redis实现数据持久化"><a href="#Docker下的Redis实现数据持久化" class="headerlink" title="Docker下的Redis实现数据持久化"></a>Docker下的Redis实现数据持久化</h3><h4 id="RDB-1"><a href="#RDB-1" class="headerlink" title="RDB"></a>RDB</h4><ol>
<li>将本地修改好的conf配置文件<strong>（记得把这个挂载的配置文件的save等允许持久化挂载打开并且有需要修改的修改）</strong>挂载数据卷到redis容器</li>
</ol>
<p><strong>现在的redis初始配置文件默认开启RDB了，会自动备份到data目录（容器运行目录）下，不做任何修改可以不挂载配置文件，直接执行下一步操作即可</strong></p>
<p><code>docker run -p 6379:6379 --name redis -v /home/docker/redis/conf:/etc/redis/redis.conf -v /home/docker/redis/data:/data redis</code></p>
<p>这条命令就是把容器中<code>/etc/redis/redis.conf</code>映射到本地，本地<code>/home/docker/redis/conf</code>配置文件会挂载在容器的配置文件，修改会同步生效</p>
<p><code>docker run -p 6379:6379 --name redis -v /home/docker/redis/conf:/etc/redis/redis.conf -v /home/docker/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</code></p>
<ol start="2">
<li>将容器data目录映射到本地（挂载data目录）</li>
</ol>
<p><code>docker run -d --name redis1 -p 6379:6379 -v /d/redis/data:/data redis </code></p>
<p>这条命令主要就是<code>-v</code>部分去挂载数据卷，这里表示把本地<code>D:\redis\data</code><strong>（如果路径不存在，Docker会自动创建）</strong>映射到容器内的路径（容器的data路径是容器内自动创建的目录）</p>
<p><strong>示例命令（包括挂载conf和data）</strong></p>
<p><code>docker run -id -p 6380:6379 --name redis2 -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf:/etc/redis/redis.conf -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data:/data redis</code></p>
<h4 id="AOF-1"><a href="#AOF-1" class="headerlink" title="AOF"></a>AOF</h4><p>修改配置文件并在挂载data后命令加上<code>--appendonly yes</code>表示开启aof数据持久化</p>
<p>运行起来后会发现在挂载的data目录下会出现appendolydir文件夹，该文件夹下自动生成了多个备份文件，这是因为在 redis7.x 以后，采取了 AOF 多文件存储技术。</p>
<p><strong>示例命令</strong></p>
<p><code>docker run -id -p 6380:6379 --name redis2 -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf:/etc/redis/redis.conf -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data:/data redis --appendonly yes  </code></p>
<hr>
<h2 id="Redis主从复制（适合中小型系统）"><a href="#Redis主从复制（适合中小型系统）" class="headerlink" title="Redis主从复制（适合中小型系统）"></a>Redis主从复制（适合中小型系统）</h2><h3 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h3><p><strong>简介</strong></p>
<p>主从复制，是将多台数据库服务器分为主节点（master）和从节点（slaver），主节点数据更新后会根据配置和策略，自动同步到从节点上，从而保证主从节点中存有相同的数据。主从复制常见结构如下。</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202309271033679.png"></p>
<p><strong>当有许多从节点时，可以采用主-从-从的链式结构，以减少主节点的压力</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031241996.png"></p>
<p><strong>好处</strong></p>
<ul>
<li>默认实现读写分离机制，Master 以写为主，Slave 以读为主，提升系统的缓存读写性能；</li>
</ul>
<p>容灾快速恢复，提升整个系统的可用性。因为从节点中有主节点数据的副本，当主节点宕机后，可以立刻提升其中一个从节点为主节点，继续提供服务；</p>
<ul>
<li><p>数据备份，主从节点上都有数据，且都可以进行数据持久化处理；</p>
</li>
<li><p>支持高并发，提升数据库系统的请求处理能力。单个节点能够支撑的读流量有限。部署多个节点，并构成主从关系，主从节点一起提供服务。</p>
</li>
</ul>
<h3 id="简单实现数据同步"><a href="#简单实现数据同步" class="headerlink" title="简单实现数据同步"></a>简单实现数据同步</h3><p><strong>一开始6379为主节点，6380、6381为从节点，名称就是对应端口号</strong></p>
<ol>
<li><p>修改配置文件</p>
<p>修改其中的slaveof参数，这个参数指定成为哪一个master的从节点</p>
</li>
<li><p>启动主从服务器（一台主服务器，两台从服务器）</p>
</li>
</ol>
<p><strong>通过redis-server redis_6379.conf	redis-server redis_6380.conf	redis-server redis_6381.conf指定以哪个配置文件启动服务</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031207098.png"></p>
<p><strong>6379主节点信息</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031209856.png"></p>
<p><strong>6380从节点信息</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031210035.png"></p>
<p><strong>6381从节点信息</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031211196.png"></p>
<ol start="3">
<li>测试数据同步</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031213070.png"></p>
<h3 id="主从复制的容灾处理（手动）"><a href="#主从复制的容灾处理（手动）" class="headerlink" title="主从复制的容灾处理（手动）"></a>主从复制的容灾处理（手动）</h3><ol>
<li><p>手动关闭主节点（模拟主节点宕机）</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031218817.png"></p>
</li>
<li><p>将一个从节点提升为主节点，原先从节点挂载到新主节点上</p>
<p><code>slaveof no one</code>  : 将一台 slave 服务器提升为 Master</p>
<p><code>slaveof 主节点的 ip + 端口号</code>  : 将 slave 挂至新的 master 上</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031222911.png"></p>
</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031223645.png"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031239001.png"></p>
<ol start="3">
<li>重启原先主节点，修改原先主节点为新主节点的从节点</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031239456.png"></p>
<h3 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h3><h4 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h4><p><strong>简介</strong></p>
<p>哨兵（Sentinel）是 Redis 官方提供的一种高可用方案，它可以监控多个 Redis 服务实例的运行情况，监控主节点是否出现故障。如果出现故障，它会根据投票数自动将某一个从节点提升为主节点，以继续对外提供服务。<br>本质上，Sentinel 也是一个运行在特殊模式下的 Redis 服务器。主从复制模式下，一般会配置多个 Sentinel 节点，通过互相协作来实现系统的高可用，如下图所示。</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031251312.png"></p>
<p><strong>作用</strong></p>
<ul>
<li><p>主从监控：Sentinel 不断的检查主节点和从节点是否按照预期正常工作；</p>
</li>
<li><p>消息通知： Sentinel 会将故障和故障转移的结果通知客户端或其他应用程序；</p>
</li>
<li><p>自动故障转移：如果主节点异常，Sentinel 会自动进行故障迁移操作。即将一个从节点升级新的主节点，并让其他从服务器挂到新的主服务器，同时向客户端提供新的主服务器地址；</p>
</li>
<li><p>配置中心：客户端通过连接哨兵来获得当前 redis 服务的主节点地址。</p>
</li>
</ul>
<p><strong>原理</strong></p>
<p>Sentinel 基于心跳机制监测服务状态，每隔 1 秒向集群的每个实例发送 ping 命令：</p>
<ul>
<li>主观下线：如果某个 Sentinel 发现某个 redis 服务未在规定时间内（默认 30秒）响应，则认为该实例主观下线；</li>
<li>客观下线：若超过指定数（投票数）的 Sentinel 认为该 redis 服务主观下线，则该实例为客观下线，即哨兵模式确认该 redis 服务下线了。投票数的值最好超过 Sentinel 实例数量的一半。</li>
</ul>
<h4 id="具体样例搭建"><a href="#具体样例搭建" class="headerlink" title="具体样例搭建"></a>具体样例搭建</h4><p><strong>一开始6379为主节点，6380、6381为从节点，26379、26380、26381分别为6379、6380、6381哨兵</strong></p>
<ol>
<li><p>修改配置文件</p>
<p>以哨兵1（监听6379服务器）的配置文件为例，修改端口号为26379（自己设定），修改sentinel monitor参数</p>
<p><code>Sentinel monitor &lt;master-name&gt; &lt;masterIP&gt; &lt;masterPort&gt;&lt;Quorum 投票数&gt;</code></p>
<p><strong>参数说明</strong></p>
<ul>
<li>Master-name：主节点的名字</li>
<li>masterIP：主节点的 IP</li>
<li>masterPort：主节点的端口号</li>
<li>Quorum：判断主节点失效时，需要的哨兵节点的投票数</li>
</ul>
<p><strong>哨兵1样例</strong></p>
<p><code>sentinel monitor mymaster 127.0.0.1 6379 2</code></p>
</li>
<li><p>启动主从服务的三个Redis服务</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092023593.jpg" alt="img"></p>
</li>
<li><p>启动三个哨兵服务</p>
<p><strong>通过 redis-server sentinel_26379.conf –sentinel  redis-server sentinel_26380.conf  –sentinel  redis-server sentinel_26381.conf  –sentinel命令启动哨兵</strong></p>
<p>可以通过<code>info sentinel</code>命令查看哨兵运行情况</p>
</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031339981.png"></p>
<ol start="4">
<li>模拟主机宕机</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031350890.png"></p>
<p>主机宕机前后哨兵变化，可以看到主节点自动迁移到从节点了，从节点提升为主节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031352158.png"></p>
<p>6380变成了主节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031352298.png"></p>
<p>6379重启变成了从节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031352298.png"></p>
<p>6379重启后的主从结构</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310031354263.png"></p>
<h3 id="Docker下Redis实现哨兵模式"><a href="#Docker下Redis实现哨兵模式" class="headerlink" title="Docker下Redis实现哨兵模式"></a>Docker下Redis实现哨兵模式</h3><ol>
<li>修改redis服务的配置文件</li>
</ol>
<p>​		需要注意的是默认情况下新建一个redis主节点，其ip为172.17.0.2，端口号为6379，然后需要跟正常配置主从模式一样，要在配置文件中把6380和6381设置为是6379的从节点，这就需要知道主节点的ip以及端口号，但是如果存在建立过的docker容器可能主节点ip不同，所以可以先启动主节点，通过<code>docker inspect 主节点容器名称 </code>查看其ip再修改从节点配置文件以及启动从节点。</p>
<p><strong>下面是各节点配置文件</strong></p>
<p><em>主节点</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">#protected-mode no</span><br><span class="line">bind 0.0.0.0</span><br><span class="line"></span><br><span class="line">#开启分片集群</span><br><span class="line">cluster-enabled no</span><br><span class="line"></span><br><span class="line">#指定分片集群需要使用的节点配置文件名</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line">cluster-announce-ip 192.168.101.26</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br></pre></td></tr></table></figure>

<p><em>从节点1</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">port 6380</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">#protected-mode no</span><br><span class="line">slaveof 172.17.0.2 6379</span><br><span class="line"></span><br><span class="line">cluster-enabled no</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line">cluster-announce-ip 192.168.101.26</span><br><span class="line">cluster-announce-port 6380</span><br><span class="line">cluster-announce-bus-port 16380</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p><em>从节点2</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">port 6381</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">#protected-mode no</span><br><span class="line"></span><br><span class="line">slaveof 172.17.0.2 6379</span><br><span class="line">cluster-enabled no</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line">cluster-announce-ip 192.168.101.26</span><br><span class="line">cluster-announce-port 6381</span><br><span class="line">cluster-announce-bus-port 16381</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>搭建和运行1主2从服务</li>
</ol>
<p><strong>下面是运行例子的命令</strong></p>
<p><em>新建主节点容器</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_master -p 6379:6379 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_sentinel/redis_6379.conf:/etc/redis/redis_6379.conf redis redis-server /etc/redis/redis_6379.conf</span><br></pre></td></tr></table></figure>

<p><em>新建从节点1容器</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_slave1 -p 6380:6380 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_sentinel/redis_6380.conf:/etc/redis/redis_6380.conf redis redis-server /etc/redis/redis_6380.conf</span><br></pre></td></tr></table></figure>

<p><em>新建从节点2容器</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_slave2 -p 6381:6381 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_sentinel/redis_6381.conf:/etc/redis/redis_6381.conf redis redis-server /etc/redis/redis_6381.conf</span><br></pre></td></tr></table></figure>



<p>新建容器完成后，可以进入主节点，通过<code>info replication</code>查看主从复制是否成功建立</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092013504.png" alt="image-20231009201343377"></p>
<ol start="3">
<li>修改哨兵的配置文件</li>
</ol>
<p>修改配置需要修改的有端口号，以及添加sentinel指令去指定监听的redis服务的ip和端口、投票数</p>
<p><strong>下面是各哨兵的配置</strong></p>
<p><em>26379哨兵监听6379</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">port 26379</span><br><span class="line">#protected-mode no</span><br><span class="line"></span><br><span class="line">#Sentinel去监视一个名为mymaster的主redis实例</span><br><span class="line">sentinel monitor mymaster 172.17.0.2 6379 2</span><br></pre></td></tr></table></figure>

<p><em>26380哨兵监听6380</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">port 26380</span><br><span class="line">#protected-mode no</span><br><span class="line"></span><br><span class="line">#Sentinel去监视一个名为mymaster的主redis实例</span><br><span class="line">sentinel monitor mymaster 172.17.0.2 6379 2</span><br></pre></td></tr></table></figure>

<p><em>26381哨兵监听6381</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">port 26381</span><br><span class="line">#protected-mode no</span><br><span class="line"></span><br><span class="line">#Sentinel去监视一个名为mymaster的主redis实例</span><br><span class="line">sentinel monitor mymaster 172.17.0.2 6379 2</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>创建哨兵节点</li>
</ol>
<p><strong>下面是运行例子的命令</strong></p>
<p><em>新建26379哨兵监听6379节点</em></p>
<p> docker run -d –name redis_sentinel1 -p 26379:26379 –privileged&#x3D;true -v C:&#x2F;Users&#x2F;GTR&#x2F;Desktop&#x2F;temp&#x2F;大学上课学习&#x2F;大三上&#x2F;非关系型数据库&#x2F;redis&#x2F;docker_sentinel&#x2F;redis_26379.conf:&#x2F;etc&#x2F;redis&#x2F;redis_26379.conf redis redis-server &#x2F;etc&#x2F;redis&#x2F;redis_26379.conf –sentinel</p>
<p><em>新建26380哨兵监听6380节点</em></p>
<p> docker run -d –name redis_sentinel2 -p 26380:26380 –privileged&#x3D;true -v C:&#x2F;Users&#x2F;GTR&#x2F;Desktop&#x2F;temp&#x2F;大学上课学习&#x2F;大三上&#x2F;非关系型数据库&#x2F;redis&#x2F;docker_sentinel&#x2F;redis_26380.conf:&#x2F;etc&#x2F;redis&#x2F;redis_26380.conf redis redis-server &#x2F;etc&#x2F;redis&#x2F;redis_26380.conf –sentinel</p>
<p><em>新建26381哨兵监听6381节点</em></p>
<p> docker run -d –name redis_sentinel3 -p 26381:26381 –privileged&#x3D;true -v C:&#x2F;Users&#x2F;GTR&#x2F;Desktop&#x2F;temp&#x2F;大学上课学习&#x2F;大三上&#x2F;非关系型数据库&#x2F;redis&#x2F;docker_sentinel&#x2F;redis_26381.conf:&#x2F;etc&#x2F;redis&#x2F;redis_26381.conf redis redis-server &#x2F;etc&#x2F;redis&#x2F;redis_26381.conf –sentinel</p>
<p>可以进入哨兵1容器，通过<code>info sentinel</code>查看整个哨兵结构</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092052516.png" alt="image-20231009205204440"></p>
<ol start="5">
<li>主从数据同步实验</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092055948.png" alt="image-20231009205530879"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092055110.png" alt="image-20231009205552051"></p>
<ol start="6">
<li>自动处理故障</li>
</ol>
<p>​		首先将master主节点停止，模拟宕机</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092057813.png" alt="image-20231009205744720"></p>
<p>可以发现6381节点自动变成了主节点，并且此时6381作为主节点，6380节点为从节点依然可以满足用户请求需求</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092059589.png" alt="image-20231009205908530"></p>
<p>重启6379节点，可以发现他自动变成6381的从节点了</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092101097.png" alt="image-20231009210113033"></p>
<p>最后主从结构为下图</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310092102176.png" alt="image-20231009210223118"></p>
<hr>
<h2 id="Redis-Cluster-分片集群"><a href="#Redis-Cluster-分片集群" class="headerlink" title="Redis Cluster 分片集群"></a>Redis Cluster 分片集群</h2><h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><p><strong>分布式数据存储</strong></p>
<p>分布式数据存储是一种计算机数据存储架构，它将数据存储在多台独立的数据库服务器上，以实现数据的高可靠性、可扩展性和性能。在分布式存储中，每个计算机或服务器都可以看作一个存储节点，它们通过网络连接相互通信和协作，以实现数据的分布式存储和管理，同时还采用可扩展的系统结构，不仅提高了系统的可靠性、可用性和存取效率，还易于扩展。</p>
<p>分布式存储通常使用<strong>数据分片</strong>和<strong>副本复制</strong>技术，以确保数据的可靠性和可用性。</p>
<p>为了确保数据在不同节点之间的一致性，分布式存储系统通常使用数据同步和管理机制。</p>
<p>在分布式存储系统中，数据可以并行地从多个节点中读取和写入，以提高读写性能和吞吐量。数据访问通常使用<strong>负载均衡机制</strong>来实现，例如，使用分布式哈希表、分布式缓存或分布式文件系统等技术来实现。（负载均衡是一种用于分布式计算和网络系统中的关键技术，旨在平衡服务器集群的负载，以确保每个服务器都能充分利用并均匀分担请求负荷。负载均衡机制有助于提高系统的可用性、性能和稳定性。）</p>
<p><strong>数据分片</strong></p>
<p>在分布式存储系统中，数据被分成多个部分，每个部分存储在不同的节点上，以实现数据的分布式存储和管理。<strong>数据分片</strong>通常使用<strong>哈希函数</strong>或<strong>一致性哈希算法</strong>等技术来实现。分布式数据存储首先要考虑的是如何将整体数据按照分片规则映射到多个存储节点上，让节点负责数据的一个子集。</p>
<p><strong>副本复制</strong></p>
<p>为了提高数据的可靠性和可用性，分布式存储系统通常使用副本复制技术。每个数据副本都存储在不同的节点上，以确保即使某些节点出现故障，仍然可以从其他节点中恢复数据。副本复制通常使用复制策略来实现，例如，简单的复制、多副本复制和跨区域复制等。</p>
<p><strong>哈希取余分区</strong></p>
<ul>
<li><p>公式：<code>hash(key) % n</code>	（其中key可以为特定的数据，如键或用户ID；n为节点数量）</p>
</li>
<li><p>优点：简单明了，常用于可以预估数据节点，或扩容&#x2F;缩容不太频繁的应用场景，如使用 5 台服务器，就可以保证可支撑未来一段时间的数据请求处理。</p>
</li>
<li><p>缺点：当节点数量变化频繁时，如扩容或收缩节点，数据节点映射关系需要重新计算，会导致数据的重新迁移。</p>
</li>
</ul>
<p><strong>一致性哈希分区</strong></p>
<ul>
<li><p>一致性哈希算法：一致性哈希算法的目的是解决分布式数据变动和映射问题，在移除或者添加一个服务器时，能够尽可能小地改变已存在的服务请求与服务器之间的映射关系。</p>
</li>
<li><p>工作原理</p>
<ul>
<li>构建哈希环：一致性哈希算法将整个哈希值空间映射成一个虚拟的圆环，即哈希环。整个哈希空间的取值范围为 0~2的32 次方-1，并按<strong>顺时针</strong>方向组织，最后的2的32次方和零点重合，形成哈希环；</li>
<li>服务器节点映射：可以选择服务器的 IP 或主机名作为 key,进行 hash 运算，将服务器也映射到了哈希环上；</li>
<li>数据读写映射：先根据 key 计算 hash 值，然后沿哈希环<strong>顺时针</strong>找到第一个大于等于该哈希值的服务器节点，即为该数据的服务节点。</li>
</ul>
</li>
<li><p>优点：当增加一台新的服务器时，受影响的数据仅仅是新添加的服务器到其环空间中的前一台服务器（也就是顺着逆时针方向遇到的第一台服务器）之间的数据，其他节点都不会受到影响。因此，一致性哈希算法对于节点的增减，只需重新定位环空间中的一小部分数据，具有较好的容错性和扩展性。</p>
</li>
<li><p>缺点：不适合作为少量数据节点的分布式存储方案。在一致性哈希算法中，数据的分布和服务器节点的位置有关，这些节点不是均匀分布在哈希环上的。因此，当使用少量节点时，节点变化可能会影响哈希环中大范围的数据映射，产生<strong>数据倾斜问题</strong>（一部分数据集中在少数的节点或分区上，而其他节点或分区相对空闲），出现数据访问<strong>负载不均衡</strong></p>
</li>
</ul>
<p><strong>虚拟一致性哈希分区</strong></p>
<p>为了解决一致性哈希分区的缺点，一些分布式系统采用<strong>虚拟槽&#x2F;虚拟节点</strong>对一致性哈希方法进行了改进，如虚拟一致性哈希分区方法。</p>
<p>虚拟一致性哈希分区为了让各节点能够保持动态的<strong>均衡</strong>，在每个<strong>真实节点上虚拟出若干个虚拟节点</strong>，再将这些虚拟节点随机映射到哈希环上。此时，每个真实节点就不再直接映射到环上了，它只负责管理一组环上的虚拟节点和实际存储的键值对数据。</p>
<p>这样，就形成了<strong>数据 - - 虚拟节点 - - 真实节点</strong>的映射关系。当对数据进行存取操作时，</p>
<p>首先映射到虚拟节点上，再由虚拟节点找到对应的真实节点。</p>
<p><strong>如</strong>，三个真实节点: Node1、Node2 和 Node3，每个真实节点再虚拟出三个虚拟节点: V1，V2，V3，一共是 9 个虚拟节点。然后，这 9 个虚拟节点再映射到哈希环上。</p>
<p>这样，每个真实节点所负责的 hash 空间不再是连续的一段，而是分散在环上的各处，这样就可以将局部的压力均衡到不同的节点，虚拟节点越多，分散性越好，理论上负载就越倾向均匀</p>
<h3 id="概述-5"><a href="#概述-5" class="headerlink" title="概述"></a>概述</h3><p><strong>Cluster 分片集群架构基本结构</strong></p>
<p>Redis 哨兵模式虽然提供了 Redis 高可用、高并发读写的解决方案，但是在当前的一些互联网海量数据应用场景下，因为只有一组 master-slave 结构对外提供服务，数据的高并发写、数据备份和恢复都会大大降低效率,因此仍然存在海量数据存储问题、高并发和高可用等问题。</p>
<p>针对这些问题，Redis 推出 Cluster 分片集群架构，集群基本结构如下：</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182126654.png"></p>
<p>Redis分片集群实现了自动数据分片，实现了数据负载均衡，方便集群动态伸缩。（优点）</p>
<p><strong>Cluster 分片集群架构特点</strong></p>
<ul>
<li><p>Redis Cluster 采用的是基于 P2P 的去中心化的网络拓扑架构，没有中心节点，支持多个 master 节点，所master 节点既是数据存储节点，也是监控节点；</p>
</li>
<li><p>引入槽(slot)的概念，通过 <strong>CRC + hashslot</strong>算法支持多个主节点（分片），每个主节点分别负责存储一部分数据，集群<strong>自动维护数据 – 哈希槽 – 节点之间的对应关系</strong>，这样理论上可以支持无限主节点的水平扩容以便支持海量吞吐量；</p>
</li>
<li><p>每个 master 节点又可以配置多个 slave 节点，支持读写分离；</p>
</li>
<li><p><strong>内置类似哨兵的高可用机制</strong>，能够实现自动故障转移，保证每个 master 节点的高可用；</p>
</li>
<li><p>Master 节点之间通过 ping 监测彼此健康状态；</p>
</li>
<li><p>客户端请求可以<strong>访问集群任意节点</strong>，最终都会<strong>被转发到正确节点</strong>。</p>
</li>
</ul>
<p>因此，Redis Cluster 集群也叫分片集群，是一个有多个主从节点群组成的分布式服务集群。它具有复制、高可用性和分布存储的特性。该集群不需要哨兵也可以完成节点故障自动转移功能，并可实现动态扩容（官方建议不要超过 1000 个节点）。Cluster 集群的性能和高可用性均优于哨兵模式，且集群配置非常简单，更加适合应用于海量数据、高并发和高可用的场景。</p>
<p><strong>数据自动分片的实现</strong></p>
<p>Redis参考虚拟<strong>一致性哈希分区</strong>的思想，提出了<strong>虚拟槽分区方案</strong>。哈希槽(hash slot)是 Redis 实现分片集群的基础，也是集群内数据管理和迁移的基本单位。虚拟槽的取值为整数，<strong>范围为 0<del>16383（0</del>2的14次方-1），每一个整数即为一个哈希槽</strong>。</p>
<p><strong>具体步骤</strong></p>
<ul>
<li><p>预先设定哈希槽：共 <strong>16384</strong> 个哈希槽<strong>（默认数量）</strong>；</p>
</li>
<li><p>为每个 Redis 节点分配哈希槽位：根据节点的性能分配槽位，一般是平均分配。分配后，该节点就负责管理这些槽的读写操作；</p>
</li>
<li><p>计算要写入数据的哈希槽：当在 master 节点上写入数据时，Redis 先对每个键（key）用 <strong>CRC16 + hashslot</strong> 算法进行运算，所得数值即为槽位号；</p>
</li>
<li><p>在对应节点上写入数据：寻找该槽位号所在的 Redis 节点，并在对应编号的哈希槽中写入数据；</p>
</li>
<li><p>读取数据: 计算该数据的槽位号，寻找该槽位所在的 Redis 节点，然后读取数据。</p>
</li>
</ul>
<p><strong>默认情况下虚拟槽位值的计算：<code>slot = CRC16(key) mod 16383</code></strong></p>
<h3 id="Docker下简单实现"><a href="#Docker下简单实现" class="headerlink" title="Docker下简单实现"></a>Docker下简单实现</h3><p><strong>因为本身就是分布式实现，需要多台电脑，一台电脑多开虚拟机很卡，无法实践，这里这里借助docker简单展示使用</strong></p>
<ol>
<li><p>配置六个redis服务器，形成<strong>一主一从，一共3组</strong>的分片集群，修改所有节点的配置文件</p>
<p>主节点 1: IP:127.0.0.1 6379，配置文件：redis_6379.conf</p>
<p>主节点 2: IP:127.0.0.1 6380，配置文件：redis_6380.conf</p>
<p>主节点 3: IP:127.0.0.1 6381，配置文件：redis_6381.conf</p>
<p>从节点 4: IP:127.0.0.1 26379，配置文件：redis_26379.conf</p>
<p>从节点 5 :IP:127.0.0.1 26380，配置文件：redis_26380.conf</p>
<p>从节点 6 :IP:127.0.0.1 26381，配置文件：redis_26381.conf</p>
<p>主节点就以主节点1的配置文件修改为例，<strong>其他节点类似</strong>，<strong>修改端口号、打开分片集群、设置节点配置文件名</strong><code>cluster-enabled yes</code>表示开启分片集群</p>
<p><code>cluster-config-file 配置文件名</code>表示指定分片集群需要使用的节点配置文件名，这个指定的文件Redis自动创建，这里只需要给出配置文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6379.conf</span><br></pre></td></tr></table></figure>


</li>
<li><p>启动docker服务并创建6个Redis容器，并查看启动情况</p>
<p>主节点挂载data卷和redis配置卷，从节点挂载redis配置卷即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_6379 -p 6379:6379 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6379:/data -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_6379.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_6380 -p 6380:6380 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6380:/data -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_6380.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_6381 -p 6381:6381 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6381:/data -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_6381.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_26379 -p 26379:26379 --privileged=true  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_26379.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_26380 -p 26380:26380 --privileged=true  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_26380.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_26381 -p 26381:26381 --privileged=true  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_26381.conf</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​		</p>
<p>docker创建容器</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182239225.png" alt="image-20231018223901128"></p>
<p>查看服务器启动情况</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182240214.png" alt="image-20231018224027141"></p>
<ol start="3">
<li><p>查询每个redis节点的容器内IP</p>
<p><code>docker inspect redis_6379</code></p>
<p>6379主节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182241823.png" alt="image-20231018224118722"></p>
</li>
</ol>
<p>​		6380主节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182241347.png" alt="image-20231018224136241"></p>
<p>​		6381主节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182241868.png" alt="image-20231018224154777"></p>
<p>​		26379从节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182242899.png" alt="image-20231018224212782"></p>
<p>​		26380从节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182242711.png" alt="image-20231018224229607"></p>
<p>​		26381从节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182242679.png" alt="image-20231018224240573"></p>
<ol start="4">
<li><p>创建集群：将 6 个节点创建成 3 主 3 从的分片集群<strong>（最重要的步骤）</strong>，到这里就搭建完成了，后面可以查看是否正确搭建</p>
<ul>
<li>先进入一个容器（也可以在docker可视化里面进入容器，然后执行后面的命令就行）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis_6380 /bin/bash</span><br></pre></td></tr></table></figure>







<ul>
<li>然后执行下面创建分片集群语句，然后输入yes后面出现绿色语句说明创建成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 172.17.0.2:6379 172.17.0.3:6380 172.17.0.4:6381 172.17.0.5:26379 172.17.0.6:26380 172.17.0.7:26381 --cluster-replicas 1</span><br></pre></td></tr></table></figure>





<p><code>redis-cli --cluster help </code>	查询集群创建相关参数</p>
</li>
</ol>
<p>​	<code>redis-cli --cluster create --cluster-replicas 1 &lt;节点 1&gt;，&lt;节点 2&gt;...</code></p>
<p>​	cluster create参数表示要创建集群；cluster-replicas 1表示1个主节点配置1个从节点</p>
<p>​	</p>
<p>根据上面查询的IP地址，可以用最上面的命令创建分片集群，redis 会根据–cluster-replicas 1 参数，自动平均分配 6 个节点，前 3 个为主节点，后 3 个为从节点，这里的端口号也可以根据上面查询得到，也可以根据一开始创建容器的指令直接得到</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182229096.png" alt="image-20231018222924014"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182230309.png" alt="image-20231018223018233"></p>
<ol start="5">
<li><p>连接任一节点，查看集群节点和集群状态信息</p>
<p><code>cluster nodes</code> 	查看各节点信息，如主从配置信息，节点 ID 等</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182247991.png" alt="image-20231018224734914"></p>
</li>
</ol>
<p>​		<code>cluster info</code> 	显示集群的相关信息</p>
<p>​		<img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182250493.png" alt="image-20231018225002419"></p>
<h3 id="搭建完成后读写操作"><a href="#搭建完成后读写操作" class="headerlink" title="搭建完成后读写操作"></a>搭建完成后读写操作</h3><ol>
<li><p>进入6381节点容器内并连接redis服务</p>
<p><code>docker exec -it redis_6381 /bin/bash</code> </p>
<p><code>redis-cli -c -p 6381</code> <strong>这里一定要加上<code>-c</code>表示进入集群环境</strong></p>
</li>
<li><p>写入数据</p>
<p>集群会计算键等slot值，并存储到相应的redis节点上</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182257427.png" alt="image-20231018225740346"></p>
</li>
<li><p>查询数据</p>
<p>查询数据时也会计算slot值，然后从对应节点上拉取数据</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182300444.png" alt="image-20231018230016368"></p>
</li>
<li><p>查询集群各节点的数据存储情况</p>
<p><code>redis-cli --cluster check 任一节点 ip:端口号</code></p>
</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182302133.png" alt="image-20231018230258046"></p>
<h3 id="搭建完成后的故障转移"><a href="#搭建完成后的故障转移" class="headerlink" title="搭建完成后的故障转移"></a>搭建完成后的故障转移</h3><ol>
<li>停止6379，进入6380容器输入<code>redis-cli -p 6380 cluster nodes</code>可以看到6379的fail说明出现问题并且26380成为master了</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182310255.png" alt="image-20231018231007176"></p>
<ol start="2">
<li>重启6379，再次查询集群节点信息，可以发现6379变成了从节点</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182312343.png" alt="image-20231018231206246"></p>
<h3 id="搭建完成后的扩容"><a href="#搭建完成后的扩容" class="headerlink" title="搭建完成后的扩容"></a>搭建完成后的扩容</h3><ol>
<li>新建一个6382主节点，端口号为6382，配置文件类似前面6379主节点，创建这个容器并查看IP</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_6382 -p 6382:6382 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6382:/data -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_6382.conf</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182322593.png" alt="image-20231018232223517"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182321409.png" alt="image-20231018232158309"></p>
<ol start="2">
<li><p>进入任一节点，将6382节点加入到集群，默认是主节点</p>
<p><code>docker exec -it redis_6379 /bin/bash</code></p>
<p><code>redis-cli --cluster add-node 172.17.0.8:6382 172.17.0.2:6379</code></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182327427.png" alt="image-20231018232719313"></p>
</li>
</ol>
<p>查看集群节点信息</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310182329532.png" alt="image-20231018232900447"></p>
<ol start="3">
<li><p>为6382节点分配4096个slot插槽（即4个主节点平均分配）</p>
<p>当前，6382 节点虽然已加入集群，但是没有 slot 插槽，不能使用，所以还需要为它分配插槽。</p>
</li>
</ol>
<p>​		<code>redis-cli --culuster reshard 集群中任一节点的 IP + port</code>	reshard表示在集群中重新分配slot插槽，后面接目标分配节点和端口号，这个命令中的IP和端口是集群中的任何一个可访问的节点的IP地址和端口，通常是用于执行reshard操作的源节点。这个节点将被用作数据的来源，从而将数据从一个源槽移动到目标槽。</p>
<p>​		<code>redis-cli --cluster reshard 172.17.0.8:6382</code></p>
<p>​		然后输入分配的槽位4096，输入all表示平均分配，系统分配方案，输入yes表示同意该方案，等待分配，分配完没有报错即为正确</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310221705967.png" alt="image-20231022170537837"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310221707212.png" alt="image-20231022170736126"></p>
<p><code>redis-cli --cluster check 172.17.0.3:6380</code>  查看集群各节点数据存储情况</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310222202173.png" alt="image-20231022220225083"></p>
<ol start="4">
<li><p>为6382主节点配置从节点26382</p>
<ul>
<li>创建26382节点</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_26382 -p 26382:26382 --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/docker_cluster:/etc/redis redis redis-server /etc/redis/redis_26382.conf</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310221727472.png" alt="image-20231022172731409"></p>
<ul>
<li>为6382节点指定26382从节点，进入主节点执行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster add-node 172.17.0.9:26382 172.17.0.8:6382 --cluster-slave --cluster-master-id dc3f89457c6038e72b5f70a7b44af39f9b748c58</span><br></pre></td></tr></table></figure>



<p><code>redis-cli --cluster add-node 新节点IP 旧节点IP --cluster-slave --cluster-master-id 指定的主节点的容器 id </code></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310222314532.png"></p>
</li>
</ol>
<p><strong>补充（手动迁移槽位）</strong></p>
<p>指定从某个节点移动多少个槽位到指定节点，这里把6382所有节点移动到6379节点</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310222221605.png"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202310222222511.png"></p>
<h3 id="搭建完成后的缩容"><a href="#搭建完成后的缩容" class="headerlink" title="搭建完成后的缩容"></a>搭建完成后的缩容</h3><p><strong>（在Redis Cluster中，你可以从集群中移除节点，然后再重新分配虚拟槽。这个过程不会导致数据丢失，因为Redis Cluster具有数据复制和故障转移机制，可以确保数据的可靠性。）</strong></p>
<p>缩容可以先备份数据，然后从集群中删除节点，之后通过上面的方法手动迁移删除的节点的槽位到其他节点（也可以直接均匀分配槽位，都是同个命令，同上面），等待槽位迁移完成后，验证集群状态。（也可以先迁移槽位再删除节点，这种方式更加安全）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster  reshard  172.17.0.3:6380  --cluster-from 2bea24374ee6403d86cd5fb2d81ff1f55640471f  --cluster-to ffa0585637379e96c91b6f6f8de7f7aa3248567f  --cluster-slots 4096</span><br></pre></td></tr></table></figure>

<p>这条指定可以直接把第一个容器<code>2bea24374ee6403d86cd5fb2d81ff1f55640471f</code>指定的槽位数<code>4096</code>转移到第二个容器<code>ffa0585637379e96c91b6f6f8de7f7aa3248567f</code><strong>（可以直接用这条命令，会更快一点）</strong></p>
<p><code>cluster slots</code>检查槽位分配情况</p>
<p><code>cluster nodes</code>验证集群状态</p>
<p><code>redis-cli --cluster del-node 172.17.0.2:6379  c6a46b48e977b86b369c6b25f8b146cdf4f94655</code>删除节点</p>
<hr>
<h2 id="Java连接数据库（MySQL和Redis）"><a href="#Java连接数据库（MySQL和Redis）" class="headerlink" title="Java连接数据库（MySQL和Redis）"></a>Java连接数据库（MySQL和Redis）</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><ul>
<li><p><strong>关于Maven和SpringBoot的配置和创建</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42057154/article/details/106114515">【精选】IDEA配置Maven（详细版）_idea maven-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="http://python1234.cn/archives/python24132">idea将普通项目更改为maven项目的两种方式 - 程序员小屋（寒舍） (python1234.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.cn/faq/542631.html">怎么使用IDEA创建SpringBoot项目-java教程-PHP中文网</a></p>
</li>
<li><p><strong>JUnit单元测试框架的基本介绍和使用</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53869058/article/details/131055237">JUnit单元测试框架_junit框架-CSDN博客</a></p>
</li>
<li><p>非关系型数据库这门课程主要是介绍Redis相关的，这部分主要介绍使用关于Java访问Redis以及Redis搭配MySQL的使用，需要应用到的主要有Jedis、JDBC、SpringDataRedis、SpringBoot、MyBatis，案例可以直接通过文档最顶部的网盘链接打开</p>
</li>
</ul>
<h3 id="Jedis-API访问Redis"><a href="#Jedis-API访问Redis" class="headerlink" title="Jedis API访问Redis"></a>Jedis API访问Redis</h3><ol>
<li><p>基于Maven项目导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>基本使用，使用单元测试框架进行展示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPubSub;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span> JedisDemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/21</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisDemo</span> &#123;</span><br><span class="line">    Jedis jedis;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//关闭jedis</span></span><br><span class="line">        <span class="built_in">this</span>.jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试redis是否连通</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        System.out.println(ping);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * string类型测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stringTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;site&quot;</span>, <span class="string">&quot;http://www.itsoku.com&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;site&quot;</span>));</span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">&quot;site&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * list类型测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.rpush(<span class="string">&quot;courses&quot;</span>, <span class="string">&quot;java&quot;</span>, <span class="string">&quot;spring&quot;</span>, <span class="string">&quot;springmvc&quot;</span>, <span class="string">&quot;springboot&quot;</span>);</span><br><span class="line">        List&lt;String&gt; courses = jedis.lrange(<span class="string">&quot;courses&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String course : courses) &#123;</span><br><span class="line">            System.out.println(course);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set类型测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.sadd(<span class="string">&quot;users&quot;</span>, <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;jack&quot;</span>, <span class="string">&quot;ready&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; users = jedis.smembers(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash类型测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hashTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;1001&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; userMap = jedis.hgetAll(<span class="string">&quot;user:1001&quot;</span>);</span><br><span class="line">        System.out.println(userMap);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * zset类型测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zsetTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.zadd(<span class="string">&quot;languages&quot;</span>, <span class="number">100d</span>, <span class="string">&quot;java&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;languages&quot;</span>, <span class="number">95d</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;languages&quot;</span>, <span class="number">70d</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line">        List&lt;String&gt; languages = jedis.zrange(<span class="string">&quot;languages&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(languages);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订阅消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribeTest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// subscribe(消息监听器,频道列表)</span></span><br><span class="line">        jedis.subscribe(<span class="keyword">new</span> <span class="title class_">JedisPubSub</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String channel, String message)</span> &#123;</span><br><span class="line">                System.out.println(channel + <span class="string">&quot;:&quot;</span> + message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;sitemsg&quot;</span>);</span><br><span class="line">        TimeUnit.HOURS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publishTest</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.publish(<span class="string">&quot;sitemsg&quot;</span>, <span class="string">&quot;hello redis&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="SpringDataRedis-API访问Redis集群"><a href="#SpringDataRedis-API访问Redis集群" class="headerlink" title="SpringDataRedis API访问Redis集群"></a>SpringDataRedis API访问Redis集群</h3><p>这里给定的是一个基于spring boot 的java web项目</p>
<p><a name = "SpringDataRedis的集群"></a></p>
<ol>
<li><strong>首先需要基于docker搭建redis集群环境</strong></li>
</ol>
<p>其中的<code>cluster-announce-ip</code>是用来宣告IP的，需要的是一个可访问redis的IP，不宣告则为本地IP，这里宣告为本地IP</p>
<p><em>6380</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">port 6380</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6380.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6380</span><br><span class="line">cluster-announce-bus-port 16380</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>6381</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">port 6381</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6381.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6381</span><br><span class="line">cluster-announce-bus-port 16381</span><br></pre></td></tr></table></figure>

<p><em>6382</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6382</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6382.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6382</span><br><span class="line">cluster-announce-bus-port 16382</span><br></pre></td></tr></table></figure>

<p><em>6383</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">port 6383</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6383.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6383</span><br><span class="line">cluster-announce-bus-port 16383</span><br></pre></td></tr></table></figure>

<p><em>6384</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6384</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6384.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6384</span><br><span class="line">cluster-announce-bus-port 16384</span><br></pre></td></tr></table></figure>

<p><em>6385</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6385</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6385.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6385</span><br><span class="line">cluster-announce-bus-port 16385</span><br></pre></td></tr></table></figure>



<ul>
<li>创建容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -id --name redis_6380  -p 6380:6380 -p 16380:16380   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6380:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6380.conf </span><br><span class="line"></span><br><span class="line">docker run -id --name redis_6381  -p 6381:6381 -p 16381:16381   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6381:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6381.conf</span><br><span class="line"></span><br><span class="line">docker run -id --name redis_6382  -p 6382:6382 -p 16382:16382   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6382:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6382.conf</span><br><span class="line"></span><br><span class="line">docker run -id --name redis_6383  -p 6383:6383 -p 16383:16383   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6383:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6383.conf </span><br><span class="line"></span><br><span class="line">docker run -id --name redis_6384  -p 6384:6384 -p 16384:16384   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6384:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6384.conf </span><br><span class="line"></span><br><span class="line">docker run -id --name redis_6385  -p 6385:6385 -p 16385:16385   --privileged=true -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/data/6385:/data  -v C:/Users/GTR/Desktop/temp/大学上课学习/大三上/非关系型数据库/redis/conf_cluster:/etc/redis redis redis-server /etc/redis/redis-6385.conf </span><br></pre></td></tr></table></figure>



<ul>
<li>进入容器并创建集群</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//进入容器</span><br><span class="line">docker exec -it redis_6380 /bin/bash</span><br><span class="line"></span><br><span class="line">//创建集群</span><br><span class="line">redis-cli --cluster create 192.168.3.226:6380 192.168.3.226:6381 192.168.3.226:6382 192.168.3.226:6383 192.168.3.226:6384  192.168.3.226:6385  --cluster-replicas 1</span><br><span class="line"></span><br><span class="line">//查询集群</span><br><span class="line">redis-cli -p 6380  cluster nodes</span><br></pre></td></tr></table></figure>



<ol start="2">
<li><strong>案例</strong></li>
</ol>
<p><em>这个类是对redis的相关操作</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.DataType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataRedisController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.操作 字符串 类型</span></span><br><span class="line">    <span class="comment">//访问的 URL：http://localhost:8080/testString</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testString&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//默认情况下，SpringDataRedis将存入 redis中的 key和 value</span></span><br><span class="line">        <span class="comment">// 都作为 java对象进行了序列化处理，转换为 字节 后存入redis</span></span><br><span class="line">        <span class="comment">//如：&quot;k1&quot;---&quot;\xac\xed\x00\x05t\x00\x02k1&quot;</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        System.out.println(value);</span><br><span class="line">        <span class="comment">// redisTemplate.expire(&quot;k1&quot;,20, TimeUnit.SECONDS);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello: &quot;</span> + value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实验1：自行设计一个对String类型操作的方法，并访问</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.操作 列表类型</span></span><br><span class="line"><span class="comment">//    操作list数据是redisTemplate.opsForList()方法，返回类型是ListOperations</span></span><br><span class="line"><span class="comment">//    listOperations.leftPush为存值（只存一个），listOperations.leftPushAll为存值（存多个） --lpush</span></span><br><span class="line"><span class="comment">//    listOperations.range为取值 --相当于命令行 lrange</span></span><br><span class="line"><span class="comment">//    listOperations.size为获取长度 --相当于命令行 llen</span></span><br><span class="line"><span class="comment">//    listOperations.rightPop为移除最后一个元素 --相当于命令行 rpop</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问的 URL：http://localhost:8080/testList</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">testList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line">        <span class="comment">//插入数据</span></span><br><span class="line">        listOperations.leftPush(<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        listOperations.leftPush(<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">        listOperations.leftPush(<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        <span class="comment">//取出数据</span></span><br><span class="line">        List&lt;String&gt; list1 = listOperations.range(<span class="string">&quot;list1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String value : list1) &#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取列表的长度</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> listOperations.size(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lSize</span> <span class="operator">=</span> ((<span class="type">int</span>) size);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lSize; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">element</span> <span class="operator">=</span> (String) listOperations.rightPop(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line">            System.out.println(element);  <span class="comment">//a b c</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.操作 Set 类型</span></span><br><span class="line"><span class="comment">//   操作set类型数据是redisTemplate.opsForSet()，返回类型为 SetOperations</span></span><br><span class="line"><span class="comment">//setOperations.add 是存值，可以存一个或多个。 --对应命令行 sadd</span></span><br><span class="line"><span class="comment">//setOperations.members 是取值。 --对应命令行为 smembers</span></span><br><span class="line"><span class="comment">//setOperations.remove 是删除成员。 --对应命令行 srem</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问的 URL：http://localhost:8080/testSet</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testSet&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line">        <span class="comment">//插入集合数据</span></span><br><span class="line">        setOperations.add(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; myset = setOperations.members(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String o : myset) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;---删除后------&quot;</span>);</span><br><span class="line">        <span class="comment">//删除元素</span></span><br><span class="line">        setOperations.remove(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        myset = setOperations.members(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String o : myset) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 操作 hash数据</span></span><br><span class="line">    <span class="comment">// 对应的是 redisTemplate.opsForHash()方法，返回值是 hashOperations 类型</span></span><br><span class="line">    <span class="comment">//hashOperations.put 为存值 --相当于命令行中 hset</span></span><br><span class="line">    <span class="comment">//hashOperations.get 为取值 --相当于命令行中 hget</span></span><br><span class="line">    <span class="comment">//hashOperations.keys 为获取所有字段（key值） --相当于命令行中 hkeys</span></span><br><span class="line">    <span class="comment">//hashOperations.values 为获取 hash结构的所有值（value值） --相当于命令函中的hvals</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问的 URL：http://localhost:8080/testHash</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testHash&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        HashOperations hashOperations=redisTemplate.opsForHash();</span><br><span class="line">        <span class="comment">//插入数据</span></span><br><span class="line">        hashOperations.put(<span class="string">&quot;s001&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        hashOperations.put(<span class="string">&quot;s001&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">        hashOperations.put(<span class="string">&quot;s001&quot;</span>,<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;13900000&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String age=(String)hashOperations.get(<span class="string">&quot;s001&quot;</span>,<span class="string">&quot;age&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(age);</span><br><span class="line">        <span class="comment">//获取所有字段</span></span><br><span class="line">        Set keys=hashOperations.keys(<span class="string">&quot;s001&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object key:keys)&#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取所有的值</span></span><br><span class="line"></span><br><span class="line">        List values=hashOperations.values(<span class="string">&quot;s001&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object value:values)&#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在hash表中一次性插入多个元素</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;xxx@gdufs.edu.cn&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;13500000&quot;</span>);</span><br><span class="line">        redisTemplate.opsForHash().putAll(<span class="string">&quot;s002&quot;</span>, map);</span><br><span class="line">        System.out.println(redisTemplate.opsForHash().entries(<span class="string">&quot;s002&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5. 操作 zset 数据</span></span><br><span class="line"><span class="comment">//   操作 zset 类型的是 redisTemplate.opsForZSet()，返回类型 ZSetOperations</span></span><br><span class="line"><span class="comment">//    zSetOperations.add 存值 -- zadd</span></span><br><span class="line"><span class="comment">//    zSetOperations.range 取值 -- zrange</span></span><br><span class="line"><span class="comment">//    zSetOperations.remove 删除成员 -- zrem</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问的 URL：http://localhost:8080/testZset</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testZset&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入数据</span></span><br><span class="line">        zSetOperations.add(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">10.0</span>);</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">20.0</span>);</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="number">15.0</span>);</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="number">51.0</span>);</span><br><span class="line">        <span class="comment">//取数据</span></span><br><span class="line">        Set&lt;String&gt; myZset = zSetOperations.range(<span class="string">&quot;myZset&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : myZset) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;----数据修改后-------&quot;</span>);</span><br><span class="line">        zSetOperations.incrementScore(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        myZset = zSetOperations.range(<span class="string">&quot;myZset&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : myZset) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        zSetOperations.remove(<span class="string">&quot;myZset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    6.操作通用命令（针对不同的类型都可以操作）</span></span><br><span class="line"><span class="comment">//    redisTemplate.keys(“*”) 获取数据库所有的 key字段 --keys *</span></span><br><span class="line"><span class="comment">//    redisTemplate.hasKey判断 key值是否存在 --exists (key)</span></span><br><span class="line"><span class="comment">//    redisTemplate.delete删除 key – del (key)</span></span><br><span class="line"><span class="comment">//    redisTemplate.type获取指定 key的类型 --type(key)</span></span><br><span class="line"><span class="comment">//    这里返回的为 DataType类型，dataType.name()为其类型所对应名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问的 URL：http://localhost:8080/testCommon</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testCommon&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCommon</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        Set&lt;String&gt; keys=redisTemplate.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">       System.out.println(redisTemplate.keys(<span class="string">&quot;*&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span> (String key:keys)&#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Boolean itcast=redisTemplate.hasKey(<span class="string">&quot;User：4&quot;</span>);</span><br><span class="line">        System.out.println(itcast);</span><br><span class="line">        </span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;myZset&quot;</span>);</span><br><span class="line"></span><br><span class="line">       DataType dataType= redisTemplate.type(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">       System.out.println(dataType.name());</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><em>pom.xml文件中导入了相关的依赖</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">2.7</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;demo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;demo&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;Demo project <span class="keyword">for</span> Spring Boot&lt;/description&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;<span class="number">1.8</span>&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--        springDataRedis--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--        redis连接池--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--        web项目--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>



<p>application.yml和application.properties文件配置文件的作用一样，但是格式不一样，配置文件中配置了对redis数据库的访问信息</p>
<p><em>下面是application.yml的配置</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   redis:</span><br><span class="line">     # redis分片集群配置</span><br><span class="line">     cluster:</span><br><span class="line">       nodes:</span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6380</span></span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6381</span></span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6382</span></span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6383</span></span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6384</span></span><br><span class="line">         - <span class="number">192.168</span><span class="number">.3</span><span class="number">.226</span>:<span class="number">6385</span></span><br><span class="line">         #  重定向最大次数</span><br><span class="line">       max-redirects: <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     # redis连接池配置</span><br><span class="line">     lettuce:</span><br><span class="line">       pool:</span><br><span class="line">         max-active: <span class="number">10</span></span><br><span class="line">         max-idle: <span class="number">10</span></span><br><span class="line">         min-idle: <span class="number">1</span></span><br><span class="line">         max-wait: -1ms</span><br><span class="line">       cluster:</span><br><span class="line">        # 使能集群拓扑自适应刷新，默认值：<span class="literal">false</span></span><br><span class="line">         refresh:</span><br><span class="line">           adaptive: <span class="literal">true</span></span><br><span class="line">          # 集群拓扑定时刷新周期，Unit：毫秒</span><br><span class="line">           period: <span class="number">6000</span></span><br></pre></td></tr></table></figure>



<h3 id="MyBatis框架"><a href="#MyBatis框架" class="headerlink" title="MyBatis框架"></a>MyBatis框架</h3><p>ORM框架连接MySQL： ORM（Object-Relational Mapping）框架是一种将对象和关系数据库进行映射的技术。MyBatis就是一种ORM框架。</p>
<h4 id="简单学习"><a href="#简单学习" class="headerlink" title="简单学习"></a>简单学习</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_49211683/article/details/127975868?ops_request_misc=%7B%22request_id%22:%22169997537916800188521933%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=169997537916800188521933&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-127975868-null-null.142%5Ev96%5Epc_search_result_base9&utm_term=mybatis%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E5%AE%9E%E4%BE%8B&spm=1018.2226.3001.4187">MyBatis的入门学习（增删改查）_mybatis增删改查项目demo-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/vcj1009784814/article/details/106391982?ops_request_misc=%7B%22request_id%22:%22169997007516800188590517%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=169997007516800188590517&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-106391982-null-null.142%5Ev96%5Epc_search_result_base9&utm_term=mybatis&spm=1018.2226.3001.4187">mybatis看这一篇就够了，简单全面一发入魂-CSDN博客</a></p>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dhptkq9465/article/details/101503739">spring boot +mybatis(通过properties配置) 集成-CSDN博客</a></p>
<p><strong>也可以通过<code>.yml</code>文件配置，两者作用一样就是书写方式有些区别</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33164994/article/details/85042378">IntelliJ IDEA 整合 Spring Boot 2.1.1 + mybatis + mysql 8.0.13 使用application.properties配置文件 微服务框架整合-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly_leopard/article/details/78498804">Spring-Boot (二) application.properties配置文件内容_springboot application.properties配置-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16175508/6658766">如何实现spring boot redis 集群 配置的具体操作步骤_mob649e81664bd9的技术博客_51CTO博客</a></p>
<p>集群配置中，如<code>spring.redis.cluster.nodes=redis1:6379,redis2:6379,redis3:6379</code>中<code>redis1</code>、<code>redis2</code>和<code>redis3</code>是Redis集群中的三个节点的主机名或IP地址，<code>6379</code>是这些节点上Redis服务器的端口号，也可以直接使用IP进行配置，这里是本地使用Docker创建了几个容器并且配置了集群环境</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 集群信息</span><br><span class="line"><span class="function">root@901954ace2ba:/<span class="title">data</span># <span class="title">redis</span>-<span class="title">cli</span> -<span class="title">p</span> 6380  <span class="title">cluster</span> <span class="title">nodes</span></span></span><br><span class="line"><span class="function"><span class="title">d9a4c5850392510e49da4ded6bd0b0811067e716</span> 192.168.3.226:6381@16381 <span class="title">master</span> - 0 1700135929120 2 <span class="title">connected</span> 5461-10922</span></span><br><span class="line"><span class="function">7<span class="title">a298025c3ac129278d7eabaf3fa85c70549f128</span> 192.168.3.226:6384@16384 <span class="title">slave</span> <span class="title">d9a4c5850392510e49da4ded6bd0b0811067e716</span> 0 1700135930526 2 <span class="title">connected</span></span></span><br><span class="line"><span class="function"><span class="title">de6be6bfb2abf66fdbb5d7f66d78b4993f32ad2e</span> 192.168.3.226:6383@16383 <span class="title">slave</span> 20<span class="title">edeaa91aecdfdc3ac91d1baddadd667c495fc9</span> 0 1700135930526 1 <span class="title">connected</span></span></span><br><span class="line"><span class="function"><span class="title">c2121c060fdb513c6dad9f596164ee83f5d660a0</span> 192.168.3.226:6382@16382 <span class="title">master</span> - 0 1700135929522 3 <span class="title">connected</span> 10923-16383</span></span><br><span class="line"><span class="function">20<span class="title">edeaa91aecdfdc3ac91d1baddadd667c495fc9</span> 192.168.3.226:6380@16380 <span class="title">myself</span>,<span class="title">master</span> - 0 1700135929000 1 <span class="title">connected</span> 0-5460</span></span><br><span class="line"><span class="function">6<span class="title">d73ddeadb01b2c07bf93407a402f66138df5806</span> 192.168.3.226:6385@16385 <span class="title">slave</span> <span class="title">c2121c060fdb513c6dad9f596164ee83f5d660a0</span> 0 1700135929522 3 <span class="title">connected</span></span></span><br><span class="line"><span class="function"><span class="title">root</span>@901954<span class="title">ace2ba</span>:/<span class="title">data</span>#</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>



<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis集群配置</span></span><br><span class="line"><span class="attr">spring.data.redis.cluster.nodes</span>=<span class="string">192.168.3.226:6380,192.168.3.226:6381,192.168.3.226:6382,192.168.3.226:6383,192.168.3.226:6384,192.168.3.226:6385</span></span><br></pre></td></tr></table></figure>



<h3 id="Redis作为MySQL缓存应用"><a href="#Redis作为MySQL缓存应用" class="headerlink" title="Redis作为MySQL缓存应用"></a>Redis作为MySQL缓存应用</h3><p><strong>一般流程如下</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241240229.png" alt="image-20231114005454893"></p>
<h4 id="需要解决的一些问题"><a href="#需要解决的一些问题" class="headerlink" title="需要解决的一些问题"></a>需要解决的一些问题</h4><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/582570001/answer/3045002344">(5 封私信 &#x2F; 20 条消息) Redis 缓存和 MySQL 数据保持一致性的方法有哪些？ - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MinggeQingchun/article/details/130400887">Redis - 缓存雪崩，缓存穿透，缓存击穿_雪崩redis_MinggeQingchun的博客-CSDN博客</a></p>
<p>缓存雪崩是指在同一时段，Redis 中的缓存 key 大面积同时失效，或者 Redis 服务宕机，导致大量的数据请求直接面向 MySQL 数据库，给数据库造成巨大压力，可能带来灾难性的问题。</p>
<p><strong>解决相关问题出现的一些知识回顾</strong></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/472756166">【数据库】数据库锁 - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yifeiliu338/article/details/129316099">Redis的分布式锁详解_redis分布式锁-CSDN博客</a></p>
<h4 id="样例实现"><a href="#样例实现" class="headerlink" title="样例实现"></a>样例实现</h4><p>下面代码为学习过程中仿照给定代码进行书写的，<strong>整个样例实现了Redis作为MySQL的缓存并且Redis开启了三主三从的集群，同时对缓存穿透、缓存雪崩、缓存击穿作出了一些简单的处理</strong></p>
<p><strong>整个样例下载路径</strong></p>
<p><a target="_blank" rel="noopener" href="https://wwcz.lanzout.com/b04kt8wla">https://wwcz.lanzout.com/b04kt8wla</a><br>密码:2wdy</p>
<ul>
<li><strong>首先需要在MySQL数据库中存在一个名为week_10的数据库，并且在其中创建一张名为student的表</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">    id        int auto_increment</span><br><span class="line">        primary key,</span><br><span class="line">    name      varchar(50) not null,</span><br><span class="line">    studentId varchar(50) not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>使用Docker创建集群环境，创建方法在上面讲了，创建的集群跟上面一样</strong></li>
</ul>
<p>​		<a href="#SpringDataRedis的集群">跳转查看集群创建</a></p>
<ul>
<li><p><strong>使用上面构建SpringBoot项目的方法创建项目并通过maven导入依赖</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/houxian1103/article/details/128721100">工具类库 Hutool介绍与使用（请记得收藏）-CSDN博客</a></p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>week10_redis_20211003238<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>week10_redis_20211003238<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>week10_redis_20211003238<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring-boot-starter-web: 提供了使用 Spring MVC 进行 Web 开发所需的基本依赖。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring-boot-starter-test: 包含了 Spring Boot 测试模块，支持单元测试、集成测试等。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring-boot-starter-data-redis: 集成了 Spring Data Redis，简化了在 Spring Boot 中使用 Redis 的配置和操作。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis-spring-boot-starter: 集成了 MyBatis 持久层框架，简化了 MyBatis 在 Spring Boot 中的集成。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java: MySQL 数据库的 JDBC 驱动。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombok: 提供了简化 Java 代码的注解，如 @Data、@Getter、@Setter 等，减少了冗长的 Java 代码。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;optional&gt;true&lt;/optional&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--commons-pool2: Apache Commons 池化库，用于提供对象池的实现，通常用于数据库连接池等场景。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hutool-all: Hutool 工具库，提供了丰富的工具方法，包括字符串处理、日期时间处理、加密解密等，简化了 Java 开发中的常见任务。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 将java目录下的xml文件打包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">builder</span>&gt;</span>paketobuildpacks/builder-jammy-base:latest<span class="tag">&lt;/<span class="name">builder</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><strong><code>application.properties</code>配置文件</strong></li>
</ul>
<p><strong>该文件位于resources文件夹下</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql配置</span></span><br><span class="line"><span class="comment">#配置访问驱动</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"># spring.datasource.url指定连接数据库URL信息</span></span><br><span class="line"><span class="comment">#jdbc:mysql:///week10连接week10数据库，jdbc是Java数据库连接的标准前缀，mysql是数据库的类型，///表示使用默认的主机（通常是 localhost），week10 是数据库的名称。</span></span><br><span class="line"><span class="comment"># characterEncoding=utf8: 这是设置数据库连接的字符编码为UTF-8，确保能够正确处理包含非英文字符的数据。</span></span><br><span class="line"><span class="comment"># serverTimezone=Hongkong设置地区</span></span><br><span class="line"><span class="comment">#serverTimezone=GMT%2B8: 这是设置数据库服务器的时区为GMT+8。这对于确保应用程序和数据库之间的时间一致性非常重要，特别是在涉及到时间戳等信息时。</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql:///week10?serverTimezone=Hongkong?characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="comment">#配置redis用户名和密码</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">wang10086</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="comment">#配置访问redis的主机和端口号，也可以使用spring.redis.url=</span></span><br><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">16366</span></span><br><span class="line"><span class="comment"># 修改配置集群</span></span><br><span class="line"><span class="attr">spring.data.redis.cluster.nodes</span>=<span class="string">192.168.3.226:6380,192.168.3.226:6381,192.168.3.226:6382,192.168.3.226:6383,192.168.3.226:6384,192.168.3.226:6385</span></span><br><span class="line"><span class="comment"># 配置重定向最大次数</span></span><br><span class="line"><span class="comment"># 在 Redis 集群中，当执行某个命令时，如果节点发生了槽分区的迁移，客户端会被重定向到新的节点。</span></span><br><span class="line"><span class="comment">#当某个节点执行槽分区迁移时，可能会触发重定向。在一些异常情况下，可能发生多次重定向。max-redirects 的作用就是为了防止客户端无限制地进行重定向，避免陷入死循环。</span></span><br><span class="line"><span class="attr">spring.data.redis.cluster.max-redirects</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#配置连接池，lettuce连接池专门为redis使用的，pring.data.redis.lettuce.pool配置lettuce连接池,还有commnon连接池</span></span><br><span class="line"><span class="comment">#max-active:连接池中的最大活跃连接数。max-idle:连接池中的最大空闲连接数。min-idle:连接池中的最小空闲连接数。max-wait:当连接池没有可用连接时，最大等待时间。若为负数，则表示无限等待。</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-active</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-idle</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-wait</span>=<span class="string">1000</span></span><br><span class="line"><span class="comment"># adaptive是否启用集群拓扑自适应刷新</span></span><br><span class="line"><span class="comment"># 集群拓扑自适应刷新点作用包括故障转移感知、节点变化感知、动态适应性</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.cluster.refresh.adaptive</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 集群拓扑定时刷新周期，单位为毫秒</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.cluster.refresh.period</span>=<span class="string">6000</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#mybatis配置</span></span><br><span class="line"><span class="comment">#指定sql配置文件的位置</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:com/example/week10_redis_20211003238/mapper/*.xml</span></span><br><span class="line"><span class="comment">#指定实体类所在的包名</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.example.week10_redis_20211003238.pojo</span></span><br><span class="line"><span class="comment">#输出SQL命令</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>



<p><strong>注：也可以使用<code>.yml</code>配置文件进行配置，下面放出两者的区别的介绍博客</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/flower-dance/p/14268237.html">SpringBoot之yml与properties配置文件格式的区别 - 彼岸舞 - 博客园 (cnblogs.com)</a></p>
<ul>
<li><strong>首先需要了解这几层再进行代码书写，各层放在了项目不同文件夹下，可以看项目结构了解</strong></li>
</ul>
<p>经典的四层架构，通常在使用 Spring 框架进行开发时会采用这种结构。下面是每一层的主要职责：</p>
<ol>
<li><p><strong>Pojo层（Model层）</strong>：</p>
<ul>
<li>主要包含应用程序的领域模型，通常是实体类（Entity）或者简单的 Java Bean。</li>
<li>用于表示业务数据以及业务规则。</li>
</ul>
</li>
<li><p><strong>Mapper层（Data Access层）</strong>：</p>
<ul>
<li>负责数据的持久化，与数据库进行交互。</li>
<li>包含数据访问对象（DAO）或者 Repository。</li>
<li>可以使用 ORM 框架（如 MyBatis 或 Hibernate）简化数据库操作。</li>
</ul>
</li>
<li><p><strong>Service层</strong>：</p>
<ul>
<li>业务逻辑的处理中心，负责处理应用程序的业务规则。</li>
<li>调用 Mapper 层进行数据库操作，协调不同的业务逻辑。</li>
<li>提供事务管理、安全性等服务。</li>
</ul>
</li>
<li><p><strong>Controller层</strong>：</p>
<ul>
<li>处理用户请求，接收用户输入，调用 Service 层处理业务逻辑，最终返回结果给用户。</li>
<li>负责与用户界面进行交互，通常是通过 HTTP 请求和响应。</li>
</ul>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241241117.png" alt="image-20231116225329415"></p>
</li>
</ol>
<ul>
<li><strong>配置 Spring Boot 项目中 Redis 连接和序列化的类</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 配置 Spring Boot 项目中 Redis 连接和序列化的类</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Configuration表明是配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="comment">//Bean注解表示这是将被Spring管理的Bean对象的方法。</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建RedisTemplate对象，用于操作Redis数据，之后返回</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置连接工厂，指定Redis的连接方式</span></span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">//创建JSON序列化工具，SpringDataRedis提供的一个JSON序列化工具，用于将对象序列化成JSON格式</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">jsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">        <span class="comment">//设置Key的序列化,使用了Redis的字符串序列化。</span></span><br><span class="line">        <span class="comment">//Redis中的键默认是以字符串形式存在的，但在实际应用中，你可能会使用复杂的数据结构或者自定义对象作为键。在这种情况下，你需要确定如何将这些键序列化为字符串，以便存储到 Redis 中。</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">//设置Value的序列化，使用了JSON的序列化</span></span><br><span class="line">        <span class="comment">//当你存储自定义对象或复杂数据结构时，你需要确定如何将这些值序列化为字符串，以便存储到 Redis 中</span></span><br><span class="line">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="comment">//返回</span></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>RedisConnectionFactory</code> 是 Spring Data Redis 中的一个关键接口，它定义了用于创建 <code>RedisConnection</code> 对象的工厂方法。<code>RedisConnection</code> 表示与 Redis 数据库的连接，可以用于执行各种 Redis 操作，例如读写数据、执行事务、发布和订阅消息等。</p>
<p><code>RedisConnectionFactory</code> 的主要作用是抽象出连接 Redis 所需的细节，包括连接池配置、连接超时、主从配置等。通过实现这个接口，可以灵活地配置和管理与 Redis 的连接。</p>
<p>在 Spring 中，<code>RedisConnectionFactory</code> 的实现通常使用第三方的 Redis 客户端库，比如 Jedis 或 Lettuce。这些实现隐藏了底层连接细节，同时提供了一些配置选项，以满足不同应用场景的需求。</p>
<p>以下是 <code>RedisConnectionFactory</code> 的一些常见实现：</p>
<ol>
<li><p><strong>JedisConnectionFactory</strong>: 使用 Jedis 作为底层连接库，适用于传统的阻塞式 I&#x2F;O 模型。</p>
</li>
<li><p><strong>LettuceConnectionFactory</strong>: 使用 Lettuce 作为底层连接库，适用于基于 Netty 的非阻塞式 I&#x2F;O 模型，支持更多高级特性，例如异步操作和响应式编程。</p>
</li>
</ol>
<p>通过配置 <code>RedisConnectionFactory</code>，你可以轻松地切换底层连接库，同时可以设置连接池、超时时间、主从配置等参数，以满足具体应用的性能和可用性要求。</p>
<ul>
<li><strong>pojo层</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Data是Lombok提供的一个组合注解，自动生成 Getter、Setter、toString、hashCode 和 equals 方法。它可以减少大量重复性的代码。</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//自动生成无参构造函数</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自动生成全参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String studentId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>mapper层</strong></li>
</ul>
<p>StudentMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.pojo.Student;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有数据</span></span><br><span class="line">    <span class="comment">/*也可以在xml中</span></span><br><span class="line"><span class="comment">    *     &lt;select id=&quot;getAllStudents&quot; resultType=&quot;Student&quot;&gt;</span></span><br><span class="line"><span class="comment">        SELECT *</span></span><br><span class="line"><span class="comment">        FROM student</span></span><br><span class="line"><span class="comment">    &lt;/select&gt;</span></span><br><span class="line"><span class="comment">    * 然后在这个接口中public List&lt;Student&gt; getAllStudents();</span></span><br><span class="line"><span class="comment">    * xml中的返回类型指定为返回类型即可，不用管是不是List*/</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM student&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getAllStudents</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteStudentById</span><span class="params">(String studentId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询数据</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findStudentById</span><span class="params">(String studentId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateStudentNameById</span><span class="params">(Student student)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.week10_redis_20211003238.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--namespace属性的值就是对应的Mapper接口的全限定名。通过这个命名空间，MyBatis就知道了要将这个XML文件中的SQL映射到哪个Java接口上。--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--SQL语句带一个参数</span></span><br><span class="line"><span class="comment">    parameterType：指定接收参数类型，返回一条记录，用下标取参数</span></span><br><span class="line"><span class="comment">    parameterType：参数类型--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--插入学生数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;selectKey keyProperty=&quot;id&quot; order=&quot;AFTER&quot; resultType=&quot;int&quot;&gt;:这是一个用于获取数据库生成主键的配置。它的作用是在插入后执行一条额外的查询语句，从数据库中获取生成的主键值。具体解释如下：</span></span><br><span class="line"><span class="comment">    keyProperty=&quot;id&quot;: 表示将获取到的主键值设置到 User 对象的 id 属性中。</span></span><br><span class="line"><span class="comment">    order=&quot;AFTER&quot;: 表示在插入语句执行之后执行这条额外的查询语句。</span></span><br><span class="line"><span class="comment">    resultType=&quot;int&quot;: 表示查询结果的类型是整数型。--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--LAST_INSERT_ID() 是 MySQL 数据库的函数，用于获取最后插入的自增主键值。--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--INSERT INTO users SET name=#&#123;name&#125;,studentId=#&#123;studentId&#125;: 这是实际的插入语句，其中 #&#123;name&#125; 和 #&#123;studentId&#125; 是参数占位符，会被传入的 Student 对象的属性值替代。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO student SET name=#&#123;name&#125;,studentId=#&#123;studentId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;insert id=&quot;addStudent&quot; parameterType=&quot;Student&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;selectKey keyProperty=&quot;id&quot; order=&quot;AFTER&quot; resultType=&quot;int&quot;&gt;</span></span><br><span class="line"><span class="comment">            select LAST_INSERT_ID()</span></span><br><span class="line"><span class="comment">        &lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">        INSERT INTO student SET name=#&#123;name&#125;,studentId=#&#123;studentId&#125;</span></span><br><span class="line"><span class="comment">    &lt;/insert&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据学号删除学生数据--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span>&gt;</span></span><br><span class="line">        DELETE</span><br><span class="line">        FROM student</span><br><span class="line">        WHERE studentId = #&#123;0&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据学号查找学生--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在 MyBatis 中，#&#123;0&#125; 表示SQL语句中的第一个参数。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span>&gt;</span></span><br><span class="line">        SELECT *</span><br><span class="line">        FROM student</span><br><span class="line">        WHERE studentId = #&#123;0&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据学号修改学生数据--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudentNameById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        UPDATE student</span><br><span class="line">        SET name=#&#123;name&#125;</span><br><span class="line">        WHERE studentId = #&#123;studentId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    &lt;select id=&quot;getAllStudents&quot; resultType=&quot;Student&quot;&gt;</span></span><br><span class="line"><span class="comment">        SELECT *</span></span><br><span class="line"><span class="comment">        FROM student</span></span><br><span class="line"><span class="comment">    &lt;/select&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><strong>service层</strong></li>
</ul>
<p>StudentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.pojo.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getAllStudents</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteStudentById</span><span class="params">(String studentId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findStudentById</span><span class="params">(String studentId)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateStudentNameById</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存储Student对象到Redis中</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveToRedis</span><span class="params">(Student student)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>StudentServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.mapper.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.pojo.Student;</span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.BooleanUtil;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StudentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * description:数据一致性处理：需修改</span></span><br><span class="line"><span class="comment">     * 1.数据写入redis时，设置 key的超时时间，</span></span><br><span class="line"><span class="comment">     * 2.修改用户数据时，先修改 mysql，再删除 redis缓存</span></span><br><span class="line"><span class="comment">     * 3.开启事务：保证正确事务的提交</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="comment">//@Autowired</span></span><br><span class="line">    <span class="comment">/*@Resource 注解是 JavaEE 的规范，而 @Autowired 是 Spring 框架特有的注解。@Resource 比 @Autowired 更通用，</span></span><br><span class="line"><span class="comment">    因为它不仅可以用于注入 Spring bean，还可以用于注入其他 JavaEE 组件。*/</span></span><br><span class="line">    <span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StudentServiceImpl</span><span class="params">(RedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单个Student再从缓存中查询，没有再从MySQL中查询再保存到Redis</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getAllStudents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.getAllStudents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加Student信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.addStudent(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除数据、更新数据需要开启事物进行一致性处理，这里的方案是先更新数据库数据再删除缓存</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteStudentById</span><span class="params">(String studentId)</span> &#123;</span><br><span class="line">        <span class="comment">//删除数据库数据</span></span><br><span class="line">        studentMapper.deleteStudentById(studentId);</span><br><span class="line">        <span class="comment">//删除缓存数据</span></span><br><span class="line">        <span class="keyword">if</span> (studentId != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;student:&quot;</span> + studentId;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;删除成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单个Student</span></span><br><span class="line">    <span class="comment">//这里进行了防止缓存穿透的修改，这里只是把空值也加入到缓存之中而已</span></span><br><span class="line">    <span class="comment">//下面注释的代码是没有进行缓存击穿处理的代码，只进行了简单缓存穿透处理</span></span><br><span class="line"><span class="comment">/*    @Override</span></span><br><span class="line"><span class="comment">    public Student findStudentById(String studentId) throws IOException &#123;</span></span><br><span class="line"><span class="comment">        //1.从Redis缓存中查询数据</span></span><br><span class="line"><span class="comment">        Student student = getStudentByRedis(studentId);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //2.Redis中有该用户就返回</span></span><br><span class="line"><span class="comment">        if (student != null) &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;Redis缓存中查询到该用户&quot;);</span></span><br><span class="line"><span class="comment">            return student;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //3.Redis中没有找到，到MySQL中查询后加redis</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;Redis缓存中没有此用户&quot;);</span></span><br><span class="line"><span class="comment">        student = studentMapper.findStudentById(studentId);</span></span><br><span class="line"><span class="comment">        if (student == null) &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;Mysql中也没有此用户&quot;);</span></span><br><span class="line"><span class="comment">            //缓存穿透修改，把空对象写入redis，保存查询的studentId为查询使用的</span></span><br><span class="line"><span class="comment">            Student s = new Student();</span></span><br><span class="line"><span class="comment">            s.setStudentId(studentId);</span></span><br><span class="line"><span class="comment">            saveToRedis(s);</span></span><br><span class="line"><span class="comment">        &#125; else &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;Mysql中查询到此用户&quot;);</span></span><br><span class="line"><span class="comment">            saveToRedis(student);//保存到Redis</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        return student;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findStudentById</span><span class="params">(String studentId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1.从Redis缓存中查询数据</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> getStudentByRedis(studentId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.Redis中有该用户就返回</span></span><br><span class="line">        <span class="keyword">if</span> (student != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Redis缓存中查询到该用户&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> student;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.Redis中没有找到，到MySQL中查询后加redis</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Redis缓存中没有此用户&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//①准备互斥锁的key</span></span><br><span class="line">        <span class="comment">//这里就单机测试没有并发，不会出现lock:student:的这种key，需要高并发情况下同时执行这段代码才会出现</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:student:&quot;</span> + studentId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//②调用addLock获取锁</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> addLock(lockKey);</span><br><span class="line">            <span class="comment">//判断锁是否获取成功，这里判断加锁失败则休眠，然后再次执行该方法</span></span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">                <span class="comment">//③休眠50毫秒后递归调用该方法，重新查询redis</span></span><br><span class="line">                <span class="keyword">return</span> findStudentById(studentId);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;Redis申请锁成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//④如果成功加上了锁，就要查询redis缓存中是否有该数据，因为可能有其他应用已经重建了该数据的缓存</span></span><br><span class="line">            <span class="keyword">if</span> (getStudentByRedis(studentId) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;再次查询时，Redis缓存中查询到了此用户&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> getStudentByRedis(studentId);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//⑤这里表示两次查询Redis都没有查询到数据就要到MySQL中查询，重建缓存，如果MySQL中也没有就写入空对象</span></span><br><span class="line">            <span class="comment">//写入空对象是防止缓存穿透</span></span><br><span class="line">            student = studentMapper.findStudentById(studentId);</span><br><span class="line">            <span class="keyword">if</span> (student == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Mysql中也没有此用户&quot;</span>);</span><br><span class="line">                <span class="comment">//缓存穿透修改，把空对象写入redis，保存查询的studentId为查询使用的</span></span><br><span class="line">                <span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">                s.setStudentId(studentId);</span><br><span class="line">                saveToRedis(s);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Mysql中查询到此用户&quot;</span>);</span><br><span class="line">                saveToRedis(student);<span class="comment">//保存到Redis</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//⑥删除锁</span></span><br><span class="line">            unLock(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里演示通过加互斥锁的方式处理缓存击穿问题</span></span><br><span class="line">    <span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">addLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">//将存在的键的值设置为1，不存在就设置过期时间为10s</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> redisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">        <span class="comment">/*BooleanUtil 是 Hutool 工具库（HuTool）提供的一个工具类，用于处理布尔值。</span></span><br><span class="line"><span class="comment">          在Java 中，Boolean 类型是一个对象，可以为 null。而 boolean 基本类型则不能为 null。</span></span><br><span class="line"><span class="comment">          使用 BooleanUtil.isTrue(flag) 可以确保在处理 Boolean 对象时不会因为 null 而产生空指针异常。*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放锁，删除key就是释放锁</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除数据、更新数据需要开启事物进行一致性处理，这里的方案是先更新数据库数据再删除缓存</span></span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">//开启事务</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateStudentNameById</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">studentId</span> <span class="operator">=</span> student.getStudentId();</span><br><span class="line">        <span class="keyword">if</span> (studentId != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//先更新数据库数据</span></span><br><span class="line">            studentMapper.updateStudentNameById(student);</span><br><span class="line">            <span class="comment">//删除缓存</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;student:&quot;</span> + studentId;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;修改成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从Redis中查询</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">getStudentByRedis</span><span class="params">(String studentId)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;student:&quot;</span> + studentId;</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> (Integer) redisTemplate.opsForHash().get(key, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) redisTemplate.opsForHash().get(key, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">            student = <span class="keyword">new</span> <span class="title class_">Student</span>(id, name, studentId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里进行了防止缓存雪崩的简单修改，这里使用随机数设置一个随机的key的有效期</span></span><br><span class="line">    <span class="comment">//将查询到的数据加入到Redis</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveToRedis</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        <span class="comment">//设置key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;student:&quot;</span> + student.getStudentId();</span><br><span class="line">        <span class="comment">//设置值</span></span><br><span class="line">        redisTemplate.opsForHash().put(key, <span class="string">&quot;id&quot;</span>, student.getId());</span><br><span class="line">        redisTemplate.opsForHash().put(key, <span class="string">&quot;name&quot;</span>, student.getName());</span><br><span class="line">        redisTemplate.opsForHash().put(key, <span class="string">&quot;studentId&quot;</span>, student.getStudentId());</span><br><span class="line">        <span class="comment">//设置键的过期时间</span></span><br><span class="line">        <span class="comment">//redisTemplate.expire(key, 360, TimeUnit.SECONDS);</span></span><br><span class="line">        <span class="comment">//设置随机的key有效期，上面一行是没有设置随机</span></span><br><span class="line">        redisTemplate.expire(key, <span class="number">360</span> + <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">100</span>), TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 缓存穿透是指在使用Redis作为缓存应用时,客户端请求的数据在Redis缓存中和Mysql数据库中都不存在,缓存不生效。</span></span><br><span class="line"><span class="comment">但是针对该数据的请求还是源源不断的过来,导致每次请求都会到数据库，从而压垮数据库。</span></span><br><span class="line"><span class="comment">2. 缓存雪崩是指在同一时段，Redis中的缓存 key 大面积同时失效，或者Redis服务宕机,导致大量的数据请求直接面向 MySQL 数据库，</span></span><br><span class="line"><span class="comment">给数据库造成巨大压力，可能带来灾难性的问题。</span></span><br><span class="line"><span class="comment">3. 缓存击穿问题也叫热点Key问题，就是一个被高并发访问并且缓存重建业务较复杂的key突然失效了，无数的请求访问会在瞬间给数据库带来巨大的冲击。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<ul>
<li><strong>controller层</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.pojo.Student;</span><br><span class="line"><span class="keyword">import</span> com.example.week10_redis_20211003238.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> StudentService studentService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StudentController</span><span class="params">(StudentService studentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.studentService = studentService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*增加信息*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/addStudent</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;addStudent&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setName(<span class="string">&quot;王骏飚&quot;</span>);</span><br><span class="line">        student.setStudentId(<span class="string">&quot;20211003238&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> studentService.addStudent(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*删除信息*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/deleteStudentById</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;deleteStudentById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteStudentById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">studentId</span> <span class="operator">=</span> <span class="string">&quot;20211003238&quot;</span>;</span><br><span class="line">        System.out.println(studentService.deleteStudentById(studentId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*查找信息*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/findStudentById</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/findStudentById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findStudentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">studentId</span> <span class="operator">=</span> <span class="string">&quot;20211003238&quot;</span>;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentService.findStudentById(studentId);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*修改信息*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/updateStudentNameById</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;updateStudentNameById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateStudentNameById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setName(<span class="string">&quot;王骏飚1&quot;</span>);</span><br><span class="line">        student.setStudentId(<span class="string">&quot;20211003238&quot;</span>);</span><br><span class="line">        System.out.println(studentService.updateStudentNameById(student));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*获取所有用户*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/getAllStudents</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;getAllStudents&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAllStudents</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Student&gt; list = studentService.getAllStudents();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*测试集群，运行后从cmd查看有没有对应的key*/</span></span><br><span class="line">    <span class="comment">//URL:http://localhost:8080/findStudentTestCluster</span></span><br><span class="line">    <span class="comment">//数据库中已经存在小明，小红，小王数据了，这里查找加到缓存中来测试集群是否生效</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;findStudentTestCluster&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findStudentTestCluster</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="comment">//小明 111；小红 222；小王333</span></span><br><span class="line">        studentService.findStudentById(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        studentService.findStudentById(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">        studentService.findStudentById(<span class="string">&quot;333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p><strong>这里解决缓存雪崩介绍了缓存预热怎么做，具体做法没有实现，就是把框架搭出来，需要怎么预热自己再写，写在了cache下的RedisWarmUp类中</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.week10_redis_20211003238.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Redis缓存预热：实现ApplicationRunner接口</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//@Component是一个通用性注解，用于表示一个类是Spring容器中的一个组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisWarmUp</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;缓存数据开始预热....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//之后可以使用RedisTemplate将一些数据先加入到缓存之中，再结束预热</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>修改Application入口代码，加上注解即可</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.example.week10_redis_20211003238;</span><br><span class="line"></span><br><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@MapperScan(basePackages = &quot;com.example.week10_redis_20211003238.mapper&quot;)</span><br><span class="line">public class Week10Redis20211003238Application &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Week10Redis20211003238Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>之后可以运行起来，再浏览器测试controller中的代码</li>
</ul>
<h4 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wstever/article/details/128469318">【好物推荐】性能测试之压力测试，如何使用Jmeter来压测接口？_jmeter接口压测_本本本添哥的博客-CSDN博客</a></p>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><strong>社区版本安装</strong></li>
</ul>
<ol>
<li>下载安装包并进行安装</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">MongoDB社区版下载地址</a></p>
<p>安装过程可以选择data和log的存放路径，安装程序还是会安装到默认路径，所以安装时还是直接用默认路径吧，bin目录在<code>C:\Program Files\MongoDB\Server\7.0\bin</code>，并且为了方便，安装时直接选择<code>Complete</code>选项安装所有组件吧。</p>
<ul>
<li>mongod.exe：启动数据库服务器实例进程的可执行文件，是整个 MongoDB中最核心的内容，可进行复制数据库的创建、删除等管理工作，运行在服务器端为客户端提供监听；</li>
<li>mongos.exe：分片集群的控制器和查询路由器；</li>
<li>mongod.conf：系统配置文件。</li>
</ul>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241241528.png" alt="image-20231122111630916"></p>
<ol start="2">
<li>配置环境变量</li>
</ol>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241241708.png" alt="image-20231128203035119"></p>
<p>配置好环境后可以输入<code>mongod --version</code>就可以查看到MongoDB的版本</p>
<ol start="3">
<li>之后启动服务就好，MongoDB默认端口为27017，可以在浏览器输入<code>http://localhost:27017/</code>,有响应就说明服务已启动，也可以在系统服务界面找到服务。</li>
</ol>
<ul>
<li><strong>进行一些配置</strong></li>
</ul>
<p>在默认情况下，MongoDB中创建的数据库文件会存储在<code>C:\Program Files\MongoDB\Server\7.0\data</code>路径下，实际开发中需要我们指定存放的路径，下面给出具体的配置方式。</p>
<ol>
<li><p>创建存放数据库文件和日志文件的文件夹，一个文件夹为data，一个文件夹为log，具体创建在哪里视自己情况来定吗，路径不能带中文</p>
</li>
<li><p>修改配置文件，7.0版本配置文件在bin目录下，名为<code>mongod.cfg</code>，<strong>注意这里log的写法，这里我的log文件在mongodb路径下，后面加上<code>\mongod.log</code></strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241241541.png" alt="image-20231128212905044"></p>
</li>
<li><p>重启服务器生效</p>
</li>
</ol>
<p>无法启动检查路径是否为英文，还是不行可以以管理员打开cmd或者powershell窗口下输入<code>sc delete MongoDB</code>删除原有服务，之后输入<code> mongod --install -f &quot;C:\Program Files\MongoDB\Server\7.0\bin\mongod.cfg&quot;</code>重新安装配置文件，之后点击启动即可</p>
<ul>
<li><strong>安装MongoDB Shell工具</strong></li>
</ul>
<p>早期的MongoDB版本中自带这个工具，在当前7.0版本中不包含该工具，需要另外下载，MongoDB Shell工具是MongoDB服务器常用客户端访问工具</p>
<ol>
<li>下载MongoDB Shell工具</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/compass">MongoDB Shell下载地址</a></p>
<p>下载压缩文件即可，安装程序也是安装到跟Mongo服务器的默认路径一样，将压缩文件放到跟Mongo服务器的默认路径下，这样好找，路径为<code>C:\Program Files\MongoDB\Server\7.0\bin</code>，之后解压</p>
<ol start="2">
<li>配置环境</li>
</ol>
<p>将解压后的文件中的bin目录也加入到环境变量中，相关路径在上面服务器的环境变量配置中框起来的下一条就是了，这里不另外截图了。配置环境后在命令行输入<code>mongosh</code>可以连接到服务器</p>
<ul>
<li><strong>安装MongoDB Compass</strong></li>
</ul>
<p>MongoDB Compass是官方提供的图形界面，在安装server时可以直接选择安装，也可以单独安装</p>
<ul>
<li><strong>Docker中安装MongoDB</strong></li>
</ul>
<ol>
<li>拉取MongoDB的镜像</li>
</ol>
<p><code>docker pull mongo</code> <strong>记得先开启Docker</strong></p>
<ol start="2">
<li>查看下载的镜像</li>
</ol>
<p><code>docker images</code></p>
<ol start="3">
<li>启动一个MongoDB服务器容器</li>
</ol>
<p><code>docker run -d --name mongodb -p 27017:27017 --privileged=true -v /d/mongodb/data:/data/db mongo</code> <strong>这里将数据卷挂载在本地的<code>D:/mongodb/data</code></strong></p>
<ol start="4">
<li>之后可以通过shell工具连接服务器容器</li>
</ol>
<h3 id="MongoDB简单操作"><a href="#MongoDB简单操作" class="headerlink" title="MongoDB简单操作"></a>MongoDB简单操作</h3><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><h4 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h4><h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><h3 id="MongoDB备份和恢复"><a href="#MongoDB备份和恢复" class="headerlink" title="MongoDB备份和恢复"></a>MongoDB备份和恢复</h3><h3 id="MongoDB复制集"><a href="#MongoDB复制集" class="headerlink" title="MongoDB复制集"></a>MongoDB复制集</h3><h4 id="概述-6"><a href="#概述-6" class="headerlink" title="概述"></a>概述</h4><p><strong>相关概念</strong></p>
<p>为了提高系统的高可用，MongoDB 提供了数据复制功能。MongoDB 支持两种数据复制功能：传统的主从复制和副本集&#x2F;复制集。<strong>副本集在传统主从复制的基础上，支持故障自动恢复功能，提供了更好的可用性，也是 MongoDB 官方推荐的集群部署方式。</strong></p>
<p>副本集（Replica Set）是一组 MongoDB 实例保持其相同数据集的集群，即由一个主（Primary）服务器和多个副本（Secondary）服务器构成。通过复制（Replication）将数据的更新由主服务器推送到其它副本服务器上，实现每个 MongoDB 实例维护相同的数据集副本。</p>
<p><strong>功能</strong></p>
<ul>
<li>数据备份</li>
<li>读写分离</li>
<li>自动故障转移</li>
</ul>
<p><strong>构成</strong></p>
<ul>
<li><p>主节点(Primary)</p>
<p><strong>主节点</strong>是副本集中负责处理客户端请求和读写数据主要成员。主节点通过 <strong>oplog</strong>（操作日志）记录所有操作。副本集中有且只有一个主节点，如果当前主节点不可用，则会从副本节点中选举出新的主节点。</p>
</li>
<li><p>副本节点(Secondary)</p>
<p><strong>副本节点</strong>定期轮询主节点获取 <strong>oplog</strong> 记录的操作内容，然后对自己的数据副本执行这些操作，从而保证副本节点的数据副本与主节点保持一致。副本集中可以有一个或多个副本节点。当主节点宕机时，副本集会根据优先级等参数选举出新的主节点。</p>
</li>
<li><p>仲裁节点(Arbiter)</p>
<p><strong>仲裁节点</strong>不存储数据，只是负责通过心跳包来确认集群中节点的数量，并在主服务器选举的时候作为仲裁决定结果。仲裁节点需要的资源很小。<strong>当副本集中节点个数为偶数时，建议添加一个仲裁节点，防止选举新的主节点过程中出现票数一致，导致无法选举出新的主节点。</strong></p>
</li>
</ul>
<p><strong>默认配置</strong></p>
<p>主节点负责处理所有的写入请求；主节点（默认）和副节点都可以处理读取请求；副节点从主节点（或符合条件的副节点）处复制数据；</p>
<p>每个节点都会向其它节点发送心跳请求；每隔 2 秒发送一次，超过 10 秒则请求超时（默认）；副本集中最多可以有 50 个节点。</p>
<p><strong>选举</strong></p>
<p>主节点与副节点之间的心跳请求超时、复制集初始化、新节点加入复制集会触发选举事件。</p>
<p>副本集通过 <strong>replSetInitiate</strong> 命令（或 mongo shell 的 **rs.initiate()**）进行初始化。初始化后，各个成员之间开始发送心跳消息，并发起 Priamry 节点的选举操作。获得大多数成员投票支持的节点，会成为 Primary 节点，其余节点成为Secondary 节点。假设复制集内投票成员数量为 N，则大多数为 N&#x2F;2 + 1，当复制集内存活成员数量不足大多数时，整个复制集将无法选举出 Primary，复制集将无法提供写服务，处于只读状态。</p>
<p>被选举为主节点的节点必须能够与多数节点建立连接、具有较新的 oplog、具有较高的优先级（如果有配置）</p>
<h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><ol>
<li><p>创建三个容器</p>
<p>下面可以将数据卷更改成为自己需要保存的位置，其中<code>--replSet &quot;rs0&quot;</code>指定副本集的名称为<code>rs0</code>，<code>--bind_ip_all</code>表示允许所有IP连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run  -d --name mongo_1 -p 27018:27017 --privileged=true -v /d/mongodb/replicaSet/mongo_1:/data/db mongo --replSet &quot;rs0&quot; --bind_ip_all</span><br><span class="line"></span><br><span class="line">docker run  -d --name mongo_2 -p 27019:27017 --privileged=true -v /d/mongodb/replicaSet/mongo_2:/data/db mongo --replSet &quot;rs0&quot; --bind_ip_all</span><br><span class="line"></span><br><span class="line">docker run  -d --name mongo_3 -p 27020:27017 --privileged=true -v /d/mongodb/replicaSet/mongo_3:/data/db mongo --replSet &quot;rs0&quot; --bind_ip_all</span><br></pre></td></tr></table></figure>

<p><code>docker ps</code>查看存在容器</p>
</li>
<li><p>初始化副本集</p>
<p>初始化副本集，通过<code>rs.initiate()</code>选举出主节点，首先需要知道自己本机的IP地址，然后将下面的的IP地址更改成为本机的IP地址即可在cmd窗口连接，或者在docker可视化软件进行操作，这里我的IP是<code>192.168.3.226</code></p>
<p>通过<code>mongosh 192.168.3.226:27018</code>连接其中任何一个mongo服务器即可，然后执行下面命令初始化主节点（注意IP），返回<code>&#123;ok:1&#125;</code>表示创建成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate( &#123;</span><br><span class="line">_id : &quot;rs0&quot;,</span><br><span class="line">members: [</span><br><span class="line">&#123; _id: 0, host: &quot;192.168.3.226:27018&quot; &#125;,</span><br><span class="line">&#123; _id: 1, host: &quot;192.168.3.226:27019&quot; &#125;,</span><br><span class="line">&#123; _id: 2, host: &quot;192.168.3.226:27020&quot; &#125;</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​		<code>rs.conf()</code> 查看副本集配置信息</p>
<p>​		<code>rs.status()</code> 查看副本集状态，可以看到哪个节点是主节点</p>
<ol start="3">
<li><p>这里副本集就搭建完成了，可以进行数据同步验证</p>
<ul>
<li><p>首先在主节点插入数据<code>db.user.insert(&#123;&quot;id&quot;:1001,&quot;name&quot;:&quot;zhangsan&quot;&#125;)</code></p>
</li>
<li><p>然后可以在主节点查询数据（新开一个cmd窗口连接到另外一个从节点服务器执行下面查询）<code>db.user.find()</code>，这时会发现默认情况下从节点不允许读写操作，需要在连接的<strong>从节点</strong>执行<code>db.getMongo().setReadPref(&quot;secondary&quot;)</code>命令，这是再查询就可以查询到数据了</p>
</li>
</ul>
</li>
<li><p>下面也可以进行读写分离实验，这个比较简单，在从节点执行写操作会发现不允许进行，只允许在主节点进行写操作</p>
</li>
<li><p>故障自动转移实验：</p>
<p>首先在docker可视化界面中手动暂停主节点服务器，然后在从节点通过<code>rs.status()</code>可以发现集群选举出了新的主节点，进行了故障转移。重新启动旧的主节点会自动变成从节点。</p>
</li>
</ol>
<h4 id="加入仲裁节点"><a href="#加入仲裁节点" class="headerlink" title="加入仲裁节点"></a>加入仲裁节点</h4><ol>
<li>新建一个节点容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create --name mongo04 -p 27021:27017 -v mongo-data-04:/data/db mongo:4 --replSet &quot;rs0&quot; --bind_ip_all</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>重新配置副本集的写关注</li>
</ol>
<p>在副本集中，WriteConcern（写关注）配置是决定一个写操作落到多少个节点上才算是成功的参数。WriterConcern 的取值包括：</p>
<ul>
<li>0：发起写操作，不关心是否成功</li>
<li>1：默认值，primary 节点完成写操作, 就可以返回确认写成功的消息</li>
<li>n：表示写操作需要被复制到指定节点数才算成功</li>
<li>majority：写操作需要被复制到大多数节点上才算成功</li>
</ul>
<p>由于在副本集中，添加了仲裁节点，可能会导致默认 WriterConcern 发生改变，所以需要再配置一下 setDefaultRWConcern 的内容。</p>
<p>在复制集中的一个节点输入下面命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.adminCommand(&#123;</span><br><span class="line"> &quot;setDefaultRWConcern&quot; : 1,</span><br><span class="line"> &quot;defaultWriteConcern&quot; : &#123;</span><br><span class="line"> &quot;w&quot; : &quot;majority&quot;</span><br><span class="line"> &#125;&#125;)</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>将仲裁节点接入复集<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.addArb(&quot;192.168.3.226:27021&quot;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>之后可以通过<code>rs.status()</code>查询复制集信息</p>
<h3 id="MongoDB分片集群"><a href="#MongoDB分片集群" class="headerlink" title="MongoDB分片集群"></a>MongoDB分片集群</h3><h4 id="概述-7"><a href="#概述-7" class="headerlink" title="概述"></a>概述</h4><p><strong>相关概念</strong></p>
<p>MongoDB 分片是 MongoDB 支持的另一种集群形式，它可以满足 MongoDB 数据量呈爆发式增长的需求。当 MongoDB 存储海量的数据时，一台服务器可能无法满足数据存储的需求，就可以通过在多台机器上对海量数据进行划分（即分片），使得 MongoDB 数据库系统能够存储和处理更多的数据。</p>
<p>MongoDB 数据库提供了数据自动分片功能，它内置了多种分片逻辑，使得 MongoDB可以自动处理分片数据，也可以很容易的管理分片集群。</p>
<p><strong>构成</strong></p>
<ul>
<li>分片服务器（Mongod&#x2F;Shard）</li>
</ul>
<p>即 MongoDB 实例（<strong>mongod</strong>，用 <strong>Shard</strong> 表示）。分片服务器是<strong>实际存储数据</strong>的组件，持有完整数据集中的一部分。每个分片服务器都可以是一个 MongoDB 实例，也可是一组MongoDB 实例组成的集群（副本集）。从 MongoDB 3.6 开始，必须将<strong>分片部署为副本集</strong>，这样具有更好的容错性。</p>
<ul>
<li>路由服务器（Mongos）</li>
</ul>
<p>即 <strong>Mongos</strong>。路由服务器主要提供<strong>客户端应用程序</strong>与<strong>分片集群</strong>交互的接口，所有请求都需要通过路由服务器进行协调工作。<strong>Mongos 实际上就是一个消息分发请求中心</strong>，它负责把客户端应用程序对应的数据请求转发到对应的分片服务器上。应用程序将查询、存储、更新等请求原封不动地发送给 <strong>Mongos</strong>, <strong>Mongos</strong> 询问配置服务器操作分片服务器需要获取哪些元数据，然后连接相应的分片服务器进行相关操作，最后将各个分片服务器的响应进行合并，返回给客户端应用程序。生产环境中，一个分片集群通常会有<strong>多个</strong>路由服务器，一方面可以解决多个客户端同时请求，从而达到负载均衡的效果；另一方面可以解决当路由服务器宕机时导致整个分片集群无法使用的问题。</p>
<ul>
<li>配置服务器（Config Server）</li>
</ul>
<p>即 <strong>Config Server</strong>。它存储了分片集群的<strong>元数据</strong>（如，每个集群上有多少分片，数据存储范围等信息），存储了集群的认证和授权配置，这些数据是不允许丢失的。因此，在生产环境中，通常需要配置多个配置服务器以防止数据丢失。从 MongoDB 3.4 版本开始，配置服务器必须部署副本集，因此一般需要配置<strong>三个配置服务器</strong>组成的副本集。配置服务器存储着分片集群的<strong>持久化元数据</strong>，而路由服务器存储着分片集群的<strong>非持久化元数据</strong>，这些数据均为内存缓存的数据。当路由服务器初次启动或关闭重启时，就会从配置服务器中加载分片集群的元数据。若是配置服务器的信息发生变化，则会通知所有路由服务器更新自己的状态，这样路由服务器就能继续准确的协调客户端与分片集群的交互工作。</p>
<p><img src="https://img-blog.csdnimg.cn/61111f5f17fe40a6ab627711d5f5ad20.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bm_5rW3X-Wwj-eWr-eWr-S4tg==,size_18,color_FFFFFF,t_70,g_se,x_16"></p>
<p><strong>从上图可以看出，</strong>每个分片存储一部分数据，需要部署为复制集；mongos 路由可以将客户请求发送至相关的分片，同时与配置服务器通信，一般部署多台；配置服务器保存集群配置和元数据，需要部署为复制集。</p>
<p><strong>分片优点</strong></p>
<ul>
<li>对集群进行抽象，让集群“不可见”</li>
</ul>
<p>Mongos 就是掌握统一路口的路由器，其会将客户端发来的请求准确无误的路由到集群中的一个或者一组服务器上，同时会把接收到的响应拼装起来发回到客户端。</p>
<ul>
<li>保证集群总是可读写</li>
</ul>
<p>MongoDB 通过多种方法来确保集群的可用性和可靠性。如，将 MongoDB 的分片和副本集功能结合使用，在确保数据分片到多台服务器的同时，也确保了每分数据都有相应的备份，这样就可以确保有服务器宕机时，其他的从节点可以立即接替工作。</p>
<ul>
<li>使集群易于扩展</li>
</ul>
<p>当系统需要更多的空间和资源的时候，可以按需方便的扩充系统容量。</p>
<p><strong>一般分片步骤</strong></p>
<ul>
<li>分析数据库中的哪些集合的数据，需要进行分片存储；</li>
<li>指定每个集合的<strong>分片键（Shard Key），</strong>分片键可以是集合文档中的一个或多个字段；</li>
<li>制定分片策略，如是范围分片还是哈希分片；</li>
<li><strong>分片键</strong>会将集合数据划分为多个<strong>块</strong>（<strong>Chunk</strong>）（默认大小为 <strong>64MB</strong>，每个块均表示集合中数据的一部分）；</li>
<li>MongoDB 根据分片策略和分片键，将划分的<strong>块</strong>分发到分片集群中。</li>
</ul>
<p><strong>内置分片策略</strong></p>
<ul>
<li>范围分片</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/a008e55d39694e3ab2fb84202fe42988.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bm_5rW3X-Wwj-eWr-eWr-S4tg==,size_19,color_FFFFFF,t_70,g_se,x_16"></p>
<p><img src="https://img-blog.csdnimg.cn/ef3de502c08341c1b0bfd032fcbe2184.png"></p>
<ul>
<li>哈希分片</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/5c5c0d4001f2470db58eecf975630e96.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bm_5rW3X-Wwj-eWr-eWr-S4tg==,size_17,color_FFFFFF,t_70,g_se,x_16"></p>
<p><img src="https://img-blog.csdnimg.cn/28240878f44240d0b46fafba84fdf043.png"></p>
<p><strong>分片键的选择</strong></p>
<p>MongoDB 分片集群中，分片键的选择很重要。分片键的选择标准包括：</p>
<ul>
<li>分片键值的取值范围大，或称基数大（如使用布尔值做片键就不合适）；</li>
<li>分片键值的取值分布较均衡，取值不要集中在某一个范围内；</li>
<li>分片键值不要单向增大或减小，以防产生数据不均衡；</li>
<li>分片键值要方便查询；</li>
</ul>
<p>在实际选择分片键时，可以使用 hash 运算，增加分片键值的随机性；可以使用复合片键，扩大键值的取值基数。</p>
<p><strong>分片集群数据库的分裂</strong></p>
<p>数据块 <strong>chunk</strong></p>
<p>在一个分片节点中，MongoDB 会根据<strong>分片键</strong>，将集合数据划分为多个<strong>块</strong>（<strong>Chunk</strong>）。系统初始时产生 1 个 chunk，每个 chunk 默认大小为 <strong>64MB</strong>，存储了集合中一部分数据。chunk 的产生，有以下两个用途：</p>
<ul>
<li><p><strong>分裂 Splitting</strong>：当一个 chunk 的大小超过配置中的 chunk size 时，MongoDB 的后台进程会自动把这个 chunk 切分成更小的 chunk，从而避免chunk 过大；</p>
</li>
<li><p><strong>均衡 Balancing：</strong>在 MongoDB 中，balancer 是一个后台进程，会负责监视和调整集群的平衡，负责 chunk 的迁移，从而均衡各个分片节点的负载。</p>
</li>
</ul>
<h4 id="搭建-1"><a href="#搭建-1" class="headerlink" title="搭建"></a>搭建</h4><h5 id="1-首先需要了解结构"><a href="#1-首先需要了解结构" class="headerlink" title="1. 首先需要了解结构"></a>1. 首先需要了解结构</h5><p>这里共需要11个节点，3 个 Config Server 节点构成的副本集，2 个 shard 集群。每个集群又是一个副本集，包括 1 主 1 从和 1 个仲裁节点，2 个 mongos 节点，具体的配置文件可以下载实验材料找到具体内容找到</p>
<h5 id="2-搭建3个Config节点构成的副本集"><a href="#2-搭建3个Config节点构成的副本集" class="headerlink" title="2. 搭建3个Config节点构成的副本集"></a>2. 搭建3个Config节点构成的副本集</h5><p>这里有3个节点，分别为conf_1、conf_2、conf_3，IP都为本机回环地址127.0.0.1，端口号分别为17000、17001、17002，副本集名称为rs_conf，配置文件为mongo.cfg</p>
<p>配置文件主要参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 日志文件</span><br><span class="line">storage:</span><br><span class="line">  # mongod 进程存储数据目录，此配置仅对 mongod 进程有效</span><br><span class="line">  dbPath: /data/db</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /data/logs/mongo.log</span><br><span class="line"></span><br><span class="line">#  网络设置</span><br><span class="line">net:</span><br><span class="line">  port: 27017  #端口号</span><br><span class="line">  bindIp: 0.0.0.0    #绑定ip</span><br><span class="line">replication:</span><br><span class="line">  replSetName: rs_conf  #副本集名称</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: configsvr # 集群角色，这里配置的角色是配置节点</span><br></pre></td></tr></table></figure>



<p><strong>执行命令创建3个config节点容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name conf_01 -p 17000:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/confServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/conf_01:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/conf_01:/data/logs mongo --config /data/configdb/mongo.cfg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d --name conf_02 -p 17001:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/confServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/conf_02:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/conf_02:/data/logs mongo --config /data/configdb/mongo.cfg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d --name conf_03 -p 17002:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/confServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/conf_03:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/conf_03:/data/logs mongo --config /data/configdb/mongo.cfg</span><br></pre></td></tr></table></figure>



<p><strong>副本集初始化</strong></p>
<p>连接170000节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongosh 127.0.0.1:17000</span><br></pre></td></tr></table></figure>

<p>输入命令初始化，注意IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate(</span><br><span class="line">&#123;</span><br><span class="line">_id: &quot;rs_conf&quot;,</span><br><span class="line">configsvr: true,</span><br><span class="line">members: [</span><br><span class="line">&#123; _id : 0, host : &quot;192.168.3.226:17000&quot; &#125;,</span><br><span class="line">&#123; _id : 1, host : &quot;192.168.3.226:17001&quot; &#125;,</span><br><span class="line">&#123; _id : 2, host : &quot;192.168.3.226:17002&quot; &#125;</span><br><span class="line">]&#125;)</span><br></pre></td></tr></table></figure>

<p>输入<code>rs.status()</code>查看Config server 集群信息</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831512.png" alt="image-20231216162616759"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831534.png" alt="image-20231216163416070"></p>
<h5 id="3-创建2个shard集群"><a href="#3-创建2个shard集群" class="headerlink" title="3. 创建2个shard集群"></a>3. 创建2个shard集群</h5><p>集群1</p>
<p>集群1有3个节点，分别为shardsvr_01、shardsvr_02 、shardsvr_03（仲裁节点），IP都为本机回环IP，端口号分别为27018、27019、27020，副本集的名称为rs_shard01 、配置文件为mongo_1.cfg，配置文件内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 日志文件</span><br><span class="line">storage:</span><br><span class="line">  # mongod 进程存储数据目录，此配置仅对 mongod 进程有效</span><br><span class="line">  dbPath: /data/db</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /data/logs/mongo.log</span><br><span class="line"></span><br><span class="line">#  网络设置</span><br><span class="line">net:</span><br><span class="line">  port: 27017  #端口号</span><br><span class="line">  bindIp: 0.0.0.0    #绑定ip</span><br><span class="line">replication:</span><br><span class="line">  replSetName: rs_shard01  #副本集名称</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr # 集群角色，这里配置的角色是shard节点</span><br></pre></td></tr></table></figure>



<p>集群2</p>
<p>集群1有3个节点，分别为shardsvr_04、shardsvr_05 、shardsvr_06（仲裁节点），IP都为本机回环IP，端口号分别为27021、27022、27023，副本集的名称为rs_shard02 、配置文件为mongo_2.cfg，配置文件内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 日志文件</span><br><span class="line">storage:</span><br><span class="line">  # mongod 进程存储数据目录，此配置仅对 mongod 进程有效</span><br><span class="line">  dbPath: /data/db</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /data/logs/mongo.log</span><br><span class="line"></span><br><span class="line">#  网络设置</span><br><span class="line">net:</span><br><span class="line">  port: 27017  #端口号</span><br><span class="line">  bindIp: 0.0.0.0    #绑定ip</span><br><span class="line">replication:</span><br><span class="line">  replSetName: rs_shard02  #副本集名称</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr # 集群角色，这里配置的角色是shard节点</span><br></pre></td></tr></table></figure>



<p><strong>创建rs_shard01 集群</strong></p>
<p>创建容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name shardsvr_01 -p 27018:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_01:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_01:/data/logs mongo --config /data/configdb/mongo_1.cfg</span><br><span class="line"></span><br><span class="line">docker run -d --name shardsvr_02 -p 27019:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_02:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_02:/data/logs mongo --config /data/configdb/mongo_1.cfg</span><br><span class="line"></span><br><span class="line">docker run -d --name shardsvr_03 -p 27020:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_03:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_03:/data/logs mongo --config /data/configdb/mongo_1.cfg</span><br></pre></td></tr></table></figure>

<p><code>mongosh 127.0.0.1:27018</code>进入服务器，然后输入下面命令初始化集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate( &#123;</span><br><span class="line">_id : &quot;rs_shard01&quot;,</span><br><span class="line">members: [</span><br><span class="line">&#123; _id: 0, host: &quot;192.168.3.226:27018&quot; &#125;,</span><br><span class="line">&#123; _id: 1, host: &quot;192.168.3.226:27019&quot; &#125;,</span><br><span class="line">&#123; _id: 2, host: &quot;192.168.3.226:27020&quot;,arbiterOnly:true  &#125;</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831987.png" alt="image-20231216165017619"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831283.png" alt="image-20231216165527784"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831809.png" alt="image-20231216165620013"></p>
<p><strong>创建rs_shard02 集群</strong></p>
<p>创建容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name shardsvr_04 -p 27021:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_04:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_04:/data/logs mongo --config /data/configdb/mongo_2.cfg</span><br><span class="line"></span><br><span class="line">docker run -d --name shardsvr_05 -p 27022:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_05:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_05:/data/logs mongo --config /data/configdb/mongo_2.cfg</span><br><span class="line"></span><br><span class="line">docker run -d --name shardsvr_06 -p 27023:27017 --privileged=true -v C:/mongodb/docker/mongodb/cluster/conf/shardServ:/data/configdb -v C:/mongodb/docker/mongodb/cluster/data/shardsvr_06:/data/db -v C:/mongodb/docker/mongodb/cluster/logs/shardsvr_06:/data/logs mongo --config /data/configdb/mongo_2.cfg</span><br></pre></td></tr></table></figure>

<p><code>mongosh 127.0.0.1:27021</code>进入服务器，然后输入下面命令初始化集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate( &#123;</span><br><span class="line">_id : &quot;rs_shard02&quot;,</span><br><span class="line">members: [</span><br><span class="line">&#123; _id: 0, host: &quot;192.168.3.226:27021&quot; &#125;,</span><br><span class="line">&#123; _id: 1, host: &quot;192.168.3.226:27022&quot; &#125;,</span><br><span class="line">&#123; _id: 2, host: &quot;192.168.3.226:27023&quot;,arbiterOnly:true &#125;</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831605.png" alt="image-20231216171848824"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831262.png" alt="image-20231216171957847"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831985.png" alt="image-20231216172149987"></p>
<h5 id="4-创建2个Mongos节点"><a href="#4-创建2个Mongos节点" class="headerlink" title="4. 创建2个Mongos节点"></a>4. 创建2个Mongos节点</h5><p>两个节点分别为mongos_01和mongos_02，IP都为本机回环地址，端口号分别为30001和30002，配置文件为mongo.cfg，配置文件内容如下<strong>（自己搭建的时候记得把配置文件的IP修改成自己的本机现在的实际IP）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 日志文件</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /data/logs/mongo.log</span><br><span class="line"></span><br><span class="line">#  网络设置</span><br><span class="line">net:</span><br><span class="line">  port: 27017  #端口号</span><br><span class="line">  bindIp: 0.0.0.0    #绑定ip</span><br><span class="line"></span><br><span class="line"># 配置分片，这里面配置的是需要读取的配置节点的信息</span><br><span class="line">sharding:</span><br><span class="line">  configDB: rs_conf/192.168.3.226:17000,192.168.3.226:17001,192.168.3.226:17002</span><br></pre></td></tr></table></figure>



<p><strong>创建2个容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mongos_01 -p 30001:27017 --privileged=true  --entrypoint &quot;mongos&quot; -v C:/mongodb/docker/mongodb/cluster/conf/mongos:/data/configdb -v C:/mongodb/docker/mongodb/cluster/logs/mongos_01:/data/logs mongo --config /data/configdb/mongo.cfg</span><br><span class="line"></span><br><span class="line">docker run -d --name mongos_02 -p 30002:27017 --privileged=true  --entrypoint &quot;mongos&quot; -v C:/mongodb/docker/mongodb/cluster/conf/mongos:/data/configdb -v C:/mongodb/docker/mongodb/cluster/logs/mongos_02:/data/logs mongo --config /data/configdb/mongo.cfg</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161831014.png" alt="image-20231216173616436"></p>
<p><strong>在mongos_01节点添加2个shard 集群</strong></p>
<p><code>mongosh 127.0.0.1:30001</code>连接30001节点</p>
<p>然后输入下面命令配置WriteConcern 参数（如果需要）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.adminCommand(&#123;</span><br><span class="line"> &quot;setDefaultRWConcern&quot; : 1,</span><br><span class="line"> &quot;defaultWriteConcern&quot; : &#123;</span><br><span class="line"> &quot;w&quot; : &quot;majority&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161830067.png" alt="image-20231216174343377"></p>
<p><strong>在mongos_01中添加第一个shard 集群的节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh.addShard(&quot;rs_shard01/192.168.3.226:27018,192.168.3.226:27019,192.168.3.226:27020&quot;)</span><br></pre></td></tr></table></figure>



<p><strong>在mongos_01添加第二个shard 集群的节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh.addShard(&quot;rs_shard02/192.168.3.226:27021,192.168.3.226:27022,192.168.3.226:27023&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161830125.png" alt="image-20231216174731478"></p>
<p><strong>在mongos_02节点添加2个shard 集群</strong></p>
<p><code>mongosh 127.0.0.1:30002</code>连接30002节点</p>
<p><strong>在mongos_02中添加第一个shard 集群的节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh.addShard(&quot;rs_shard01/192.168.3.226:27018,192.168.3.226:27019,192.168.3.226:27020&quot;)</span><br></pre></td></tr></table></figure>



<p><strong>在mongos_02中添加第二个shard 集群的节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh.addShard(&quot;rs_shard02/192.168.3.226:27021,192.168.3.226:27022,192.168.3.226:27023&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161830816.png" alt="image-20231216175150714"></p>
<p><strong>查看分片集群状态</strong></p>
<p><code>sh.status()</code></p>
<p>也可以使用以下命令，查看特定分片的详细信息：<code>sh.status(shard 集群名字) </code>如：<code>sh.status(&#39;rs_shard01&#39;)</code></p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="1-启用分片集群"><a href="#1-启用分片集群" class="headerlink" title="1. 启用分片集群"></a>1. 启用分片集群</h5><p><strong>连接到任意一个mongos节点</strong></p>
<p><code>mongosh 127.0.0.1:30002</code></p>
<p><strong>开启数据库的分片功能</strong></p>
<p>这里如要开启数据库study的分片功能</p>
<p><code>use study</code></p>
<p><code>sh.enableSharding(&quot;study&quot;)</code></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161830355.png" alt="image-20231216180133922"></p>
<h5 id="2-指定分片键和分片策略"><a href="#2-指定分片键和分片策略" class="headerlink" title="2. 指定分片键和分片策略"></a>2. 指定分片键和分片策略</h5><p>如下面的命令就是代表students集合按照_id的hash值进行分片，进行hash分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh.shardCollection(&quot;study.students&quot;, &#123;&quot;_id&quot;: &quot;hashed&quot; &#125;)</span><br></pre></td></tr></table></figure>



<p>如果需要使用其他键作为分片键，需要为它创建索引</p>
<ul>
<li><p><code>db.order.createIndex(&#123;&quot;id&quot;:1&#125;)</code> 用于范围分片策略</p>
</li>
<li><p><code>db.user.createIndex(&#123;id: &quot;hashed&quot;&#125;) </code>创建一个哈希索引，用于哈希分片策略</p>
</li>
</ul>
<h5 id="3-插入多条信息并进行查看"><a href="#3-插入多条信息并进行查看" class="headerlink" title="3. 插入多条信息并进行查看"></a>3. 插入多条信息并进行查看</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (i = 1; i &lt;= 1000; i=i+1)&#123;</span><br><span class="line">db.students.insertOne(&#123;&#x27;id&#x27;:i , &#x27;ranking&#x27;: 100+i&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>db.stats()</code>查看数据库的基本信息</p>
<p><code>db.students.getShardDistribution()</code>查看分片集合中数据分布情况</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312161829629.jpg" alt="img"></p>
<h2 id="期末大作业（主题一）"><a href="#期末大作业（主题一）" class="headerlink" title="期末大作业（主题一）"></a>期末大作业（主题一）</h2><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>首先需要先了解我的文件路径是如何的，我在<code>C</code>盘根目录创建了一个<code>examTest</code>文件夹，并在其中创建了<code>MySQL</code>和<code>Redis</code>两个文件夹，再<code>MySQL</code>文件夹下创建了<code>data</code>、<code>log</code>、<code>conf</code>文件夹，在<code>Redis</code>文件夹下创建了<code>data</code>、<code>conf</code>文件夹</p>
<p>出现docker端口没有权限等问题，可以先以管理员身份运行命令行窗口，然后输入<code>net stop winnat</code>停止服务，然后再输入<code>net start winnat</code>重启服务即可</p>
<h3 id="MySQL相关"><a href="#MySQL相关" class="headerlink" title="MySQL相关"></a>MySQL相关</h3><h4 id="1-创建MySQL容器"><a href="#1-创建MySQL容器" class="headerlink" title="1. 创建MySQL容器"></a>1. 创建MySQL容器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mysql_3307_exam -v C:/examTest/MySQL/log:/var/log/mysql -v C:/examTest/MySQL/data:/var/lib/mysql -v C:/examTest/MySQL/conf:/etc/mysql/conf.d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=wang10086 -d mysql --init-connect=&quot;SET collation_connection=utf8mb4_0900_ai_ci&quot; --init-connect=&quot;SET NAMES utf8mb4&quot; --skip-character-set-client-handshake</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241223326.png" alt="image-20231216215859408"></p>
<p><code>mysql -h 127.0.0.1 -P 3307 -u root -p</code>	输入密码就可以进行连接</p>
<h4 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2. 创建数据库"></a>2. 创建数据库</h4><p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241223804.png" alt="image-20231216223118130"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -id --name mysql_3307_exam -p 3307:3306 mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="Redis创建集群"><a href="#Redis创建集群" class="headerlink" title="Redis创建集群"></a>Redis创建集群</h3><h4 id="1-创建容器"><a href="#1-创建容器" class="headerlink" title="1. 创建容器"></a>1. 创建容器</h4><p><strong>配置文件内容如下（IP修改为自己的本机IP）：</strong></p>
<p><strong>redis_exam_6380.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6380</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6380.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6380</span><br><span class="line">cluster-announce-bus-port 16380</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p><strong>redis_exam_6381.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">port 6381</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6381.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6381</span><br><span class="line">cluster-announce-bus-port 16381</span><br></pre></td></tr></table></figure>

<p><strong>redis_exam_6382.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6382</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6382.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 6382</span><br><span class="line">cluster-announce-bus-port 16382</span><br></pre></td></tr></table></figure>

<p><strong>redis_exam_26380.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">port 26380</span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-26380.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 26380</span><br><span class="line">cluster-announce-bus-port 16383</span><br></pre></td></tr></table></figure>

<p><strong>redis_exam_26381.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 26381</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-26381.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 26381</span><br><span class="line">cluster-announce-bus-port 16384</span><br></pre></td></tr></table></figure>

<p><strong>redis_exam_26382.conf</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 26382</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-26382.conf</span><br><span class="line"></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-announce-ip 192.168.3.226</span><br><span class="line">cluster-announce-port 26382</span><br><span class="line">cluster-announce-bus-port 16385</span><br></pre></td></tr></table></figure>



<p><strong>命令行输入下面命令创建容器，并配置数据卷的位置和配置文件的位置，上面已经给出了每个配置文件的名字和内容，把配置文件放到自己的目录下后按照实际情况修改下面的路径</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis_exam_6380 -p 6380:6380 -p 16380:16380 --privileged=true -v C:/examTest/Redis/data/6380:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_6380.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_exam_6381 -p 6381:6381 -p 16381:16381 --privileged=true -v C:/examTest/Redis/data/6381:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_6381.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_exam_6382 -p 6382:6382 -p 16382:16382 --privileged=true -v C:/examTest/Redis/data/6382:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_6382.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_exam_26380 -p 26380:26380 -p 16383:16383 --privileged=true -v C:/examTest/Redis/data/26380:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_26380.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_exam_26381 -p 26381:26381 -p 16384:16384 --privileged=true -v C:/examTest/Redis/data/26381:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_26381.conf</span><br><span class="line"></span><br><span class="line">docker run -d --name redis_exam_26382 -p 26382:26382 -p 16385:16385 --privileged=true -v C:/examTest/Redis/data/26382:/data -v C:/examTest/Redis/conf:/etc/redis redis redis-server /etc/redis/redis_exam_26382.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145496.png" alt="image-20231217112809620"></p>
<h4 id="2-创建分片集群"><a href="#2-创建分片集群" class="headerlink" title="2. 创建分片集群"></a>2. 创建分片集群</h4><p>根据自己的IP进行修改，这里指定每个主节点的副本数量为1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//1. 进入一个容器,也可以在docker可视化界面进行操作</span><br><span class="line">docker exec -it redis_exam_6380 /bin/bash</span><br><span class="line"></span><br><span class="line">//2. 输入下面命令创建集群，记得修改IP为自己的IP</span><br><span class="line">redis-cli --cluster create 192.168.3.226:6380 192.168.3.226:6381 192.168.3.226:6382 192.168.3.226:26380 192.168.3.226:26381  192.168.3.226:26382  --cluster-replicas 1</span><br><span class="line"></span><br><span class="line">//3. 按照提示输入yes后等待即可</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145170.png" alt="image-20231217112852799"></p>
<p><code>cluster nodes</code>查看节点信息</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145082.png" alt="image-20231217113748109"></p>
<p><code>cluster info</code>查看集群信息</p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145144.png" alt="image-20231217113652619"></p>
<h4 id="3-分片集群测试"><a href="#3-分片集群测试" class="headerlink" title="3. 分片集群测试"></a>3. 分片集群测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis_exam_6380 /bin/bash</span><br><span class="line"></span><br><span class="line">redis-cli -c -p 6380</span><br><span class="line"></span><br><span class="line">docker exec -it redis_exam_26381 /bin/bash</span><br><span class="line"></span><br><span class="line">redis-cli -c -p 26381</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145186.png" alt="image-20231217114356281"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312171145493.png" alt="image-20231217114405610"></p>
<h3 id="系统功能模块的实现"><a href="#系统功能模块的实现" class="headerlink" title="系统功能模块的实现"></a>系统功能模块的实现</h3><h4 id="登录注册"><a href="#登录注册" class="headerlink" title="登录注册"></a>登录注册</h4><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><p><strong>Mapper</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222554.png" alt="image-20231221232624286"></p>
<p><strong>Service</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222927.png" alt="image-20231222182751185"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222215.png" alt="image-20231221232744909"></p>
<p><strong>Controller</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222808.png" alt="image-20231221232906012"></p>
<p><strong>Token</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222679.png" alt="image-20231221232815864"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222294.png" alt="image-20231221232826109"></p>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><p><strong>注册</strong></p>
<p><strong>注册成功</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241222546.png" alt="image-20231221232141276"></p>
<p><strong>数据库中</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221865.png" alt="image-20231221232218134"></p>
<p><strong>不允许相同账号</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221829.png" alt="image-20231221232055354"></p>
<p><strong>登录</strong></p>
<p><strong>登录成功返回token</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221463.png" alt="image-20231221231923828"></p>
<p><strong>再一次登录删除旧token</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221742.png" alt="image-20231221232015195"></p>
<p><strong>账号或密码错误，登录失败返回空</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221744.png" alt="image-20231221232337228"></p>
<h4 id="用户信息"><a href="#用户信息" class="headerlink" title="用户信息"></a>用户信息</h4><h5 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h5><p><strong>Mapper</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221123.png" alt="image-20231222173729728"></p>
<p><strong>Service</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221349.png" alt="image-20231222182632311"></p>
<p><strong>Controller</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221543.png" alt="image-20231222173844493"></p>
<h5 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h5><p><strong>token错误</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241221433.png" alt="image-20231222171523273"></p>
<p><strong>token过期</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220628.png" alt="image-20231222171608200"></p>
<p><strong>更新成功</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220154.png" alt="image-20231222173617250"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220598.png" alt="image-20231222173629486"></p>
<h4 id="反馈"><a href="#反馈" class="headerlink" title="反馈"></a>反馈</h4><h5 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h5><p><strong>Mapper</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220946.png" alt="image-20231222111933524"></p>
<p><strong>Service</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220603.png" alt="image-20231222112025074"></p>
<p><strong>Controller</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220359.png" alt="image-20231222112324470"></p>
<h5 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h5><p><strong>反馈成功</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220437.png" alt="image-20231222001031333"></p>
<p><strong>token过期</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220501.png" alt="image-20231222111717267"></p>
<p><strong>token错误</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241220526.png" alt="image-20231222110112931"></p>
<p><strong>获取所有书本信息</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219166.png" alt="image-20231222190118729"></p>
<p><strong>获取一本书</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219785.png" alt="image-20231222190819895"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219986.png" alt="image-20231222190804776"></p>
<h4 id="书籍信息"><a href="#书籍信息" class="headerlink" title="书籍信息"></a>书籍信息</h4><h5 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h5><p><strong>Mapper</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219233.png" alt="image-20231222190848610"></p>
<p><strong>Service</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219645.png" alt="image-20231222191900463"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219211.png" alt="image-20231222234345129"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219817.png" alt="image-20231222191927165"></p>
<p><strong>Controller</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219909.png" alt="image-20231222191940230"></p>
<h5 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h5><p><strong>不存在的</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241219769.png" alt="image-20231222183804597"></p>
<p><strong>Redis保存空白值</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241224507.png" alt="image-20231222183911718"></p>
<p><strong>查询到</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218617.png" alt="image-20231222184404865"></p>
<h4 id="阅读信息"><a href="#阅读信息" class="headerlink" title="阅读信息"></a>阅读信息</h4><h5 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h5><p><strong>Mapper</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218417.png" alt="image-20231223172636078"></p>
<p><strong>Service</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218219.png" alt="image-20231223172659640"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/image-20231223172726973.png" alt="image-20231223172726973"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218066.png" alt="image-20231223172753182"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218451.png" alt="image-20231223172826645"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218669.png" alt="image-20231223172843143"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218793.png" alt="image-20231223172855942"></p>
<p><strong>Controller</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218709.png" alt="image-20231223222929566"></p>
<h5 id="测试-4"><a href="#测试-4" class="headerlink" title="测试"></a>测试</h5><p><strong>阅读人数</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241218480.png" alt="image-20231223160859728"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217010.png" alt="image-20231223160918912"></p>
<p><strong>下载人数</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217511.png" alt="image-20231223160946012"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217690.png" alt="image-20231223161038043"></p>
<p><strong>点赞人数</strong></p>
<p><strong>身份过期</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217447.png" alt="image-20231223161608218"></p>
<p><strong>收藏成功</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217894.png" alt="image-20231223161950842"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217987.png" alt="image-20231223165313274"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217547.png" alt="image-20231223165413234"></p>
<p><strong>再次请求就是解除收藏</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217951.png" alt="image-20231223164159348"></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241217190.png" alt="image-20231223165245891"></p>
<p><strong>token错误</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241216504.png" alt="image-20231223163636716"></p>
<p><strong>定时更新浏览数据到数据库</strong></p>
<p><img src="https://gitee.com/wuleizhenshang/person-typora-programming-pic/raw/master/img/202312241216272.png" alt="image-20231223172506002"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.wuleizhenshang.love">无泪真伤</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.wuleizhenshang.love/2023/10/11/%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%80%89%E4%BF%AE%E8%AF%BE%EF%BC%89/">https://www.wuleizhenshang.love/2023/10/11/%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%80%89%E4%BF%AE%E8%AF%BE%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.wuleizhenshang.love" target="_blank">Blog-无泪真伤</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/">开发技术</a></div><div class="post_share"><div class="social-share" data-image="https://pic.imgdb.cn/item/6558704bc458853aef160963.jpg" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/17/GitHub+Hexo+Git/" title="GitHub Pages+Hexo+Git快速搭建个人博客"><img class="cover" src="https://pic.imgdb.cn/item/65597baac458853aef754b7b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">GitHub Pages+Hexo+Git快速搭建个人博客</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/24/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" title="Android学习笔记"><img class="cover" src="https://pic.imgdb.cn/item/65dd5b1c9f345e8d035100ba.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Android学习笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic.imgdb.cn/item/65582252c458853aeff7c6f5.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">无泪真伤</div><div class="author-info__description">找寻自己所爱！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wuleizhenshang"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本人并非什么大佬！写博客纯属个人兴趣，记录一下个人学习经历而已，有错误请见谅！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E9%80%89%E4%BF%AE%E8%AF%BE%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">非关系型数据库（选修课）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9"><span class="toc-number">1.1.</span> <span class="toc-text">Redis基础内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.2.</span> <span class="toc-text">相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">其他</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Key%EF%BC%88%E9%94%AE%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">Key（键）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">String（字符串）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">List（列表）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">Set（集合）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash%EF%BC%88%E6%95%A3%E5%88%97%EF%BC%89"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">Hash（散列）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sorted-Sets%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">Sorted Sets（有序集合）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.</span> <span class="toc-text">Docker基础内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.</span> <span class="toc-text">命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">Docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">镜像相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">容器相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">数据卷配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.3.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">网络模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Bridge%EF%BC%88%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">Bridge（桥接模式）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Host%EF%BC%88%E4%B8%BB%E6%9C%BA%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">Host（主机模式）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#none%EF%BC%88%E6%97%A0%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">none（无网络模式）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%8B%E4%BD%BF%E7%94%A8Redis"><span class="toc-number">1.3.</span> <span class="toc-text">Docker下使用Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%8B%E4%BD%BF%E7%94%A8MySql"><span class="toc-number">1.4.</span> <span class="toc-text">Docker下使用MySql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%8B%E4%BD%BF%E7%94%A8MongoDB"><span class="toc-number">1.5.</span> <span class="toc-text">Docker下使用MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">Redis数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">1.6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.2.</span> <span class="toc-text">具体操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.2.1.1.</span> <span class="toc-text">手动方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.2.1.2.</span> <span class="toc-text">自动方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">AOF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E4%B8%8B%E7%9A%84Redis%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.6.3.</span> <span class="toc-text">Docker下的Redis实现数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB-1"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF-1"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">AOF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%EF%BC%88%E9%80%82%E5%90%88%E4%B8%AD%E5%B0%8F%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">Redis主从复制（适合中小型系统）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="toc-number">1.7.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">1.7.2.</span> <span class="toc-text">简单实现数据同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%AE%B9%E7%81%BE%E5%A4%84%E7%90%86%EF%BC%88%E6%89%8B%E5%8A%A8%EF%BC%89"><span class="toc-number">1.7.3.</span> <span class="toc-text">主从复制的容灾处理（手动）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.7.4.</span> <span class="toc-text">哨兵模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-4"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%A0%B7%E4%BE%8B%E6%90%AD%E5%BB%BA"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">具体样例搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E4%B8%8BRedis%E5%AE%9E%E7%8E%B0%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.7.5.</span> <span class="toc-text">Docker下Redis实现哨兵模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-Cluster-%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.</span> <span class="toc-text">Redis Cluster 分片集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.8.1.</span> <span class="toc-text">相关概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-5"><span class="toc-number">1.8.2.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E4%B8%8B%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.3.</span> <span class="toc-text">Docker下简单实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%88%90%E5%90%8E%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.4.</span> <span class="toc-text">搭建完成后读写操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="toc-number">1.8.5.</span> <span class="toc-text">搭建完成后的故障转移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E6%89%A9%E5%AE%B9"><span class="toc-number">1.8.6.</span> <span class="toc-text">搭建完成后的扩容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E7%BC%A9%E5%AE%B9"><span class="toc-number">1.8.7.</span> <span class="toc-text">搭建完成后的缩容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88MySQL%E5%92%8CRedis%EF%BC%89"><span class="toc-number">1.9.</span> <span class="toc-text">Java连接数据库（MySQL和Redis）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.9.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis-API%E8%AE%BF%E9%97%AERedis"><span class="toc-number">1.9.2.</span> <span class="toc-text">Jedis API访问Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringDataRedis-API%E8%AE%BF%E9%97%AERedis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.9.3.</span> <span class="toc-text">SpringDataRedis API访问Redis集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E6%A1%86%E6%9E%B6"><span class="toc-number">1.9.4.</span> <span class="toc-text">MyBatis框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">简单学习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E4%BD%9C%E4%B8%BAMySQL%E7%BC%93%E5%AD%98%E5%BA%94%E7%94%A8"><span class="toc-number">1.9.5.</span> <span class="toc-text">Redis作为MySQL缓存应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">需要解决的一些问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">样例实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">压力测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB"><span class="toc-number">1.10.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.10.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C"><span class="toc-number">1.10.2.</span> <span class="toc-text">MongoDB简单操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">聚合查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.10.2.3.</span> <span class="toc-text">索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.10.3.</span> <span class="toc-text">MongoDB备份和恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86"><span class="toc-number">1.10.4.</span> <span class="toc-text">MongoDB复制集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-6"><span class="toc-number">1.10.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-number">1.10.4.2.</span> <span class="toc-text">搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E4%BB%B2%E8%A3%81%E8%8A%82%E7%82%B9"><span class="toc-number">1.10.4.3.</span> <span class="toc-text">加入仲裁节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4"><span class="toc-number">1.10.5.</span> <span class="toc-text">MongoDB分片集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-7"><span class="toc-number">1.10.5.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-1"><span class="toc-number">1.10.5.2.</span> <span class="toc-text">搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%A6%96%E5%85%88%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.5.2.1.</span> <span class="toc-text">1. 首先需要了解结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA3%E4%B8%AAConfig%E8%8A%82%E7%82%B9%E6%9E%84%E6%88%90%E7%9A%84%E5%89%AF%E6%9C%AC%E9%9B%86"><span class="toc-number">1.10.5.2.2.</span> <span class="toc-text">2. 搭建3个Config节点构成的副本集</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA2%E4%B8%AAshard%E9%9B%86%E7%BE%A4"><span class="toc-number">1.10.5.2.3.</span> <span class="toc-text">3. 创建2个shard集群</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA2%E4%B8%AAMongos%E8%8A%82%E7%82%B9"><span class="toc-number">1.10.5.2.4.</span> <span class="toc-text">4. 创建2个Mongos节点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.5.3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%90%AF%E7%94%A8%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4"><span class="toc-number">1.10.5.3.1.</span> <span class="toc-text">1. 启用分片集群</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%8C%87%E5%AE%9A%E5%88%86%E7%89%87%E9%94%AE%E5%92%8C%E5%88%86%E7%89%87%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.5.3.2.</span> <span class="toc-text">2. 指定分片键和分片策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%8F%92%E5%85%A5%E5%A4%9A%E6%9D%A1%E4%BF%A1%E6%81%AF%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.10.5.3.3.</span> <span class="toc-text">3. 插入多条信息并进行查看</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%9F%E6%9C%AB%E5%A4%A7%E4%BD%9C%E4%B8%9A%EF%BC%88%E4%B8%BB%E9%A2%98%E4%B8%80%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">期末大作业（主题一）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.11.1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E7%9B%B8%E5%85%B3"><span class="toc-number">1.11.2.</span> <span class="toc-text">MySQL相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BAMySQL%E5%AE%B9%E5%99%A8"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">1. 创建MySQL容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">2. 创建数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">1.11.3.</span> <span class="toc-text">Redis创建集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">1.11.3.1.</span> <span class="toc-text">1. 创建容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4"><span class="toc-number">1.11.3.2.</span> <span class="toc-text">2. 创建分片集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.3.3.</span> <span class="toc-text">3. 分片集群测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.4.</span> <span class="toc-text">系统功能模块的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">登录注册</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.11.4.1.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.4.1.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.11.4.2.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">1.11.4.2.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E9%A6%88"><span class="toc-number">1.11.4.3.</span> <span class="toc-text">反馈</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="toc-number">1.11.4.3.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-number">1.11.4.3.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E7%B1%8D%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.4.4.</span> <span class="toc-text">书籍信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="toc-number">1.11.4.4.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="toc-number">1.11.4.4.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%85%E8%AF%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.4.5.</span> <span class="toc-text">阅读信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="toc-number">1.11.4.5.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-4"><span class="toc-number">1.11.4.5.2.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/android%E7%9F%A5%E8%AF%86%E7%B2%BE%E5%8D%8E/" title="Android知识秘籍"><img src="https://smms.app/image/gw4uYQMBloWir5K" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android知识秘籍"/></a><div class="content"><a class="title" href="/2025/01/03/android%E7%9F%A5%E8%AF%86%E7%B2%BE%E5%8D%8E/" title="Android知识秘籍">Android知识秘籍</a><time datetime="2025-01-03T12:19:51.000Z" title="发表于 2025-01-03 20:19:51">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/" title="Android提问问答"><img src="https://smms.app/image/tPiv5zLXgsfGWmn" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android提问问答"/></a><div class="content"><a class="title" href="/2025/01/03/android%E6%8F%90%E9%97%AE200%E9%81%93/" title="Android提问问答">Android提问问答</a><time datetime="2025-01-03T12:19:12.000Z" title="发表于 2025-01-03 20:19:12">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/28/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/" title="程序员面试金典（Java代码）"><img src="https://pic.imgdb.cn/item/67487ddcd0e0a243d4da7860.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序员面试金典（Java代码）"/></a><div class="content"><a class="title" href="/2024/11/28/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/" title="程序员面试金典（Java代码）">程序员面试金典（Java代码）</a><time datetime="2024-11-28T14:54:00.000Z" title="发表于 2024-11-28 22:54:00">2024-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/18/23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+7%E7%A7%8D%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="7大设计原则+23种设计模式（Java代码版本）"><img src="https://pic.imgdb.cn/item/673b421bd29ded1a8cbbff29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7大设计原则+23种设计模式（Java代码版本）"/></a><div class="content"><a class="title" href="/2024/11/18/23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F+7%E7%A7%8D%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="7大设计原则+23种设计模式（Java代码版本）">7大设计原则+23种设计模式（Java代码版本）</a><time datetime="2024-11-18T07:54:00.000Z" title="发表于 2024-11-18 15:54:00">2024-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" title="代码随想录学习记录"><img src="https://s2.loli.net/2024/09/16/rdv2wuJ17ghb3Qj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代码随想录学习记录"/></a><div class="content"><a class="title" href="/2024/09/16/%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" title="代码随想录学习记录">代码随想录学习记录</a><time datetime="2024-09-16T07:54:00.000Z" title="发表于 2024-09-16 15:54:00">2024-09-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By 无泪真伤</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to my blog! --by Wuleizhenshang</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false#  open shake (抖動特效);
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>